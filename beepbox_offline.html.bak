<!DOCTYPE html>
<html lang="en">
<head>
	<link rel='shortcut icon' type='image/x-icon' href='./favicon.ico' />
	<!-- CDN for jQuery and select2 -->
	<script
	  src="https://code.jquery.com/jquery-3.4.1.min.js"
	  integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
	  crossorigin="anonymous"></script>
	<link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.7/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.7/js/select2.min.js"></script>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>JummBox</title>
	<meta name="application-name" content="JummBox" />
	<meta name="apple-mobile-web-app-title" content="JummBox">
	<meta name="description" content="JummBox is an online tool for sketching and sharing instrumental melodies." />
	<meta name="keywords" content="chiptune, instrumental, music, melody, composition, tool, square wave, NES, NSF, JummBox, jummbox, BeepBox, beepbox" />
	<meta name="mobile-web-app-capable" content="yes" />
	<meta name="apple-mobile-web-app-capable" content="yes" />
	<meta name="apple-mobile-web-app-status-bar-style" content="black" />
	<meta name="theme-color" content="#444" />
	<meta name="msapplication-TileColor" content="#603cba" />
	<meta name="msapplication-config" content="/browserconfig.xml" />
	<meta name="format-detection" content="telephone=no" />
	<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
	<link rel="icon" type="image/png" sizes="32x32" href="/icon_32.png" />
	<link rel="manifest" href="/manifest.webmanifest" />
	<link href="https://fonts.googleapis.com/css?family=B612" rel="stylesheet" rel="stylesheet" media="none" onload="if (this.media != 'all') this.media='all';" /> <!-- this is a trick to load CSS asynchronously. -->
	<style type="text/css">
		body {
			margin: auto;
			background: #040410;
			font-family: 'B612', sans-serif;
			font-size: large;
			line-height: 1.3;
			color: #fff;
		}
		h1 {
			font-size: 30px;
			text-align: center;
		}
		.centerDiv {
			margin: 0px auto;
		}
		a {
			color: #98f;
		}
		.donation form {
			display: inline;
		}
		.donation input[type="submit"] {
			-webkit-appearance: none;
			appearance: none;
			background: none;
			border: none;
			font-family: inherit;
			font-size: inherit;
			color: #98f;
			text-decoration: underline;
			cursor: pointer;
			padding: 0;
			margin: 0;
		}
		#beepboxEditorContainer {
			min-height: 645px;
		}
		
		/* wide screen */
		@media (min-width: 701px) {
			body {
				width: 700px;
			}
			.column-container {
				display: flex;
				justify-content: space-between;
			}
		}
		
		/* narrow screen */
		@media (max-width: 700px) {
			body {
				width: 100vw;
			}
			p, .donation {
				margin: 1em 0.5em;
			}
			.column-container {
				display: flex;
				flex-direction: column;
				align-items: center;
			}
		}
	</style>
</head>

<body>
	<br>
	<div id="beepboxEditorContainer"></div>
	
	<h1>
		<font color="#9c64f7">JummBox Offline</font>
		<div id="jummboxPlant" style="display: inline; color:#62a13b"></div>
	</h1>
	<p id="introduction">
		This is an online (and offline!) tool for sketching and sharing chiptune melodies.<br>
		It is a modification of the <a href="https://www.beepbox.co/">original BeepBox</a> by John Nesky.
	</p>
	<p>
		If you're familiar with BeepBox and just want to learn what JummBox does differently, check out this <a href="https://youtu.be/26yDP4ACuzE">overview video</a>.
	</p>
	<p>
		All song data is packaged into the URL at the top of your browser. 
		When you make changes to the song, the URL is updated to reflect your changes. 
		When you are satisfied with your song, just copy and paste the URL to save and share your song! 
	</p>
	<!--
    <div class="donation">
		BeepBox is a passion project, and will always be free to use. If you find it valuable and have the means, any gratuity via
		<form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_blank">
			<input type="hidden" name="cmd" value="_donations" />
			<input type="hidden" name="business" value="QZJTX9GRYEV9N" />
			<input type="hidden" name="currency_code" value="USD" />
			<input type="submit" name="submit" value="Paypal"/>
		</form>
		would be appreciated!
    </div>
	-->
	
	<div class="column-container">
		<div class="instructions-column">
			<h1>
				Instructions
			</h1>
			<p>
				You can add or remove notes by clicking on the gray rows at the top. 
				JummBox automatically plays the notes out loud for you. Try it!
			</p>
			<p>
				Notes go into patterns, and you can edit one pattern at a time.
				Those numbered boxes at the bottom of the editor are the different patterns you can edit.
				<span id="bar-editing">
					Click the other boxes to move to a different part of the song, or click the arrows on the currently selected box to swap which pattern is played during that part of the song.
				</span>
			</p>
			<p>
				JummBox can play several rows of patterns simultaneously, and each row has its own set of patterns. 
				Most rows can play melodies or harmonies, but the bottom row is for drums.
			</p>
			<p>
				The purple loop underneath the numbered boxes controls which part of the song is currently repeating. 
				Move the loop to listen to a different part of the song, or drag the ends to expand the loop to include the whole song. 
			</p>
			<div id="keyboard-instructions">
				<p>
					When JummBox has focus (click on its interface above), you can use these keyboard shortcuts: <br/>
				</p>
				<ul>
					<li>Spacebar: play or pause the song</li>
					<li>Z: undo</li>
					<li>Y or Shift Z: redo</li>
					<li>C: copy pattern from selection</li>
					<li>V: paste pattern into selection</li>
					<li>0-9: assign a pattern number to selection</li>
					<li>Arrows: move selection</li>
					<li>[ ]: Move the playhead backward and forward</li>
					<li>Shift 0-9: reassign the instrument for the currently selected pattern </li>
					<li>- +: move the notes in the pattern up or down (and hold Shift to move an octave at a time!)</li>
					<li>A: Select all patterns</li>
					<li>Shift A: Select current channel</li>
					<li>Enter: insert a bar</li>
					<li>Backspace: delete a bar</li>
					<li>F: move playhead to the <b>F</b>irst bar in the song</li>
					<li>H: move playhead to the selected bar (<b>H</b>ere)</li>
					<li>M: <b>M</b>ute/unmute current channel</li>
					<li>Shift M: <b>M</b>ute/unmute all channels
					<li>S: <b>S</b>olo current channel</li>	
					<li>N: set pattern to the lowest-numbered one not used anywhere in the song (This can help you find gaps in patterns that you missed).</li>
					<li>Shift N: set pattern to the lowest-numbered one that is completely empty.</li>
				</ul>
			</div>
			<p>
				In the note pattern editor, you can click and drag horizontally on a note to adjust its duration.
				You can also click above or below an existing note to add more notes to be played simultaneously, which is called a chord. 
			</p>
			<p>
				ADVANCED: Drag vertically from an existing note to bend its pitch, or drag vertically from above or below the note to adjust its volume. You can perform fine volume adjustment if you hold Control while doing this!
			</p>
			<p>
				ADVANCED: Click and drag on the pattern grid to make a selection. You can then press C/V to mass copy/paste parts of your song.

			</p>
			<p>
				JummBox has many more features. 
				Try playing with the buttons and menus on the right side to find out what it can do!
				You can also click on the label next to each option for a description of what it does.
			</p>
			<p>
				<a href="https://twitter.com/beepboxco">Check out some of these songs that other people have posted on Twitter!</a>
				If you find something you like, you should let the creator know!
				And if you see any beginners asking for advice, maybe you can help them!
			</p>
			<h1>
				About
			</h1>
			<p>
				JummBox is developed by Jummbus. You can find him sporadically at <a href="https://twitter.com/jummbus">twitter.com/jummbus</a>.<br><br>
				BeepBox was originally developed by <a href="http://www.johnnesky.com">John Nesky</a>, also known as <a href="https://twitter.com/shaktool">@shaktool</a>. 
			</p>
			<p>
				JummBox does not claim ownership over songs created with it, so original songs belong to their authors. 
			</p>
			<p>
				Neither Jummbus nor Jummbox assume responsibility for any copyrighted material played on JummBox. No songs are ever received, recorded, or distributed by JummBox's servers. All song data is contained in the URL after the hash (#) mark, and JummBox running inside your browser converts that data into sound waves.
			</p>
			<!-- Hmm, maybe offline some day.
			<p>
				You can download <a download="beepbox_offline.html" href="beepbox_offline.html">an offline version of JummBox</a> to use when you don't have access to the internet. The features are otherwise the same.
			</p>
			-->
			<p>
				You can download and use <a href="https://github.com/jummbus/jummbox">the source code</a> under the MIT license.
				The original BeepBox source code by John Nesky can be found <a href="https://github.com/johnnesky/beepbox">here</a>.
			</p>
		</div>
	</div>

	<script type="text/javascript">

		// Randomize display of header
		// 1-in-10
		if ( Math.floor( Math.random() * 10 ) == 0 ) {
			switch ( Math.floor( Math.random() * 5 ) ) {
				case 0:
					document.getElementById("jummboxPlant").innerHTML = "  üçÇ";
					break;
				case 1:
					document.getElementById("jummboxPlant").innerHTML = "  üåø";
					break;
				case 2:
					document.getElementById("jummboxPlant").innerHTML = "  üå∫";
					break;
				case 3:
					document.getElementById("jummboxPlant").innerHTML = "  üçÉ";
					break;
				case 4:
					document.getElementById("jummboxPlant").style.color = "#66ccff";
					document.getElementById("jummboxPlant").innerHTML = "  ‚ùÑ";
					break;
			}
		}
		
		if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|android|ipad|playbook|silk/i.test(navigator.userAgent) ) {
			document.getElementById("introduction").innerHTML = "JummBox is an online tool for sketching and sharing chiptune melodies. Make sure that your volume is turned up, then press the play button!";
	document.getElementById("keyboard-instructions").style.display = "none";
	document.getElementById("bar-editing").innerHTML = "Tap the other boxes to move to a different part of the song, or tap on the currently selected box to swap which pattern is played during that part of the song.";
		}
		
		function browserHasRequiredFeatures() {
			"use strict";
			if (window.AudioContext == undefined && window.webkitAudioContext == undefined) {
				return false;
			}
			
			try {
				eval("class T {}");
				eval("const a = () => 0");
				eval("for (const a of []);");
			} catch (error) {
				return false;
			}
			
			return true;
		}
		
		if (browserHasRequiredFeatures()) {
			// Go ahead and load js beepbox editor interface:
			var fileref = document.createElement("script");
			fileref.setAttribute("type", "text/javascript");
			fileref.setAttribute("src", "beepbox_editor.min.js");
			document.head.appendChild(fileref);
		} else {
			document.getElementById("beepboxEditorContainer").innerHTML = "Sorry, JummBox doesn't support your browser. Try a recent version of Chrome, Firefox, Edge, Safari, or Opera.";
		}

var beepbox;!function(t){class e{}function i(t){let e=0;for(let i=0;i<t.length;i++)e+=t[i];const i=e/t.length;let s=0,n=0;for(let e=0;e<t.length;e++)s+=n,n=t[e]-i,t[e]=s;return t.push(0),new Float64Array(t)}function s(t){let e=0,i=0;for(let s=0;s<t.length;s++)e+=t[s],i+=Math.abs(t[s]);const s=e/t.length,n=i/t.length;let o=0,h=0;for(let e=0;e<t.length;e++)o+=h,h=(t[e]-s)/n,t[e]=o;return t.push(0),new Float64Array(t)}function n(i){let s=e.chipNoises[i].samples;if(null==s){if(s=new Float32Array(e.chipNoiseLength+1),e.chipNoises[i].samples=s,0==i){let t=1;for(let i=0;i<e.chipNoiseLength;i++){s[i]=2*(1&t)-1;let e=t>>1;1==(t+e&1)&&(e+=16384),t=e}}else if(1==i)for(let t=0;t<e.chipNoiseLength;t++)s[t]=2*Math.random()-1;else if(2==i){let t=1;for(let i=0;i<e.chipNoiseLength;i++){s[i]=2*(1&t)-1;let e=t>>1;1==(t+e&1)&&(e+=32768),t=e}}else if(3==i){let t=1;for(let i=0;i<e.chipNoiseLength;i++){s[i]=2*(1&t)-1;let e=t>>1;1==(t+e&1)&&(e+=40),t=e}}else if(4==i)o(s,10,11,1,1,0),o(s,11,14,.6578,.6578,0),t.inverseRealFourierTransform(s,e.chipNoiseLength),t.scaleElementsByFactor(s,1/Math.sqrt(e.chipNoiseLength));else if(5==i)for(var n=1,h=0;h<e.chipNoiseLength;h++){s[h]=2*(1&n)-1,1==(n+(r=n>>1)&1)&&(r+=40),n=r}else if(6==i)o(s,1,10,1,1,0),o(s,20,14,-2,-2,0),t.inverseRealFourierTransform(s,e.chipNoiseLength),t.scaleElementsByFactor(s,1/Math.sqrt(e.chipNoiseLength));else if(7==i)for(n=1,h=0;h<e.chipNoiseLength;h++){s[h]=4*(1&n)*(14*Math.random()+1),1==(n+(r=n>>1)&1)&&(r+=60),n=r}else{if(8!=i)throw new Error("Unrecognized drum index: "+i);for(n=1,h=0;h<32768;h++){var r;s[h]=(1&n)/2+.5,1==(n+(r=n>>1)&1)&&(r-=40),n=r}}s[e.chipNoiseLength]=s[0]}return s}function o(t,i,s,o,h,r){const a=0|Math.pow(2,i),l=Math.min(e.chipNoiseLength>>1,0|Math.pow(2,s)),c=n(0);let f=0;for(let n=a;n<l;n++){let a=o+(h-o)*(Math.log(n)/Math.LN2-i)/(s-i),l=Math.pow(2,(a-1)*e.spectrumMax+1)*a;f+=l*=Math.pow(n/2048,r),l*=c[n];const d=.61803398875*n*n*Math.PI*2;t[n]=Math.cos(d)*l,t[e.chipNoiseLength-n]=Math.sin(d)*l}return f}function h(t){const e={};for(let i=0;i<t.length;i++){const s=t[i];s.index=i,e[s.name]=s}const i=t;return i.dictionary=e,i}e.thresholdVal=-10,e.kneeVal=40,e.ratioVal=12,e.attackVal=0,e.releaseVal=.25,e.versionDisplayName="JummBox 1.2",e.scales=h([{name:"Free",flags:[!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0]},{name:"Major",flags:[!0,!1,!0,!1,!0,!0,!1,!0,!1,!0,!1,!0]},{name:"Minor",flags:[!0,!1,!0,!0,!1,!0,!1,!0,!0,!1,!0,!1]},{name:"Mixolydian",flags:[!0,!1,!0,!1,!0,!0,!1,!0,!1,!0,!0,!1]},{name:"Lydian",flags:[!0,!1,!0,!1,!0,!1,!0,!0,!1,!0,!1,!0]},{name:"Dorian",flags:[!0,!1,!0,!0,!1,!0,!1,!0,!1,!0,!0,!1]},{name:"Phrygian",flags:[!0,!0,!1,!0,!1,!0,!1,!0,!0,!1,!0,!1]},{name:"Locrian",flags:[!0,!0,!1,!0,!1,!0,!0,!1,!0,!1,!0,!1]},{name:"Lydian Dominant",flags:[!0,!1,!0,!1,!0,!1,!0,!0,!1,!0,!0,!1]},{name:"Phrygian Dominant",flags:[!0,!0,!1,!1,!0,!0,!1,!0,!0,!1,!0,!1]},{name:"Harmonic Major",flags:[!0,!1,!0,!1,!0,!0,!1,!0,!0,!1,!1,!0]},{name:"Harmonic Minor",flags:[!0,!1,!0,!0,!1,!0,!1,!0,!0,!1,!1,!0]},{name:"Melodic Minor",flags:[!0,!1,!0,!0,!1,!0,!1,!0,!1,!0,!1,!0]},{name:"Blues",flags:[!0,!1,!1,!0,!1,!0,!0,!0,!1,!1,!0,!1]},{name:"Altered",flags:[!0,!0,!1,!0,!0,!1,!0,!1,!0,!1,!0,!1]},{name:"Major Pentatonic",flags:[!0,!1,!0,!1,!0,!1,!1,!0,!1,!0,!1,!1]},{name:"Minor Pentatonic",flags:[!0,!1,!1,!0,!1,!0,!1,!0,!1,!1,!0,!1]},{name:"Whole Tone",flags:[!0,!1,!0,!1,!0,!1,!0,!1,!0,!1,!0,!1]},{name:"Octatonic",flags:[!0,!1,!0,!0,!1,!0,!0,!1,!0,!0,!1,!0]},{name:"Hexatonic",flags:[!0,!1,!1,!0,!0,!1,!1,!0,!0,!1,!1,!0]}]),e.keys=h([{name:"C",isWhiteKey:!0,basePitch:12},{name:"C‚ôØ",isWhiteKey:!1,basePitch:13},{name:"D",isWhiteKey:!0,basePitch:14},{name:"D‚ôØ",isWhiteKey:!1,basePitch:15},{name:"E",isWhiteKey:!0,basePitch:16},{name:"F",isWhiteKey:!0,basePitch:17},{name:"F‚ôØ",isWhiteKey:!1,basePitch:18},{name:"G",isWhiteKey:!0,basePitch:19},{name:"G‚ôØ",isWhiteKey:!1,basePitch:20},{name:"A",isWhiteKey:!0,basePitch:21},{name:"A‚ôØ",isWhiteKey:!1,basePitch:22},{name:"B",isWhiteKey:!0,basePitch:23}]),e.blackKeyNameParents=[-1,1,-1,1,-1,1,-1,-1,1,-1,1,-1],e.tempoMin=30,e.tempoMax=320,e.reverbRange=32,e.beatsPerBarMin=3,e.beatsPerBarMax=16,e.barCountMin=1,e.barCountMax=256,e.instrumentsPerChannelMin=1,e.instrumentsPerChannelMax=10,e.partsPerBeat=24,e.ticksPerPart=2,e.rhythms=h([{name:"√∑3 (triplets)",stepsPerBeat:3,ticksPerArpeggio:4,arpeggioPatterns:[[0],[0,0,1,1],[0,1,2,1],[0,1,2,3]],roundUpThresholds:[5,12,18]},{name:"√∑4 (standard)",stepsPerBeat:4,ticksPerArpeggio:3,arpeggioPatterns:[[0],[0,0,1,1],[0,1,2,1],[0,1,2,3]],roundUpThresholds:[3,9,17,21]},{name:"√∑6",stepsPerBeat:6,ticksPerArpeggio:4,arpeggioPatterns:[[0],[0,1],[0,1,2,1],[0,1,2,3]],roundUpThresholds:null},{name:"√∑8",stepsPerBeat:8,ticksPerArpeggio:3,arpeggioPatterns:[[0],[0,1],[0,1,2,1],[0,1,2,3]],roundUpThresholds:null},{name:"freehand",stepsPerBeat:24,ticksPerArpeggio:3,arpeggioPatterns:[[0],[0,1],[0,1,2,1],[0,1,2,3]],roundUpThresholds:null}]),e.instrumentTypeNames=["chip","FM","noise","spectrum","drumset","harmonics","PWM","custom chip"],e.instrumentTypeHasSpecialInterval=[!0,!0,!1,!1,!1,!0,!1,!0],e.instrumentTypeHasChorus=[!0,!0,!0,!1,!1,!0,!0,!0],e.chipWaves=h([{name:"rounded",volume:.94,samples:i([0,.2,.4,.5,.6,.7,.8,.85,.9,.95,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,.95,.9,.85,.8,.7,.6,.5,.4,.2,0,-.2,-.4,-.5,-.6,-.7,-.8,-.85,-.9,-.95,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-.95,-.9,-.85,-.8,-.7,-.6,-.5,-.4,-.2])},{name:"triangle",volume:1,samples:i([1/15,.2,5/15,7/15,.6,11/15,13/15,1,1,13/15,11/15,.6,7/15,5/15,.2,1/15,-1/15,-.2,-5/15,-7/15,-.6,-11/15,-13/15,-1,-1,-13/15,-11/15,-.6,-7/15,-5/15,-.2,-1/15])},{name:"square",volume:.5,samples:i([1,-1])},{name:"1/4 pulse",volume:.5,samples:i([1,-1,-1,-1])},{name:"1/8 pulse",volume:.5,samples:i([1,-1,-1,-1,-1,-1,-1,-1])},{name:"sawtooth",volume:.65,samples:i([1/31,3/31,5/31,7/31,9/31,11/31,13/31,15/31,17/31,19/31,21/31,23/31,25/31,27/31,29/31,1,-1,-29/31,-27/31,-25/31,-23/31,-21/31,-19/31,-17/31,-15/31,-13/31,-11/31,-9/31,-7/31,-5/31,-3/31,-1/31])},{name:"double saw",volume:.5,samples:i([0,-.2,-.4,-.6,-.8,-1,1,-.8,-.6,-.4,-.2,1,.8,.6,.4,.2])},{name:"double pulse",volume:.4,samples:i([1,1,1,1,1,-1,-1,-1,1,1,1,1,-1,-1,-1,-1])},{name:"spiky",volume:.4,samples:i([1,-1,1,-1,1,0])},{name:"sine",volume:.88,samples:s([8,9,11,12,13,14,15,15,15,15,14,14,13,11,10,9,7,6,4,3,2,1,0,0,0,0,1,1,2,4,5,6])},{name:"flute",volume:.8,samples:s([3,4,6,8,10,11,13,14,15,15,14,13,11,8,5,3])},{name:"harp",volume:.8,samples:s([0,3,3,3,4,5,5,6,7,8,9,11,11,13,13,15,15,14,12,11,10,9,8,7,7,5,4,3,2,1,0,0])},{name:"sharp clarinet",volume:.38,samples:s([0,0,0,1,1,8,8,9,9,9,8,8,8,8,8,9,9,7,9,9,10,4,0,0,0,0,0,0,0,0,0,0])},{name:"soft clarinet",volume:.45,samples:s([0,1,5,8,9,9,9,9,9,9,9,11,11,12,13,12,10,9,7,6,4,3,3,3,1,1,1,1,1,1,1,1])},{name:"alto sax",volume:.3,samples:s([5,5,6,4,3,6,8,7,2,1,5,6,5,4,5,7,9,11,13,14,14,14,14,13,10,8,7,7,4,3,4,2])},{name:"bassoon",volume:.35,samples:s([9,9,7,6,5,4,4,4,4,5,7,8,9,10,11,13,13,11,10,9,7,6,4,2,1,1,1,2,2,5,11,14])},{name:"trumpet",volume:.22,samples:s([10,11,8,6,5,5,5,6,7,7,7,7,6,6,7,7,7,7,7,6,6,6,6,6,6,6,6,7,8,9,11,14])},{name:"electric guitar",volume:.2,samples:s([11,12,12,10,6,6,8,0,2,4,8,10,9,10,1,7,11,3,6,6,8,13,14,2,0,12,8,4,13,11,10,13])},{name:"organ",volume:.2,samples:s([11,10,12,11,14,7,5,5,12,10,10,9,12,6,4,5,13,12,12,10,12,5,2,2,8,6,6,5,8,3,2,1])},{name:"pan flute",volume:.35,samples:s([1,4,7,6,7,9,7,7,11,12,13,15,13,11,11,12,13,10,7,5,3,6,10,7,3,3,1,0,1,0,1,0])}]),e.chipNoises=h([{name:"retro",volume:.25,basePitch:69,pitchFilterMult:1024,isSoft:!1,samples:null},{name:"white",volume:1,basePitch:69,pitchFilterMult:8,isSoft:!0,samples:null},{name:"clang",volume:.4,basePitch:69,pitchFilterMult:1024,isSoft:!1,samples:null},{name:"buzz",volume:.3,basePitch:69,pitchFilterMult:1024,isSoft:!1,samples:null},{name:"hollow",volume:1.5,basePitch:96,pitchFilterMult:1,isSoft:!0,samples:null},{name:"shine",volume:1,basePitch:69,pitchFilterMult:1024,isSoft:!1,samples:null},{name:"deep",volume:1.5,basePitch:120,pitchFilterMult:1024,isSoft:!0,samples:null},{name:"cutter",volume:.005,basePitch:96,pitchFilterMult:1024,isSoft:!1,samples:null},{name:"metallic",volume:1,basePitch:96,pitchFilterMult:1024,isSoft:!1,samples:null}]),e.filterCutoffMaxHz=8e3,e.filterCutoffMinHz=1,e.filterMax=.95,e.filterMaxResonance=.95,e.filterCutoffRange=11,e.filterResonanceRange=8,e.transitions=h([{name:"seamless",isSeamless:!0,attackSeconds:0,releases:!1,releaseTicks:1,slides:!1,slideTicks:3},{name:"hard",isSeamless:!1,attackSeconds:0,releases:!1,releaseTicks:3,slides:!1,slideTicks:3},{name:"soft",isSeamless:!1,attackSeconds:.025,releases:!1,releaseTicks:3,slides:!1,slideTicks:3},{name:"slide",isSeamless:!0,attackSeconds:.025,releases:!1,releaseTicks:3,slides:!0,slideTicks:3},{name:"cross fade",isSeamless:!1,attackSeconds:.04,releases:!0,releaseTicks:6,slides:!1,slideTicks:3},{name:"hard fade",isSeamless:!1,attackSeconds:0,releases:!0,releaseTicks:48,slides:!1,slideTicks:3},{name:"medium fade",isSeamless:!1,attackSeconds:.0125,releases:!0,releaseTicks:72,slides:!1,slideTicks:3},{name:"soft fade",isSeamless:!1,attackSeconds:.06,releases:!0,releaseTicks:96,slides:!1,slideTicks:6}]),e.vibratos=h([{name:"none",amplitude:0,periodsSeconds:[.14],delayParts:0},{name:"light",amplitude:.15,periodsSeconds:[.14],delayParts:0},{name:"delayed",amplitude:.3,periodsSeconds:[.14],delayParts:18},{name:"heavy",amplitude:.45,periodsSeconds:[.14],delayParts:0},{name:"shaky",amplitude:.1,periodsSeconds:[.11,.17798,.33],delayParts:0}]),e.intervals=h([{name:"union",spread:0,offset:0,volume:.7,sign:1},{name:"shimmer",spread:.016,offset:0,volume:.8,sign:1},{name:"hum",spread:.045,offset:0,volume:1,sign:1},{name:"honky tonk",spread:.09,offset:0,volume:1,sign:1},{name:"dissonant",spread:.25,offset:0,volume:.9,sign:1},{name:"fifth",spread:3.5,offset:3.5,volume:.9,sign:1},{name:"octave",spread:6,offset:6,volume:.8,sign:1},{name:"bowed",spread:.02,offset:0,volume:1,sign:-1}]),e.effectsNames=["none","reverb","chorus","chorus & reverb"],e.volumeRange=50,e.volumeLogScale=.1428,e.panCenter=50,e.panMax=2*e.panCenter,e.chords=h([{name:"harmony",harmonizes:!0,customInterval:!1,arpeggiates:!1,isCustomInterval:!1,strumParts:0},{name:"strum",harmonizes:!0,customInterval:!1,arpeggiates:!1,isCustomInterval:!1,strumParts:1},{name:"arpeggio",harmonizes:!1,customInterval:!1,arpeggiates:!0,isCustomInterval:!1,strumParts:0},{name:"custom interval",harmonizes:!0,customInterval:!0,arpeggiates:!0,isCustomInterval:!0,strumParts:0}]),e.operatorCount=4,e.algorithms=h([{name:"1‚Üê(2‚ÄÇ3‚ÄÇ4)",carrierCount:1,associatedCarrier:[1,1,1,1],modulatedBy:[[2,3,4],[],[],[]]},{name:"1‚Üê(2‚ÄÇ3‚Üê4)",carrierCount:1,associatedCarrier:[1,1,1,1],modulatedBy:[[2,3],[],[4],[]]},{name:"1‚Üê2‚Üê(3‚ÄÇ4)",carrierCount:1,associatedCarrier:[1,1,1,1],modulatedBy:[[2],[3,4],[],[]]},{name:"1‚Üê(2‚ÄÇ3)‚Üê4",carrierCount:1,associatedCarrier:[1,1,1,1],modulatedBy:[[2,3],[4],[4],[]]},{name:"1‚Üê2‚Üê3‚Üê4",carrierCount:1,associatedCarrier:[1,1,1,1],modulatedBy:[[2],[3],[4],[]]},{name:"1‚Üê3‚ÄÉ2‚Üê4",carrierCount:2,associatedCarrier:[1,2,1,2],modulatedBy:[[3],[4],[],[]]},{name:"1‚ÄÉ2‚Üê(3‚ÄÇ4)",carrierCount:2,associatedCarrier:[1,2,2,2],modulatedBy:[[],[3,4],[],[]]},{name:"1‚ÄÉ2‚Üê3‚Üê4",carrierCount:2,associatedCarrier:[1,2,2,2],modulatedBy:[[],[3],[4],[]]},{name:"(1‚ÄÇ2)‚Üê3‚Üê4",carrierCount:2,associatedCarrier:[1,2,2,2],modulatedBy:[[3],[3],[4],[]]},{name:"(1‚ÄÇ2)‚Üê(3‚ÄÇ4)",carrierCount:2,associatedCarrier:[1,2,2,2],modulatedBy:[[3,4],[3,4],[],[]]},{name:"1‚ÄÉ2‚ÄÉ3‚Üê4",carrierCount:3,associatedCarrier:[1,2,3,3],modulatedBy:[[],[],[4],[]]},{name:"(1‚ÄÇ2‚ÄÇ3)‚Üê4",carrierCount:3,associatedCarrier:[1,2,3,3],modulatedBy:[[4],[4],[4],[]]},{name:"1‚ÄÉ2‚ÄÉ3‚ÄÉ4",carrierCount:4,associatedCarrier:[1,2,3,4],modulatedBy:[[],[],[],[]]}]),e.operatorCarrierInterval=[0,.04,-.073,.091],e.operatorAmplitudeMax=15,e.operatorFrequencies=h([{name:"1√ó",mult:1,hzOffset:0,amplitudeSign:1},{name:"~1√ó",mult:1,hzOffset:1.5,amplitudeSign:-1},{name:"2√ó",mult:2,hzOffset:0,amplitudeSign:1},{name:"~2√ó",mult:2,hzOffset:-1.3,amplitudeSign:-1},{name:"3√ó",mult:3,hzOffset:0,amplitudeSign:1},{name:"4√ó",mult:4,hzOffset:0,amplitudeSign:1},{name:"5√ó",mult:5,hzOffset:0,amplitudeSign:1},{name:"6√ó",mult:6,hzOffset:0,amplitudeSign:1},{name:"7√ó",mult:7,hzOffset:0,amplitudeSign:1},{name:"8√ó",mult:8,hzOffset:0,amplitudeSign:1},{name:"9√ó",mult:9,hzOffset:0,amplitudeSign:1},{name:"11√ó",mult:11,hzOffset:0,amplitudeSign:1},{name:"13√ó",mult:13,hzOffset:0,amplitudeSign:1},{name:"16√ó",mult:16,hzOffset:0,amplitudeSign:1},{name:"20√ó",mult:20,hzOffset:0,amplitudeSign:1}]),e.envelopes=h([{name:"custom",type:0,speed:0},{name:"steady",type:1,speed:0},{name:"punch",type:2,speed:0},{name:"flare 1",type:3,speed:32},{name:"flare 2",type:3,speed:8},{name:"flare 3",type:3,speed:2},{name:"twang 1",type:4,speed:32},{name:"twang 2",type:4,speed:8},{name:"twang 3",type:4,speed:2},{name:"swell 1",type:5,speed:32},{name:"swell 2",type:5,speed:8},{name:"swell 3",type:5,speed:2},{name:"tremolo1",type:6,speed:4},{name:"tremolo2",type:6,speed:2},{name:"tremolo3",type:6,speed:1},{name:"tremolo4",type:7,speed:4},{name:"tremolo5",type:7,speed:2},{name:"tremolo6",type:7,speed:1},{name:"decay 1",type:8,speed:10},{name:"decay 2",type:8,speed:7},{name:"decay 3",type:8,speed:4}]),e.feedbacks=h([{name:"1‚ü≤",indices:[[1],[],[],[]]},{name:"2‚ü≤",indices:[[],[2],[],[]]},{name:"3‚ü≤",indices:[[],[],[3],[]]},{name:"4‚ü≤",indices:[[],[],[],[4]]},{name:"1‚ü≤‚ÄÉ2‚ü≤",indices:[[1],[2],[],[]]},{name:"3‚ü≤‚ÄÉ4‚ü≤",indices:[[],[],[3],[4]]},{name:"1‚ü≤‚ÄÉ2‚ü≤‚ÄÉ3‚ü≤",indices:[[1],[2],[3],[]]},{name:"2‚ü≤‚ÄÉ3‚ü≤‚ÄÉ4‚ü≤",indices:[[],[2],[3],[4]]},{name:"1‚ü≤ 2‚ü≤ 3‚ü≤ 4‚ü≤",indices:[[1],[2],[3],[4]]},{name:"1‚Üí2",indices:[[],[1],[],[]]},{name:"1‚Üí3",indices:[[],[],[1],[]]},{name:"1‚Üí4",indices:[[],[],[],[1]]},{name:"2‚Üí3",indices:[[],[],[2],[]]},{name:"2‚Üí4",indices:[[],[],[],[2]]},{name:"3‚Üí4",indices:[[],[],[],[3]]},{name:"1‚Üí3‚ÄÉ2‚Üí4",indices:[[],[],[1],[2]]},{name:"1‚Üí4‚ÄÉ2‚Üí3",indices:[[],[],[2],[1]]},{name:"1‚Üí2‚Üí3‚Üí4",indices:[[],[1],[2],[3]]}]),e.chipNoiseLength=32768,e.spectrumBasePitch=24,e.spectrumControlPoints=30,e.spectrumControlPointsPerOctave=7,e.spectrumControlPointBits=3,e.spectrumMax=(1<<e.spectrumControlPointBits)-1,e.harmonicsControlPoints=28,e.harmonicsRendered=64,e.harmonicsControlPointBits=3,e.harmonicsMax=(1<<e.harmonicsControlPointBits)-1,e.harmonicsWavelength=2048,e.pulseWidthRange=50,e.pitchChannelCountMin=1,e.pitchChannelCountMax=40,e.noiseChannelCountMin=0,e.noiseChannelCountMax=8,e.noiseInterval=6,e.drumCount=12,e.pitchOctaves=7,e.windowOctaves=3,e.scrollableOctaves=e.pitchOctaves-e.windowOctaves,e.windowPitchCount=12*e.windowOctaves+1,e.maxPitch=12*e.pitchOctaves,e.maximumTonesPerChannel=8,e.sineWaveLength=256,e.sineWaveMask=e.sineWaveLength-1,e.sineWave=function(){const t=new Float64Array(e.sineWaveLength+1);for(let i=0;i<e.sineWaveLength+1;i++)t[i]=Math.sin(i*Math.PI*2/e.sineWaveLength);return t}(),e.barEditorHeight=10,t.Config=e,t.getDrumWave=n,t.drawNoiseSpectrum=o,t.toNameMap=h}(beepbox||(beepbox={})),function(t){t.isMobile=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|android|ipad|playbook|silk/i.test(navigator.userAgent);class e{static valueToPreset(t){const i=t>>6,s=63&t;return e.presetCategories[i].presets[s]}static midiProgramToPresetValue(t){for(let i=0;i<e.presetCategories.length;i++){const s=e.presetCategories[i];for(let e=0;e<s.presets.length;e++){const n=s.presets[e];if(n.generalMidi&&n.midiProgram==t)return(i<<6)+e}}return null}static nameToPresetValue(t){for(let i=0;i<e.presetCategories.length;i++){const s=e.presetCategories[i];for(let e=0;e<s.presets.length;e++){if(s.presets[e].name==t)return(i<<6)+e}}return null}}e.versionDisplayName="Jummbox 1.3",e.presetCategories=t.toNameMap([{name:"Custom Instruments",presets:t.toNameMap([{name:"chip wave",customType:0},{name:"FM (expert)",customType:1},{name:"basic noise",customType:2},{name:"spectrum",customType:3},{name:"drumset",customType:4},{name:"harmonics",customType:5},{name:"pulse width",customType:6},{name:"custom chip",customType:7}])},{name:"Retro Presets",presets:t.toNameMap([{name:"square wave",midiProgram:80,settings:{type:"chip",transition:"seamless",effects:"none",chord:"arpeggio",filterCutoffHz:4e3,filterResonance:0,filterEnvelope:"steady",wave:"square",interval:"union",vibrato:"none"}},{name:"triangle wave",midiProgram:71,settings:{type:"chip",transition:"seamless",effects:"none",chord:"arpeggio",filterCutoffHz:4e3,filterResonance:0,filterEnvelope:"steady",wave:"triangle",interval:"union",vibrato:"none"}},{name:"square lead",midiProgram:80,generalMidi:!0,settings:{type:"chip",transition:"hard",effects:"reverb",chord:"harmony",filterCutoffHz:2828,filterResonance:14,filterEnvelope:"steady",wave:"square",interval:"hum",vibrato:"none"}},{name:"sawtooth lead 1",midiProgram:81,generalMidi:!0,settings:{type:"chip",transition:"hard",effects:"reverb",chord:"harmony",filterCutoffHz:2828,filterResonance:14,filterEnvelope:"steady",wave:"sawtooth",interval:"shimmer",vibrato:"none"}},{name:"sawtooth lead 2",midiProgram:81,settings:{type:"chip",effects:"reverb",transition:"medium fade",chord:"harmony",filterCutoffHz:5657,filterResonance:29,filterEnvelope:"steady",wave:"sawtooth",interval:"hum",vibrato:"light"}},{name:"chip noise",midiProgram:116,isNoise:!0,settings:{type:"noise",transition:"hard",effects:"none",chord:"arpeggio",filterCutoffHz:4e3,filterResonance:0,filterEnvelope:"steady",wave:"retro"}},{name:"FM twang",midiProgram:32,settings:{type:"FM",transition:"hard",effects:"none",chord:"harmony",filterCutoffHz:8e3,filterResonance:0,filterEnvelope:"steady",vibrato:"none",algorithm:"1‚Üê(2‚ÄÇ3‚ÄÇ4)",feedbackType:"1‚ü≤",feedbackAmplitude:0,feedbackEnvelope:"steady",operators:[{frequency:"1√ó",amplitude:15,envelope:"custom"},{frequency:"1√ó",amplitude:15,envelope:"twang 2"},{frequency:"1√ó",amplitude:0,envelope:"steady"},{frequency:"1√ó",amplitude:0,envelope:"steady"}]}},{name:"FM bass",midiProgram:36,settings:{type:"FM",effects:"reverb",transition:"hard",chord:"custom interval",filterCutoffHz:8e3,filterResonance:0,filterEnvelope:"steady",vibrato:"none",algorithm:"1‚Üê(2‚ÄÇ3‚Üê4)",feedbackType:"1‚ü≤",feedbackAmplitude:0,feedbackEnvelope:"steady",operators:[{frequency:"2√ó",amplitude:11,envelope:"custom"},{frequency:"1√ó",amplitude:7,envelope:"twang 2"},{frequency:"1√ó",amplitude:9,envelope:"twang 3"},{frequency:"20√ó",amplitude:3,envelope:"twang 2"}]}},{name:"FM flute",midiProgram:73,settings:{type:"FM",effects:"reverb",transition:"soft",chord:"harmony",filterCutoffHz:8e3,filterResonance:0,filterEnvelope:"steady",vibrato:"none",algorithm:"1‚Üê(2‚ÄÇ3‚ÄÇ4)",feedbackType:"1‚ü≤",feedbackAmplitude:0,feedbackEnvelope:"steady",operators:[{frequency:"1√ó",amplitude:15,envelope:"custom"},{frequency:"1√ó",amplitude:6,envelope:"twang 2"},{frequency:"1√ó",amplitude:0,envelope:"steady"},{frequency:"1√ó",amplitude:0,envelope:"steady"}]}},{name:"FM organ",midiProgram:16,settings:{type:"FM",effects:"reverb",transition:"soft",chord:"custom interval",filterCutoffHz:8e3,filterResonance:0,filterEnvelope:"steady",vibrato:"delayed",algorithm:"1‚Üê3‚ÄÉ2‚Üê4",feedbackType:"1‚ü≤‚ÄÉ2‚ü≤",feedbackAmplitude:0,feedbackEnvelope:"steady",operators:[{frequency:"1√ó",amplitude:7,envelope:"custom"},{frequency:"2√ó",amplitude:7,envelope:"custom"},{frequency:"1√ó",amplitude:11,envelope:"steady"},{frequency:"2√ó",amplitude:11,envelope:"steady"}]}},{name:"NES Pulse",midiProgram:80,settings:{type:"custom chip",transition:"hard",effects:"none",chord:"arpeggio",filterCutoffHz:4e3,filterResonance:0,filterEnvelope:"steady",interval:"union",vibrato:"none",customChipWave:[-24,-24,-24,-24,-23,-23,-23,-23,-22,-22,-22,-22,-21,-21,-21,-21,-20,-20,-20,-20,-19,-19,-19,-19,-18,-18,-18,-18,-17,-17,-17,-17,24,24,24,24,23,23,23,23,22,22,22,22,21,21,21,21,20,20,20,20,19,19,19,19,18,18,18,18,17,17,17,17]}},{name:"Gameboy Pulse",midiProgram:80,settings:{type:"custom chip",transition:"hard",effects:"none",chord:"arpeggio",filterCutoffHz:4e3,filterResonance:0,filterEnvelope:"steady",interval:"union",vibrato:"none",customChipWave:[-24,-20,-17,-15,-13,-13,-11,-11,-11,-9,-9,-9,-9,-7,-7,-7,-7,-7,-5,-5,-5,-5,-5,-5,-3,-3,-3,-3,-3,-3,-3,-3,24,20,17,15,13,13,11,11,11,9,9,9,9,7,7,7,7,7,5,5,5,5,5,5,3,3,3,3,3,3,3,3]}},{name:"VRC6 Sawtooth",midiProgram:81,settings:{type:"custom chip",transition:"hard",effects:"none",chord:"arpeggio",filterCutoffHz:4e3,filterResonance:0,filterEnvelope:"steady",interval:"union",vibrato:"none",customChipWave:[-24,-20,-16,-13,-10,-8,-6,-5,-4,-4,0,0,0,0,4,4,4,4,4,4,8,8,8,8,8,8,8,8,12,12,12,12,12,12,12,12,16,16,16,16,16,16,16,16,20,20,20,20,20,20,20,20,24,24,24,24,24,24,24,24,24,24,24,24]}},{name:"Atari Square",midiProgram:80,settings:{type:"custom chip",effects:"none",transition:"seamless",chord:"arpeggio",filterCutoffHz:8e3,filterResonance:0,filterEnvelope:"steady",interval:"union",vibrato:"none",customChipWave:[-24,-24,-24,-23,-23,-23,-22,-22,-22,-21,-21,-21,-20,-20,-20,-19,-19,-19,-18,-18,-18,-17,-17,-17,-16,-16,-16,-15,-15,-15,-14,-14,-14,-13,-13,-13,24,24,24,23,23,23,22,22,22,21,21,21,20,20,20,19,19,19,18,18,18,17,17,17,16,16,15,15]}},{name:"Atari Bass",midiProgram:36,settings:{type:"custom chip",effects:"none",transition:"seamless",chord:"arpeggio",filterCutoffHz:8e3,filterResonance:0,filterEnvelope:"steady",interval:"union",vibrato:"none",customChipWave:[-24,-24,-24,-24,-24,-24,-24,-24,-24,24,24,24,24,24,24,-24,-24,-24,24,24,24,-24,-24,-24,24,24,24,-24,-24,-24,24,24,-24,-24,-24,-24,-24,-24,-24,-24,-24,24,24,24,24,24,24,-24,-24,24,24,24,24,24,-24,-24,-24,-24,24,24,-24,-24,24,24]}}])},{name:"Keyboard Presets",presets:t.toNameMap([{name:"grand piano 1",midiProgram:0,generalMidi:!0,settings:{type:"harmonics",effects:"reverb",transition:"hard fade",chord:"harmony",filterCutoffHz:2e3,filterResonance:43,filterEnvelope:"twang 3",interval:"shimmer",vibrato:"none",harmonics:[100,100,86,86,86,71,71,71,0,57,57,57,57,57,57,57,57,0,57,57,57,57,57,57,57,57,14,43]}},{name:"bright piano",midiProgram:1,generalMidi:!0,settings:{type:"harmonics",effects:"reverb",transition:"hard fade",chord:"harmony",filterCutoffHz:2e3,filterResonance:29,filterEnvelope:"twang 3",interval:"shimmer",vibrato:"none",harmonics:[100,100,86,86,71,71,0,71,71,71,71,71,71,0,57,57,57,57,57,57,0,43,43,43,43,43,43,43]}},{name:"electric grand",midiProgram:2,generalMidi:!0,settings:{type:"chip",effects:"reverb",transition:"hard fade",chord:"harmony",filterCutoffHz:2e3,filterResonance:14,filterEnvelope:"twang 3",wave:"1/8 pulse",interval:"shimmer",vibrato:"none"}},{name:"honky-tonk piano",midiProgram:3,generalMidi:!0,settings:{type:"harmonics",effects:"reverb",transition:"hard fade",chord:"harmony",filterCutoffHz:5657,filterResonance:29,filterEnvelope:"twang 2",interval:"honky tonk",vibrato:"none",harmonics:[100,100,86,71,86,71,43,71,43,43,57,57,57,29,57,43,43,43,43,43,29,43,43,43,29,29,29,29]}},{name:"electric piano 1",midiProgram:4,generalMidi:!0,settings:{type:"harmonics",effects:"reverb",transition:"hard",chord:"harmony",filterCutoffHz:2828,filterResonance:14,filterEnvelope:"twang 2",interval:"union",vibrato:"none",harmonics:[86,100,100,71,71,57,57,43,43,43,29,29,29,14,14,14,0,0,0,0,0,57,0,0,0,0,0,0]}},{name:"electric piano 2",midiProgram:5,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"hard fade",chord:"harmony",filterCutoffHz:2828,filterResonance:0,filterEnvelope:"twang 3",vibrato:"none",algorithm:"1‚Üê3‚ÄÉ2‚Üê4",feedbackType:"1‚ü≤‚ÄÉ2‚ü≤",feedbackAmplitude:0,feedbackEnvelope:"steady",operators:[{frequency:"1√ó",amplitude:12,envelope:"custom"},{frequency:"1√ó",amplitude:6,envelope:"custom"},{frequency:"1√ó",amplitude:9,envelope:"steady"},{frequency:"16√ó",amplitude:6,envelope:"twang 3"}]}},{name:"harpsichord",midiProgram:6,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"hard fade",chord:"harmony",filterCutoffHz:8e3,filterResonance:0,filterEnvelope:"twang 2",vibrato:"none",algorithm:"1‚Üê(2‚ÄÇ3‚Üê4)",feedbackType:"4‚ü≤",feedbackAmplitude:9,feedbackEnvelope:"twang 2",operators:[{frequency:"1√ó",amplitude:15,envelope:"custom"},{frequency:"4√ó",amplitude:8,envelope:"steady"},{frequency:"3√ó",amplitude:6,envelope:"steady"},{frequency:"5√ó",amplitude:7,envelope:"steady"}]}},{name:"clavinet",midiProgram:7,generalMidi:!0,settings:{type:"FM",transition:"hard",effects:"reverb",chord:"harmony",filterCutoffHz:5657,filterResonance:0,filterEnvelope:"twang 2",vibrato:"none",algorithm:"1‚Üê(2‚ÄÇ3‚ÄÇ4)",feedbackType:"3‚ü≤",feedbackAmplitude:6,feedbackEnvelope:"twang 2",operators:[{frequency:"3√ó",amplitude:15,envelope:"custom"},{frequency:"~1√ó",amplitude:6,envelope:"steady"},{frequency:"8√ó",amplitude:4,envelope:"steady"},{frequency:"1√ó",amplitude:0,envelope:"steady"}]}},{name:"dulcimer",midiProgram:15,generalMidi:!0,settings:{type:"harmonics",effects:"reverb",transition:"hard fade",chord:"strum",filterCutoffHz:5657,filterResonance:14,filterEnvelope:"twang 2",interval:"shimmer",vibrato:"none",harmonics:[100,100,100,86,100,86,57,100,100,86,100,86,100,86,100,71,57,71,71,100,86,71,86,86,100,86,86,86]}},{name:"grand piano 2",midiProgram:0,generalMidi:!0,settings:{type:"harmonics",effects:"reverb",transition:"hard fade",chord:"harmony",filterCutoffHz:1414,filterResonance:43,filterEnvelope:"twang 3",interval:"shimmer",vibrato:"none",harmonics:[100,86,86,86,86,71,71,57,0,57,29,43,57,57,57,43,43,0,29,43,43,43,43,43,43,29,0,29]}}])},{name:"Idiophone Presets",presets:t.toNameMap([{name:"celesta",midiProgram:8,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"hard fade",chord:"strum",filterCutoffHz:5657,filterResonance:14,filterEnvelope:"twang 2",vibrato:"none",algorithm:"(1‚ÄÇ2)‚Üê(3‚ÄÇ4)",feedbackType:"1‚ü≤‚ÄÉ2‚ü≤",feedbackAmplitude:0,feedbackEnvelope:"steady",operators:[{frequency:"~1√ó",amplitude:11,envelope:"custom"},{frequency:"8√ó",amplitude:6,envelope:"custom"},{frequency:"20√ó",amplitude:3,envelope:"twang 1"},{frequency:"3√ó",amplitude:1,envelope:"twang 2"}]}},{name:"glockenspiel",midiProgram:9,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"hard fade",chord:"strum",filterCutoffHz:5657,filterResonance:14,filterEnvelope:"twang 2",vibrato:"none",algorithm:"(1‚ÄÇ2‚ÄÇ3)‚Üê4",feedbackType:"1‚ü≤‚ÄÉ2‚ü≤‚ÄÉ3‚ü≤",feedbackAmplitude:2,feedbackEnvelope:"decay 1",operators:[{frequency:"1√ó",amplitude:7,envelope:"custom"},{frequency:"5√ó",amplitude:11,envelope:"custom"},{frequency:"8√ó",amplitude:7,envelope:"custom"},{frequency:"20√ó",amplitude:2,envelope:"twang 1"}]}},{name:"music box 1",midiProgram:10,generalMidi:!0,settings:{type:"harmonics",effects:"reverb",transition:"hard fade",chord:"strum",filterCutoffHz:4e3,filterResonance:14,filterEnvelope:"twang 2",interval:"union",vibrato:"none",harmonics:[100,0,0,100,0,0,0,0,0,0,100,0,0,0,0,0,0,0,0,86,0,0,0,0,0,0,71,0]}},{name:"music box 2",midiProgram:10,settings:{type:"harmonics",effects:"reverb",transition:"hard fade",chord:"strum",filterCutoffHz:2828,filterResonance:14,filterEnvelope:"twang 1",interval:"union",vibrato:"none",harmonics:[100,57,57,0,0,0,0,0,0,57,0,0,0,14,14,14,14,14,14,43,14,14,14,14,14,14,14,14]}},{name:"vibraphone",midiProgram:11,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"hard fade",chord:"harmony",filterCutoffHz:2828,filterResonance:14,filterEnvelope:"twang 2",vibrato:"none",algorithm:"1‚ÄÉ2‚ÄÉ3‚ÄÉ4",feedbackType:"1‚Üí2‚Üí3‚Üí4",feedbackAmplitude:3,feedbackEnvelope:"twang 1",operators:[{frequency:"1√ó",amplitude:9,envelope:"custom"},{frequency:"~1√ó",amplitude:9,envelope:"custom"},{frequency:"9√ó",amplitude:3,envelope:"custom"},{frequency:"4√ó",amplitude:9,envelope:"custom"}]}},{name:"marimba",midiProgram:12,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"hard fade",chord:"strum",filterCutoffHz:2e3,filterResonance:29,filterEnvelope:"decay 1",vibrato:"none",algorithm:"1‚ÄÉ2‚Üê(3‚ÄÇ4)",feedbackType:"1‚ü≤",feedbackAmplitude:0,feedbackEnvelope:"steady",operators:[{frequency:"1√ó",amplitude:10,envelope:"custom"},{frequency:"4√ó",amplitude:6,envelope:"custom"},{frequency:"13√ó",amplitude:6,envelope:"twang 1"},{frequency:"1√ó",amplitude:0,envelope:"steady"}]}},{name:"kalimba",midiProgram:108,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"hard fade",chord:"strum",filterCutoffHz:2828,filterResonance:14,filterEnvelope:"decay 1",vibrato:"none",algorithm:"1‚Üê(2‚ÄÇ3‚ÄÇ4)",feedbackType:"1‚ü≤",feedbackAmplitude:0,feedbackEnvelope:"steady",operators:[{frequency:"1√ó",amplitude:11,envelope:"custom"},{frequency:"5√ó",amplitude:3,envelope:"twang 2"},{frequency:"20√ó",amplitude:3,envelope:"twang 1"},{frequency:"1√ó",amplitude:0,envelope:"steady"}]}},{name:"xylophone",midiProgram:13,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"hard",chord:"strum",filterCutoffHz:2e3,filterResonance:14,filterEnvelope:"twang 1",vibrato:"none",algorithm:"(1‚ÄÇ2‚ÄÇ3)‚Üê4",feedbackType:"1‚ü≤‚ÄÉ2‚ü≤‚ÄÉ3‚ü≤",feedbackAmplitude:0,feedbackEnvelope:"steady",operators:[{frequency:"1√ó",amplitude:9,envelope:"custom"},{frequency:"6√ó",amplitude:9,envelope:"custom"},{frequency:"11√ó",amplitude:9,envelope:"custom"},{frequency:"20√ó",amplitude:6,envelope:"twang 1"}]}},{name:"tubular bell",midiProgram:14,generalMidi:!0,midiSubharmonicOctaves:1,settings:{type:"harmonics",effects:"reverb",transition:"hard fade",chord:"strum",filterCutoffHz:4e3,filterResonance:14,filterEnvelope:"twang 3",interval:"hum",vibrato:"none",harmonics:[43,71,0,100,0,100,0,86,0,0,86,0,14,71,14,14,57,14,14,43,14,14,43,14,14,43,14,14]}},{name:"bell synth",midiProgram:14,settings:{type:"FM",effects:"reverb",transition:"hard fade",chord:"strum",filterCutoffHz:2e3,filterResonance:29,filterEnvelope:"twang 3",vibrato:"none",algorithm:"1‚Üê(2‚ÄÇ3‚ÄÇ4)",feedbackType:"1‚ü≤",feedbackAmplitude:0,feedbackEnvelope:"steady",operators:[{frequency:"~2√ó",amplitude:10,envelope:"custom"},{frequency:"7√ó",amplitude:6,envelope:"twang 3"},{frequency:"20√ó",amplitude:1,envelope:"twang 1"},{frequency:"1√ó",amplitude:0,envelope:"steady"}]}},{name:"rain drop",midiProgram:96,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"hard fade",chord:"strum",filterCutoffHz:4e3,filterResonance:14,filterEnvelope:"twang 1",vibrato:"none",algorithm:"(1‚ÄÇ2)‚Üê(3‚ÄÇ4)",feedbackType:"1‚ü≤‚ÄÉ2‚ü≤",feedbackAmplitude:0,feedbackEnvelope:"steady",operators:[{frequency:"1√ó",amplitude:12,envelope:"custom"},{frequency:"6√ó",amplitude:4,envelope:"custom"},{frequency:"20√ó",amplitude:3,envelope:"twang 1"},{frequency:"1√ó",amplitude:6,envelope:"tremolo1"}]}},{name:"crystal",midiProgram:98,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"hard fade",chord:"harmony",filterCutoffHz:2828,filterResonance:14,filterEnvelope:"twang 2",vibrato:"delayed",algorithm:"1‚ÄÉ2‚ÄÉ3‚ÄÉ4",feedbackType:"1‚ü≤ 2‚ü≤ 3‚ü≤ 4‚ü≤",feedbackAmplitude:4,feedbackEnvelope:"twang 1",operators:[{frequency:"1√ó",amplitude:10,envelope:"custom"},{frequency:"3√ó",amplitude:7,envelope:"custom"},{frequency:"6√ó",amplitude:4,envelope:"custom"},{frequency:"13√ó",amplitude:4,envelope:"custom"}]}},{name:"tinkle bell",midiProgram:112,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"hard",chord:"strum",filterCutoffHz:2828,filterResonance:14,filterEnvelope:"twang 2",vibrato:"none",algorithm:"1‚ÄÉ2‚ÄÉ3‚ÄÉ4",feedbackType:"1‚Üí2‚Üí3‚Üí4",feedbackAmplitude:5,feedbackEnvelope:"twang 3",operators:[{frequency:"~2√ó",amplitude:7,envelope:"custom"},{frequency:"5√ó",amplitude:7,envelope:"custom"},{frequency:"7√ó",amplitude:7,envelope:"custom"},{frequency:"16√ó",amplitude:7,envelope:"custom"}]}},{name:"agogo",midiProgram:113,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"hard fade",chord:"strum",filterCutoffHz:4e3,filterResonance:14,filterEnvelope:"decay 1",vibrato:"none",algorithm:"1‚ÄÉ2‚ÄÉ3‚ÄÉ4",feedbackType:"1‚Üí4",feedbackAmplitude:15,feedbackEnvelope:"decay 1",operators:[{frequency:"2√ó",amplitude:9,envelope:"custom"},{frequency:"5√ó",amplitude:6,envelope:"custom"},{frequency:"8√ó",amplitude:9,envelope:"custom"},{frequency:"13√ó",amplitude:11,envelope:"custom"}]}}])},{name:"Guitar Presets",presets:t.toNameMap([{name:"nylon guitar",midiProgram:24,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"hard fade",chord:"strum",filterCutoffHz:5657,filterResonance:14,filterEnvelope:"twang 1",vibrato:"none",algorithm:"1‚Üê2‚Üê3‚Üê4",feedbackType:"3‚ü≤",feedbackAmplitude:6,feedbackEnvelope:"twang 1",operators:[{frequency:"1√ó",amplitude:15,envelope:"custom"},{frequency:"1√ó",amplitude:6,envelope:"steady"},{frequency:"5√ó",amplitude:2,envelope:"steady"},{frequency:"7√ó",amplitude:4,envelope:"steady"}]}},{name:"steel guitar",midiProgram:25,generalMidi:!0,settings:{type:"harmonics",effects:"reverb",transition:"hard fade",chord:"strum",filterCutoffHz:5657,filterResonance:14,filterEnvelope:"twang 2",interval:"union",vibrato:"none",harmonics:[100,100,86,71,71,71,86,86,71,57,43,43,43,57,57,57,57,57,43,43,43,43,43,43,43,43,43,43]}},{name:"jazz guitar",midiProgram:26,generalMidi:!0,settings:{type:"harmonics",effects:"reverb",transition:"hard",chord:"strum",filterCutoffHz:2e3,filterResonance:14,filterEnvelope:"twang 2",interval:"union",vibrato:"none",harmonics:[100,100,86,71,57,71,71,43,57,71,57,43,29,29,29,29,29,29,29,29,14,14,14,14,14,14,14,0]}},{name:"clean guitar",midiProgram:27,generalMidi:!0,settings:{type:"harmonics",effects:"reverb",transition:"hard",chord:"strum",filterCutoffHz:2828,filterResonance:14,filterEnvelope:"twang 2",interval:"union",vibrato:"none",harmonics:[86,100,100,100,86,57,86,100,100,100,71,57,43,71,86,71,57,57,71,71,71,71,57,57,57,57,57,43]}},{name:"muted guitar",midiProgram:28,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"hard",chord:"strum",filterCutoffHz:2e3,filterResonance:14,filterEnvelope:"twang 1",vibrato:"none",algorithm:"1‚Üê(2‚ÄÇ3‚Üê4)",feedbackType:"1‚ü≤",feedbackAmplitude:7,feedbackEnvelope:"twang 2",operators:[{frequency:"1√ó",amplitude:13,envelope:"custom"},{frequency:"1√ó",amplitude:4,envelope:"twang 3"},{frequency:"4√ó",amplitude:4,envelope:"twang 2"},{frequency:"16√ó",amplitude:4,envelope:"twang 1"}]}}])},{name:"Picked Bass Presets",presets:t.toNameMap([{name:"acoustic bass",midiProgram:32,generalMidi:!0,settings:{type:"harmonics",effects:"reverb",transition:"hard fade",chord:"strum",filterCutoffHz:4e3,filterResonance:14,filterEnvelope:"twang 1",interval:"union",vibrato:"none",harmonics:[100,86,71,71,71,71,57,57,57,57,43,43,43,43,43,29,29,29,29,29,29,14,14,14,14,14,14,14]}},{name:"fingered bass",midiProgram:33,generalMidi:!0,settings:{type:"harmonics",effects:"reverb",transition:"hard fade",chord:"strum",filterCutoffHz:2828,filterResonance:14,filterEnvelope:"twang 1",interval:"union",vibrato:"none",harmonics:[100,86,71,57,71,43,57,29,29,29,29,29,29,14,14,14,14,14,14,14,14,14,14,14,14,14,14,0]}},{name:"picked bass",midiProgram:34,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"hard fade",chord:"strum",filterCutoffHz:2828,filterResonance:0,filterEnvelope:"twang 1",vibrato:"none",algorithm:"1‚Üê(2‚ÄÇ3‚Üê4)",feedbackType:"3‚ü≤",feedbackAmplitude:4,feedbackEnvelope:"twang 1",operators:[{frequency:"1√ó",amplitude:15,envelope:"custom"},{frequency:"1√ó",amplitude:5,envelope:"steady"},{frequency:"11√ó",amplitude:1,envelope:"twang 3"},{frequency:"1√ó",amplitude:9,envelope:"steady"}]}},{name:"fretless bass",midiProgram:35,generalMidi:!0,settings:{type:"harmonics",effects:"reverb",transition:"hard",chord:"strum",filterCutoffHz:1e3,filterResonance:14,filterEnvelope:"flare 2",interval:"union",vibrato:"none",harmonics:[100,100,86,71,71,57,57,71,71,71,57,57,57,57,57,57,57,43,43,43,43,43,43,43,43,29,29,14]}},{name:"slap bass 1",midiProgram:36,generalMidi:!0,settings:{type:"harmonics",effects:"reverb",transition:"hard",chord:"strum",filterCutoffHz:4e3,filterResonance:0,filterEnvelope:"twang 1",interval:"union",vibrato:"none",harmonics:[100,100,100,100,86,71,57,29,29,43,43,57,71,57,29,29,43,57,57,57,43,43,43,57,71,71,71,71]}},{name:"slap bass 2",midiProgram:37,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"hard",chord:"strum",filterCutoffHz:5657,filterResonance:0,filterEnvelope:"twang 1",vibrato:"none",algorithm:"1‚Üê2‚Üê3‚Üê4",feedbackType:"3‚ü≤",feedbackAmplitude:4,feedbackEnvelope:"steady",operators:[{frequency:"3√ó",amplitude:13,envelope:"custom"},{frequency:"1√ó",amplitude:7,envelope:"steady"},{frequency:"13√ó",amplitude:3,envelope:"steady"},{frequency:"1√ó",amplitude:11,envelope:"steady"}]}},{name:"bass synth 1",midiProgram:38,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"hard",chord:"strum",filterCutoffHz:4e3,filterResonance:43,filterEnvelope:"twang 2",vibrato:"none",algorithm:"1‚Üê3‚ÄÉ2‚Üê4",feedbackType:"3‚ü≤‚ÄÉ4‚ü≤",feedbackAmplitude:9,feedbackEnvelope:"twang 2",operators:[{frequency:"1√ó",amplitude:15,envelope:"custom"},{frequency:"1√ó",amplitude:10,envelope:"custom"},{frequency:"1√ó",amplitude:14,envelope:"twang 1"},{frequency:"~1√ó",amplitude:13,envelope:"twang 2"}]}},{name:"bass synth 2",midiProgram:39,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"hard fade",chord:"strum",filterCutoffHz:1e3,filterResonance:57,filterEnvelope:"punch",vibrato:"none",algorithm:"1‚Üê(2‚ÄÇ3‚ÄÇ4)",feedbackType:"1‚Üí2",feedbackAmplitude:4,feedbackEnvelope:"twang 3",operators:[{frequency:"1√ó",amplitude:9,envelope:"custom"},{frequency:"1√ó",amplitude:9,envelope:"steady"},{frequency:"3√ó",amplitude:0,envelope:"steady"},{frequency:"1√ó",amplitude:0,envelope:"steady"}]}},{name:"bass & lead",midiProgram:87,generalMidi:!0,settings:{type:"chip",transition:"hard",effects:"reverb",chord:"harmony",filterCutoffHz:4e3,filterResonance:86,filterEnvelope:"twang 2",wave:"sawtooth",interval:"shimmer",vibrato:"none"}}])},{name:"Picked String Presets",presets:t.toNameMap([{name:"pizzicato strings",midiProgram:45,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"medium fade",chord:"harmony",filterCutoffHz:1e3,filterResonance:14,filterEnvelope:"twang 1",vibrato:"none",algorithm:"(1‚ÄÇ2‚ÄÇ3)‚Üê4",feedbackType:"1‚ü≤ 2‚ü≤ 3‚ü≤ 4‚ü≤",feedbackAmplitude:7,feedbackEnvelope:"twang 1",operators:[{frequency:"1√ó",amplitude:14,envelope:"custom"},{frequency:"3√ó",amplitude:11,envelope:"custom"},{frequency:"6√ó",amplitude:9,envelope:"custom"},{frequency:"~1√ó",amplitude:10,envelope:"steady"}]}},{name:"harp",midiProgram:46,generalMidi:!0,settings:{type:"FM",transition:"hard fade",effects:"reverb",chord:"strum",filterCutoffHz:2828,filterResonance:0,filterEnvelope:"twang 1",vibrato:"none",algorithm:"1‚Üê3‚ÄÉ2‚Üê4",feedbackType:"3‚ü≤",feedbackAmplitude:6,feedbackEnvelope:"twang 2",operators:[{frequency:"1√ó",amplitude:15,envelope:"custom"},{frequency:"4√ó",amplitude:6,envelope:"custom"},{frequency:"~2√ó",amplitude:3,envelope:"steady"},{frequency:"1√ó",amplitude:6,envelope:"steady"}]}},{name:"sitar",midiProgram:104,generalMidi:!0,settings:{type:"FM",transition:"hard fade",effects:"reverb",chord:"strum",filterCutoffHz:8e3,filterResonance:57,filterEnvelope:"twang 2",vibrato:"none",algorithm:"1‚Üê(2‚ÄÇ3‚ÄÇ4)",feedbackType:"1‚ü≤",feedbackAmplitude:0,feedbackEnvelope:"steady",operators:[{frequency:"1√ó",amplitude:15,envelope:"custom"},{frequency:"1√ó",amplitude:14,envelope:"twang 3"},{frequency:"9√ó",amplitude:3,envelope:"twang 3"},{frequency:"16√ó",amplitude:9,envelope:"swell 3"}]}},{name:"banjo",midiProgram:105,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"hard fade",chord:"strum",filterCutoffHz:2828,filterResonance:14,filterEnvelope:"twang 2",vibrato:"none",algorithm:"1‚Üê(2‚ÄÇ3‚Üê4)",feedbackType:"2‚ü≤",feedbackAmplitude:4,feedbackEnvelope:"steady",operators:[{frequency:"4√ó",amplitude:14,envelope:"custom"},{frequency:"1√ó",amplitude:10,envelope:"steady"},{frequency:"11√ó",amplitude:3,envelope:"twang 3"},{frequency:"1√ó",amplitude:11,envelope:"steady"}]}},{name:"ukulele",midiProgram:105,settings:{type:"FM",effects:"reverb",transition:"hard fade",chord:"strum",filterCutoffHz:2e3,filterResonance:0,filterEnvelope:"twang 1",vibrato:"none",algorithm:"1‚Üê(2‚ÄÇ3‚Üê4)",feedbackType:"3‚ü≤",feedbackAmplitude:5,feedbackEnvelope:"twang 1",operators:[{frequency:"2√ó",amplitude:14,envelope:"custom"},{frequency:"1√ó",amplitude:6,envelope:"steady"},{frequency:"9√ó",amplitude:4,envelope:"twang 2"},{frequency:"1√ó",amplitude:11,envelope:"steady"}]}},{name:"shamisen",midiProgram:106,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"hard fade",chord:"harmony",filterCutoffHz:8e3,filterResonance:14,filterEnvelope:"twang 1",vibrato:"none",algorithm:"1‚Üê(2‚ÄÇ3‚Üê4)",feedbackType:"3‚ü≤",feedbackAmplitude:9,feedbackEnvelope:"twang 3",operators:[{frequency:"1√ó",amplitude:15,envelope:"custom"},{frequency:"1√ó",amplitude:12,envelope:"steady"},{frequency:"16√ó",amplitude:4,envelope:"twang 3"},{frequency:"1√ó",amplitude:7,envelope:"steady"}]}},{name:"koto",midiProgram:107,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"hard fade",chord:"harmony",filterCutoffHz:4e3,filterResonance:14,filterEnvelope:"twang 2",vibrato:"none",algorithm:"1‚Üê3‚ÄÉ2‚Üê4",feedbackType:"1‚ü≤‚ÄÉ2‚ü≤",feedbackAmplitude:5,feedbackEnvelope:"twang 2",operators:[{frequency:"~1√ó",amplitude:12,envelope:"custom"},{frequency:"6√ó",amplitude:10,envelope:"custom"},{frequency:"4√ó",amplitude:8,envelope:"twang 3"},{frequency:"~2√ó",amplitude:8,envelope:"twang 3"}]}}])},{name:"Distortion Presets",presets:t.toNameMap([{name:"overdrive guitar",midiProgram:29,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"hard",chord:"strum",filterCutoffHz:2828,filterResonance:14,filterEnvelope:"steady",vibrato:"none",algorithm:"1‚Üê(2‚ÄÇ3‚Üê4)",feedbackType:"1‚Üí2",feedbackAmplitude:2,feedbackEnvelope:"steady",operators:[{frequency:"~1√ó",amplitude:13,envelope:"custom"},{frequency:"1√ó",amplitude:12,envelope:"steady"},{frequency:"1√ó",amplitude:7,envelope:"twang 3"},{frequency:"1√ó",amplitude:4,envelope:"swell 3"}]}},{name:"distortion guitar",midiProgram:30,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"hard",chord:"strum",filterCutoffHz:2828,filterResonance:57,filterEnvelope:"steady",vibrato:"none",algorithm:"1‚Üê(2‚ÄÇ3‚Üê4)",feedbackType:"1‚Üí2",feedbackAmplitude:4,feedbackEnvelope:"steady",operators:[{frequency:"~1√ó",amplitude:13,envelope:"custom"},{frequency:"1√ó",amplitude:11,envelope:"steady"},{frequency:"1√ó",amplitude:9,envelope:"swell 1"},{frequency:"~2√ó",amplitude:5,envelope:"swell 3"}]}},{name:"charango synth",midiProgram:84,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"hard",chord:"strum",filterCutoffHz:5657,filterResonance:0,filterEnvelope:"twang 3",vibrato:"none",algorithm:"1‚Üê(2‚ÄÇ3‚Üê4)",feedbackType:"1‚Üí2‚Üí3‚Üí4",feedbackAmplitude:8,feedbackEnvelope:"twang 3",operators:[{frequency:"3√ó",amplitude:13,envelope:"custom"},{frequency:"~1√ó",amplitude:5,envelope:"steady"},{frequency:"4√ó",amplitude:6,envelope:"steady"},{frequency:"3√ó",amplitude:7,envelope:"steady"}]}},{name:"guitar harmonics",midiProgram:31,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"hard",chord:"strum",filterCutoffHz:2e3,filterResonance:29,filterEnvelope:"steady",vibrato:"none",algorithm:"1‚Üê(2‚ÄÇ3)‚Üê4",feedbackType:"1‚ü≤",feedbackAmplitude:2,feedbackEnvelope:"steady",operators:[{frequency:"4√ó",amplitude:12,envelope:"custom"},{frequency:"16√ó",amplitude:5,envelope:"swell 1"},{frequency:"1√ó",amplitude:2,envelope:"punch"},{frequency:"~1√ó",amplitude:12,envelope:"twang 1"}]}},{name:"distorted synth 1",midiProgram:30,settings:{type:"PWM",effects:"reverb",transition:"hard",chord:"strum",filterCutoffHz:4e3,filterResonance:29,filterEnvelope:"steady",pulseWidth:17.6875,pulseEnvelope:"punch",vibrato:"none"}},{name:"distorted synth 2",midiProgram:30,settings:{type:"FM",effects:"reverb",transition:"seamless",chord:"strum",filterCutoffHz:8e3,filterResonance:0,filterEnvelope:"steady",vibrato:"none",algorithm:"1‚Üê(2‚ÄÇ3‚ÄÇ4)",feedbackType:"1‚ü≤",feedbackAmplitude:7,feedbackEnvelope:"steady",operators:[{frequency:"1√ó",amplitude:15,envelope:"custom"},{frequency:"1√ó",amplitude:13,envelope:"steady"},{frequency:"1√ó",amplitude:11,envelope:"swell 1"},{frequency:"1√ó",amplitude:0,envelope:"flare 1"}]}},{name:"distorted synth 3",midiProgram:30,settings:{type:"FM",effects:"reverb",transition:"hard",chord:"strum",filterCutoffHz:8e3,filterResonance:0,filterEnvelope:"steady",vibrato:"delayed",algorithm:"1‚Üê(2‚ÄÇ3‚ÄÇ4)",feedbackType:"1‚Üí2",feedbackAmplitude:3,feedbackEnvelope:"steady",operators:[{frequency:"~1√ó",amplitude:13,envelope:"custom"},{frequency:"1√ó",amplitude:11,envelope:"steady"},{frequency:"1√ó",amplitude:12,envelope:"swell 1"},{frequency:"1√ó",amplitude:0,envelope:"steady"}]}},{name:"distorted synth 4",midiProgram:30,settings:{type:"PWM",effects:"reverb",transition:"hard",chord:"strum",filterCutoffHz:2828,filterResonance:57,filterEnvelope:"steady",pulseWidth:50,pulseEnvelope:"swell 1",vibrato:"delayed"}}])},{name:"Bellows Presets",presets:t.toNameMap([{name:"drawbar organ 1",midiProgram:16,generalMidi:!0,midiSubharmonicOctaves:1,settings:{type:"harmonics",effects:"reverb",transition:"hard",chord:"harmony",filterCutoffHz:2828,filterResonance:14,filterEnvelope:"steady",interval:"union",vibrato:"none",harmonics:[86,86,0,86,0,0,0,86,0,0,0,0,0,0,0,86,0,0,0,0,0,0,0,0,0,0,0,0]}},{name:"drawbar organ 2",midiProgram:16,midiSubharmonicOctaves:1,settings:{type:"harmonics",effects:"reverb",transition:"hard",chord:"harmony",filterCutoffHz:2828,filterResonance:14,filterEnvelope:"steady",interval:"union",vibrato:"none",harmonics:[86,29,71,86,71,14,0,100,0,0,0,86,0,0,0,71,0,0,0,57,0,0,0,29,0,0,0,0]}},{name:"percussive organ",midiProgram:17,generalMidi:!0,midiSubharmonicOctaves:1,settings:{type:"FM",transition:"hard",effects:"reverb",chord:"harmony",filterCutoffHz:2e3,filterResonance:14,filterEnvelope:"punch",vibrato:"light",algorithm:"1‚ÄÉ2‚ÄÉ3‚ÄÉ4",feedbackType:"1‚Üí3‚ÄÉ2‚Üí4",feedbackAmplitude:7,feedbackEnvelope:"decay 1",operators:[{frequency:"1√ó",amplitude:7,envelope:"custom"},{frequency:"2√ó",amplitude:7,envelope:"custom"},{frequency:"3√ó",amplitude:8,envelope:"custom"},{frequency:"4√ó",amplitude:8,envelope:"custom"}]}},{name:"rock organ",midiProgram:18,generalMidi:!0,midiSubharmonicOctaves:1,settings:{type:"FM",effects:"chorus & reverb",transition:"hard",chord:"harmony",filterCutoffHz:4e3,filterResonance:14,filterEnvelope:"punch",vibrato:"delayed",algorithm:"(1‚ÄÇ2‚ÄÇ3)‚Üê4",feedbackType:"1‚ü≤‚ÄÉ2‚ü≤‚ÄÉ3‚ü≤",feedbackAmplitude:2,feedbackEnvelope:"flare 1",operators:[{frequency:"1√ó",amplitude:9,envelope:"custom"},{frequency:"4√ó",amplitude:9,envelope:"custom"},{frequency:"6√ó",amplitude:9,envelope:"custom"},{frequency:"2√ó",amplitude:5,envelope:"steady"}]}},{name:"pipe organ",midiProgram:19,generalMidi:!0,midiSubharmonicOctaves:1,settings:{type:"FM",transition:"cross fade",effects:"reverb",chord:"harmony",filterCutoffHz:5657,filterResonance:43,filterEnvelope:"steady",vibrato:"none",algorithm:"1‚ÄÉ2‚ÄÉ3‚ÄÉ4",feedbackType:"1‚ü≤ 2‚ü≤ 3‚ü≤ 4‚ü≤",feedbackAmplitude:5,feedbackEnvelope:"steady",operators:[{frequency:"1√ó",amplitude:8,envelope:"custom"},{frequency:"2√ó",amplitude:9,envelope:"custom"},{frequency:"4√ó",amplitude:9,envelope:"custom"},{frequency:"8√ó",amplitude:8,envelope:"custom"}]}},{name:"reed organ",midiProgram:20,generalMidi:!0,settings:{type:"harmonics",effects:"reverb",transition:"soft",chord:"harmony",filterCutoffHz:2e3,filterResonance:29,filterEnvelope:"steady",interval:"union",vibrato:"none",harmonics:[71,86,100,86,71,100,57,71,71,71,43,43,43,71,43,71,57,57,57,57,57,57,57,29,43,29,29,14]}},{name:"accordion",midiProgram:21,generalMidi:!0,settings:{type:"chip",effects:"reverb",transition:"cross fade",chord:"harmony",filterCutoffHz:5657,filterResonance:0,filterEnvelope:"swell 1",wave:"double saw",interval:"honky tonk",vibrato:"none"}},{name:"bandoneon",midiProgram:23,generalMidi:!0,settings:{type:"harmonics",effects:"reverb",transition:"soft",chord:"harmony",filterCutoffHz:4e3,filterResonance:29,filterEnvelope:"swell 1",interval:"hum",vibrato:"none",harmonics:[86,86,86,57,71,86,57,71,71,71,57,43,57,43,71,43,71,57,57,43,43,43,57,43,43,29,29,29]}},{name:"bagpipe",midiProgram:109,generalMidi:!0,settings:{type:"harmonics",effects:"reverb",transition:"cross fade",chord:"harmony",filterCutoffHz:5657,filterResonance:43,filterEnvelope:"punch",interval:"hum",vibrato:"none",harmonics:[71,86,86,100,100,86,57,100,86,71,71,71,57,57,57,71,57,71,57,71,43,57,57,43,43,43,43,43]}}])},{name:"String Presets",presets:t.toNameMap([{name:"violin 1",midiProgram:40,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"cross fade",chord:"harmony",filterCutoffHz:2828,filterResonance:43,filterEnvelope:"steady",vibrato:"delayed",algorithm:"(1‚ÄÇ2)‚Üê(3‚ÄÇ4)",feedbackType:"4‚ü≤",feedbackAmplitude:5,feedbackEnvelope:"twang 3",operators:[{frequency:"4√ó",amplitude:9,envelope:"custom"},{frequency:"3√ó",amplitude:9,envelope:"custom"},{frequency:"2√ó",amplitude:7,envelope:"steady"},{frequency:"7√ó",amplitude:5,envelope:"swell 1"}]}},{name:"viola",midiProgram:41,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"cross fade",chord:"harmony",filterCutoffHz:2e3,filterResonance:29,filterEnvelope:"steady",vibrato:"delayed",algorithm:"(1‚ÄÇ2‚ÄÇ3)‚Üê4",feedbackType:"1‚ü≤‚ÄÉ2‚ü≤‚ÄÉ3‚ü≤",feedbackAmplitude:8,feedbackEnvelope:"swell 1",operators:[{frequency:"2√ó",amplitude:11,envelope:"custom"},{frequency:"7√ó",amplitude:7,envelope:"custom"},{frequency:"13√ó",amplitude:4,envelope:"custom"},{frequency:"1√ó",amplitude:5,envelope:"steady"}]}},{name:"cello",midiProgram:42,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"cross fade",chord:"harmony",filterCutoffHz:2828,filterResonance:29,filterEnvelope:"steady",vibrato:"delayed",algorithm:"(1‚ÄÇ2‚ÄÇ3)‚Üê4",feedbackType:"1‚ü≤‚ÄÉ2‚ü≤‚ÄÉ3‚ü≤",feedbackAmplitude:6,feedbackEnvelope:"swell 1",operators:[{frequency:"1√ó",amplitude:11,envelope:"custom"},{frequency:"3√ó",amplitude:9,envelope:"custom"},{frequency:"8√ó",amplitude:7,envelope:"custom"},{frequency:"1√ó",amplitude:6,envelope:"steady"}]}},{name:"contrabass",midiProgram:43,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"cross fade",chord:"harmony",filterCutoffHz:2e3,filterResonance:29,filterEnvelope:"steady",vibrato:"delayed",algorithm:"(1‚ÄÇ2)‚Üê3‚Üê4",feedbackType:"1‚ü≤‚ÄÉ2‚ü≤",feedbackAmplitude:0,feedbackEnvelope:"steady",operators:[{frequency:"16√ó",amplitude:5,envelope:"custom"},{frequency:"1√ó",amplitude:10,envelope:"custom"},{frequency:"1√ó",amplitude:10,envelope:"steady"},{frequency:"6√ó",amplitude:3,envelope:"swell 1"}]}},{name:"fiddle",midiProgram:110,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"soft",chord:"harmony",filterCutoffHz:2828,filterResonance:29,filterEnvelope:"steady",vibrato:"delayed",algorithm:"(1‚ÄÇ2)‚Üê(3‚ÄÇ4)",feedbackType:"3‚ü≤‚ÄÉ4‚ü≤",feedbackAmplitude:5,feedbackEnvelope:"twang 1",operators:[{frequency:"2√ó",amplitude:10,envelope:"custom"},{frequency:"8√ó",amplitude:8,envelope:"custom"},{frequency:"1√ó",amplitude:8,envelope:"steady"},{frequency:"16√ó",amplitude:3,envelope:"steady"}]}},{name:"tremolo strings",midiProgram:44,generalMidi:!0,settings:{type:"FM",effects:"chorus & reverb",transition:"medium fade",chord:"harmony",filterCutoffHz:2e3,filterResonance:0,filterEnvelope:"tremolo4",vibrato:"none",algorithm:"1‚ÄÉ2‚ÄÉ3‚ÄÉ4",feedbackType:"1‚Üí2‚Üí3‚Üí4",feedbackAmplitude:12,feedbackEnvelope:"steady",operators:[{frequency:"1√ó",amplitude:8,envelope:"custom"},{frequency:"~2√ó",amplitude:8,envelope:"custom"},{frequency:"4√ó",amplitude:8,envelope:"custom"},{frequency:"7√ó",amplitude:8,envelope:"custom"}]}},{name:"strings",midiProgram:48,generalMidi:!0,settings:{type:"FM",effects:"chorus & reverb",transition:"cross fade",chord:"harmony",filterCutoffHz:2828,filterResonance:43,filterEnvelope:"steady",vibrato:"none",algorithm:"(1‚ÄÇ2)‚Üê(3‚ÄÇ4)",feedbackType:"4‚ü≤",feedbackAmplitude:5,feedbackEnvelope:"twang 3",operators:[{frequency:"4√ó",amplitude:9,envelope:"custom"},{frequency:"3√ó",amplitude:9,envelope:"custom"},{frequency:"2√ó",amplitude:7,envelope:"steady"},{frequency:"7√ó",amplitude:3,envelope:"swell 1"}]}},{name:"slow strings",midiProgram:49,generalMidi:!0,settings:{type:"FM",effects:"chorus & reverb",transition:"soft fade",chord:"harmony",filterCutoffHz:1414,filterResonance:0,filterEnvelope:"swell 2",vibrato:"none",algorithm:"(1‚ÄÇ2)‚Üê(3‚ÄÇ4)",feedbackType:"4‚ü≤",feedbackAmplitude:6,feedbackEnvelope:"flare 3",operators:[{frequency:"4√ó",amplitude:10,envelope:"custom"},{frequency:"3√ó",amplitude:10,envelope:"custom"},{frequency:"2√ó",amplitude:7,envelope:"steady"},{frequency:"7√ó",amplitude:4,envelope:"swell 1"}]}},{name:"strings synth 1",midiProgram:50,generalMidi:!0,settings:{type:"chip",volume:60,transition:"soft fade",effects:"chorus & reverb",chord:"harmony",filterCutoffHz:1414,filterResonance:43,filterEnvelope:"steady",wave:"sawtooth",interval:"hum",vibrato:"delayed"}},{name:"strings synth 2",midiProgram:51,generalMidi:!0,settings:{type:"FM",effects:"chorus & reverb",transition:"soft fade",chord:"harmony",filterCutoffHz:2e3,filterResonance:43,filterEnvelope:"steady",vibrato:"none",algorithm:"1‚ÄÉ2‚ÄÉ3‚ÄÉ4",feedbackType:"1‚ü≤ 2‚ü≤ 3‚ü≤ 4‚ü≤",feedbackAmplitude:12,feedbackEnvelope:"swell 1",operators:[{frequency:"3√ó",amplitude:6,envelope:"custom"},{frequency:"2√ó",amplitude:7,envelope:"custom"},{frequency:"1√ó",amplitude:8,envelope:"custom"},{frequency:"1√ó",amplitude:9,envelope:"custom"}]}},{name:"orchestra hit 1",midiProgram:55,generalMidi:!0,midiSubharmonicOctaves:1,settings:{type:"FM",effects:"chorus & reverb",transition:"hard fade",chord:"harmony",filterCutoffHz:8e3,filterResonance:14,filterEnvelope:"custom",vibrato:"none",algorithm:"1‚ÄÉ2‚ÄÉ3‚ÄÉ4",feedbackType:"1‚ü≤ 2‚ü≤ 3‚ü≤ 4‚ü≤",feedbackAmplitude:14,feedbackEnvelope:"twang 3",operators:[{frequency:"1√ó",amplitude:15,envelope:"twang 3"},{frequency:"2√ó",amplitude:15,envelope:"flare 3"},{frequency:"4√ó",amplitude:15,envelope:"flare 2"},{frequency:"8√ó",amplitude:15,envelope:"flare 1"}]}},{name:"violin 2",midiProgram:40,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"cross fade",chord:"harmony",filterCutoffHz:2828,filterResonance:43,filterEnvelope:"steady",vibrato:"light",algorithm:"(1‚ÄÇ2)‚Üê(3‚ÄÇ4)",feedbackType:"4‚ü≤",feedbackAmplitude:5,feedbackEnvelope:"twang 3",operators:[{frequency:"4√ó",amplitude:15,envelope:"custom"},{frequency:"3√ó",amplitude:13,envelope:"custom"},{frequency:"2√ó",amplitude:7,envelope:"steady"},{frequency:"7√ó",amplitude:8,envelope:"swell 1"}]}},{name:"orchestra hit 2",midiProgram:55,midiSubharmonicOctaves:1,settings:{type:"FM",effects:"chorus & reverb",transition:"medium fade",chord:"harmony",filterCutoffHz:8e3,filterResonance:0,filterEnvelope:"decay 1",vibrato:"delayed",algorithm:"1‚ÄÉ2‚ÄÉ3‚ÄÉ4",feedbackType:"1‚ü≤ 2‚ü≤ 3‚ü≤ 4‚ü≤",feedbackAmplitude:14,feedbackEnvelope:"steady",operators:[{frequency:"1√ó",amplitude:12,envelope:"custom"},{frequency:"2√ó",amplitude:14,envelope:"custom"},{frequency:"3√ó",amplitude:12,envelope:"custom"},{frequency:"4√ó",amplitude:14,envelope:"custom"}]}}])},{name:"Vocal Presets",presets:t.toNameMap([{name:"choir soprano",midiProgram:94,generalMidi:!0,settings:{type:"harmonics",effects:"chorus & reverb",transition:"soft fade",chord:"harmony",filterCutoffHz:2828,filterResonance:57,filterEnvelope:"steady",interval:"union",vibrato:"shaky",harmonics:[86,100,86,43,14,14,57,71,57,14,14,14,14,14,43,57,43,14,14,14,14,14,14,14,0,0,0,0]}},{name:"choir tenor",midiProgram:52,generalMidi:!0,settings:{type:"harmonics",effects:"chorus & reverb",transition:"soft fade",chord:"harmony",filterCutoffHz:2828,filterResonance:86,filterEnvelope:"steady",interval:"union",vibrato:"shaky",harmonics:[86,100,100,86,71,57,29,14,14,14,29,43,43,43,29,14,14,14,0,0,0,0,0,0,0,0,0,0]}},{name:"choir bass",midiProgram:52,settings:{type:"harmonics",effects:"chorus & reverb",transition:"soft fade",chord:"harmony",filterCutoffHz:2828,filterResonance:86,filterEnvelope:"steady",interval:"union",vibrato:"shaky",harmonics:[71,86,86,100,86,100,57,43,14,14,14,14,29,29,43,43,43,43,43,29,29,29,29,14,14,14,0,0]}},{name:"solo soprano",midiProgram:85,settings:{type:"harmonics",effects:"reverb",transition:"cross fade",chord:"harmony",filterCutoffHz:2828,filterResonance:71,filterEnvelope:"steady",interval:"union",vibrato:"shaky",harmonics:[86,100,86,43,14,14,57,71,57,14,14,14,14,14,43,57,43,14,14,14,14,14,14,14,0,0,0,0]}},{name:"solo tenor",midiProgram:85,settings:{type:"harmonics",effects:"reverb",transition:"cross fade",chord:"harmony",filterCutoffHz:2828,filterResonance:86,filterEnvelope:"steady",interval:"union",vibrato:"shaky",harmonics:[86,100,100,86,71,57,29,14,14,14,29,43,43,43,29,14,14,14,0,0,0,0,0,0,0,0,0,0]}},{name:"solo bass",midiProgram:85,settings:{type:"harmonics",effects:"reverb",transition:"cross fade",chord:"harmony",filterCutoffHz:2828,filterResonance:86,filterEnvelope:"steady",interval:"union",vibrato:"shaky",harmonics:[71,86,86,100,86,100,57,43,14,14,14,14,29,29,43,43,43,43,43,29,29,29,29,14,14,14,0,0]}},{name:"voice ooh",midiProgram:53,generalMidi:!0,settings:{type:"harmonics",effects:"reverb",transition:"soft",chord:"harmony",filterCutoffHz:1414,filterResonance:57,filterEnvelope:"steady",interval:"union",vibrato:"shaky",harmonics:[100,57,43,43,14,14,0,0,0,14,29,29,14,0,14,29,29,14,0,0,0,0,0,0,0,0,0,0]}},{name:"voice synth",midiProgram:54,generalMidi:!0,settings:{type:"chip",transition:"medium fade",effects:"chorus & reverb",chord:"harmony",filterCutoffHz:4e3,filterResonance:57,filterEnvelope:"steady",wave:"rounded",interval:"union",vibrato:"light"}},{name:"vox synth lead",midiProgram:85,generalMidi:!0,settings:{type:"FM",effects:"chorus & reverb",transition:"cross fade",chord:"harmony",filterCutoffHz:2828,filterResonance:14,filterEnvelope:"steady",vibrato:"light",algorithm:"(1‚ÄÇ2‚ÄÇ3)‚Üê4",feedbackType:"1‚Üí2‚Üí3‚Üí4",feedbackAmplitude:2,feedbackEnvelope:"punch",operators:[{frequency:"2√ó",amplitude:10,envelope:"custom"},{frequency:"9√ó",amplitude:5,envelope:"custom"},{frequency:"20√ó",amplitude:1,envelope:"custom"},{frequency:"~1√ó",amplitude:4,envelope:"steady"}]}},{name:"tiny robot",midiProgram:85,settings:{type:"FM",transition:"slide",effects:"reverb",chord:"harmony",filterCutoffHz:8e3,filterResonance:0,filterEnvelope:"steady",vibrato:"delayed",algorithm:"1‚Üê(2‚ÄÇ3‚ÄÇ4)",feedbackType:"1‚ü≤",feedbackAmplitude:2,feedbackEnvelope:"twang 3",operators:[{frequency:"2√ó",amplitude:15,envelope:"custom"},{frequency:"1√ó",amplitude:7,envelope:"punch"},{frequency:"~1√ó",amplitude:7,envelope:"steady"},{frequency:"1√ó",amplitude:0,envelope:"steady"}]}},{name:"yowie",midiProgram:85,settings:{type:"FM",effects:"reverb",transition:"cross fade",chord:"harmony",filterCutoffHz:2e3,filterResonance:86,filterEnvelope:"tremolo5",vibrato:"none",algorithm:"1‚Üê2‚Üê(3‚ÄÇ4)",feedbackType:"1‚ü≤",feedbackAmplitude:12,feedbackEnvelope:"tremolo3",operators:[{frequency:"2√ó",amplitude:12,envelope:"custom"},{frequency:"16√ó",amplitude:5,envelope:"steady"},{frequency:"1√ó",amplitude:5,envelope:"steady"},{frequency:"1√ó",amplitude:0,envelope:"steady"}]}},{name:"mouse",midiProgram:85,settings:{type:"FM",effects:"reverb",transition:"slide",chord:"harmony",filterCutoffHz:8e3,filterResonance:0,filterEnvelope:"steady",vibrato:"light",algorithm:"1‚ÄÉ2‚ÄÉ3‚ÄÉ4",feedbackType:"1‚ü≤‚ÄÉ2‚ü≤",feedbackAmplitude:5,feedbackEnvelope:"flare 2",operators:[{frequency:"2√ó",amplitude:13,envelope:"custom"},{frequency:"5√ó",amplitude:12,envelope:"custom"},{frequency:"1√ó",amplitude:0,envelope:"steady"},{frequency:"1√ó",amplitude:0,envelope:"steady"}]}},{name:"gumdrop",midiProgram:85,settings:{type:"FM",effects:"reverb",transition:"hard",chord:"harmony",filterCutoffHz:8e3,filterResonance:0,filterEnvelope:"steady",vibrato:"none",algorithm:"(1‚ÄÇ2‚ÄÇ3)‚Üê4",feedbackType:"1‚ü≤‚ÄÉ2‚ü≤‚ÄÉ3‚ü≤",feedbackAmplitude:0,feedbackEnvelope:"steady",operators:[{frequency:"2√ó",amplitude:15,envelope:"punch"},{frequency:"4√ó",amplitude:15,envelope:"punch"},{frequency:"7√ó",amplitude:15,envelope:"punch"},{frequency:"1√ó",amplitude:10,envelope:"twang 1"}]}},{name:"echo drop",midiProgram:102,generalMidi:!0,settings:{type:"FM",effects:"chorus & reverb",transition:"hard",chord:"harmony",filterCutoffHz:2828,filterResonance:14,filterEnvelope:"punch",vibrato:"none",algorithm:"1‚Üê(2‚ÄÇ3‚Üê4)",feedbackType:"1‚ü≤",feedbackAmplitude:2,feedbackEnvelope:"steady",operators:[{frequency:"~2√ó",amplitude:11,envelope:"custom"},{frequency:"~1√ó",amplitude:5,envelope:"steady"},{frequency:"11√ó",amplitude:2,envelope:"steady"},{frequency:"16√ó",amplitude:5,envelope:"swell 3"}]}},{name:"dark choir",midiProgram:85,settings:{type:"spectrum",effects:"reverb",transition:"soft",chord:"harmony",filterCutoffHz:4e3,filterResonance:29,filterEnvelope:"swell 1",spectrum:[43,14,14,14,14,14,14,100,14,14,14,57,14,14,100,14,43,14,43,14,14,43,14,29,14,29,14,14,29,0]}}])},{name:"Brass Presets",presets:t.toNameMap([{name:"trumpet",midiProgram:56,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"soft",chord:"harmony",filterCutoffHz:2828,filterResonance:43,filterEnvelope:"steady",vibrato:"none",algorithm:"1‚Üê(2‚ÄÇ3‚ÄÇ4)",feedbackType:"1‚ü≤",feedbackAmplitude:9,feedbackEnvelope:"swell 1",operators:[{frequency:"1√ó",amplitude:14,envelope:"custom"},{frequency:"1√ó",amplitude:8,envelope:"steady"},{frequency:"1√ó",amplitude:5,envelope:"flare 2"},{frequency:"1√ó",amplitude:0,envelope:"steady"}]}},{name:"trombone",midiProgram:57,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"soft",chord:"harmony",filterCutoffHz:2e3,filterResonance:43,filterEnvelope:"steady",vibrato:"none",algorithm:"1‚Üê(2‚ÄÇ3‚ÄÇ4)",feedbackType:"2‚ü≤",feedbackAmplitude:7,feedbackEnvelope:"swell 1",operators:[{frequency:"1√ó",amplitude:14,envelope:"custom"},{frequency:"1√ó",amplitude:8,envelope:"steady"},{frequency:"1√ó",amplitude:0,envelope:"steady"},{frequency:"1√ó",amplitude:0,envelope:"steady"}]}},{name:"tuba",midiProgram:58,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"soft",chord:"harmony",filterCutoffHz:2e3,filterResonance:43,filterEnvelope:"steady",vibrato:"none",algorithm:"1‚Üê(2‚ÄÇ3‚ÄÇ4)",feedbackType:"2‚ü≤",feedbackAmplitude:8,feedbackEnvelope:"swell 1",operators:[{frequency:"1√ó",amplitude:14,envelope:"custom"},{frequency:"1√ó",amplitude:6,envelope:"steady"},{frequency:"1√ó",amplitude:0,envelope:"steady"},{frequency:"1√ó",amplitude:0,envelope:"steady"}]}},{name:"muted trumpet",midiProgram:59,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"soft",chord:"harmony",filterCutoffHz:2828,filterResonance:29,filterEnvelope:"swell 1",vibrato:"none",algorithm:"1‚Üê(2‚ÄÇ3‚Üê4)",feedbackType:"1‚ü≤",feedbackAmplitude:5,feedbackEnvelope:"flare 2",operators:[{frequency:"1√ó",amplitude:13,envelope:"custom"},{frequency:"1√ó",amplitude:5,envelope:"steady"},{frequency:"9√ó",amplitude:5,envelope:"steady"},{frequency:"13√ó",amplitude:9,envelope:"swell 1"}]}},{name:"french horn",midiProgram:60,generalMidi:!0,settings:{type:"FM",transition:"soft",effects:"reverb",chord:"harmony",filterCutoffHz:2828,filterResonance:14,filterEnvelope:"steady",vibrato:"none",algorithm:"1‚Üê3‚ÄÉ2‚Üê4",feedbackType:"1‚ü≤‚ÄÉ2‚ü≤",feedbackAmplitude:3,feedbackEnvelope:"swell 1",operators:[{frequency:"1√ó",amplitude:15,envelope:"custom"},{frequency:"1√ó",amplitude:12,envelope:"custom"},{frequency:"1√ó",amplitude:10,envelope:"swell 1"},{frequency:"~1√ó",amplitude:8,envelope:"flare 2"}]}},{name:"brass section",midiProgram:61,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"soft",chord:"harmony",filterCutoffHz:2828,filterResonance:14,filterEnvelope:"punch",vibrato:"none",algorithm:"1‚Üê3‚ÄÉ2‚Üê4",feedbackType:"1‚ü≤‚ÄÉ2‚ü≤",feedbackAmplitude:6,feedbackEnvelope:"swell 1",operators:[{frequency:"1√ó",amplitude:14,envelope:"custom"},{frequency:"1√ó",amplitude:12,envelope:"custom"},{frequency:"1√ó",amplitude:10,envelope:"swell 1"},{frequency:"~1√ó",amplitude:10,envelope:"swell 1"}]}},{name:"brass synth 1",midiProgram:62,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"soft",chord:"harmony",filterCutoffHz:4e3,filterResonance:29,filterEnvelope:"steady",vibrato:"none",algorithm:"1‚Üê3‚ÄÉ2‚Üê4",feedbackType:"1‚ü≤‚ÄÉ2‚ü≤",feedbackAmplitude:11,feedbackEnvelope:"swell 1",operators:[{frequency:"1√ó",amplitude:14,envelope:"custom"},{frequency:"1√ó",amplitude:14,envelope:"custom"},{frequency:"1√ó",amplitude:12,envelope:"flare 1"},{frequency:"~1√ó",amplitude:8,envelope:"flare 2"}]}},{name:"brass synth 2",midiProgram:63,generalMidi:!0,settings:{type:"FM",transition:"soft",effects:"reverb",chord:"harmony",filterCutoffHz:4e3,filterResonance:43,filterEnvelope:"twang 3",vibrato:"none",algorithm:"1‚Üê3‚ÄÉ2‚Üê4",feedbackType:"1‚ü≤‚ÄÉ2‚ü≤",feedbackAmplitude:9,feedbackEnvelope:"swell 1",operators:[{frequency:"1√ó",amplitude:15,envelope:"custom"},{frequency:"1√ó",amplitude:15,envelope:"custom"},{frequency:"1√ó",amplitude:10,envelope:"flare 1"},{frequency:"~1√ó",amplitude:7,envelope:"flare 1"}]}},{name:"pulse brass",midiProgram:62,settings:{type:"PWM",effects:"reverb",transition:"soft",chord:"harmony",filterCutoffHz:4e3,filterResonance:29,filterEnvelope:"swell 1",pulseWidth:50,pulseEnvelope:"flare 3",vibrato:"none"}}])},{name:"Reed Presets",presets:t.toNameMap([{name:"soprano sax",midiProgram:64,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"soft",chord:"harmony",filterCutoffHz:2e3,filterResonance:29,filterEnvelope:"steady",vibrato:"none",algorithm:"1‚Üê2‚Üê3‚Üê4",feedbackType:"4‚ü≤",feedbackAmplitude:5,feedbackEnvelope:"swell 1",operators:[{frequency:"1√ó",amplitude:13,envelope:"custom"},{frequency:"4√ó",amplitude:4,envelope:"swell 1"},{frequency:"1√ó",amplitude:7,envelope:"steady"},{frequency:"5√ó",amplitude:4,envelope:"punch"}]}},{name:"alto sax",midiProgram:65,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"soft",chord:"harmony",filterCutoffHz:2e3,filterResonance:43,filterEnvelope:"steady",vibrato:"none",algorithm:"1‚Üê(2‚ÄÇ3‚Üê4)",feedbackType:"1‚ü≤",feedbackAmplitude:4,feedbackEnvelope:"punch",operators:[{frequency:"1√ó",amplitude:13,envelope:"custom"},{frequency:"1√ó",amplitude:6,envelope:"steady"},{frequency:"4√ó",amplitude:6,envelope:"swell 1"},{frequency:"1√ó",amplitude:12,envelope:"steady"}]}},{name:"tenor sax",midiProgram:66,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"soft",chord:"harmony",filterCutoffHz:2828,filterResonance:29,filterEnvelope:"steady",vibrato:"none",algorithm:"1‚Üê2‚Üê3‚Üê4",feedbackType:"1‚ü≤",feedbackAmplitude:6,feedbackEnvelope:"swell 1",operators:[{frequency:"2√ó",amplitude:12,envelope:"custom"},{frequency:"3√ó",amplitude:7,envelope:"steady"},{frequency:"1√ó",amplitude:3,envelope:"steady"},{frequency:"8√ó",amplitude:3,envelope:"steady"}]}},{name:"baritone sax",midiProgram:67,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"soft",chord:"harmony",filterCutoffHz:2828,filterResonance:0,filterEnvelope:"steady",vibrato:"none",algorithm:"1‚Üê(2‚ÄÇ3‚Üê4)",feedbackType:"1‚ü≤",feedbackAmplitude:2,feedbackEnvelope:"swell 2",operators:[{frequency:"1√ó",amplitude:12,envelope:"custom"},{frequency:"8√ó",amplitude:4,envelope:"steady"},{frequency:"4√ó",amplitude:5,envelope:"steady"},{frequency:"1√ó",amplitude:4,envelope:"punch"}]}},{name:"sax synth",midiProgram:64,settings:{type:"FM",effects:"reverb",transition:"soft",chord:"harmony",filterCutoffHz:8e3,filterResonance:0,filterEnvelope:"steady",vibrato:"light",algorithm:"1‚Üê(2‚ÄÇ3‚ÄÇ4)",feedbackType:"1‚ü≤‚ÄÉ2‚ü≤",feedbackAmplitude:4,feedbackEnvelope:"steady",operators:[{frequency:"4√ó",amplitude:15,envelope:"custom"},{frequency:"1√ó",amplitude:15,envelope:"steady"},{frequency:"1√ó",amplitude:0,envelope:"steady"},{frequency:"1√ó",amplitude:0,envelope:"steady"}]}},{name:"shehnai",midiProgram:111,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"soft",chord:"harmony",filterCutoffHz:8e3,filterResonance:0,filterEnvelope:"steady",vibrato:"light",algorithm:"1‚Üê(2‚ÄÇ3‚ÄÇ4)",feedbackType:"1‚ü≤",feedbackAmplitude:3,feedbackEnvelope:"steady",operators:[{frequency:"4√ó",amplitude:15,envelope:"custom"},{frequency:"1√ó",amplitude:8,envelope:"steady"},{frequency:"1√ó",amplitude:0,envelope:"steady"},{frequency:"1√ó",amplitude:0,envelope:"steady"}]}},{name:"oboe",midiProgram:68,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"cross fade",chord:"harmony",filterCutoffHz:4e3,filterResonance:14,filterEnvelope:"swell 1",vibrato:"none",algorithm:"1‚ÄÉ2‚Üê(3‚ÄÇ4)",feedbackType:"2‚ü≤",feedbackAmplitude:2,feedbackEnvelope:"tremolo5",operators:[{frequency:"1√ó",amplitude:7,envelope:"custom"},{frequency:"4√ó",amplitude:12,envelope:"custom"},{frequency:"1√ó",amplitude:6,envelope:"steady"},{frequency:"6√ó",amplitude:2,envelope:"steady"}]}},{name:"english horn",midiProgram:69,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"cross fade",chord:"harmony",filterCutoffHz:2e3,filterResonance:14,filterEnvelope:"steady",vibrato:"none",algorithm:"1‚ÄÉ2‚Üê(3‚ÄÇ4)",feedbackType:"2‚ü≤",feedbackAmplitude:2,feedbackEnvelope:"steady",operators:[{frequency:"4√ó",amplitude:12,envelope:"custom"},{frequency:"2√ó",amplitude:10,envelope:"custom"},{frequency:"1√ó",amplitude:8,envelope:"punch"},{frequency:"8√ó",amplitude:4,envelope:"steady"}]}},{name:"bassoon",midiProgram:70,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"soft",chord:"harmony",filterCutoffHz:707,filterResonance:57,filterEnvelope:"steady",vibrato:"none",algorithm:"1‚Üê(2‚ÄÇ3‚Üê4)",feedbackType:"1‚ü≤",feedbackAmplitude:2,feedbackEnvelope:"steady",operators:[{frequency:"2√ó",amplitude:11,envelope:"custom"},{frequency:"1√ó",amplitude:6,envelope:"steady"},{frequency:"6√ó",amplitude:6,envelope:"swell 1"},{frequency:"1√ó",amplitude:0,envelope:"steady"}]}},{name:"clarinet",midiProgram:71,generalMidi:!0,settings:{type:"harmonics",effects:"reverb",transition:"soft",chord:"harmony",filterCutoffHz:1414,filterResonance:14,filterEnvelope:"steady",interval:"union",vibrato:"none",harmonics:[100,43,86,57,86,71,86,71,71,71,71,71,71,43,71,71,57,57,57,57,57,57,43,43,43,29,14,0]}},{name:"harmonica",midiProgram:22,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"soft",chord:"harmony",filterCutoffHz:5657,filterResonance:29,filterEnvelope:"swell 1",vibrato:"none",algorithm:"1‚Üê(2‚ÄÇ3‚Üê4)",feedbackType:"1‚ü≤",feedbackAmplitude:9,feedbackEnvelope:"tremolo5",operators:[{frequency:"2√ó",amplitude:14,envelope:"custom"},{frequency:"1√ó",amplitude:15,envelope:"steady"},{frequency:"~2√ó",amplitude:2,envelope:"twang 3"},{frequency:"1√ó",amplitude:0,envelope:"steady"}]}}])},{name:"Flute Presets",presets:t.toNameMap([{name:"flute 1",midiProgram:73,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"soft",chord:"harmony",filterCutoffHz:5657,filterResonance:14,filterEnvelope:"steady",vibrato:"none",algorithm:"1‚Üê(2‚ÄÇ3‚ÄÇ4)",feedbackType:"4‚ü≤",feedbackAmplitude:7,feedbackEnvelope:"decay 2",operators:[{frequency:"1√ó",amplitude:15,envelope:"custom"},{frequency:"2√ó",amplitude:4,envelope:"steady"},{frequency:"1√ó",amplitude:3,envelope:"steady"},{frequency:"~1√ó",amplitude:1,envelope:"punch"}]}},{name:"recorder",midiProgram:74,generalMidi:!0,settings:{type:"harmonics",effects:"reverb",transition:"soft",chord:"harmony",filterCutoffHz:4e3,filterResonance:29,filterEnvelope:"swell 2",interval:"union",vibrato:"none",harmonics:[100,43,57,43,57,43,43,43,43,43,43,43,43,29,29,29,29,29,29,29,14,14,14,14,14,14,14,0]}},{name:"whistle",midiProgram:78,generalMidi:!0,settings:{type:"harmonics",effects:"chorus & reverb",transition:"soft",chord:"harmony",filterCutoffHz:2e3,filterResonance:43,filterEnvelope:"steady",interval:"union",vibrato:"delayed",harmonics:[100,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},{name:"ocarina",midiProgram:79,generalMidi:!0,settings:{type:"harmonics",effects:"reverb",transition:"soft",chord:"harmony",filterCutoffHz:2828,filterResonance:43,filterEnvelope:"steady",interval:"union",vibrato:"none",harmonics:[100,14,57,14,29,14,14,14,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},{name:"piccolo",midiProgram:72,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"soft",chord:"harmony",filterCutoffHz:5657,filterResonance:43,filterEnvelope:"steady",vibrato:"none",algorithm:"1‚Üê3‚ÄÉ2‚Üê4",feedbackType:"4‚ü≤",feedbackAmplitude:15,feedbackEnvelope:"twang 1",operators:[{frequency:"1√ó",amplitude:15,envelope:"custom"},{frequency:"1√ó",amplitude:10,envelope:"custom"},{frequency:"~2√ó",amplitude:3,envelope:"punch"},{frequency:"~1√ó",amplitude:5,envelope:"punch"}]}},{name:"shakuhachi",midiProgram:77,generalMidi:!0,settings:{type:"FM",effects:"chorus & reverb",transition:"soft",chord:"harmony",filterCutoffHz:4e3,filterResonance:14,filterEnvelope:"steady",vibrato:"delayed",algorithm:"1‚Üê(2‚ÄÇ3‚Üê4)",feedbackType:"3‚Üí4",feedbackAmplitude:15,feedbackEnvelope:"steady",operators:[{frequency:"1√ó",amplitude:15,envelope:"custom"},{frequency:"2√ó",amplitude:3,envelope:"punch"},{frequency:"~1√ó",amplitude:4,envelope:"twang 1"},{frequency:"20√ó",amplitude:15,envelope:"steady"}]}},{name:"pan flute",midiProgram:75,generalMidi:!0,settings:{type:"spectrum",effects:"reverb",transition:"soft",chord:"harmony",filterCutoffHz:8e3,filterResonance:43,filterEnvelope:"steady",spectrum:[100,0,0,0,0,0,0,14,0,0,0,71,0,0,14,0,57,0,29,14,29,14,14,29,14,29,14,14,29,14]}},{name:"blown bottle",midiProgram:76,generalMidi:!0,settings:{type:"FM",effects:"chorus & reverb",transition:"cross fade",chord:"harmony",filterCutoffHz:5657,filterResonance:57,filterEnvelope:"steady",vibrato:"none",algorithm:"1‚ÄÉ2‚ÄÉ3‚ÄÉ4",feedbackType:"1‚ü≤ 2‚ü≤ 3‚ü≤ 4‚ü≤",feedbackAmplitude:7,feedbackEnvelope:"twang 1",operators:[{frequency:"1√ó",amplitude:15,envelope:"custom"},{frequency:"3√ó",amplitude:4,envelope:"custom"},{frequency:"6√ó",amplitude:2,envelope:"custom"},{frequency:"11√ó",amplitude:2,envelope:"custom"}]}},{name:"calliope",midiProgram:82,generalMidi:!0,settings:{type:"spectrum",transition:"cross fade",effects:"reverb",chord:"harmony",filterCutoffHz:5657,filterResonance:14,filterEnvelope:"steady",spectrum:[100,0,0,0,0,0,0,86,0,0,0,71,0,0,57,0,43,0,29,14,14,29,14,14,14,14,14,14,14,14]}},{name:"chiffer",midiProgram:83,generalMidi:!0,settings:{type:"spectrum",effects:"reverb",transition:"hard",chord:"harmony",filterCutoffHz:2e3,filterResonance:14,filterEnvelope:"punch",spectrum:[86,0,0,0,0,0,0,71,0,0,0,71,0,0,57,0,57,0,43,14,14,43,14,29,14,29,29,29,29,14]}},{name:"breath noise",midiProgram:121,generalMidi:!0,settings:{type:"spectrum",effects:"reverb",transition:"cross fade",chord:"strum",filterCutoffHz:5657,filterResonance:14,filterEnvelope:"twang 1",spectrum:[71,0,0,0,0,0,0,29,0,0,0,71,0,0,29,0,100,29,14,29,100,29,100,14,14,71,0,29,0,0]}},{name:"flute 2",midiProgram:73,generalMidi:!0,settings:{type:"harmonics",effects:"reverb",transition:"seamless",chord:"harmony",filterCutoffHz:1414,filterResonance:14,filterEnvelope:"steady",interval:"union",vibrato:"delayed",harmonics:[100,43,86,57,86,71,86,71,71,71,71,71,71,43,71,71,57,57,57,57,57,57,43,43,43,29,14,0]}}])},{name:"Pad Presets",presets:t.toNameMap([{name:"new age pad",midiProgram:88,generalMidi:!0,settings:{type:"FM",effects:"chorus & reverb",transition:"hard fade",chord:"harmony",filterCutoffHz:8e3,filterResonance:43,filterEnvelope:"twang 3",vibrato:"none",algorithm:"1‚Üê(2‚ÄÇ3‚Üê4)",feedbackType:"1‚ü≤‚ÄÉ2‚ü≤",feedbackAmplitude:3,feedbackEnvelope:"swell 3",operators:[{frequency:"2√ó",amplitude:14,envelope:"custom"},{frequency:"~1√ó",amplitude:4,envelope:"swell 2"},{frequency:"6√ó",amplitude:3,envelope:"twang 3"},{frequency:"13√ó",amplitude:3,envelope:"steady"}]}},{name:"warm pad",midiProgram:89,generalMidi:!0,settings:{type:"FM",effects:"chorus & reverb",transition:"soft fade",chord:"harmony",filterCutoffHz:2828,filterResonance:29,filterEnvelope:"swell 3",vibrato:"none",algorithm:"1‚Üê(2‚ÄÇ3‚ÄÇ4)",feedbackType:"1‚ü≤",feedbackAmplitude:7,feedbackEnvelope:"steady",operators:[{frequency:"1√ó",amplitude:14,envelope:"custom"},{frequency:"1√ó",amplitude:6,envelope:"swell 1"},{frequency:"1√ó",amplitude:0,envelope:"steady"},{frequency:"1√ó",amplitude:0,envelope:"steady"}]}},{name:"polysynth pad",midiProgram:90,generalMidi:!0,settings:{type:"chip",transition:"hard fade",effects:"chorus & reverb",chord:"harmony",filterCutoffHz:2828,filterResonance:43,filterEnvelope:"twang 3",wave:"sawtooth",interval:"hum",vibrato:"delayed"}},{name:"space voice pad",midiProgram:91,generalMidi:!0,settings:{type:"FM",effects:"chorus & reverb",transition:"medium fade",chord:"harmony",filterCutoffHz:4e3,filterResonance:71,filterEnvelope:"steady",vibrato:"none",algorithm:"(1‚ÄÇ2‚ÄÇ3)‚Üê4",feedbackType:"1‚ü≤ 2‚ü≤ 3‚ü≤ 4‚ü≤",feedbackAmplitude:5,feedbackEnvelope:"swell 2",operators:[{frequency:"1√ó",amplitude:10,envelope:"custom"},{frequency:"2√ó",amplitude:8,envelope:"custom"},{frequency:"3√ó",amplitude:7,envelope:"custom"},{frequency:"11√ó",amplitude:1,envelope:"punch"}]}},{name:"bowed glass pad",midiProgram:92,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"soft fade",chord:"harmony",filterCutoffHz:4e3,filterResonance:14,filterEnvelope:"twang 3",vibrato:"none",algorithm:"1‚Üê3‚ÄÉ2‚Üê4",feedbackType:"1‚ü≤‚ÄÉ2‚ü≤",feedbackAmplitude:0,feedbackEnvelope:"steady",operators:[{frequency:"1√ó",amplitude:10,envelope:"custom"},{frequency:"2√ó",amplitude:12,envelope:"custom"},{frequency:"3√ó",amplitude:7,envelope:"twang 3"},{frequency:"7√ó",amplitude:4,envelope:"flare 3"}]}},{name:"metallic pad",midiProgram:93,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"medium fade",chord:"harmony",filterCutoffHz:5657,filterResonance:14,filterEnvelope:"twang 3",vibrato:"none",algorithm:"1‚Üê3‚ÄÉ2‚Üê4",feedbackType:"1‚ü≤‚ÄÉ2‚ü≤",feedbackAmplitude:13,feedbackEnvelope:"twang 3",operators:[{frequency:"1√ó",amplitude:15,envelope:"custom"},{frequency:"~1√ó",amplitude:9,envelope:"custom"},{frequency:"1√ó",amplitude:7,envelope:"swell 2"},{frequency:"11√ó",amplitude:7,envelope:"steady"}]}},{name:"sweep pad",midiProgram:95,generalMidi:!0,settings:{type:"chip",effects:"chorus & reverb",transition:"soft fade",chord:"harmony",filterCutoffHz:4e3,filterResonance:86,filterEnvelope:"flare 3",wave:"sawtooth",interval:"hum",vibrato:"none"}},{name:"atmosphere",midiProgram:99,generalMidi:!0,settings:{type:"FM",effects:"chorus & reverb",transition:"hard fade",chord:"strum",filterCutoffHz:4e3,filterResonance:29,filterEnvelope:"steady",vibrato:"none",algorithm:"1‚Üê(2‚ÄÇ3‚ÄÇ4)",feedbackType:"3‚ü≤‚ÄÉ4‚ü≤",feedbackAmplitude:3,feedbackEnvelope:"steady",operators:[{frequency:"1√ó",amplitude:14,envelope:"custom"},{frequency:"1√ó",amplitude:10,envelope:"swell 3"},{frequency:"3√ó",amplitude:7,envelope:"twang 2"},{frequency:"1√ó",amplitude:7,envelope:"twang 3"}]}},{name:"brightness",midiProgram:100,generalMidi:!0,settings:{type:"harmonics",effects:"chorus & reverb",transition:"medium fade",chord:"harmony",filterCutoffHz:2828,filterResonance:14,filterEnvelope:"twang 3",interval:"octave",vibrato:"none",harmonics:[100,86,86,86,43,57,43,71,43,43,43,57,43,43,57,71,57,43,29,43,57,57,43,29,29,29,29,14]}},{name:"goblins",midiProgram:101,generalMidi:!0,settings:{type:"FM",effects:"chorus & reverb",transition:"soft fade",chord:"harmony",filterCutoffHz:1414,filterResonance:14,filterEnvelope:"swell 2",vibrato:"none",algorithm:"1‚Üê2‚Üê3‚Üê4",feedbackType:"1‚ü≤",feedbackAmplitude:10,feedbackEnvelope:"flare 3",operators:[{frequency:"1√ó",amplitude:15,envelope:"custom"},{frequency:"4√ó",amplitude:5,envelope:"swell 3"},{frequency:"1√ó",amplitude:10,envelope:"tremolo1"},{frequency:"1√ó",amplitude:0,envelope:"steady"}]}},{name:"sci-fi",midiProgram:103,generalMidi:!0,settings:{type:"FM",effects:"chorus & reverb",transition:"medium fade",chord:"harmony",filterCutoffHz:5657,filterResonance:14,filterEnvelope:"twang 3",vibrato:"none",algorithm:"(1‚ÄÇ2)‚Üê3‚Üê4",feedbackType:"1‚ü≤ 2‚ü≤ 3‚ü≤ 4‚ü≤",feedbackAmplitude:8,feedbackEnvelope:"twang 3",operators:[{frequency:"~1√ó",amplitude:13,envelope:"custom"},{frequency:"2√ó",amplitude:10,envelope:"custom"},{frequency:"5√ó",amplitude:5,envelope:"twang 3"},{frequency:"11√ó",amplitude:8,envelope:"tremolo5"}]}},{name:"flutter pad",midiProgram:90,settings:{type:"FM",effects:"chorus & reverb",transition:"hard fade",chord:"harmony",filterCutoffHz:4e3,filterResonance:86,filterEnvelope:"twang 3",vibrato:"delayed",algorithm:"(1‚ÄÇ2)‚Üê(3‚ÄÇ4)",feedbackType:"1‚ü≤‚ÄÉ2‚ü≤‚ÄÉ3‚ü≤",feedbackAmplitude:9,feedbackEnvelope:"steady",operators:[{frequency:"1√ó",amplitude:13,envelope:"custom"},{frequency:"5√ó",amplitude:7,envelope:"custom"},{frequency:"7√ó",amplitude:5,envelope:"tremolo1"},{frequency:"~1√ó",amplitude:6,envelope:"punch"}]}},{name:"feedback pad",midiProgram:89,settings:{type:"FM",effects:"reverb",transition:"soft fade",chord:"custom interval",filterCutoffHz:8e3,filterResonance:0,filterEnvelope:"steady",vibrato:"none",algorithm:"1‚ÄÉ2‚ÄÉ3‚ÄÉ4",feedbackType:"1‚ü≤ 2‚ü≤ 3‚ü≤ 4‚ü≤",feedbackAmplitude:7,feedbackEnvelope:"swell 2",operators:[{frequency:"1√ó",amplitude:15,envelope:"custom"},{frequency:"1√ó",amplitude:15,envelope:"custom"},{frequency:"1√ó",amplitude:15,envelope:"custom"},{frequency:"~1√ó",amplitude:15,envelope:"custom"}]}}])},{name:"Drum Presets",presets:t.toNameMap([{name:"standard drumset",midiProgram:116,isNoise:!0,settings:{type:"drumset",effects:"reverb",drums:[{filterEnvelope:"twang 1",spectrum:[57,71,71,86,86,86,71,71,71,71,57,57,57,57,43,43,43,43,29,29,29,29,29,29,29,29,29,29,29,29]},{filterEnvelope:"twang 1",spectrum:[0,0,0,100,71,71,57,86,57,57,57,71,43,43,57,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43]},{filterEnvelope:"twang 1",spectrum:[0,0,0,0,100,57,43,43,29,57,43,29,71,43,43,43,43,57,43,43,43,43,43,43,43,43,29,43,43,43]},{filterEnvelope:"twang 1",spectrum:[0,0,0,0,0,71,57,43,43,43,57,57,43,29,57,43,43,43,29,43,57,43,43,43,43,43,43,29,43,43]},{filterEnvelope:"decay 2",spectrum:[0,14,29,43,86,71,29,43,43,43,43,29,71,29,71,29,43,43,43,43,57,43,43,57,43,43,43,57,57,57]},{filterEnvelope:"decay 1",spectrum:[0,0,14,14,14,14,29,29,29,43,43,43,57,57,57,71,71,71,71,71,71,71,71,57,57,57,57,43,43,43]},{filterEnvelope:"twang 3",spectrum:[43,43,43,71,29,29,43,43,43,29,43,43,43,29,29,43,43,29,29,29,57,14,57,43,43,57,43,43,57,57]},{filterEnvelope:"decay 3",spectrum:[29,43,43,43,43,29,29,43,29,29,43,29,14,29,43,29,43,29,57,29,43,57,43,71,43,71,57,57,71,71]},{filterEnvelope:"twang 3",spectrum:[43,29,29,43,29,29,29,57,29,29,29,57,43,43,29,29,57,43,43,43,71,43,43,71,57,71,71,71,71,71]},{filterEnvelope:"decay 3",spectrum:[57,57,57,43,57,57,43,43,57,43,43,43,71,57,43,57,86,71,57,86,71,57,86,100,71,86,86,86,86,86]},{filterEnvelope:"flare 1",spectrum:[0,0,14,14,14,14,29,29,29,43,43,43,57,57,71,71,86,86,100,100,100,100,100,100,100,100,86,57,29,0]},{filterEnvelope:"decay 2",spectrum:[14,14,14,14,29,14,14,29,14,43,14,43,57,86,57,57,100,57,43,43,57,100,57,43,29,14,0,0,0,0]}]}},{name:"steel pan",midiProgram:114,generalMidi:!0,settings:{type:"FM",effects:"chorus & reverb",transition:"hard fade",chord:"harmony",filterCutoffHz:2828,filterResonance:0,filterEnvelope:"decay 2",vibrato:"none",algorithm:"1‚Üê(2‚ÄÇ3‚Üê4)",feedbackType:"1‚ü≤",feedbackAmplitude:0,feedbackEnvelope:"steady",operators:[{frequency:"~1√ó",amplitude:14,envelope:"custom"},{frequency:"7√ó",amplitude:3,envelope:"flare 1"},{frequency:"3√ó",amplitude:5,envelope:"flare 2"},{frequency:"4√ó",amplitude:4,envelope:"swell 2"}]}},{name:"steel pan synth",midiProgram:114,settings:{type:"FM",effects:"reverb",transition:"hard",chord:"harmony",filterCutoffHz:2828,filterResonance:0,filterEnvelope:"twang 1",vibrato:"none",algorithm:"1‚ÄÉ2‚ÄÉ3‚Üê4",feedbackType:"1‚ü≤",feedbackAmplitude:5,feedbackEnvelope:"flare 1",operators:[{frequency:"~1√ó",amplitude:12,envelope:"custom"},{frequency:"2√ó",amplitude:15,envelope:"custom"},{frequency:"4√ó",amplitude:14,envelope:"flare 1"},{frequency:"~1√ó",amplitude:3,envelope:"flare 2"}]}},{name:"timpani",midiProgram:47,generalMidi:!0,settings:{type:"spectrum",effects:"reverb",transition:"hard fade",chord:"harmony",filterCutoffHz:4e3,filterResonance:29,filterEnvelope:"twang 2",spectrum:[100,0,0,0,86,0,0,71,0,14,43,14,43,43,0,29,43,29,29,29,43,29,43,29,43,43,43,43,43,43]}},{name:"dark strike",midiProgram:47,settings:{type:"spectrum",effects:"reverb",transition:"hard fade",chord:"harmony",filterCutoffHz:4e3,filterResonance:29,filterEnvelope:"twang 2",spectrum:[0,0,0,0,14,14,14,29,29,43,43,86,43,43,43,29,86,29,29,29,86,29,14,14,14,14,0,0,0,0]}},{name:"woodblock",midiProgram:115,generalMidi:!0,isNoise:!0,midiSubharmonicOctaves:-2.5,settings:{type:"spectrum",effects:"reverb",transition:"hard fade",chord:"strum",filterCutoffHz:2828,filterResonance:14,filterEnvelope:"twang 1",spectrum:[0,14,29,43,43,57,86,86,71,57,57,43,43,57,86,86,43,43,71,57,57,57,57,57,86,86,71,71,71,71]}},{name:"taiko drum",midiProgram:116,generalMidi:!0,isNoise:!0,midiSubharmonicOctaves:-.5,settings:{type:"spectrum",effects:"reverb",transition:"hard fade",chord:"strum",filterCutoffHz:2828,filterResonance:29,filterEnvelope:"twang 1",spectrum:[71,100,100,43,43,71,71,43,43,43,43,43,43,57,29,57,43,57,43,43,57,43,43,43,43,43,43,43,43,43]}},{name:"melodic drum",midiProgram:117,generalMidi:!0,isNoise:!0,midiSubharmonicOctaves:-1.5,settings:{type:"spectrum",effects:"reverb",transition:"hard fade",chord:"strum",filterCutoffHz:2828,filterResonance:43,filterEnvelope:"twang 1",spectrum:[100,71,71,57,57,43,43,71,43,43,43,57,43,43,57,43,43,43,43,29,29,29,29,29,29,29,29,29,29,29]}},{name:"drum synth",midiProgram:118,generalMidi:!0,isNoise:!0,midiSubharmonicOctaves:-2,settings:{type:"spectrum",effects:"reverb",transition:"hard fade",chord:"harmony",filterCutoffHz:4e3,filterResonance:43,filterEnvelope:"decay 1",spectrum:[100,86,71,57,43,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29]}},{name:"tom-tom",midiProgram:116,isNoise:!0,midiSubharmonicOctaves:-1,settings:{type:"spectrum",effects:"reverb",transition:"hard fade",chord:"strum",filterCutoffHz:2e3,filterResonance:14,filterEnvelope:"twang 1",spectrum:[100,29,14,0,0,86,14,43,29,86,29,14,29,57,43,43,43,43,57,43,43,43,29,57,43,43,43,43,43,43]}},{name:"metal pipe",midiProgram:117,isNoise:!0,midiSubharmonicOctaves:-1.5,settings:{type:"spectrum",effects:"reverb",transition:"hard fade",chord:"strum",filterCutoffHz:8e3,filterResonance:14,filterEnvelope:"twang 2",spectrum:[29,43,86,43,43,43,43,43,100,29,14,14,100,14,14,0,0,0,0,0,14,29,29,14,0,0,14,29,0,0]}}])},{name:"Novelty Presets",presets:t.toNameMap([{name:"guitar fret noise",midiProgram:120,generalMidi:!0,settings:{type:"spectrum",effects:"reverb",transition:"hard",chord:"harmony",filterCutoffHz:8e3,filterResonance:86,filterEnvelope:"flare 1",spectrum:[0,0,0,0,0,0,0,0,0,0,0,0,0,14,0,0,0,29,14,0,0,43,0,43,0,71,43,0,57,0]}},{name:"fifth saw lead",midiProgram:86,generalMidi:!0,midiSubharmonicOctaves:1,settings:{type:"chip",effects:"chorus & reverb",transition:"hard fade",chord:"harmony",filterCutoffHz:2828,filterResonance:57,filterEnvelope:"twang 3",wave:"sawtooth",interval:"fifth",vibrato:"none"}},{name:"fifth swell",midiProgram:86,midiSubharmonicOctaves:1,settings:{type:"chip",effects:"chorus & reverb",transition:"hard fade",chord:"harmony",filterCutoffHz:2e3,filterResonance:57,filterEnvelope:"swell 3",wave:"sawtooth",interval:"fifth",vibrato:"none"}},{name:"soundtrack",midiProgram:97,generalMidi:!0,settings:{type:"chip",effects:"chorus & reverb",transition:"soft fade",chord:"harmony",filterCutoffHz:2e3,filterResonance:14,filterEnvelope:"flare 3",wave:"sawtooth",interval:"fifth",vibrato:"none"}},{name:"reverse cymbal",midiProgram:119,generalMidi:!0,isNoise:!0,midiSubharmonicOctaves:-3,settings:{type:"spectrum",effects:"none",transition:"soft",chord:"harmony",filterCutoffHz:4e3,filterResonance:14,filterEnvelope:"swell 3",spectrum:[29,57,57,29,57,57,29,29,43,29,29,43,29,29,57,57,14,57,14,57,71,71,57,86,57,100,86,86,86,86]}},{name:"seashore",midiProgram:122,generalMidi:!0,isNoise:!0,midiSubharmonicOctaves:-3,settings:{type:"spectrum",transition:"soft fade",effects:"reverb",chord:"harmony",filterCutoffHz:2828,filterResonance:0,filterEnvelope:"swell 3",spectrum:[14,14,29,29,43,43,43,57,57,57,57,57,57,71,71,71,71,71,71,71,71,71,71,71,71,71,71,71,71,57]}},{name:"bird tweet",midiProgram:123,generalMidi:!0,settings:{type:"harmonics",effects:"reverb",transition:"soft",chord:"strum",filterCutoffHz:2828,filterResonance:0,filterEnvelope:"decay 1",interval:"hum",vibrato:"heavy",harmonics:[0,0,14,100,14,0,0,14,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},{name:"telephone ring",midiProgram:124,generalMidi:!0,settings:{type:"FM",effects:"reverb",transition:"hard",chord:"arpeggio",filterCutoffHz:4e3,filterResonance:14,filterEnvelope:"tremolo4",vibrato:"none",algorithm:"1‚Üê(2‚ÄÇ3‚ÄÇ4)",feedbackType:"1‚ü≤",feedbackAmplitude:2,feedbackEnvelope:"steady",operators:[{frequency:"2√ó",amplitude:12,envelope:"custom"},{frequency:"1√ó",amplitude:4,envelope:"tremolo1"},{frequency:"20√ó",amplitude:1,envelope:"steady"},{frequency:"1√ó",amplitude:0,envelope:"steady"}]}},{name:"helicopter",midiProgram:125,generalMidi:!0,isNoise:!0,midiSubharmonicOctaves:-.5,settings:{type:"spectrum",effects:"reverb",transition:"seamless",chord:"arpeggio",filterCutoffHz:1414,filterResonance:14,filterEnvelope:"tremolo4",spectrum:[14,43,43,57,57,57,71,71,71,71,86,86,86,86,86,86,86,86,86,86,86,71,71,71,71,71,71,71,57,57]}},{name:"applause",midiProgram:126,generalMidi:!0,isNoise:!0,midiSubharmonicOctaves:-3,settings:{type:"spectrum",effects:"reverb",transition:"soft fade",chord:"harmony",filterCutoffHz:2e3,filterResonance:14,filterEnvelope:"swell 3",spectrum:[14,14,29,29,29,43,43,57,71,71,86,86,86,71,71,57,57,57,71,86,86,86,86,86,71,71,57,57,57,57]}},{name:"gunshot",midiProgram:127,generalMidi:!0,isNoise:!0,midiSubharmonicOctaves:-2,settings:{type:"spectrum",effects:"reverb",transition:"hard fade",chord:"strum",filterCutoffHz:1414,filterResonance:29,filterEnvelope:"twang 1",spectrum:[14,29,43,43,57,57,57,71,71,71,86,86,86,86,86,86,86,86,86,86,86,71,71,71,71,57,57,57,57,43]}},{name:"scoot",midiProgram:92,settings:{type:"chip",transition:"hard",effects:"reverb",chord:"harmony",filterCutoffHz:707,filterResonance:86,filterEnvelope:"flare 1",wave:"sawtooth",interval:"shimmer",vibrato:"none"}},{name:"buzz saw",midiProgram:30,settings:{type:"FM",effects:"reverb",transition:"soft",chord:"custom interval",filterCutoffHz:2e3,filterResonance:0,filterEnvelope:"steady",vibrato:"none",algorithm:"1‚Üê2‚Üê3‚Üê4",feedbackType:"1‚ü≤",feedbackAmplitude:0,feedbackEnvelope:"steady",operators:[{frequency:"5√ó",amplitude:13,envelope:"custom"},{frequency:"1√ó",amplitude:10,envelope:"steady"},{frequency:"~1√ó",amplitude:6,envelope:"steady"},{frequency:"11√ó",amplitude:12,envelope:"steady"}]}},{name:"mosquito",midiProgram:93,settings:{type:"PWM",effects:"reverb",transition:"cross fade",chord:"harmony",filterCutoffHz:2828,filterResonance:57,filterEnvelope:"steady",pulseWidth:4.40625,pulseEnvelope:"tremolo6",vibrato:"shaky"}},{name:"breathing",midiProgram:126,isNoise:!0,midiSubharmonicOctaves:-1,settings:{type:"spectrum",effects:"reverb",transition:"hard fade",chord:"harmony",filterCutoffHz:2e3,filterResonance:14,filterEnvelope:"swell 2",spectrum:[14,14,14,29,29,29,29,29,43,29,29,43,43,43,29,29,71,43,86,86,57,100,86,86,86,86,71,86,71,57]}},{name:"klaxon synth",midiProgram:125,isNoise:!0,midiSubharmonicOctaves:-1,settings:{type:"noise",effects:"reverb",transition:"slide",chord:"harmony",filterCutoffHz:2e3,filterResonance:86,filterEnvelope:"steady",wave:"buzz"}},{name:"theremin",midiProgram:40,settings:{type:"harmonics",effects:"reverb",transition:"slide",chord:"harmony",filterCutoffHz:4e3,filterResonance:14,filterEnvelope:"steady",interval:"union",vibrato:"heavy",harmonics:[100,71,57,43,29,29,14,14,14,14,14,14,14,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}}])}]),t.EditorConfig=e}(beepbox||(beepbox={})),function(t){class e{static resetColors(){this.colorLookup.clear()}static getChannelColor(i,s){if(e.colorLookup.has(s))return e.colorLookup.get(s);if(s<i.pitchChannelCount){let i={channelDim:"hsl("+6.1*s/t.Config.pitchChannelCountMax*256%256+","+83.3*(1-.1*Math.floor(s/7))+"%,"+40*(1-.05*Math.floor(s/7))+"%)",channelBright:"hsl("+6.1*s/t.Config.pitchChannelCountMax*256%256+","+100*(1-.1*Math.floor(s/7))+"%,"+67.5*(1-.05*Math.floor(s/7))+"%)",noteDim:"hsl("+6.1*s/t.Config.pitchChannelCountMax*256%256+","+93.9*(1-.1*Math.floor(s/7))+"%,"+25*(1-.05*Math.floor(s/7))+"%)",noteBright:"hsl("+6.1*s/t.Config.pitchChannelCountMax*256%256+","+100*(1-.05*Math.floor(s/7))+"%,"+85.6*(1-.025*Math.floor(s/7))+"%)"};return e.colorLookup.set(s,i),e.colorLookup.get(s)}{let n={channelDim:"hsl("+2*(s-i.pitchChannelCount)/t.Config.noiseChannelCountMax*256+",25%,42%)",channelBright:"hsl("+2*(s-i.pitchChannelCount)/t.Config.noiseChannelCountMax*256+",33%,63.5%)",noteDim:"hsl("+2*(s-i.pitchChannelCount)/t.Config.noiseChannelCountMax*256+",33.5%,55%)",noteBright:"hsl("+2*(s-i.pitchChannelCount)/t.Config.noiseChannelCountMax*256+",46.5%,74%)"};return e.colorLookup.set(s,n),e.colorLookup.get(s)}}}e.colorLookup=new Map,e.pitchBackgroundColors=["#446688","#3E444E","#4A443A","#3E444E","#4A443A","#3E444E","#4A443A","#446688","#4A443A","#3E444E","#4A443A","#3E444E"],t.ColorConfig=e}(beepbox||(beepbox={})),function(t){function e(t){if(!function(t){return!(!t||t&t-1)}(t))throw new Error("FFT array length must be a power of 2.");return Math.round(Math.log(t)/Math.log(2))}t.scaleElementsByFactor=function(t,e){for(let i=0;i<t.length;i++)t[i]*=e},t.inverseRealFourierTransform=function(t,i){const s=e(i);if(i<4)throw new Error("FFT array length must be at least 4.");for(let e=s-1;e>=2;e--){const s=1<<e,n=s>>1,o=s<<1,h=2*Math.PI/o,r=Math.cos(h),a=Math.sin(h),l=2*r;for(let e=0;e<i;e+=o){const i=e,o=i+n,h=i+s,c=h+n,f=h+s,d=t[i],u=t[h];t[i]=d+u,t[o]*=2,t[h]=d-u,t[c]*=2;let m=r,p=-a,y=1,b=0;for(let e=1;e<n;e++){const s=i+e,n=h-e,o=h+e,r=f-e,a=t[s],c=t[n],d=t[o],u=t[r],g=a-c,v=d+u;t[s]=a+c,t[n]=u-d,t[o]=g*m-v*p,t[r]=v*m+g*p;const w=l*m-y,M=l*p-b;y=m,b=p,m=w,p=M}}}for(let e=0;e<i;e+=4){const i=e+1,s=e+2,n=e+3,o=t[e],h=2*t[i],r=t[s],a=2*t[n],l=o+r,c=o-r;t[e]=l+h,t[i]=l-h,t[s]=c+a,t[n]=c-a}!function(t,i){const s=e(i);if(s>16)throw new Error("FFT array length must not be greater than 2^16.");const n=16-s;for(let e=0;e<i;e++){let i;if((i=((i=(61680&(i=(52428&(i=(43690&e)>>1|(21845&e)<<1))>>2|(13107&i)<<2))>>4|(3855&i)<<4)>>8|(255&i)<<8)>>n)>e){let s=t[e];t[e]=t[i],t[i]=s}}}(t,i)}}(beepbox||(beepbox={})),function(t){t.Deque=class{constructor(){this.t=1,this.i=[void 0],this.s=0,this.o=0,this.h=0}pushFront(t){this.h>=this.t&&this.l(),this.o=this.o-1&this.s,this.i[this.o]=t,this.h++}pushBack(t){this.h>=this.t&&this.l(),this.i[this.o+this.h&this.s]=t,this.h++}popFront(){if(this.h<=0)throw new Error("No elements left to pop.");const t=this.i[this.o];return this.i[this.o]=void 0,this.o=this.o+1&this.s,this.h--,t}popBack(){if(this.h<=0)throw new Error("No elements left to pop.");this.h--;const t=this.o+this.h&this.s,e=this.i[t];return this.i[t]=void 0,e}peakFront(){if(this.h<=0)throw new Error("No elements left to pop.");return this.i[this.o]}peakBack(){if(this.h<=0)throw new Error("No elements left to pop.");return this.i[this.o+this.h-1&this.s]}count(){return this.h}set(t,e){if(t<0||t>=this.h)throw new Error("Invalid index");this.i[this.o+t&this.s]=e}get(t){if(t<0||t>=this.h)throw new Error("Invalid index");return this.i[this.o+t&this.s]}remove(t){if(t<0||t>=this.h)throw new Error("Invalid index");if(t<=this.h>>1){for(;t>0;)this.set(t,this.get(t-1)),t--;this.popFront()}else{for(t++;t<this.h;)this.set(t-1,this.get(t)),t++;this.popBack()}}l(){if(this.t>=1073741824)throw new Error("Capacity too big.");this.t=this.t<<1;const t=this.i,e=new Array(this.t),i=0|this.h,s=0|this.o;for(let n=0;n<i;n++)e[n]=t[s+n&this.s];for(let t=i;t<this.t;t++)e[t]=void 0;this.o=0,this.i=e,this.s=this.t-1}}}(beepbox||(beepbox={})),function(t){const e=[48,49,50,51,52,53,54,55,56,57,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,45,95],i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,62,62,0,0,1,2,3,4,5,6,7,8,9,0,0,0,0,0,0,0,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,0,0,0,0,63,0,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,0,0,0,0,0];class s{constructor(t,e,s){this.u=[],this.m=0;for(let n=e;n<s;n++){const e=i[t.charCodeAt(n)];this.u.push(e>>5&1),this.u.push(e>>4&1),this.u.push(e>>3&1),this.u.push(e>>2&1),this.u.push(e>>1&1),this.u.push(1&e)}}read(t){let e=0;for(;t>0;)e<<=1,e+=this.u[this.m++],t--;return e}readLongTail(t,e){let i=t,s=e;for(;this.u[this.m++];)i+=1<<s,s++;for(;s>0;)s--,this.u[this.m++]&&(i+=1<<s);return i}readPartDuration(){return this.readLongTail(1,3)}readLegacyPartDuration(){return this.readLongTail(1,2)}readPinCount(){return this.readLongTail(1,0)}readPitchInterval(){return this.read(1)?-this.readLongTail(1,3):this.readLongTail(1,3)}}class n{constructor(){this.u=[]}write(t,e){for(t--;t>=0;)this.u.push(e>>>t&1),t--}writeLongTail(t,e,i){if(i<t)throw new Error("value out of bounds");i-=t;let s=e;for(;i>=1<<s;)this.u.push(1),i-=1<<s,s++;for(this.u.push(0);s>0;)s--,this.u.push(i>>>s&1)}writePartDuration(t){this.writeLongTail(1,3,t)}writePinCount(t){this.writeLongTail(1,0,t)}writePitchInterval(t){t<0?(this.write(1,1),this.writeLongTail(1,3,-t)):(this.write(1,0),this.writeLongTail(1,3,t))}concat(t){this.u=this.u.concat(t.u)}encodeBase64(t){for(let i=0;i<this.u.length;i+=6){const s=this.u[i]<<5|this.u[i+1]<<4|this.u[i+2]<<3|this.u[i+3]<<2|this.u[i+4]<<1|this.u[i+5];t.push(e[s])}return t}lengthBase64(){return Math.ceil(this.u.length/6)}}function o(t,e,i){return{interval:t,time:e,volume:i}}function h(t,e,i){return i<=(e-=1)?i>=t?i:t:e}t.makeNotePin=o;class r{constructor(t,e,i,s,n=!1){this.pitches=[t],this.pins=[o(0,0,s),o(0,i-e,n?0:s)],this.start=e,this.end=i}pickMainInterval(){let t=0,e=0;for(let i=1;i<this.pins.length;i++){const s=this.pins[i-1],n=this.pins[i];if(s.interval==n.interval){const i=n.time-s.time;t<i&&(t=i,e=s.interval)}}if(0==t){let t=0;for(let i=0;i<this.pins.length;i++){const s=this.pins[i];t<s.volume&&(t=s.volume,e=s.interval)}}return e}}t.Note=r;class a{constructor(){this.notes=[],this.instrument=0}cloneNotes(){const t=[];for(const e of this.notes){const i=new r(-1,e.start,e.end,6);i.pitches=e.pitches.concat(),i.pins=[];for(const t of e.pins)i.pins.push(o(t.interval,t.time,t.volume));t.push(i)}return t}reset(){this.notes.length=0,this.instrument=0}}t.Pattern=a;class l{constructor(t){this.frequency=0,this.amplitude=0,this.envelope=0,this.reset(t)}reset(e){this.frequency=0,this.amplitude=e<=1?t.Config.operatorAmplitudeMax:0,this.envelope=0==e?0:1}copy(t){this.frequency=t.frequency,this.amplitude=t.amplitude,this.envelope=t.envelope}}t.Operator=l;class c{constructor(t){this.spectrum=[],this.v=null,this.M=!1,this.reset(t)}reset(e){for(let i=0;i<t.Config.spectrumControlPoints;i++)if(e)this.spectrum[i]=Math.round(t.Config.spectrumMax*(1/Math.sqrt(1+i/3)));else{const e=0==i||7==i||11==i||14==i||16==i||18==i||21==i||23==i||i>=25;this.spectrum[i]=e?Math.max(0,Math.round(t.Config.spectrumMax*(1-i/30))):0}this.M=!1}markCustomWaveDirty(){this.M=!1}getCustomWave(e){if(!this.M||null==this.v){let s=t.Config.chipNoiseLength;null!=this.v&&this.v.length==s+1||(this.v=new Float32Array(s+1));const n=this.v;for(let t=0;t<s;t++)n[t]=0;const o=14,h=.25,r=[0,1/7,Math.log(5/4)/Math.LN2,3/7,Math.log(1.5)/Math.LN2,5/7,6/7];function i(i){return e+Math.floor(i/t.Config.spectrumControlPointsPerOctave)+r[(i+t.Config.spectrumControlPointsPerOctave)%t.Config.spectrumControlPointsPerOctave]}let a=1;for(let e=0;e<t.Config.spectrumControlPoints+1;e++){const s=e<=0?0:this.spectrum[e-1],r=e>=t.Config.spectrumControlPoints?this.spectrum[t.Config.spectrumControlPoints-1]:this.spectrum[e],l=i(e-1);let c=i(e);e>=t.Config.spectrumControlPoints&&(c=o+(c-o)*h),0==s&&0==r||(a+=.02*t.drawNoiseSpectrum(n,l,c,s/t.Config.spectrumMax,r/t.Config.spectrumMax,-.5))}this.spectrum[t.Config.spectrumControlPoints-1]>0&&(a+=.02*t.drawNoiseSpectrum(n,o+(i(t.Config.spectrumControlPoints)-o)*h,o,this.spectrum[t.Config.spectrumControlPoints-1]/t.Config.spectrumMax,0,-.5)),t.inverseRealFourierTransform(n,s),t.scaleElementsByFactor(n,5/(Math.sqrt(s)*Math.pow(a,.75))),n[s]=n[0],this.M=!0}return this.v}}t.SpectrumWave=c;class f{constructor(){this.harmonics=[],this.v=null,this.M=!1,this.reset()}reset(){for(let e=0;e<t.Config.harmonicsControlPoints;e++)this.harmonics[e]=0;this.harmonics[0]=t.Config.harmonicsMax,this.harmonics[3]=t.Config.harmonicsMax,this.harmonics[6]=t.Config.harmonicsMax,this.M=!1}markCustomWaveDirty(){this.M=!1}getCustomWave(){if(!this.M||null==this.v){let e=t.Config.harmonicsWavelength;const i=t.getDrumWave(0);null!=this.v&&this.v.length==e+1||(this.v=new Float32Array(e+1));const s=this.v;for(let t=0;t<e;t++)s[t]=0;const n=-.25;let o=1;for(let h=0;h<t.Config.harmonicsRendered;h++){const r=h+1;let a=h<t.Config.harmonicsControlPoints?this.harmonics[h]:this.harmonics[t.Config.harmonicsControlPoints-1];h>=t.Config.harmonicsControlPoints&&(a*=1-(h-t.Config.harmonicsControlPoints)/(t.Config.harmonicsRendered-t.Config.harmonicsControlPoints));const l=a/t.Config.harmonicsMax;let c=Math.pow(2,a-t.Config.harmonicsMax+1)*Math.sqrt(l);h<t.Config.harmonicsControlPoints&&(o+=c),c*=Math.pow(r,n),c*=i[h+589],s[e-r]=c}t.inverseRealFourierTransform(s,e);const h=1/Math.pow(o,.7);let r=0,a=0;for(let t=0;t<s.length;t++)r+=a,a=s[t]*h,s[t]=r;s[e]=s[0],this.M=!0}return this.v}}t.HarmonicsWave=f;class d{constructor(e){this.type=0,this.preset=0,this.chipWave=2,this.chipNoise=1,this.filterCutoff=12,this.filterResonance=0,this.filterEnvelope=1,this.transition=1,this.vibrato=0,this.interval=0,this.effects=0,this.chord=1,this.volume=0,this.pan=t.Config.panCenter,this.pulseWidth=t.Config.pulseWidthRange-1,this.pulseEnvelope=1,this.algorithm=0,this.feedbackType=0,this.feedbackAmplitude=0,this.feedbackEnvelope=1,this.customChipWave=new Float64Array(64),this.customChipWaveIntegral=new Float64Array(65),this.operators=[],this.harmonicsWave=new f,this.drumsetEnvelopes=[],this.drumsetSpectrumWaves=[],this.spectrumWave=new c(e);for(let e=0;e<t.Config.operatorCount;e++)this.operators[e]=new l(e);for(let e=0;e<t.Config.drumCount;e++)this.drumsetEnvelopes[e]=t.Config.envelopes.dictionary["twang 2"].index,this.drumsetSpectrumWaves[e]=new c(!0);for(let t=0;t<64;t++)this.customChipWave[t]=24-Math.floor(.75*t);let i=0;for(let t=0;t<this.customChipWave.length;t++)i+=this.customChipWave[t];const s=i/this.customChipWave.length;let n=0,o=0;for(let t=0;t<this.customChipWave.length;t++)n+=o,o=this.customChipWave[t]-s,this.customChipWaveIntegral[t]=n;this.customChipWaveIntegral[64]=0}setTypeAndReset(e,i){switch(this.type=e,this.preset=e,this.volume=0,this.pan=t.Config.panCenter,e){case 0:this.chipWave=2,this.filterCutoff=6,this.filterResonance=0,this.filterEnvelope=t.Config.envelopes.dictionary.steady.index,this.transition=1,this.vibrato=0,this.interval=0,this.effects=1,this.chord=2;break;case 7:this.chipWave=2,this.filterCutoff=6,this.filterResonance=0,this.filterEnvelope=t.Config.envelopes.dictionary.steady.index,this.transition=1,this.vibrato=0,this.interval=0,this.effects=1,this.chord=2;for(let t=0;t<64;t++)this.customChipWave[t]=24-Math.floor(.75*t);let s=0;for(let t=0;t<this.customChipWave.length;t++)s+=this.customChipWave[t];const n=s/this.customChipWave.length;let o=0,h=0;for(let t=0;t<this.customChipWave.length;t++)o+=h,h=this.customChipWave[t]-n,this.customChipWaveIntegral[t]=o;this.customChipWaveIntegral[64]=0;break;case 1:this.transition=1,this.vibrato=0,this.effects=1,this.chord=3,this.filterCutoff=10,this.filterResonance=0,this.filterEnvelope=1,this.algorithm=0,this.feedbackType=0,this.feedbackAmplitude=0,this.feedbackEnvelope=t.Config.envelopes.dictionary.steady.index;for(let t=0;t<this.operators.length;t++)this.operators[t].reset(t);break;case 2:this.chipNoise=1,this.transition=1,this.effects=0,this.chord=2,this.filterCutoff=10,this.filterResonance=0,this.filterEnvelope=t.Config.envelopes.dictionary.steady.index;break;case 3:this.transition=1,this.effects=1,this.chord=0,this.filterCutoff=10,this.filterResonance=0,this.filterEnvelope=t.Config.envelopes.dictionary.steady.index,this.spectrumWave.reset(i);break;case 4:this.effects=0;for(let e=0;e<t.Config.drumCount;e++)this.drumsetEnvelopes[e]=t.Config.envelopes.dictionary["twang 2"].index,this.drumsetSpectrumWaves[e].reset(i);break;case 5:this.filterCutoff=10,this.filterResonance=0,this.filterEnvelope=t.Config.envelopes.dictionary.steady.index,this.transition=1,this.vibrato=0,this.interval=0,this.effects=1,this.chord=0,this.harmonicsWave.reset();break;case 6:this.filterCutoff=10,this.filterResonance=0,this.filterEnvelope=t.Config.envelopes.dictionary.steady.index,this.transition=1,this.vibrato=0,this.interval=0,this.effects=1,this.chord=2,this.pulseWidth=t.Config.pulseWidthRange-1,this.pulseEnvelope=t.Config.envelopes.dictionary["twang 2"].index;break;default:throw new Error("Unrecognized instrument type: "+e)}}toJsonObject(){const e={type:t.Config.instrumentTypeNames[this.type],volume:this.volume,pan:100*(this.pan-t.Config.panCenter)/t.Config.panCenter,effects:t.Config.effectsNames[this.effects]};if(this.preset!=this.type&&(e.preset=this.preset),4!=this.type&&(e.transition=t.Config.transitions[this.transition].name,e.chord=this.getChord().name,e.filterCutoffHz=Math.round(t.Config.filterCutoffMaxHz*Math.pow(2,this.getFilterCutoffOctaves())),e.filterResonance=Math.round(100*this.filterResonance/(t.Config.filterResonanceRange-1)),e.filterEnvelope=this.getFilterEnvelope().name),2==this.type)e.wave=t.Config.chipNoises[this.chipNoise].name;else if(3==this.type){e.spectrum=[];for(let i=0;i<t.Config.spectrumControlPoints;i++)e.spectrum[i]=Math.round(100*this.spectrumWave.spectrum[i]/t.Config.spectrumMax)}else if(4==this.type){e.drums=[];for(let i=0;i<t.Config.drumCount;i++){const s=[];for(let e=0;e<t.Config.spectrumControlPoints;e++)s[e]=Math.round(100*this.drumsetSpectrumWaves[i].spectrum[e]/t.Config.spectrumMax);e.drums[i]={filterEnvelope:this.getDrumsetEnvelope(i).name,spectrum:s}}}else if(0==this.type)e.wave=t.Config.chipWaves[this.chipWave].name,e.interval=t.Config.intervals[this.interval].name,e.vibrato=t.Config.vibratos[this.vibrato].name;else if(7==this.type){e.wave=t.Config.chipWaves[this.chipWave].name,e.interval=t.Config.intervals[this.interval].name,e.vibrato=t.Config.vibratos[this.vibrato].name,e.customChipWave=new Float64Array(64),e.customChipWaveIntegral=new Float64Array(65);for(let t=0;t<this.customChipWave.length;t++)e.customChipWave[t]=this.customChipWave[t];e.customChipWaveIntegral[64]=0}else if(6==this.type)e.pulseWidth=this.pulseWidth,e.pulseEnvelope=t.Config.envelopes[this.pulseEnvelope].name,e.vibrato=t.Config.vibratos[this.vibrato].name;else if(5==this.type){e.interval=t.Config.intervals[this.interval].name,e.vibrato=t.Config.vibratos[this.vibrato].name,e.harmonics=[];for(let i=0;i<t.Config.harmonicsControlPoints;i++)e.harmonics[i]=Math.round(100*this.harmonicsWave.harmonics[i]/t.Config.harmonicsMax)}else{if(1!=this.type)throw new Error("Unrecognized instrument type");{const i=[];for(const e of this.operators)i.push({frequency:t.Config.operatorFrequencies[e.frequency].name,amplitude:e.amplitude,envelope:t.Config.envelopes[e.envelope].name});e.vibrato=t.Config.vibratos[this.vibrato].name,e.algorithm=t.Config.algorithms[this.algorithm].name,e.feedbackType=t.Config.feedbacks[this.feedbackType].name,e.feedbackAmplitude=this.feedbackAmplitude,e.feedbackEnvelope=t.Config.envelopes[this.feedbackEnvelope].name,e.operators=i}}return e}fromJsonObject(e,i){void 0==e&&(e={});let s=t.Config.instrumentTypeNames.indexOf(e.type);-1==s&&(s=i?2:0),this.setTypeAndReset(s,i),void 0!=e.preset&&(this.preset=e.preset>>>0),void 0!=e.volume?this.volume=h(-t.Config.volumeRange/2,t.Config.volumeRange/2,0|e.volume):this.volume=0,void 0!=e.pan?this.pan=h(0,t.Config.panMax+1,Math.round(t.Config.panCenter+(0|e.pan)*t.Config.panCenter/100)):this.pan=t.Config.panCenter;const n={binary:0,sudden:1,smooth:2},o=e.transition||e.envelope;if(this.transition=void 0!=n[o]?n[o]:t.Config.transitions.findIndex(t=>t.name==o),-1==this.transition&&(this.transition=1),this.effects=t.Config.effectsNames.indexOf(e.effects),-1==this.effects&&(this.effects=2==this.type?0:1),void 0!=e.filterCutoffHz?this.filterCutoff=h(0,t.Config.filterCutoffRange,Math.round(t.Config.filterCutoffRange-1+2*Math.log((0|e.filterCutoffHz)/t.Config.filterCutoffMaxHz)/Math.LN2)):this.filterCutoff=0==this.type?6:10,void 0!=e.filterResonance?this.filterResonance=h(0,t.Config.filterResonanceRange,Math.round((t.Config.filterResonanceRange-1)*(0|e.filterResonance)/100)):this.filterResonance=0,this.filterEnvelope=t.Config.envelopes.findIndex(t=>t.name==e.filterEnvelope),-1==this.filterEnvelope&&(this.filterEnvelope=t.Config.envelopes.dictionary.steady.index),void 0!=e.filter){const t=[20,12,6,0,16,10,4],i=[1,1,1,1,18,19,20],s=["none","bright","medium","soft","decay bright","decay medium","decay soft"],n={"sustain sharp":1,"sustain medium":2,"sustain soft":3,"decay sharp":4};let o=void 0!=n[e.filter]?n[e.filter]:s.indexOf(e.filter);-1==o&&(o=0),this.filterCutoff=t[o],this.filterEnvelope=i[o],this.filterResonance=0}const r=["none","vibrato light","vibrato delayed","vibrato heavy"];if(2==this.type)this.chipNoise=t.Config.chipNoises.findIndex(t=>t.name==e.wave),-1==this.chipNoise&&(this.chipNoise=1),this.chord=t.Config.chords.findIndex(t=>t.name==e.chord),-1==this.chord&&(this.chord=2);else if(3==this.type){if(void 0!=e.spectrum)for(let i=0;i<t.Config.spectrumControlPoints;i++)this.spectrumWave.spectrum[i]=Math.max(0,Math.min(t.Config.spectrumMax,Math.round(t.Config.spectrumMax*+e.spectrum[i]/100)));this.chord=t.Config.chords.findIndex(t=>t.name==e.chord),-1==this.chord&&(this.chord=0)}else if(4==this.type){if(void 0!=e.drums)for(let i=0;i<t.Config.drumCount;i++){const s=e.drums[i];if(void 0!=s&&(void 0!=s.filterEnvelope&&(this.drumsetEnvelopes[i]=t.Config.envelopes.findIndex(t=>t.name==s.filterEnvelope),-1==this.drumsetEnvelopes[i]&&(this.drumsetEnvelopes[i]=t.Config.envelopes.dictionary["twang 2"].index)),void 0!=s.spectrum))for(let e=0;e<t.Config.spectrumControlPoints;e++)this.drumsetSpectrumWaves[i].spectrum[e]=Math.max(0,Math.min(t.Config.spectrumMax,Math.round(t.Config.spectrumMax*+s.spectrum[e]/100)))}}else if(5==this.type){if(void 0!=e.harmonics)for(let i=0;i<t.Config.harmonicsControlPoints;i++)this.harmonicsWave.harmonics[i]=Math.max(0,Math.min(t.Config.harmonicsMax,Math.round(t.Config.harmonicsMax*+e.harmonics[i]/100)));void 0!=e.interval&&(this.interval=t.Config.intervals.findIndex(t=>t.name==e.interval),-1==this.interval&&(this.interval=0)),void 0!=e.vibrato&&(this.vibrato=t.Config.vibratos.findIndex(t=>t.name==e.vibrato),-1==this.vibrato&&(this.vibrato=0)),this.chord=t.Config.chords.findIndex(t=>t.name==e.chord),-1==this.chord&&(this.chord=0)}else if(6==this.type)void 0!=e.pulseWidth?this.pulseWidth=h(0,t.Config.pulseWidthRange,e.pulseWidth):this.pulseWidth=t.Config.pulseWidthRange-1,void 0!=e.pulseEnvelope&&(this.pulseEnvelope=t.Config.envelopes.findIndex(t=>t.name==e.pulseEnvelope),-1==this.pulseEnvelope&&(this.pulseEnvelope=t.Config.envelopes.dictionary.steady.index)),void 0!=e.vibrato&&(this.vibrato=t.Config.vibratos.findIndex(t=>t.name==e.vibrato),-1==this.vibrato&&(this.vibrato=0)),this.chord=t.Config.chords.findIndex(t=>t.name==e.chord),-1==this.chord&&(this.chord=0);else if(0==this.type){const i={triangle:1,square:2,"pulse wide":3,"pulse narrow":4,sawtooth:5,"double saw":6,"double pulse":7,spiky:8,plateau:0};if(this.chipWave=void 0!=i[e.wave]?i[e.wave]:t.Config.chipWaves.findIndex(t=>t.name==e.wave),-1==this.chipWave&&(this.chipWave=1),void 0!=e.interval)this.interval=t.Config.intervals.findIndex(t=>t.name==e.interval),-1==this.interval&&(this.interval=0);else if(void 0!=e.chorus){const i={fifths:5,octaves:6};this.interval=void 0!=i[e.chorus]?i[e.chorus]:t.Config.intervals.findIndex(t=>t.name==e.chorus),-1==this.interval&&(this.interval=0)}void 0!=e.vibrato?(this.vibrato=t.Config.vibratos.findIndex(t=>t.name==e.vibrato),-1==this.vibrato&&(this.vibrato=0)):void 0!=e.effect&&(this.vibrato=r.indexOf(e.effect),-1==this.vibrato&&(this.vibrato=0)),this.chord=t.Config.chords.findIndex(t=>t.name==e.chord),-1==this.chord&&(this.chord=2),"custom harmony"==e.chorus&&(this.interval=2,this.chord=3)}else if(1==this.type){void 0!=e.vibrato?(this.vibrato=t.Config.vibratos.findIndex(t=>t.name==e.vibrato),-1==this.vibrato&&(this.vibrato=0)):void 0!=e.effect&&(this.vibrato=r.indexOf(e.effect),-1==this.vibrato&&(this.vibrato=0)),this.chord=t.Config.chords.findIndex(t=>t.name==e.chord),-1==this.chord&&(this.chord=3),this.algorithm=t.Config.algorithms.findIndex(t=>t.name==e.algorithm),-1==this.algorithm&&(this.algorithm=0),this.feedbackType=t.Config.feedbacks.findIndex(t=>t.name==e.feedbackType),-1==this.feedbackType&&(this.feedbackType=0),void 0!=e.feedbackAmplitude?this.feedbackAmplitude=h(0,t.Config.operatorAmplitudeMax+1,0|e.feedbackAmplitude):this.feedbackAmplitude=0;const i={"pluck 1":6,"pluck 2":7,"pluck 3":8};this.feedbackEnvelope=void 0!=i[e.feedbackEnvelope]?i[e.feedbackEnvelope]:t.Config.envelopes.findIndex(t=>t.name==e.feedbackEnvelope),-1==this.feedbackEnvelope&&(this.feedbackEnvelope=0);for(let s=0;s<t.Config.operatorCount;s++){const n=this.operators[s];let o=void 0;e.operators&&(o=e.operators[s]),void 0==o&&(o={}),n.frequency=t.Config.operatorFrequencies.findIndex(t=>t.name==o.frequency),-1==n.frequency&&(n.frequency=0),void 0!=o.amplitude?n.amplitude=h(0,t.Config.operatorAmplitudeMax+1,0|o.amplitude):n.amplitude=0,n.envelope=void 0!=i[o.envelope]?i[o.envelope]:t.Config.envelopes.findIndex(t=>t.name==o.envelope),-1==n.envelope&&(n.envelope=0)}}else{if(7!=this.type)throw new Error("Unrecognized instrument type.");if(void 0!=e.interval)this.interval=t.Config.intervals.findIndex(t=>t.name==e.interval),-1==this.interval&&(this.interval=0);else if(void 0!=e.chorus){const i={fifths:5,octaves:6};this.interval=void 0!=i[e.chorus]?i[e.chorus]:t.Config.intervals.findIndex(t=>t.name==e.chorus),-1==this.interval&&(this.interval=0)}if(void 0!=e.vibrato?(this.vibrato=t.Config.vibratos.findIndex(t=>t.name==e.vibrato),-1==this.vibrato&&(this.vibrato=0)):void 0!=e.effect&&(this.vibrato=r.indexOf(e.effect),-1==this.vibrato&&(this.vibrato=0)),this.chord=t.Config.chords.findIndex(t=>t.name==e.chord),-1==this.chord&&(this.chord=2),"custom harmony"==e.chorus&&(this.interval=2,this.chord=3),e.customChipWave){for(let t=0;t<64;t++)this.customChipWave[t]=e.customChipWave[t];let t=0;for(let e=0;e<this.customChipWave.length;e++)t+=this.customChipWave[e];const i=t/this.customChipWave.length;let s=0,n=0;for(let t=0;t<this.customChipWave.length;t++)s+=n,n=this.customChipWave[t]-i,this.customChipWaveIntegral[t]=s;this.customChipWaveIntegral[64]=0}}}static frequencyFromPitch(t){return 440*Math.pow(2,(t-69)/12)}static drumsetIndexReferenceDelta(e){return d.frequencyFromPitch(t.Config.spectrumBasePitch+6*e)/44100}static k(t){return 15+Math.log(d.drumsetIndexReferenceDelta(t))/Math.LN2}warmUp(){if(2==this.type)t.getDrumWave(this.chipNoise);else if(5==this.type)this.harmonicsWave.getCustomWave();else if(3==this.type)this.spectrumWave.getCustomWave(8);else if(4==this.type)for(let e=0;e<t.Config.drumCount;e++)this.drumsetSpectrumWaves[e].getCustomWave(d.k(e))}getDrumWave(){if(2==this.type)return t.getDrumWave(this.chipNoise);if(3==this.type)return this.spectrumWave.getCustomWave(8);throw new Error("Unhandled instrument type in getDrumWave")}getDrumsetWave(t){if(4==this.type)return this.drumsetSpectrumWaves[t].getCustomWave(d.k(t));throw new Error("Unhandled instrument type in getDrumWave")}getTransition(){return 4==this.type?t.Config.transitions.dictionary["hard fade"]:t.Config.transitions[this.transition]}getChord(){return 4==this.type?t.Config.chords.dictionary.harmony:t.Config.chords[this.chord]}getFilterCutoffOctaves(){return 4==this.type?0:.5*(this.filterCutoff-(t.Config.filterCutoffRange-1))}getFilterIsFirstOrder(){return 4!=this.type&&0==this.filterResonance}getFilterResonance(){return 4==this.type?1:this.filterResonance}getFilterEnvelope(){if(4==this.type)throw new Error("Can't getFilterEnvelope() for drumset.");return t.Config.envelopes[this.filterEnvelope]}getDrumsetEnvelope(e){if(4!=this.type)throw new Error("Can't getDrumsetEnvelope() for non-drumset.");return t.Config.envelopes[this.drumsetEnvelopes[e]]}}t.Instrument=d;class u{constructor(){this.octave=0,this.instruments=[],this.patterns=[],this.bars=[],this.muted=!1}}t.Channel=u;class m{constructor(t){this.channels=[],void 0!=t?this.fromBase64String(t):this.initToDefault(!0)}getChannelCount(){return this.pitchChannelCount+this.noiseChannelCount}getChannelIsNoise(t){return t>=this.pitchChannelCount}initToDefault(t=!0){if(this.scale=0,this.key=0,this.loopStart=0,this.loopLength=4,this.tempo=150,this.reverb=0,this.beatsPerBar=8,this.barCount=16,this.patternsPerChannel=8,this.rhythm=1,this.instrumentsPerChannel=1,this.title="Unnamed",document.title="JummBox 1.3",t){this.pitchChannelCount=3,this.noiseChannelCount=1;for(let t=0;t<this.getChannelCount();t++){this.channels.length<=t&&(this.channels[t]=new u);const e=this.channels[t];e.octave=3-t;for(let t=0;t<this.patternsPerChannel;t++)e.patterns.length<=t?e.patterns[t]=new a:e.patterns[t].reset();e.patterns.length=this.patternsPerChannel;const i=t>=this.pitchChannelCount;for(let t=0;t<this.instrumentsPerChannel;t++)e.instruments.length<=t&&(e.instruments[t]=new d(i)),e.instruments[t].setTypeAndReset(i?2:0,i);e.instruments.length=this.instrumentsPerChannel;for(let t=0;t<this.barCount;t++)e.bars[t]=t<4?1:0;e.bars.length=this.barCount}this.channels.length=this.getChannelCount()}}toBase64String(){let i,s=[];s.push(m.P),s.push(e[m.N]),s.push(78);var o=encodeURIComponent(this.title);s.push(e[o.length>>6],e[63&o.length]);for(let t=0;t<o.length;t++)s.push(o.charCodeAt(t));s.push(110,e[this.pitchChannelCount],e[this.noiseChannelCount]),s.push(115,e[this.scale]),s.push(107,e[this.key]),s.push(108,e[this.loopStart>>6],e[63&this.loopStart]),s.push(101,e[this.loopLength-1>>6],e[this.loopLength-1&63]),s.push(116,e[this.tempo>>6],e[63&this.tempo]),s.push(109,e[this.reverb]),s.push(97,e[this.beatsPerBar-1]),s.push(103,e[this.barCount-1>>6],e[this.barCount-1&63]),s.push(106,e[this.patternsPerChannel-1>>6],e[this.patternsPerChannel-1&63]),s.push(105,e[this.instrumentsPerChannel-1]),s.push(114,e[this.rhythm]),s.push(111);for(let t=0;t<this.getChannelCount();t++)s.push(e[this.channels[t].octave]);for(let i=0;i<this.getChannelCount();i++)for(let o=0;o<this.instrumentsPerChannel;o++){const h=this.channels[i].instruments[o];if(s.push(84,e[h.type]),s.push(118,e[h.volume+t.Config.volumeRange/2>>6],e[h.volume+t.Config.volumeRange/2&63]),s.push(76,e[h.pan>>6],e[63&h.pan]),s.push(117,e[h.preset>>6],e[63&h.preset]),s.push(113,e[h.effects]),4!=h.type&&(s.push(100,e[h.transition]),s.push(102,e[h.filterCutoff]),s.push(121,e[h.filterResonance]),s.push(122,e[h.filterEnvelope]),s.push(67,e[h.chord])),0==h.type)s.push(119,e[h.chipWave]),s.push(99,e[h.vibrato]),s.push(104,e[h.interval]);else if(1==h.type){s.push(99,e[h.vibrato]),s.push(65,e[h.algorithm]),s.push(70,e[h.feedbackType]),s.push(66,e[h.feedbackAmplitude]),s.push(86,e[h.feedbackEnvelope]),s.push(81);for(let i=0;i<t.Config.operatorCount;i++)s.push(e[h.operators[i].frequency]);s.push(80);for(let i=0;i<t.Config.operatorCount;i++)s.push(e[h.operators[i].amplitude]);s.push(69);for(let i=0;i<t.Config.operatorCount;i++)s.push(e[h.operators[i].envelope])}else if(7==h.type){s.push(119,e[h.chipWave]),s.push(99,e[h.vibrato]),s.push(104,e[h.interval]),s.push(77);for(let t=0;t<64;t++)s.push(e[h.customChipWave[t]+24])}else if(2==h.type)s.push(119,e[h.chipNoise]);else if(3==h.type){s.push(83);const e=new n;for(let i=0;i<t.Config.spectrumControlPoints;i++)e.write(t.Config.spectrumControlPointBits,h.spectrumWave.spectrum[i]);e.encodeBase64(s)}else if(4==h.type){s.push(122);for(let i=0;i<t.Config.drumCount;i++)s.push(e[h.drumsetEnvelopes[i]]);s.push(83);const i=new n;for(let e=0;e<t.Config.drumCount;e++)for(let s=0;s<t.Config.spectrumControlPoints;s++)i.write(t.Config.spectrumControlPointBits,h.drumsetSpectrumWaves[e].spectrum[s]);i.encodeBase64(s)}else if(5==h.type){s.push(99,e[h.vibrato]),s.push(104,e[h.interval]),s.push(72);const i=new n;for(let e=0;e<t.Config.harmonicsControlPoints;e++)i.write(t.Config.harmonicsControlPointBits,h.harmonicsWave.harmonics[e]);i.encodeBase64(s)}else{if(6!=h.type)throw new Error("Unknown instrument type.");s.push(99,e[h.vibrato]),s.push(87,e[h.pulseWidth],e[h.pulseEnvelope])}}s.push(98),i=new n;let h=0;for(;1<<h<this.patternsPerChannel+1;)h++;for(let t=0;t<this.getChannelCount();t++)for(let e=0;e<this.barCount;e++)i.write(h,this.channels[t].bars[e]);i.encodeBase64(s),s.push(112),i=new n;let r=0;for(;1<<r<this.instrumentsPerChannel;)r++;for(let e=0;e<this.getChannelCount();e++){const s=this.getChannelIsNoise(e),o=s?0:12*this.channels[e].octave;let h=(s?4:12)+o;const a=s?[4,6,7,2,3,8,0,10]:[12,19,24,31,36,7,0],l=[];for(let t=0;t<a.length;t++)a[t]+=o;for(const s of this.channels[e].patterns)if(i.write(r,s.instrument),s.notes.length>0){i.write(1,1);let e=0;for(const t of s.notes){t.start>e&&(i.write(2,0),i.writePartDuration(t.start-e));const s=new n;for(let e=1;e<t.pitches.length;e++)s.write(1,1);t.pitches.length<4&&s.write(1,0),s.writePinCount(t.pins.length-1),s.write(3,t.pins[0].volume);let o=0,r=t.pitches[0],c=r;const f=[];for(let e=1;e<t.pins.length;e++){const i=t.pins[e],n=r+i.interval;c!=n?(s.write(1,1),f.push(n),c=n):s.write(1,0),s.writePartDuration(i.time-o),o=i.time,s.write(3,i.volume)}const d=String.fromCharCode.apply(null,s.encodeBase64([])),u=l.indexOf(d);-1==u?(i.write(2,1),i.concat(s)):(i.write(1,1),i.writeLongTail(0,0,u),l.splice(u,1)),l.unshift(d),l.length>10&&l.pop();const m=t.pitches.concat(f);for(let e=0;e<m.length;e++){const s=m[e],n=a.indexOf(s);if(-1==n){let t=0,e=h;if(e<s)for(;e!=s;)e++,-1==a.indexOf(e)&&t++;else for(;e!=s;)e--,-1==a.indexOf(e)&&t--;i.write(1,0),i.writePitchInterval(t)}else i.write(1,1),i.write(3,n),a.splice(n,1);a.unshift(s),a.length>8&&a.pop(),h=e==t.pitches.length-1?t.pitches[0]:s}e=t.end}e<this.beatsPerBar*t.Config.partsPerBeat&&(i.write(2,0),i.writePartDuration(this.beatsPerBar*t.Config.partsPerBeat-e))}else i.write(1,0)}let a=i.lengthBase64(),l=[];for(;a>0;)l.unshift(e[63&a]),a>>=6;s.push(e[l.length]),Array.prototype.push.apply(s,l),i.encodeBase64(s);if(s.length<64e3)return String.fromCharCode.apply(null,s);{let t="";for(let e=0;e<s.length;e+=64e3)t+=String.fromCharCode.apply(null,s.slice(e,e+64e3));return t}}fromBase64String(e){if(null==e||""==e)return void this.initToDefault(!0);let n=0;for(;e.charCodeAt(n)<=32;)n++;if(35==e.charCodeAt(n)&&n++,123==e.charCodeAt(n))return void this.fromJsonObject(JSON.parse(0==n?e:e.substring(n)));var l="";106==e.charCodeAt(n)?(l="jummbox",n++):l="beepbox";const c=i[e.charCodeAt(n++)];if("beepbox"==l&&(-1==c||c>m.q||c<m.R))return;if("jummbox"==l&&(-1==c||c>m.N||c<m.S))return;const f=c<3,p=c<4,y=c<5,b=c<6,g=c<7,v=c<8;if(this.initToDefault("beepbox"==l&&b),f&&"beepbox"==l){for(const t of this.channels)t.instruments[0].transition=0;this.channels[3].instruments[0].chipNoise=0}let w=0,M=-1;for(;n<e.length;){const c=e.charCodeAt(n++);let m;if(78==c){var k=(i[e.charCodeAt(n++)]<<6)+i[e.charCodeAt(n++)];this.title=decodeURIComponent(e.substring(n,n+k)),document.title=this.title+" - JummBox 1.3",n+=k}else if(110==c){this.pitchChannelCount=i[e.charCodeAt(n++)],this.noiseChannelCount=i[e.charCodeAt(n++)],this.pitchChannelCount=h(t.Config.pitchChannelCountMin,t.Config.pitchChannelCountMax+1,this.pitchChannelCount),this.noiseChannelCount=h(t.Config.noiseChannelCountMin,t.Config.noiseChannelCountMax+1,this.noiseChannelCount);for(let t=this.channels.length;t<this.getChannelCount();t++)this.channels[t]=new u;this.channels.length=this.getChannelCount(),t.ColorConfig.resetColors()}else if(115==c)this.scale=i[e.charCodeAt(n++)],"beepbox"==l&&(this.scale=0);else if(107==c)this.key=h(0,t.Config.keys.length,g&&"beepbox"==l?11-i[e.charCodeAt(n++)]:i[e.charCodeAt(n++)]);else if(108==c)this.loopStart=y&&"beepbox"==l?i[e.charCodeAt(n++)]:(i[e.charCodeAt(n++)]<<6)+i[e.charCodeAt(n++)];else if(101==c)this.loopLength=y&&"beepbox"==l?i[e.charCodeAt(n++)]:(i[e.charCodeAt(n++)]<<6)+i[e.charCodeAt(n++)]+1;else if(116==c)this.tempo=p&&"beepbox"==l?[95,120,151,190][i[e.charCodeAt(n++)]]:g&&"beepbox"==l?[88,95,103,111,120,130,140,151,163,176,190,206,222,240,259][i[e.charCodeAt(n++)]]:i[e.charCodeAt(n++)]<<6|i[e.charCodeAt(n++)],this.tempo=h(t.Config.tempoMin,t.Config.tempoMax+1,this.tempo);else if(109==c)"beepbox"==l?(this.reverb=8*i[e.charCodeAt(n++)],this.reverb=h(0,t.Config.reverbRange,this.reverb)):(this.reverb=i[e.charCodeAt(n++)],this.reverb=h(0,t.Config.reverbRange,this.reverb));else if(97==c)this.beatsPerBar=f&&"beepbox"==l?[6,7,8,9,10][i[e.charCodeAt(n++)]]:i[e.charCodeAt(n++)]+1,this.beatsPerBar=Math.max(t.Config.beatsPerBarMin,Math.min(t.Config.beatsPerBarMax,this.beatsPerBar));else if(103==c){this.barCount=(i[e.charCodeAt(n++)]<<6)+i[e.charCodeAt(n++)]+1,this.barCount=Math.max(t.Config.barCountMin,Math.min(t.Config.barCountMax,this.barCount));for(let t=0;t<this.getChannelCount();t++){for(let e=this.channels[t].bars.length;e<this.barCount;e++)this.channels[t].bars[e]=e<4?1:0;this.channels[t].bars.length=this.barCount}}else if(106==c){this.patternsPerChannel="beepbox"==l&&v?i[e.charCodeAt(n++)]+1:(i[e.charCodeAt(n++)]<<6)+i[e.charCodeAt(n++)]+1,this.patternsPerChannel=Math.max(1,Math.min(t.Config.barCountMax,this.patternsPerChannel));for(let t=0;t<this.getChannelCount();t++){for(let e=this.channels[t].patterns.length;e<this.patternsPerChannel;e++)this.channels[t].patterns[e]=new a;this.channels[t].patterns.length=this.patternsPerChannel}}else if(105==c){this.instrumentsPerChannel=i[e.charCodeAt(n++)]+1,this.instrumentsPerChannel=Math.max(t.Config.instrumentsPerChannelMin,Math.min(t.Config.instrumentsPerChannelMax,this.instrumentsPerChannel));for(let t=0;t<this.getChannelCount();t++){const e=t>=this.pitchChannelCount;for(let i=this.channels[t].instruments.length;i<this.instrumentsPerChannel;i++)this.channels[t].instruments[i]=new d(e);if(this.channels[t].instruments.length=this.instrumentsPerChannel,b&&"beepbox"==l)for(let i=0;i<this.instrumentsPerChannel;i++)this.channels[t].instruments[i].setTypeAndReset(e?2:0,e)}}else if(114==c)this.rhythm=i[e.charCodeAt(n++)];else if(111==c)if(f&&"beepbox"==l)m=i[e.charCodeAt(n++)],this.channels[m].octave=h(0,t.Config.scrollableOctaves+1,i[e.charCodeAt(n++)]);else for(m=0;m<this.getChannelCount();m++)this.channels[m].octave=h(0,t.Config.scrollableOctaves+1,i[e.charCodeAt(n++)]);else if(84==c){++M>=this.instrumentsPerChannel&&(w++,M=0);const t=this.channels[w].instruments[M],s=h(0,8,i[e.charCodeAt(n++)]);t.setTypeAndReset(s,w>=this.pitchChannelCount)}else if(117==c){const t=i[e.charCodeAt(n++)]<<6|i[e.charCodeAt(n++)];this.channels[w].instruments[M].preset=t}else if(119==c)if(f&&"beepbox"==l){const s=[1,2,3,4,5,6,7,8,0];m=i[e.charCodeAt(n++)],this.channels[m].instruments[0].chipWave=h(0,t.Config.chipWaves.length,0|s[i[e.charCodeAt(n++)]])}else if(b&&"beepbox"==l){const s=[1,2,3,4,5,6,7,8,0];for(m=0;m<this.getChannelCount();m++)for(let o=0;o<this.instrumentsPerChannel;o++)m>=this.pitchChannelCount?this.channels[m].instruments[o].chipNoise=h(0,t.Config.chipNoises.length,i[e.charCodeAt(n++)]):this.channels[m].instruments[o].chipWave=h(0,t.Config.chipWaves.length,0|s[i[e.charCodeAt(n++)]])}else if(g&&"beepbox"==l){const s=[1,2,3,4,5,6,7,8,0];w>=this.pitchChannelCount?this.channels[w].instruments[M].chipNoise=h(0,t.Config.chipNoises.length,i[e.charCodeAt(n++)]):this.channels[w].instruments[M].chipWave=h(0,t.Config.chipWaves.length,0|s[i[e.charCodeAt(n++)]])}else w>=this.pitchChannelCount?this.channels[w].instruments[M].chipNoise=h(0,t.Config.chipNoises.length,i[e.charCodeAt(n++)]):this.channels[w].instruments[M].chipWave=h(0,t.Config.chipWaves.length,i[e.charCodeAt(n++)]);else if(102==c)if(g&&"beepbox"==l){const t=[10,6,3,0,8,5,2],s=[1,1,1,1,18,19,20],o=["none","bright","medium","soft","decay bright","decay medium","decay soft"];if(f&&"beepbox"==l){m=i[e.charCodeAt(n++)];const r=this.channels[m].instruments[0],a=[1,3,4,5][h(0,o.length,i[e.charCodeAt(n++)])];r.filterCutoff=t[a],r.filterEnvelope=s[a],r.filterResonance=0}else if(b&&"beepbox"==l)for(m=0;m<this.getChannelCount();m++)for(let r=0;r<this.instrumentsPerChannel;r++){const a=this.channels[m].instruments[r];if(m<this.pitchChannelCount){const r=h(0,o.length,i[e.charCodeAt(n++)]+1);a.filterCutoff=t[r],a.filterEnvelope=s[r],a.filterResonance=0}else a.filterCutoff=10,a.filterEnvelope=1,a.filterResonance=0}else{const r=h(0,o.length,i[e.charCodeAt(n++)]),a=this.channels[w].instruments[M];a.filterCutoff=t[r],a.filterEnvelope=s[r],a.filterResonance=0}}else{this.channels[w].instruments[M].filterCutoff=h(0,t.Config.filterCutoffRange,i[e.charCodeAt(n++)])}else if(121==c)this.channels[w].instruments[M].filterResonance=h(0,t.Config.filterResonanceRange,i[e.charCodeAt(n++)]);else if(122==c){const s=this.channels[w].instruments[M];if(4==s.type)for(let o=0;o<t.Config.drumCount;o++)s.drumsetEnvelopes[o]=h(0,t.Config.envelopes.length,i[e.charCodeAt(n++)]);else s.filterEnvelope=h(0,t.Config.envelopes.length,i[e.charCodeAt(n++)])}else if(87==c)if("beepbox"==l){const s=this.channels[w].instruments[M];s.pulseWidth=Math.round(h(0,t.Config.pulseWidthRange+1,50*Math.pow(.5,.5*(7-i[e.charCodeAt(n++)])))),s.pulseEnvelope=h(0,t.Config.envelopes.length,i[e.charCodeAt(n++)])}else{const s=this.channels[w].instruments[M];s.pulseWidth=h(0,t.Config.pulseWidthRange+1,i[e.charCodeAt(n++)]),s.pulseEnvelope=h(0,t.Config.envelopes.length,i[e.charCodeAt(n++)])}else if(100==c)if(f&&"beepbox"==l)m=i[e.charCodeAt(n++)],this.channels[m].instruments[0].transition=h(0,t.Config.transitions.length,i[e.charCodeAt(n++)]);else if(b&&"beepbox"==l)for(m=0;m<this.getChannelCount();m++)for(let s=0;s<this.instrumentsPerChannel;s++)this.channels[m].instruments[s].transition=h(0,t.Config.transitions.length,i[e.charCodeAt(n++)]);else this.channels[w].instruments[M].transition=h(0,t.Config.transitions.length,i[e.charCodeAt(n++)]);else if(99==c)if(f&&"beepbox"==l){const t=[0,3,2,0],s=[1,1,1,13];m=i[e.charCodeAt(n++)];const o=h(0,t.length,i[e.charCodeAt(n++)]),r=this.channels[m].instruments[0];r.vibrato=t[o],r.filterEnvelope=1==r.filterEnvelope?s[o]:r.filterEnvelope}else if(b&&"beepbox"==l){const t=[0,1,2,3,0,0],s=[1,1,1,1,16,13];for(m=0;m<this.getChannelCount();m++)for(let o=0;o<this.instrumentsPerChannel;o++){const r=h(0,t.length,i[e.charCodeAt(n++)]),a=this.channels[m].instruments[o];a.vibrato=t[r],a.filterEnvelope=1==a.filterEnvelope?s[r]:a.filterEnvelope}}else if(g&&"beepbox"==l){const t=[0,1,2,3,0,0],s=[1,1,1,1,16,13],o=h(0,t.length,i[e.charCodeAt(n++)]),r=this.channels[w].instruments[M];r.vibrato=t[o],r.filterEnvelope=1==r.filterEnvelope?s[o]:r.filterEnvelope}else{const s=h(0,t.Config.vibratos.length,i[e.charCodeAt(n++)]);this.channels[w].instruments[M].vibrato=s}else if(104==c)if(f&&"beepbox"==l)m=i[e.charCodeAt(n++)],this.channels[m].instruments[0].interval=h(0,t.Config.intervals.length,i[e.charCodeAt(n++)]);else if(b&&"beepbox"==l)for(m=0;m<this.getChannelCount();m++)for(let s=0;s<this.instrumentsPerChannel;s++){const o=i[e.charCodeAt(n++)];let r=h(0,t.Config.intervals.length,o);8==o&&(r=2,this.channels[m].instruments[s].chord=3),this.channels[m].instruments[s].interval=r}else if(g&&"beepbox"==l){const s=i[e.charCodeAt(n++)];let o=h(0,t.Config.intervals.length,s);8==s&&(o=2,this.channels[w].instruments[M].chord=3),this.channels[w].instruments[M].interval=o}else this.channels[w].instruments[M].interval=h(0,t.Config.intervals.length,i[e.charCodeAt(n++)]);else if(67==c)this.channels[w].instruments[M].chord=h(0,t.Config.chords.length,i[e.charCodeAt(n++)]);else if(113==c)this.channels[w].instruments[M].effects=h(0,t.Config.effectsNames.length,i[e.charCodeAt(n++)]);else if(118==c)if(f&&"beepbox"==l){m=i[e.charCodeAt(n++)],this.channels[m].instruments[0].volume=Math.round(h(-t.Config.volumeRange,1,5*-i[e.charCodeAt(n++)]))}else if(b&&"beepbox"==l)for(m=0;m<this.getChannelCount();m++)for(let s=0;s<this.instrumentsPerChannel;s++){this.channels[m].instruments[s].volume=Math.round(h(-t.Config.volumeRange,1,5*-i[e.charCodeAt(n++)]))}else if(g&&"beepbox"==l){this.channels[w].instruments[M].volume=Math.round(h(-t.Config.volumeRange,1,5*-i[e.charCodeAt(n++)]))}else if("beepbox"==l){this.channels[w].instruments[M].volume=Math.round(h(-t.Config.volumeRange/2,1,25*-i[e.charCodeAt(n++)]/7))}else{this.channels[w].instruments[M].volume=Math.round(h(-t.Config.volumeRange/2,t.Config.volumeRange/2+1,(i[e.charCodeAt(n++)]<<6|i[e.charCodeAt(n++)])-t.Config.volumeRange/2))}else if(76==c){const s=this.channels[w].instruments[M];s.pan=h(0,t.Config.panMax+1,"beepbox"==l?Math.round(i[e.charCodeAt(n++)]*(t.Config.panMax/8)):(i[e.charCodeAt(n++)]<<6)+i[e.charCodeAt(n++)])}else if(77==c){let t=this.channels[w].instruments[M];for(let s=0;s<64;s++)t.customChipWave[s]=h(-24,25,i[e.charCodeAt(n++)]-24);let s=0;for(let e=0;e<t.customChipWave.length;e++)s+=t.customChipWave[e];const o=s/t.customChipWave.length;let r=0,a=0;for(let e=0;e<t.customChipWave.length;e++)r+=a,a=t.customChipWave[e]-o,t.customChipWaveIntegral[e]=r;t.customChipWaveIntegral[64]=0}else if(65==c)this.channels[w].instruments[M].algorithm=h(0,t.Config.algorithms.length,i[e.charCodeAt(n++)]);else if(70==c)this.channels[w].instruments[M].feedbackType=h(0,t.Config.feedbacks.length,i[e.charCodeAt(n++)]);else if(66==c)this.channels[w].instruments[M].feedbackAmplitude=h(0,t.Config.operatorAmplitudeMax+1,i[e.charCodeAt(n++)]);else if(86==c)this.channels[w].instruments[M].feedbackEnvelope=h(0,t.Config.envelopes.length,i[e.charCodeAt(n++)]);else if(81==c)for(let s=0;s<t.Config.operatorCount;s++)this.channels[w].instruments[M].operators[s].frequency=h(0,t.Config.operatorFrequencies.length,i[e.charCodeAt(n++)]);else if(80==c)for(let s=0;s<t.Config.operatorCount;s++)this.channels[w].instruments[M].operators[s].amplitude=h(0,t.Config.operatorAmplitudeMax+1,i[e.charCodeAt(n++)]);else if(69==c)for(let s=0;s<t.Config.operatorCount;s++)this.channels[w].instruments[M].operators[s].envelope=h(0,t.Config.envelopes.length,i[e.charCodeAt(n++)]);else if(83==c){const i=this.channels[w].instruments[M];if(3==i.type){const o=Math.ceil(t.Config.spectrumControlPoints*t.Config.spectrumControlPointBits/6),h=new s(e,n,n+o);for(let e=0;e<t.Config.spectrumControlPoints;e++)i.spectrumWave.spectrum[e]=h.read(t.Config.spectrumControlPointBits);i.spectrumWave.markCustomWaveDirty(),n+=o}else{if(4!=i.type)throw new Error("Unhandled instrument type for spectrum song tag code.");{const o=Math.ceil(t.Config.drumCount*t.Config.spectrumControlPoints*t.Config.spectrumControlPointBits/6),h=new s(e,n,n+o);for(let e=0;e<t.Config.drumCount;e++){for(let s=0;s<t.Config.spectrumControlPoints;s++)i.drumsetSpectrumWaves[e].spectrum[s]=h.read(t.Config.spectrumControlPointBits);i.drumsetSpectrumWaves[e].markCustomWaveDirty()}n+=o}}}else if(72==c){const i=this.channels[w].instruments[M],o=Math.ceil(t.Config.harmonicsControlPoints*t.Config.harmonicsControlPointBits/6),h=new s(e,n,n+o);for(let e=0;e<t.Config.harmonicsControlPoints;e++)i.harmonicsWave.harmonics[e]=h.read(t.Config.harmonicsControlPointBits);i.harmonicsWave.markCustomWaveDirty(),n+=o}else if(98==c){let t;if(f&&"beepbox"==l){m=i[e.charCodeAt(n++)];const o=i[e.charCodeAt(n++)];t=Math.ceil(.5*o);const h=new s(e,n,n+t);for(let t=0;t<o;t++)this.channels[m].bars[t]=h.read(3)+1}else if(y&&"beepbox"==l){let i=0;for(;1<<i<this.patternsPerChannel;)i++;t=Math.ceil(this.getChannelCount()*this.barCount*i/6);const o=new s(e,n,n+t);for(m=0;m<this.getChannelCount();m++)for(let t=0;t<this.barCount;t++)this.channels[m].bars[t]=o.read(i)+1}else{let i=0;for(;1<<i<this.patternsPerChannel+1;)i++;t=Math.ceil(this.getChannelCount()*this.barCount*i/6);const o=new s(e,n,n+t);for(m=0;m<this.getChannelCount();m++)for(let t=0;t<this.barCount;t++)this.channels[m].bars[t]=o.read(i)}n+=t}else if(112==c){let h=0;if(f&&"beepbox"==l)m=i[e.charCodeAt(n++)],n++,h=i[e.charCodeAt(n++)],h<<=6,h+=i[e.charCodeAt(n++)];else{m=0;let t=i[e.charCodeAt(n++)];for(;t>0;)h<<=6,h+=i[e.charCodeAt(n++)],t--}const a=new s(e,n,n+h);n+=h;let c=0;for(;1<<c<this.instrumentsPerChannel;)c++;for(;;){const e=this.getChannelIsNoise(m),i=e?0:12*this.channels[m].octave;let s=null,n=null,h=(e?4:12)+i;const d=e?[4,6,7,2,3,8,0,10]:[12,19,24,31,36,7,0],u=[];for(let t=0;t<d.length;t++)d[t]+=i;for(let e=0;e<this.patternsPerChannel;e++){const i=this.channels[m].patterns[e];if(i.reset(),i.instrument=a.read(c),("beepbox"!=l||!f)&&0==a.read(1))continue;let p=0;const y=i.notes;for(;p<this.beatsPerBar*t.Config.partsPerBeat;){const e=1==a.read(1);let i=!1,c=0;if(e?c=a.readLongTail(0,0):i=1==a.read(1),e||i){let i,f,m;if(e)i=u[c],u.splice(c,1);else{for((i={}).pitchCount=1;i.pitchCount<4&&1==a.read(1);)i.pitchCount++;i.pinCount=a.readPinCount(),i.initialVolume="beepbox"==l?2*a.read(2):a.read(3),i.pins=[],i.length=0,i.bendCount=0;for(let e=0;e<i.pinCount;e++)(f={}).pitchBend=1==a.read(1),f.pitchBend&&i.bendCount++,i.length+=g&&"beepbox"==l?a.readLegacyPartDuration()*t.Config.partsPerBeat/t.Config.rhythms[this.rhythm].stepsPerBeat:a.readPartDuration(),f.time=i.length,f.volume="beepbox"==l?2*a.read(2):a.read(3),i.pins.push(f)}u.unshift(i),u.length>10&&u.pop(),(s=new r(0,p,p+i.length,i.initialVolume)).pitches=[],s.pins.length=1;const b=[];for(let t=0;t<i.pitchCount+i.bendCount;t++){if(1==a.read(1)){const t=a.read(3);m=d[t],d.splice(t,1)}else{const t=a.readPitchInterval();m=h;let e=t;for(;e>0;){for(m++;-1!=d.indexOf(m);)m++;e--}for(;e<0;){for(m--;-1!=d.indexOf(m);)m--;e++}}d.unshift(m),d.length>8&&d.pop(),t<i.pitchCount?s.pitches.push(m):b.push(m),h=t==i.pitchCount-1?s.pitches[0]:m}b.unshift(s.pitches[0]);for(const t of i.pins)t.pitchBend&&b.shift(),n=o(b[0]-s.pitches[0],t.time,t.volume),s.pins.push(n);p=s.end,y.push(s)}else{p+=g&&"beepbox"==l?a.readLegacyPartDuration()*t.Config.partsPerBeat/t.Config.rhythms[this.rhythm].stepsPerBeat:a.readPartDuration()}}}if(f&&"beepbox"==l)break;if(++m>=this.getChannelCount())break}}}}toJsonObject(e=!0,i=1,s=!0){const n=[];for(let o=0;o<this.getChannelCount();o++){const h=[],r=this.getChannelIsNoise(o);for(let t=0;t<this.instrumentsPerChannel;t++)h.push(this.channels[o].instruments[t].toJsonObject());const a=[];for(const e of this.channels[o].patterns){const i=[];for(const s of e.notes){const e=[];for(const i of s.pins)e.push({tick:(i.time+s.start)*t.Config.rhythms[this.rhythm].stepsPerBeat/t.Config.partsPerBeat,pitchBend:i.interval,volume:Math.round(100*i.volume/6)});i.push({pitches:s.pitches,points:e})}a.push({instrument:e.instrument+1,notes:i})}const l=[];if(e)for(let t=0;t<this.loopStart;t++)l.push(this.channels[o].bars[t]);for(let t=0;t<i;t++)for(let t=this.loopStart;t<this.loopStart+this.loopLength;t++)l.push(this.channels[o].bars[t]);if(s)for(let t=this.loopStart+this.loopLength;t<this.barCount;t++)l.push(this.channels[o].bars[t]);n.push({type:r?"drum":"pitch",octaveScrollBar:this.channels[o].octave,instruments:h,patterns:a,sequence:l})}return{format:m.T,version:m.N,scale:t.Config.scales[this.scale].name,key:t.Config.keys[this.key].name,introBars:this.loopStart,loopBars:this.loopLength,beatsPerBar:this.beatsPerBar,ticksPerBeat:t.Config.rhythms[this.rhythm].stepsPerBeat,beatsPerMinute:this.tempo,reverb:this.reverb,channels:n}}fromJsonObject(e){if(this.initToDefault(!0),!e)return;if(this.scale=0,void 0!=e.scale){const i={"romani :)":8,"romani :(":9},s=void 0!=i[e.scale]?i[e.scale]:t.Config.scales.findIndex(t=>t.name==e.scale);-1!=s&&(this.scale=s)}if(void 0!=e.key)if("number"==typeof e.key)this.key=(e.key+1200>>>0)%t.Config.keys.length;else if("string"==typeof e.key){const t=e.key,i=t.charAt(0).toUpperCase(),s=t.charAt(1).toLowerCase();let n={C:0,D:2,E:4,F:5,G:7,A:9,B:11}[i];const o={"#":1,"‚ôØ":1,b:-1,"‚ô≠":-1}[s];void 0!=n&&(void 0!=o&&(n+=o),n<0&&(n+=12),n%=12,this.key=n)}void 0!=e.beatsPerMinute&&(this.tempo=h(t.Config.tempoMin,t.Config.tempoMax+1,0|e.beatsPerMinute)),void 0!=e.reverb&&(this.reverb=h(0,t.Config.reverbRange,0|e.reverb)),void 0!=e.beatsPerBar&&(this.beatsPerBar=Math.max(t.Config.beatsPerBarMin,Math.min(t.Config.beatsPerBarMax,0|e.beatsPerBar)));let i=4;void 0!=e.ticksPerBeat&&(i=0|e.ticksPerBeat||4,this.rhythm=t.Config.rhythms.findIndex(t=>t.stepsPerBeat==i),-1==this.rhythm&&(this.rhythm=1));let s=1,n=1,l=1;if(e.channels)for(const t of e.channels)t.instruments&&(s=Math.max(s,0|t.instruments.length)),t.patterns&&(n=Math.max(n,0|t.patterns.length)),t.sequence&&(l=Math.max(l,0|t.sequence.length));this.instrumentsPerChannel=s,this.patternsPerChannel=n,this.barCount=l,void 0!=e.introBars&&(this.loopStart=h(0,this.barCount,0|e.introBars)),void 0!=e.loopBars&&(this.loopLength=h(1,this.barCount-this.loopStart+1,0|e.loopBars));const c=[],f=[];if(e.channels)for(let s=0;s<e.channels.length;s++){let n=e.channels[s];const l=new u;let m=!1;(m=void 0!=n.type?"drum"==n.type:s>=3)?f.push(l):c.push(l),void 0!=n.octaveScrollBar&&(l.octave=h(0,t.Config.scrollableOctaves+1,0|n.octaveScrollBar));for(let t=l.instruments.length;t<this.instrumentsPerChannel;t++)l.instruments[t]=new d(m);l.instruments.length=this.instrumentsPerChannel;for(let t=l.patterns.length;t<this.patternsPerChannel;t++)l.patterns[t]=new a;l.patterns.length=this.patternsPerChannel;for(let t=0;t<this.barCount;t++)l.bars[t]=1;l.bars.length=this.barCount;for(let t=0;t<this.instrumentsPerChannel;t++){l.instruments[t].fromJsonObject(n.instruments[t],m)}for(let e=0;e<this.patternsPerChannel;e++){const s=l.patterns[e];let a=void 0;if(n.patterns&&(a=n.patterns[e]),void 0!=a&&(s.instrument=h(0,this.instrumentsPerChannel,(0|a.instrument)-1),a.notes&&a.notes.length>0)){const e=Math.min(this.beatsPerBar*t.Config.partsPerBeat,a.notes.length>>>0);let n=0;for(let h=0;h<a.notes.length&&!(h>=e);h++){const e=a.notes[h];if(!(e&&e.pitches&&e.pitches.length>=1&&e.points&&e.points.length>=2))continue;const l=new r(0,0,0,0);l.pitches=[],l.pins=[];for(let t=0;t<e.pitches.length;t++){const i=0|e.pitches[t];if(-1==l.pitches.indexOf(i)&&(l.pitches.push(i),l.pitches.length>=4))break}if(l.pitches.length<1)continue;let c=n,f=0;for(let s=0;s<e.points.length;s++){const n=e.points[s];if(void 0==n||void 0==n.tick)continue;const h=void 0==n.pitchBend?0:0|n.pitchBend,r=Math.round(+n.tick*t.Config.partsPerBeat/i),a=void 0==n.volume?6:Math.max(0,Math.min(6,Math.round(6*(0|n.volume)/100)));if(!(r>this.beatsPerBar*t.Config.partsPerBeat)){if(0==l.pins.length){if(r<c)continue;l.start=r,f=h}else if(r<=c)continue;c=r,l.pins.push(o(h-f,r-l.start,a))}}if(l.pins.length<2)continue;l.end=l.pins[l.pins.length-1].time+l.start;const d=m?t.Config.drumCount-1:t.Config.maxPitch;let u=d,p=0;for(let t=0;t<l.pitches.length;t++)l.pitches[t]+=f,(l.pitches[t]<0||l.pitches[t]>d)&&(l.pitches.splice(t,1),t--),l.pitches[t]<u&&(u=l.pitches[t]),l.pitches[t]>p&&(p=l.pitches[t]);if(!(l.pitches.length<1)){for(let t=0;t<l.pins.length;t++){const e=l.pins[t];e.interval+u<0&&(e.interval=-u),e.interval+p>d&&(e.interval=d-p),t>=2&&e.interval==l.pins[t-1].interval&&e.interval==l.pins[t-2].interval&&e.volume==l.pins[t-1].volume&&e.volume==l.pins[t-2].volume&&(l.pins.splice(t-1,1),t--)}s.notes.push(l),n=l.end}}}}for(let t=0;t<this.barCount;t++)l.bars[t]=n.sequence?Math.min(this.patternsPerChannel,n.sequence[t]>>>0):0}c.length>t.Config.pitchChannelCountMax&&(c.length=t.Config.pitchChannelCountMax),f.length>t.Config.noiseChannelCountMax&&(f.length=t.Config.noiseChannelCountMax),this.pitchChannelCount=c.length,this.noiseChannelCount=f.length,this.channels.length=0,Array.prototype.push.apply(this.channels,c),Array.prototype.push.apply(this.channels,f)}getPattern(t,e){const i=this.channels[t].bars[e];return 0==i?null:this.channels[t].patterns[i-1]}getPatternInstrument(t,e){const i=this.getPattern(t,e);return null==i?0:i.instrument}getBeatsPerMinute(){return this.tempo}}m.T="BeepBox",m.R=2,m.q=8,m.S=1,m.N=1,m.P=106,t.Song=m;class p{constructor(){this.pitches=[0,0,0,0],this.pitchCount=0,this.chordSize=0,this.drumsetPitch=0,this.note=null,this.prevNote=null,this.nextNote=null,this.prevNotePitchIndex=0,this.nextNotePitchIndex=0,this.active=!1,this.noteStart=0,this.noteEnd=0,this.noteLengthTicks=0,this.ticksSinceReleased=0,this.liveInputSamplesHeld=0,this.lastInterval=0,this.lastVolume=0,this.stereoVolume1=0,this.stereoVolume2=0,this.stereoOffset=0,this.stereoDelay=0,this.sample=0,this.phases=[],this.phaseDeltas=[],this.volumeStarts=[],this.volumeDeltas=[],this.volumeStart=0,this.volumeDelta=0,this.phaseDeltaScale=0,this.pulseWidth=0,this.pulseWidthDelta=0,this.filter=0,this.filterScale=0,this.filterSample0=0,this.filterSample1=0,this.vibratoScale=0,this.intervalMult=0,this.intervalVolumeMult=1,this.feedbackOutputs=[],this.feedbackMult=0,this.feedbackDelta=0,this.reset()}reset(){for(let e=0;e<t.Config.operatorCount;e++)this.phases[e]=0,this.feedbackOutputs[e]=0;this.sample=0,this.filterSample0=0,this.filterSample1=0,this.liveInputSamplesHeld=0}}class y{constructor(e=null){this.samplesPerSecond=44100,this.song=null,this.liveInputPressed=!1,this.liveInputPitches=[0],this.liveInputChannel=0,this.loopRepeatCount=-1,this.volume=1,this.playheadInternal=0,this.bar=0,this.beat=0,this.part=0,this.tick=0,this.tickSampleCountdown=0,this.paused=!0,this.tonePool=new t.Deque,this.activeTones=[],this.releasedTones=[],this.liveInputTones=new t.Deque,this.limit=0,this.stereoBufferIndex=0,this.samplesForNone=null,this.samplesForReverb=null,this.samplesForChorus=null,this.samplesForChorusReverb=null,this.chorusDelayLine=new Float32Array(2048),this.chorusDelayPos=0,this.chorusPhase=0,this.reverbDelayLine=new Float32Array(16384),this.reverbDelayPos=0,this.reverbFeedback0=0,this.reverbFeedback1=0,this.reverbFeedback2=0,this.reverbFeedback3=0,this.audioCtx=null,this.scriptNode=null,this.audioProcessCallback=(t=>{const e=t.outputBuffer,i=e.getChannelData(0),s=e.getChannelData(1);if(this.paused)for(let t=0;t<e.length;t++)i[t]=0,s[t]=0;else this.synthesize(i,s,e.length)}),null!=e&&this.setSong(e)}static warmUpSynthesizer(t){if(null!=t)for(let e=0;e<t.getChannelCount();e++)for(let i=0;i<t.instrumentsPerChannel;i++)y.getInstrumentSynthFunction(t.channels[e].instruments[i]),t.channels[e].instruments[i].warmUp()}static operatorAmplitudeCurve(t){return(Math.pow(16,t/15)-1)/15}get playing(){return!this.paused}get playhead(){return this.playheadInternal}set playhead(e){if(null!=this.song){this.playheadInternal=Math.max(0,Math.min(this.song.barCount,e));let i=this.playheadInternal;this.bar=Math.floor(i),i=this.song.beatsPerBar*(i-this.bar),this.beat=Math.floor(i),i=t.Config.partsPerBeat*(i-this.beat),this.part=Math.floor(i),i=t.Config.ticksPerPart*(i-this.part),this.tick=Math.floor(i);const s=this.getSamplesPerTick();i=s*(i-this.tick),this.tickSampleCountdown=Math.floor(s-i)}}getSamplesPerBar(){if(null==this.song)throw new Error;return this.getSamplesPerTick()*t.Config.ticksPerPart*t.Config.partsPerBeat*this.song.beatsPerBar}getTotalBars(t,e){if(null==this.song)throw new Error;let i=this.song.loopLength*(this.loopRepeatCount+1);return t&&(i+=this.song.loopStart),e&&(i+=this.song.barCount-(this.song.loopStart+this.song.loopLength)),i}setSong(t){"string"==typeof t?this.song=new m(t):t instanceof m&&(this.song=t)}play(){if(!this.paused)return;this.paused=!1,y.warmUpSynthesizer(this.song);const t=window.AudioContext||window.webkitAudioContext;this.audioCtx=this.audioCtx||new t,this.scriptNode=this.audioCtx.createScriptProcessor?this.audioCtx.createScriptProcessor(2048,0,2):this.audioCtx.createJavaScriptNode(2048,0,2),this.scriptNode.onaudioprocess=this.audioProcessCallback,this.scriptNode.channelCountMode="explicit",this.scriptNode.channelInterpretation="speakers",this.scriptNode.connect(this.audioCtx.destination),this.samplesPerSecond=this.audioCtx.sampleRate}pause(){this.paused||(this.paused=!0,this.scriptNode.disconnect(this.audioCtx.destination),this.audioCtx.close&&this.audioCtx.close(),this.audioCtx=null,this.scriptNode=null)}resetBuffers(){for(let t=0;t<this.reverbDelayLine.length;t++)this.reverbDelayLine[t]=0;for(let t=0;t<this.chorusDelayLine.length;t++)this.chorusDelayLine[t]=0;if(null!=this.samplesForNone)for(let t=0;t<this.samplesForNone.length;t++)this.samplesForNone[t]=0;if(null!=this.samplesForReverb)for(let t=0;t<this.samplesForReverb.length;t++)this.samplesForReverb[t]=0;if(null!=this.samplesForChorus)for(let t=0;t<this.samplesForChorus.length;t++)this.samplesForChorus[t]=0;if(null!=this.samplesForChorusReverb)for(let t=0;t<this.samplesForChorusReverb.length;t++)this.samplesForChorusReverb[t]=0}snapToStart(){this.bar=0,this.snapToBar()}snapToBar(t){void 0!==t&&(this.bar=t),this.playheadInternal=this.bar,this.beat=0,this.part=0,this.tick=0,this.tickSampleCountdown=0,this.reverbDelayPos=0,this.reverbFeedback0=0,this.reverbFeedback1=0,this.reverbFeedback2=0,this.reverbFeedback3=0,this.freeAllTones(),this.resetBuffers()}jumpIntoLoop(){if(this.song&&(this.bar<this.song.loopStart||this.bar>=this.song.loopStart+this.song.loopLength)){const t=this.bar;this.bar=this.song.loopStart,this.playheadInternal+=this.bar-t}}nextBar(){if(!this.song)return;const t=this.bar;this.bar++,this.bar>=this.song.barCount&&(this.bar=0),this.playheadInternal+=this.bar-t}firstBar(){this.song&&(this.bar=0,this.playheadInternal=0,this.beat=0,this.part=0)}jumpToEditingBar(t){this.song&&(this.bar=t,this.playheadInternal=t,this.beat=0,this.part=0)}prevBar(){if(!this.song)return;const t=this.bar;this.bar--,(this.bar<0||this.bar>=this.song.barCount)&&(this.bar=this.song.barCount-1),this.playheadInternal+=this.bar-t}synthesize(e,i,s){if(null==this.song){for(let t=0;t<s;t++)e[t]=0,i[t]=0;return}const n=this.song.getChannelCount();for(let e=this.activeTones.length;e<n;e++)this.activeTones[e]=new t.Deque,this.releasedTones[e]=new t.Deque;this.activeTones.length=n,this.releasedTones.length=n;const o=this.getSamplesPerTick();let h=0,r=!1;(0==this.tickSampleCountdown||this.tickSampleCountdown>o)&&(this.tickSampleCountdown=o),this.beat>=this.song.beatsPerBar&&(this.bar++,this.beat=0,this.part=0,this.tick=0,this.tickSampleCountdown=o,0!=this.loopRepeatCount&&this.bar==this.song.loopStart+this.song.loopLength&&(this.bar=this.song.loopStart,this.loopRepeatCount>0&&this.loopRepeatCount--)),this.bar>=this.song.barCount&&(this.bar=0,-1!=this.loopRepeatCount&&(r=!0,this.pause()));const a=4*s;null!=this.samplesForNone&&this.samplesForNone.length==a&&null!=this.samplesForReverb&&this.samplesForReverb.length==a&&null!=this.samplesForChorus&&this.samplesForChorus.length==a&&null!=this.samplesForChorusReverb&&this.samplesForChorusReverb.length==a||(this.samplesForNone=new Float32Array(a),this.samplesForReverb=new Float32Array(a),this.samplesForChorus=new Float32Array(a),this.samplesForChorusReverb=new Float32Array(a),this.stereoBufferIndex=0);let l=this.stereoBufferIndex;const c=this.samplesForNone,f=this.samplesForReverb,d=this.samplesForChorus,u=this.samplesForChorusReverb,m=+this.volume,p=this.chorusDelayLine,y=this.reverbDelayLine,b=2*Math.PI/(2*this.samplesPerSecond),g=150*this.samplesPerSecond/44100,v=2048-1.51*g,w=2048-2.1*g,M=2048-3.35*g,k=2048-1.47*g,x=2048-2.15*g,E=2048-3.25*g;let A=this.chorusPhase%(2*Math.PI),C=2047&this.chorusDelayPos,P=16383&this.reverbDelayPos,N=+this.reverbFeedback0,q=+this.reverbFeedback1,R=+this.reverbFeedback2,S=+this.reverbFeedback3;const z=.425*Math.pow(this.song.reverb/t.Config.reverbRange,.667),T=1-Math.pow(.5,4/this.samplesPerSecond),B=1-Math.pow(.5,4e3/this.samplesPerSecond);let F=+this.limit;for(;h<s&&!r;){const n=s-h,L=this.tickSampleCountdown<=n?this.tickSampleCountdown:n;for(let e=0;e<this.song.getChannelCount();e++){if(e==this.liveInputChannel){this.determineLiveInputTones(this.song);for(let t=0;t<this.liveInputTones.count();t++){const i=this.liveInputTones.get(t);this.playTone(this.song,l,a,e,o,L,i,!1,!1)}}this.determineCurrentActiveTones(this.song,e);for(let t=0;t<this.activeTones[e].count();t++){const i=this.activeTones[e].get(t);this.playTone(this.song,l,a,e,o,L,i,!1,!1)}for(let i=0;i<this.releasedTones[e].count();i++){const s=this.releasedTones[e].get(i);if(s.ticksSinceReleased>=s.instrument.getTransition().releaseTicks){this.freeReleasedTone(e,i),i--;continue}const n=i+this.activeTones[e].count()>=t.Config.maximumTonesPerChannel;this.playTone(this.song,l,a,e,o,L,s,!0,n)}}let I=C+v-g*Math.sin(A+0),H=C+w-g*Math.sin(A+2.1),U=C+M-g*Math.sin(A+4.2),D=C+1024+k-g*Math.sin(A+3.2),Z=C+1024+x-g*Math.sin(A+5.3),j=C+1024+E-g*Math.sin(A+1);A+=b*L;const V=(C+L+v-g*Math.sin(A+0)-I)/L,O=(C+L+w-g*Math.sin(A+2.1)-H)/L,G=(C+L+M-g*Math.sin(A+4.2)-U)/L,W=(C+L+1024+k-g*Math.sin(A+3.2)-D)/L,Y=(C+L+1024+x-g*Math.sin(A+5.3)-Z)/L,J=(C+L+1024+E-g*Math.sin(A+1)-j)/L,Q=h+L;for(let t=h;t<Q;t++){const s=l,n=l+1,o=c[s];c[s]=0;const h=c[n];c[n]=0;const r=f[s];f[s]=0;const a=f[n];f[n]=0;const b=d[s];d[s]=0;const g=d[n];d[n]=0;const v=u[s];u[s]=0;const w=u[n];u[n]=0,l+=2;const M=b+v,k=g+w,x=I%1,E=H%1,A=U%1,L=D%1,Q=Z%1,X=j%1,_=p[2047&I],K=p[I+1&2047],$=p[2047&H],tt=p[H+1&2047],et=p[2047&U],it=p[U+1&2047],st=p[2047&D],nt=p[D+1&2047],ot=p[2047&Z],ht=p[Z+1&2047],rt=p[2047&j],at=.5*(M-(_+(K-_)*x)+($+(tt-$)*E)-(et+(it-et)*A)),lt=.5*(k-(st+(nt-st)*L)+(ot+(ht-ot)*Q)-(rt+(p[j+1&2047]-rt)*X));p[C]=M,p[C+1024&2047]=k,C=C+1&2047,I+=V,H+=O,U+=G,D+=W,Z+=Y,j+=J;const ct=P+3041&16383,ft=P+6426&16383,dt=P+10907&16383,ut=y[P],mt=y[ct],pt=y[ft],yt=y[dt],bt=-(ut+v+r)+mt,gt=-(ut+w+a)-mt,vt=-pt+yt,wt=-pt-yt;N+=.5*((bt+vt)*z-N),q+=.5*((gt+wt)*z-q),R+=.5*((bt-vt)*z-R),S+=.5*((gt-wt)*z-S),y[ct]=N,y[ft]=q,y[dt]=R,y[P]=S,P=P+1&16383;const Mt=o+at+r+mt+pt+yt,kt=h+lt+a+ut+pt-yt,xt=Mt<0?-Mt:Mt,Et=kt<0?-kt:kt,At=xt>Et?xt:Et,Ct=m/((F+=(At-F)*(F<At?B:T))>=1?1.05*F:.8*F+.25);e[t]=Mt*Ct,i[t]=kt*Ct}if(h+=L,this.tickSampleCountdown-=L,this.tickSampleCountdown<=0){for(let e=0;e<this.song.getChannelCount();e++)for(let i=0;i<this.releasedTones[e].count();i++){this.releasedTones[e].get(i).ticksSinceReleased++,i+this.activeTones[e].count()>=t.Config.maximumTonesPerChannel&&(this.freeReleasedTone(e,i),i--)}if(this.tick++,this.tickSampleCountdown=o,this.tick==t.Config.ticksPerPart){this.tick=0,this.part++;for(let e=0;e<this.song.getChannelCount();e++)for(let i=0;i<this.activeTones[e].count();i++){const s=this.activeTones[e].get(i),n=s.instrument.getTransition();n.isSeamless||null==s.note||s.note.end!=this.part+this.beat*t.Config.partsPerBeat||(n.releases?this.releaseTone(e,s):this.freeTone(s),this.activeTones[e].remove(i),i--)}this.part==t.Config.partsPerBeat&&(this.part=0,this.beat++,this.beat==this.song.beatsPerBar&&(this.beat=0,this.bar++,0!=this.loopRepeatCount&&this.bar==this.song.loopStart+this.song.loopLength&&(this.bar=this.song.loopStart,this.loopRepeatCount>0&&this.loopRepeatCount--),this.bar>=this.song.barCount&&(this.bar=0,-1!=this.loopRepeatCount&&(r=!0,this.resetBuffers(),this.pause()))))}}}-1e-24<N&&N<1e-24&&(N=0),-1e-24<q&&q<1e-24&&(q=0),-1e-24<R&&R<1e-24&&(R=0),-1e-24<S&&S<1e-24&&(S=0),-1e-24<F&&F<1e-24&&(F=0),this.stereoBufferIndex=(this.stereoBufferIndex+2*s)%a,this.chorusPhase=A,this.chorusDelayPos=C,this.reverbDelayPos=P,this.reverbFeedback0=N,this.reverbFeedback1=q,this.reverbFeedback2=R,this.reverbFeedback3=S,this.limit=F,this.playheadInternal=(((this.tick+1-this.tickSampleCountdown/o)/2+this.part)/t.Config.partsPerBeat+this.beat)/this.song.beatsPerBar+this.bar}freeTone(t){this.tonePool.pushBack(t)}newTone(){if(this.tonePool.count()>0){const t=this.tonePool.popBack();return t.reset(),t.active=!1,t}return new p}releaseTone(t,e){this.releasedTones[t].pushFront(e)}freeReleasedTone(t,e){this.freeTone(this.releasedTones[t].get(e)),this.releasedTones[t].remove(e)}freeAllTones(){for(;this.liveInputTones.count()>0;)this.freeTone(this.liveInputTones.popBack());for(let t=0;t<this.activeTones.length;t++)for(;this.activeTones[t].count()>0;)this.freeTone(this.activeTones[t].popBack());for(let t=0;t<this.releasedTones.length;t++)for(;this.releasedTones[t].count()>0;)this.freeTone(this.releasedTones[t].popBack())}determineLiveInputTones(t){if(this.liveInputPressed){const e=t.channels[this.liveInputChannel].instruments[t.getPatternInstrument(this.liveInputChannel,this.bar)];let i;0==this.liveInputTones.count()?(i=this.newTone(),this.liveInputTones.pushBack(i)):e.getTransition().isSeamless||this.liveInputTones.peakFront().pitches[0]==this.liveInputPitches[0]?i=this.liveInputTones.get(0):(this.releaseTone(this.liveInputChannel,this.liveInputTones.popFront()),i=this.newTone(),this.liveInputTones.pushBack(i));for(let t=0;t<this.liveInputPitches.length;t++)i.pitches[t]=this.liveInputPitches[t];i.pitchCount=this.liveInputPitches.length,i.chordSize=1,i.instrument=e,i.note=i.prevNote=i.nextNote=null}else for(;this.liveInputTones.count()>0;)this.releaseTone(this.liveInputChannel,this.liveInputTones.popBack())}determineCurrentActiveTones(e,i){const s=e.channels[i].instruments[e.getPatternInstrument(i,this.bar)],n=e.getPattern(i,this.bar),o=this.part+this.beat*t.Config.partsPerBeat;let h=null,r=null,a=null;if(null!=n)for(let t=0;t<n.notes.length;t++)if(n.notes[t].end<=o)r=n.notes[t];else if(n.notes[t].start<=o&&n.notes[t].end>o)h=n.notes[t];else if(n.notes[t].start>o){a=n.notes[t];break}const l=this.activeTones[i];if(null!=h)null!=r&&r.end!=h.start&&(r=null),null!=a&&a.start!=h.end&&(a=null),this.syncTones(i,l,s,h.pitches,h,r,a,o);else for(;l.count()>0;)l.peakBack().instrument.getTransition().releases?this.releaseTone(i,l.popBack()):this.freeTone(l.popBack())}syncTones(e,i,s,n,o,h,r,a){let l=0;if(s.getChord().arpeggiates){let t;0==i.count()?(t=this.newTone(),i.pushBack(t)):t=i.get(0),l=1;for(let e=0;e<n.length;e++)t.pitches[e]=n[e];t.pitchCount=n.length,t.chordSize=1,t.instrument=s,t.note=o,t.noteStart=o.start,t.noteEnd=o.end,t.prevNote=h,t.nextNote=r,t.prevNotePitchIndex=0,t.nextNotePitchIndex=0}else{const e=s.getTransition();for(let c=0;c<n.length;c++){const n=c*s.getChord().strumParts;let f=h&&h.pitches.length>c?h:null,d=o,u=r&&r.pitches.length>c?r:null,m=d.start+n;if(m>a){if(!(i.count()>c&&e.isSeamless&&null!=f))break;u=d,d=f,f=null,m=d.start+n}let p,y=d.end;e.isSeamless&&null!=u&&(y=Math.min(t.Config.partsPerBeat*this.song.beatsPerBar,y+n)),i.count()>c?p=i.get(c):(p=this.newTone(),i.pushBack(p)),l++,p.pitches[0]=d.pitches[c],p.pitchCount=1,p.chordSize=d.pitches.length,p.instrument=s,p.note=d,p.noteStart=m,p.noteEnd=y,p.prevNote=f,p.nextNote=u,p.prevNotePitchIndex=c,p.nextNotePitchIndex=c}}for(;i.count()>l;)i.peakBack().instrument.getTransition().releases?this.releaseTone(e,i.popBack()):this.freeTone(i.popBack())}playTone(t,e,i,s,n,o,h,r,a){let l;switch(y.computeTone(this,t,s,n,o,h,r,a),h.instrument.effects){case 0:l=this.samplesForNone;break;case 1:l=this.samplesForReverb;break;case 2:l=this.samplesForChorus;break;case 3:l=this.samplesForChorusReverb;break;default:throw new Error}const c=y.getInstrumentSynthFunction(h.instrument);0==t.channels[s].muted&&c(this,l,e,i,2*o,h,h.instrument)}static computeEnvelope(t,e,i,s){switch(t.type){case 0:return s;case 1:return 1;case 4:return 1/(1+e*t.speed);case 5:return 1-1/(1+e*t.speed);case 6:return.5-.5*Math.cos(2*i*Math.PI*t.speed);case 7:return.75-.25*Math.cos(2*i*Math.PI*t.speed);case 2:return Math.max(1,2-10*e);case 3:const n=t.speed,o=.25/Math.sqrt(n);return e<o?e/o:1/(1+(e-o)*n);case 8:return Math.pow(2,-t.speed*e);default:throw new Error("Unrecognized operator envelope type.")}}static computeChordVolume(t){return 1/(.25*(t-1)+1)}static computeTone(e,i,s,n,o,h,r,a){const l=h.instrument,c=l.getTransition(),f=l.getChord(),u=f.arpeggiates?1:y.computeChordVolume(h.chordSize),m=i.getChannelIsNoise(s),p=m?t.Config.noiseInterval:1,b=t.Config.ticksPerPart*n/e.samplesPerSecond,g=1/t.Config.partsPerBeat,v=h.active,w=e.tickSampleCountdown,M=1-w/n,k=1-(w-o)/n,x=(e.beat*t.Config.partsPerBeat+e.part)*t.Config.ticksPerPart+e.tick,E=x/t.Config.ticksPerPart,A=(x+1)/t.Config.ticksPerPart,C=E+(A-E)*M,P=E+(A-E)*k;h.phaseDeltaScale=0,h.filter=1,h.filterScale=1,h.vibratoScale=0,h.intervalMult=1,h.intervalVolumeMult=1,h.active=!1;const N=(l.pan-t.Config.panCenter)/t.Config.panCenter,q=65e-5*e.samplesPerSecond,R=2*Math.round(-N*q),S=1.414*Math.cos((1+N)*Math.PI*.25),z=1.414*Math.cos((1-N)*Math.PI*.25),T=Math.max(0,-R),B=Math.max(0,R);R>=0?(h.stereoVolume1=S,h.stereoVolume2=z,h.stereoOffset=0,h.stereoDelay=B+1):(h.stereoVolume1=z,h.stereoVolume2=S,h.stereoOffset=1,h.stereoDelay=T-1);let F,L,I,H,U=!0,D=0,Z=0,j=0,V=1,O=1,G=u,W=u,Y=0,J=0,Q=0,X=0;if(3==l.type)m?(L=t.Config.spectrumBasePitch,I=.6):(L=t.Config.keys[i.key].basePitch,I=.3),F=t.Config.spectrumBasePitch,H=28;else if(4==l.type)I=.45,F=L=t.Config.spectrumBasePitch,H=48;else if(2==l.type)I=.19,F=L=t.Config.chipNoises[l.chipNoise].basePitch,H=t.Config.chipNoises[l.chipNoise].isSoft?24:60;else if(1==l.type)L=t.Config.keys[i.key].basePitch,I=.03,F=16,H=48;else if(0==l.type||7==l.type)L=t.Config.keys[i.key].basePitch,I=.03375,F=16,H=48;else if(5==l.type)L=t.Config.keys[i.key].basePitch,I=.025,F=16,H=48;else{if(6!=l.type)throw new Error("Unknown instrument type in computeTone.");L=t.Config.keys[i.key].basePitch,I=.04725,F=16,H=48}for(let e=0;e<t.Config.operatorCount;e++)h.phaseDeltas[e]=0,h.volumeStarts[e]=0,h.volumeDeltas[e]=0;if(r){const e=h.noteLengthTicks+h.ticksSinceReleased,i=h.ticksSinceReleased+M,s=h.ticksSinceReleased+k,n=h.noteLengthTicks+i,o=h.noteLengthTicks+s,r=h.instrument.getTransition();U=!1,D=Math.floor(e/t.Config.ticksPerPart),Z=j=h.lastInterval,Y=J=y.expressionToVolumeMult(h.lastVolume),V=y.expressionToVolumeMult(6*(1-i/r.releaseTicks)),O=y.expressionToVolumeMult(6*(1-s/r.releaseTicks)),Q=n/t.Config.ticksPerPart,X=o/t.Config.ticksPerPart,a&&(V*=1-M,O*=1-k)}else if(null==h.note){V=O=1,Y=J=1,h.lastInterval=0,h.lastVolume=3,h.ticksSinceReleased=0,U=!1;const e=h.liveInputSamplesHeld/n;h.liveInputSamplesHeld+=o;const i=h.liveInputSamplesHeld/n;h.noteLengthTicks=i;const s=e/t.Config.ticksPerPart,r=i/t.Config.ticksPerPart;D=Math.floor(s),Q=s,X=r}else{const s=h.note,n=h.prevNote,o=h.nextNote,r=e.part+e.beat*t.Config.partsPerBeat,a=t.Config.partsPerBeat*i.beatsPerBar,l=h.noteStart,d=h.noteEnd;let m;for(D=r-l,m=1;m<s.pins.length-1&&!(s.pins[m].time+s.start>r);m++);const p=s.pins[m-1],b=s.pins[m],g=l*t.Config.ticksPerPart,w=d*t.Config.ticksPerPart-g,x=(s.start+p.time)*t.Config.ticksPerPart,C=(s.start+b.time)*t.Config.ticksPerPart;h.lastInterval=s.pins[s.pins.length-1].interval,h.lastVolume=s.pins[s.pins.length-1].volume,h.ticksSinceReleased=0,h.noteLengthTicks=w;const P=r*t.Config.ticksPerPart+e.tick,N=r*t.Config.ticksPerPart+e.tick+1,q=P-g,R=N-g,S=Math.min(1,(P-x)/(C-x)),z=Math.min(1,(N-x)/(C-x));let T=p.volume+(b.volume-p.volume)*S,B=p.volume+(b.volume-p.volume)*z,F=1,L=1,I=u,H=u,_=p.interval+(b.interval-p.interval)*S,K=p.interval+(b.interval-p.interval)*z,$=E-l,tt=A-l;U=P+M-g==0||!v;const et=.5*w;if(c.isSeamless&&!c.slides&&0==s.start)U=!v;else if(c.isSeamless&&null!=n&&(U=!v,c.slides)){const t=Math.min(et,c.slideTicks),e=Math.max(0,1-q/t),i=Math.max(0,1-R/t),o=.5*(n.pitches[h.prevNotePitchIndex]+n.pins[n.pins.length-1].interval-h.pitches[0]),r=.5*(n.pins[n.pins.length-1].volume-s.pins[0].volume),a=.5*(n.end-n.start);if(_+=e*o,K+=i*o,T+=e*r,B+=i*r,$+=e*a,tt+=i*a,!f.arpeggiates){const t=.5*(n.pitches.length-h.chordSize);I=y.computeChordVolume(h.chordSize+e*t),H=y.computeChordVolume(h.chordSize+i*t)}}if(c.isSeamless&&!c.slides&&s.end==a);else if(c.isSeamless&&null!=o){if(c.slides){const t=Math.min(et,c.slideTicks),e=Math.max(0,1-(w-q)/t),i=Math.max(0,1-(w-R)/t),n=.5*(o.pitches[h.nextNotePitchIndex]-(h.pitches[0]+s.pins[s.pins.length-1].interval)),r=.5*(o.pins[0].volume-s.pins[s.pins.length-1].volume),a=.5*-(d-l);if(_+=e*n,K+=i*n,T+=e*r,B+=i*r,$+=e*a,tt+=i*a,!f.arpeggiates){const t=.5*(o.pitches.length-h.chordSize);I=y.computeChordVolume(h.chordSize+e*t),H=y.computeChordVolume(h.chordSize+i*t)}}}else if(!c.releases){const t=c.releaseTicks;t>0&&(F*=Math.min(1,(w-q)/t),L*=Math.min(1,(w-R)/t))}Z=_+(K-_)*M,j=_+(K-_)*k,Y=y.expressionToVolumeMult(T+(B-T)*M),J=y.expressionToVolumeMult(T+(B-T)*k),V=F+(L-F)*M,O=F+(L-F)*k,G=I+(H-I)*M,W=I+(H-I)*k,Q=$+(tt-$)*M,X=$+(tt-$)*k}const _=1/e.samplesPerSecond;if(h.active=!0,0==l.type||1==l.type||5==l.type||6==l.type||7==l.type){const e=y.getLFOAmplitude(l,b*C),i=y.getLFOAmplitude(l,b*P),s=D<t.Config.vibratos[l.vibrato].delayParts?0:t.Config.vibratos[l.vibrato].amplitude;Z+=s*e,j+=s*i}if(!c.isSeamless||(c.slides||null==h.note||0!=h.note.start)&&null==h.prevNote){const t=c.attackSeconds;t>0&&(V*=Math.min(1,b*Q/t),O*=Math.min(1,b*X/t))}const K=y.instrumentVolumeToVolumeMult(l.volume);4==l.type&&(h.drumsetPitch=h.pitches[0],null!=h.note&&(h.drumsetPitch+=h.note.pickMainInterval()),h.drumsetPitch=Math.max(0,Math.min(t.Config.drumCount-1,h.drumsetPitch)));const $=l.getFilterCutoffOctaves(),tt=4==l.type?l.getDrumsetEnvelope(h.drumsetPitch):l.getFilterEnvelope(),et=t.Config.filterCutoffMaxHz*Math.pow(2,$),it=2*Math.sin(Math.PI*et/e.samplesPerSecond),st=2*Math.sin(Math.PI*t.Config.filterCutoffMinHz/e.samplesPerSecond);h.filter=it*y.computeEnvelope(tt,b*Q,g*C,Y);let nt=it*y.computeEnvelope(tt,b*X,g*P,J);h.filter=Math.min(t.Config.filterMax,Math.max(st,h.filter)),nt=Math.min(t.Config.filterMax,Math.max(st,nt)),h.filterScale=Math.pow(nt/h.filter,1/o);let ot=Math.pow(.5,.35*$);if(l.filterResonance>0&&(ot=Math.pow(ot,1.7)*Math.pow(.5,.125*(l.filterResonance-1))),8==tt.type?ot*=1.25+.025*tt.speed:4==tt.type&&(ot*=1+.02*tt.speed),U&&h.reset(),1==l.type){let s=1,n=0,r=0;if(h.pitchCount>1&&!f.harmonizes){const s=Math.floor((e.tick+e.part*t.Config.ticksPerPart)/t.Config.rhythms[i.rhythm].ticksPerArpeggio),n=t.Config.rhythms[i.rhythm].arpeggioPatterns[h.pitchCount-1];r=h.pitches[n[s%n.length]]-h.pitches[0]}const a=t.Config.algorithms[l.algorithm].carrierCount;for(let e=0;e<t.Config.operatorCount;e++){const i=t.Config.algorithms[l.algorithm].associatedCarrier[e]-1,c=h.pitches[f.harmonizes?e<h.pitchCount?e:i<h.pitchCount?i:0:0],u=t.Config.operatorFrequencies[l.operators[e].frequency].mult,m=t.Config.operatorCarrierInterval[i]+r,v=L+(c+Z)*p+m,w=u*d.frequencyFromPitch(v)+t.Config.operatorFrequencies[l.operators[e].frequency].hzOffset;h.phaseDeltas[e]=w*_*t.Config.sineWaveLength;const M=y.operatorAmplitudeCurve(l.operators[e].amplitude),k=M*t.Config.operatorFrequencies[l.operators[e].frequency].amplitudeSign;let x=k,E=k;if(e<a){const t=L+(c+j)*p+m,e=Math.pow(2,-(v-F)/H),i=Math.pow(2,-(t-F)/H);x*=e,E*=i,n+=M}else x*=1.5*t.Config.sineWaveLength,E*=1.5*t.Config.sineWaveLength,s*=1-Math.min(1,l.operators[e].amplitude/15);const A=t.Config.envelopes[l.operators[e].envelope];x*=y.computeEnvelope(A,b*Q,g*C,Y),E*=y.computeEnvelope(A,b*X,g*P,J),h.volumeStarts[e]=x,h.volumeDeltas[e]=(E-x)/o}const c=.3*t.Config.sineWaveLength*l.feedbackAmplitude/15,u=t.Config.envelopes[l.feedbackEnvelope];let m=c*y.computeEnvelope(u,b*Q,g*C,Y),v=c*y.computeEnvelope(u,b*X,g*P,J);h.feedbackMult=m,h.feedbackDelta=(v-h.feedbackMult)/o;const w=I*K;h.volumeStart=ot*w*V*G;const M=ot*w*O*W;h.volumeDelta=(M-h.volumeStart)/o,s*=(Math.pow(2,2-1.4*l.feedbackAmplitude/15)-1)/3,s*=1-Math.min(1,Math.max(0,n-1)/2),h.volumeStart*=1+3*s,h.volumeDelta*=1+3*s}else{let s=h.pitches[0];if(h.pitchCount>1){const n=Math.floor((e.tick+e.part*t.Config.ticksPerPart)/t.Config.rhythms[i.rhythm].ticksPerArpeggio);if(f.harmonizes){const e=t.Config.rhythms[i.rhythm].arpeggioPatterns[h.pitchCount-2],s=h.pitches[1+e[n%e.length]]-h.pitches[0];h.intervalMult=Math.pow(2,s/12),h.intervalVolumeMult=Math.pow(2,-s/H)}else{const e=t.Config.rhythms[i.rhythm].arpeggioPatterns[h.pitchCount-1];s=h.pitches[e[n%e.length]]}}const n=L+(s+Z)*p,r=L+(s+j)*p,a=d.frequencyFromPitch(n),c=Math.pow(2,-(n-F)/H),u=Math.pow(2,-(r-F)/H);let m=I*ot;if(2==l.type&&(m*=t.Config.chipNoises[l.chipNoise].volume),0!=l.type&&7!=l.type||(m*=t.Config.chipWaves[l.chipWave].volume),0!=l.type&&5!=l.type&&7!=l.type||(m*=t.Config.intervals[l.interval].volume),6==l.type){const e=t.Config.envelopes[l.pulseEnvelope],i=l.pulseWidth/100,s=i*y.computeEnvelope(e,b*Q,g*C,Y),n=i*y.computeEnvelope(e,b*X,g*P,J);h.pulseWidth=s,h.pulseWidthDelta=(n-s)/o}h.phaseDeltas[0]=a*_,h.volumeStart=V*G*c*m*K;let v=O*W*u*m*K;0==tt.type||6==l.type&&0==t.Config.envelopes[l.pulseEnvelope].type||(h.volumeStart*=Y,v*=J),h.volumeDelta=(v-h.volumeStart)/o}h.phaseDeltaScale=Math.pow(2,(j-Z)*p/12/o)}static getLFOAmplitude(e,i){let s=0;for(const n of t.Config.vibratos[e.vibrato].periodsSeconds)s+=Math.sin(2*Math.PI*i/n);return s}static getInstrumentSynthFunction(e){if(1==e.type){const i=e.algorithm+"_"+e.feedbackType;if(void 0==y.fmSynthFunctionCache[i]){const s=[];for(const i of y.fmSourceTemplate)if(-1!=i.indexOf("// CARRIER OUTPUTS")){const n=[];for(let i=0;i<t.Config.algorithms[e.algorithm].carrierCount;i++)n.push("operator"+i+"Scaled");s.push(i.replace("/*operator#Scaled*/",n.join(" + ")))}else if(-1!=i.indexOf("// INSERT OPERATOR COMPUTATION HERE"))for(let i=t.Config.operatorCount-1;i>=0;i--)for(const n of y.operatorSourceTemplate)if(-1!=n.indexOf("/* + operator@Scaled*/")){let o="";for(const s of t.Config.algorithms[e.algorithm].modulatedBy[i])o+=" + operator"+(s-1)+"Scaled";const h=t.Config.feedbacks[e.feedbackType].indices[i];if(h.length>0){o+=" + feedbackMult * (";const t=[];for(const e of h)t.push("operator"+(e-1)+"Output");o+=t.join(" + ")+")"}s.push(n.replace(/\#/g,i+"").replace("/* + operator@Scaled*/",o))}else s.push(n.replace(/\#/g,i+""));else if(-1!=i.indexOf("#"))for(let e=0;e<t.Config.operatorCount;e++)s.push(i.replace(/\#/g,e+""));else s.push(i);y.fmSynthFunctionCache[i]=new Function("synth","data","stereoBufferIndex","stereoBufferLength","runLength","tone","instrument",s.join("\n"))}return y.fmSynthFunctionCache[i]}if(0==e.type)return y.chipSynth;if(7==e.type)return y.chipSynth;if(5==e.type)return y.harmonicsSynth;if(6==e.type)return y.pulseWidthSynth;if(2==e.type)return y.noiseSynth;if(3==e.type)return y.spectrumSynth;if(4==e.type)return y.drumsetSynth;throw new Error("Unrecognized instrument type: "+e.type)}static chipSynth(e,i,s,n,o,h,r){var a,l;7==r.type?(a=r.customChipWaveIntegral,l=.1):(a=t.Config.chipWaves[r.chipWave].samples,l=1);const c=+a.length-1,f=+Math.pow(2,(t.Config.intervals[r.interval].offset+t.Config.intervals[r.interval].spread)/12),d=Math.pow(2,(t.Config.intervals[r.interval].offset-t.Config.intervals[r.interval].spread)/12)*h.intervalMult,u=h.intervalVolumeMult*t.Config.intervals[r.interval].sign;0!=r.interval||r.getChord().customInterval||(h.phases[1]=h.phases[0]);const m=d/f;let p=h.phaseDeltas[0]*f*c,y=p*m;const b=+h.phaseDeltaScale;let g=+h.volumeStart;const v=+h.volumeDelta;let w=h.phases[0]%1*c,M=h.phases[1]%1*c,k=+h.filter,x=r.getFilterIsFirstOrder()?1:k;const E=+h.filterScale,A=r.getFilterIsFirstOrder()?1:E,C=t.Config.filterMaxResonance*Math.pow(Math.max(0,r.getFilterResonance()-1)/(t.Config.filterResonanceRange-2),.5);let P=+h.filterSample0,N=+h.filterSample1;const q=0|w,R=0|M,S=q%c,z=R%c,T=w-q,B=M-R;let F=a[S],L=a[z];F+=(a[S+1]-F)*T,L+=(a[z+1]-L)*B;const I=s+o;s+=h.stereoOffset;const H=h.stereoVolume1,U=h.stereoVolume2,D=h.stereoDelay;for(;s<I;){const t=0|(w+=p),e=0|(M+=y),o=t%c,h=e%c;let r=a[o],f=a[h];const d=w-t,m=M-e;let q=((r+=(a[o+1]-r)*d)-F)/p,R=((f+=(a[h+1]-f)*m)-L)/y;F=r,L=f,N+=x*((P+=k*(q+R*u-P+(C+C/(1-k))*(P-N)))-N),k*=E,x*=A,p*=b,y*=b;const S=N*g*l;g+=v,i[s]+=S*H,i[(s+D)%n]+=S*U,s+=2}h.phases[0]=w/c,h.phases[1]=M/c;-1e-24<P&&P<1e-24&&(P=0),-1e-24<N&&N<1e-24&&(N=0),h.filterSample0=P,h.filterSample1=N}static harmonicsSynth(e,i,s,n,o,h,r){const a=r.harmonicsWave.getCustomWave(),l=+a.length-1,c=+Math.pow(2,(t.Config.intervals[r.interval].offset+t.Config.intervals[r.interval].spread)/12),f=Math.pow(2,(t.Config.intervals[r.interval].offset-t.Config.intervals[r.interval].spread)/12)*h.intervalMult,d=h.intervalVolumeMult*t.Config.intervals[r.interval].sign;0!=r.interval||r.getChord().customInterval||(h.phases[1]=h.phases[0]);const u=f/c;let m=h.phaseDeltas[0]*c*l,p=m*u;const y=+h.phaseDeltaScale;let b=+h.volumeStart;const g=+h.volumeDelta;let v=h.phases[0]%1*l,w=h.phases[1]%1*l,M=+h.filter,k=r.getFilterIsFirstOrder()?1:M;const x=+h.filterScale,E=r.getFilterIsFirstOrder()?1:x,A=t.Config.filterMaxResonance*Math.pow(Math.max(0,r.getFilterResonance()-1)/(t.Config.filterResonanceRange-2),.5);let C=+h.filterSample0,P=+h.filterSample1;const N=0|v,q=0|w,R=N%l,S=q%l,z=v-N,T=w-q;let B=a[R],F=a[S];B+=(a[R+1]-B)*z,F+=(a[S+1]-F)*T;const L=s+o;s+=h.stereoOffset;const I=h.stereoVolume1,H=h.stereoVolume2,U=h.stereoDelay;for(;s<L;){const t=0|(v+=m),e=0|(w+=p),o=t%l,h=e%l;let r=a[o],c=a[h];const f=v-t,u=w-e;let N=((r+=(a[o+1]-r)*f)-B)/m,q=((c+=(a[h+1]-c)*u)-F)/p;B=r,F=c,P+=k*((C+=M*(N+q*d-C+(A+A/(1-M))*(C-P)))-P),M*=x,k*=E,m*=y,p*=y;const R=P*b;b+=g,i[s]+=R*I,i[(s+U)%n]+=R*H,s+=2}h.phases[0]=v/l,h.phases[1]=w/l;-1e-24<C&&C<1e-24&&(C=0),-1e-24<P&&P<1e-24&&(P=0),h.filterSample0=C,h.filterSample1=P}static pulseWidthSynth(e,i,s,n,o,h,r){let a=h.phaseDeltas[0];const l=+h.phaseDeltaScale;let c=+h.volumeStart;const f=+h.volumeDelta;let d=h.phases[0]%1,u=h.pulseWidth;const m=h.pulseWidthDelta;let p=+h.filter,y=r.getFilterIsFirstOrder()?1:p;const b=+h.filterScale,g=r.getFilterIsFirstOrder()?1:b,v=t.Config.filterMaxResonance*Math.pow(Math.max(0,r.getFilterResonance()-1)/(t.Config.filterResonanceRange-2),.5);let w=+h.filterSample0,M=+h.filterSample1;const k=s+o;s+=h.stereoOffset;const x=h.stereoVolume1,E=h.stereoVolume2,A=h.stereoDelay;for(;s<k;){const t=d%1,e=(d+u)%1;let o=e-t;if(t<a)o+=.5*((C=t/a)+C-C*C-1);else if(t>1-a){o+=.5*((C=(t-1)/a)+C+C*C+1)}if(e<a)o-=.5*((C=e/a)+C-C*C-1);else if(e>1-a){var C;o-=.5*((C=(e-1)/a)+C+C*C+1)}M+=y*((w+=p*(o-w+(v+v/(1-p))*(w-M)))-M),p*=b,y*=g,d+=a,a*=l,u+=m;const h=M*c;c+=f,i[s]+=h*x,i[(s+A)%n]+=h*E,s+=2}h.phases[0]=d;-1e-24<w&&w<1e-24&&(w=0),-1e-24<M&&M<1e-24&&(M=0),h.filterSample0=w,h.filterSample1=M}static noiseSynth(e,i,s,n,o,h,r){let a=r.getDrumWave(),l=+h.phaseDeltas[0];const c=+h.phaseDeltaScale;let f=+h.volumeStart;const d=+h.volumeDelta;let u=h.phases[0]%1*t.Config.chipNoiseLength;0==h.phases[0]&&(u=Math.random()*t.Config.chipNoiseLength);let m=+h.sample,p=+h.filter,y=r.getFilterIsFirstOrder()?1:p;const b=+h.filterScale,g=r.getFilterIsFirstOrder()?1:b,v=t.Config.filterMaxResonance*Math.pow(Math.max(0,r.getFilterResonance()-1)/(t.Config.filterResonanceRange-2),.5);let w=+h.filterSample0,M=+h.filterSample1;const k=Math.min(1,h.phaseDeltas[0]*t.Config.chipNoises[r.chipNoise].pitchFilterMult),x=s+o;s+=h.stereoOffset;const E=h.stereoVolume1,A=h.stereoVolume2,C=h.stereoDelay;for(;s<x;){M+=y*((w+=p*((m+=(a[32767&u]-m)*k)-w+(v+v/(1-p))*(w-M)))-M),u+=l,p*=b,y*=g,l*=c;const t=M*f;f+=d,i[s]+=t*E,i[(s+C)%n]+=t*A,s+=2}h.phases[0]=u/t.Config.chipNoiseLength,h.sample=m;-1e-24<w&&w<1e-24&&(w=0),-1e-24<M&&M<1e-24&&(M=0),h.filterSample0=w,h.filterSample1=M}static spectrumSynth(e,i,s,n,o,h,r){let a=r.getDrumWave(),l=128*h.phaseDeltas[0];const c=+h.phaseDeltaScale;let f=+h.volumeStart;const d=+h.volumeDelta;let u=+h.sample,m=+h.filter,p=r.getFilterIsFirstOrder()?1:m;const b=+h.filterScale,g=r.getFilterIsFirstOrder()?1:b,v=t.Config.filterMaxResonance*Math.pow(Math.max(0,r.getFilterResonance()-1)/(t.Config.filterResonanceRange-2),.5);let w=+h.filterSample0,M=+h.filterSample1,k=h.phases[0]%1*t.Config.chipNoiseLength;0==h.phases[0]&&(k=y.findRandomZeroCrossing(a)+l);const x=Math.min(1,l),E=s+o;s+=h.stereoOffset;const A=h.stereoVolume1,C=h.stereoVolume2,P=h.stereoDelay;for(;s<E;){const t=0|k,e=32767&t;let o=a[e];const h=k-t;M+=p*((w+=m*((u+=((o+=(a[e+1]-o)*h)-u)*x)-w+(v+v/(1-m))*(w-M)))-M),k+=l,m*=b,p*=g,l*=c;const r=M*f;f+=d,i[s]+=r*A,i[(s+P)%n]+=r*C,s+=2}h.phases[0]=k/t.Config.chipNoiseLength,h.sample=u;-1e-24<w&&w<1e-24&&(w=0),-1e-24<M&&M<1e-24&&(M=0),h.filterSample0=w,h.filterSample1=M}static drumsetSynth(e,i,s,n,o,h,r){let a=r.getDrumsetWave(h.drumsetPitch),l=h.phaseDeltas[0]/d.drumsetIndexReferenceDelta(h.drumsetPitch);const c=+h.phaseDeltaScale;let f=+h.volumeStart;const u=+h.volumeDelta;let m=+h.sample,p=+h.filter,b=r.getFilterIsFirstOrder()?1:p;const g=+h.filterScale,v=r.getFilterIsFirstOrder()?1:g,w=t.Config.filterMaxResonance*Math.pow(Math.max(0,r.getFilterResonance()-1)/(t.Config.filterResonanceRange-2),.5);let M=+h.filterSample0,k=+h.filterSample1,x=h.phases[0]%1*t.Config.chipNoiseLength;0==h.phases[0]&&(x=y.findRandomZeroCrossing(a)+l);const E=s+o;s+=h.stereoOffset;const A=h.stereoVolume1,C=h.stereoVolume2,P=h.stereoDelay;for(;s<E;){const t=0|x,e=32767&t;m=a[e];const o=x-t;k+=b*((M+=p*((m+=(a[e+1]-m)*o)-M+(w+w/(1-p))*(M-k)))-k),x+=l,p*=g,b*=v,l*=c;const h=k*f;f+=u,i[s]+=h*A,i[(s+P)%n]+=h*C,s+=2}h.phases[0]=x/t.Config.chipNoiseLength,h.sample=m;-1e-24<M&&M<1e-24&&(M=0),-1e-24<k&&k<1e-24&&(k=0),h.filterSample0=M,h.filterSample1=k}static findRandomZeroCrossing(e){let i=Math.random()*t.Config.chipNoiseLength,s=32767&i,n=e[s];for(let o=128;o>0;o--){const o=s+16&32767,h=e[o];if(n*h<=0){for(let o=0;o<16;o++){const o=s+1&32767,h=e[o];if(n*h<=0){const e=h-n;i=s,Math.abs(e)>1e-8&&(i+=-n/e),i=Math.max(0,i)%t.Config.chipNoiseLength;break}s=o,n=h}break}s=o,n=h}return i}static instrumentVolumeToVolumeMult(e){return e==-t.Config.volumeRange/2?0:Math.pow(2,t.Config.volumeLogScale*e)}static volumeMultToInstrumentVolume(e){return e<=0?-t.Config.volumeRange/2:Math.min(t.Config.volumeRange,Math.log(e)/Math.LN2/t.Config.volumeLogScale)}static expressionToVolumeMult(t){return Math.pow(Math.max(0,t)/6,1.5)}static volumeMultToExpression(t){return 6*Math.pow(Math.max(0,t),1/1.5)}getSamplesPerTick(){if(null==this.song)return 0;const e=this.song.getBeatsPerMinute()/60*t.Config.partsPerBeat*t.Config.ticksPerPart;return Math.floor(this.samplesPerSecond/e)}}y.fmSynthFunctionCache={},y.fmSourceTemplate=("\n\t\t\tconst sineWave = beepbox.Config.sineWave;\n\t\t\t\n\t\t\tlet phaseDeltaScale = +tone.phaseDeltaScale;\n\t\t\t// I'm adding 1000 to the phase to ensure that it's never negative even when modulated by other waves because negative numbers don't work with the modulus operator very well.\n\t\t\tlet operator#Phase       = +((tone.phases[#] % 1) + 1000) * beepbox.Config.sineWaveLength;\n\t\t\tlet operator#PhaseDelta  = +tone.phaseDeltas[#];\n\t\t\tlet operator#OutputMult  = +tone.volumeStarts[#];\n\t\t\tconst operator#OutputDelta = +tone.volumeDeltas[#];\n\t\t\tlet operator#Output      = +tone.feedbackOutputs[#];\n\t\t\tlet feedbackMult         = +tone.feedbackMult;\n\t\t\tconst feedbackDelta        = +tone.feedbackDelta;\n\t\t\tlet volume = +tone.volumeStart;\n\t\t\tconst volumeDelta = +tone.volumeDelta;\n\t\t\t\n\t\t\tlet filter1 = +tone.filter;\n\t\t\tlet filter2 = instrument.getFilterIsFirstOrder() ? 1.0 : filter1;\n\t\t\tconst filterScale1 = +tone.filterScale;\n\t\t\tconst filterScale2 = instrument.getFilterIsFirstOrder() ? 1.0 : filterScale1;\n\t\t\tconst filterResonance = beepbox.Config.filterMaxResonance * Math.pow(Math.max(0, instrument.getFilterResonance() - 1) / (beepbox.Config.filterResonanceRange - 2), 0.5);\n\t\t\tlet filterSample0 = +tone.filterSample0;\n\t\t\tlet filterSample1 = +tone.filterSample1;\n\t\t\t\n\t\t\tconst stopIndex = stereoBufferIndex + runLength;\n\t\t\tstereoBufferIndex += tone.stereoOffset;\n\t\t\tconst stereoVolume1 = tone.stereoVolume1;\n\t\t\tconst stereoVolume2 = tone.stereoVolume2;\n\t\t\tconst stereoDelay = tone.stereoDelay;\n\t\t\twhile (stereoBufferIndex < stopIndex) {\n\t\t\t\t// INSERT OPERATOR COMPUTATION HERE\n\t\t\t\tconst fmOutput = (/*operator#Scaled*/); // CARRIER OUTPUTS\n\t\t\t\t\n\t\t\t\tconst feedback = filterResonance + filterResonance / (1.0 - filter1);\n\t\t\t\tfilterSample0 += filter1 * (fmOutput - filterSample0 + feedback * (filterSample0 - filterSample1));\n\t\t\t\tfilterSample1 += filter2 * (filterSample0 - filterSample1);\n\t\t\t\t\n\t\t\t\tfeedbackMult += feedbackDelta;\n\t\t\t\toperator#OutputMult += operator#OutputDelta;\n\t\t\t\toperator#Phase += operator#PhaseDelta;\n\t\t\t\toperator#PhaseDelta *= phaseDeltaScale;\n\t\t\t\tfilter1 *= filterScale1;\n\t\t\t\tfilter2 *= filterScale2;\n\t\t\t\t\n\t\t\t\tconst output = filterSample1 * volume;\n\t\t\t\tvolume += volumeDelta;\n\t\t\t\t\n\t\t\t\tdata[stereoBufferIndex] += output * stereoVolume1;\n\t\t\t\tdata[(stereoBufferIndex + stereoDelay) % stereoBufferLength] += output * stereoVolume2;\n\t\t\t\tstereoBufferIndex += 2;\n\t\t\t}\n\t\t\t\n\t\t\ttone.phases[#] = operator#Phase / "+t.Config.sineWaveLength+";\n\t\t\ttone.feedbackOutputs[#] = operator#Output;\n\t\t\t\n\t\t\tconst epsilon = (1.0e-24);\n\t\t\tif (-epsilon < filterSample0 && filterSample0 < epsilon) filterSample0 = 0.0;\n\t\t\tif (-epsilon < filterSample1 && filterSample1 < epsilon) filterSample1 = 0.0;\n\t\t\ttone.filterSample0 = filterSample0;\n\t\t\ttone.filterSample1 = filterSample1;\n\t\t").split("\n"),y.operatorSourceTemplate=("\n\t\t\t\tconst operator#PhaseMix = operator#Phase/* + operator@Scaled*/;\n\t\t\t\tconst operator#PhaseInt = operator#PhaseMix|0;\n\t\t\t\tconst operator#Index    = operator#PhaseInt & "+t.Config.sineWaveMask+";\n\t\t\t\tconst operator#Sample   = sineWave[operator#Index];\n\t\t\t\toperator#Output       = operator#Sample + (sineWave[operator#Index + 1] - operator#Sample) * (operator#PhaseMix - operator#PhaseInt);\n\t\t\t\tconst operator#Scaled   = operator#OutputMult * operator#Output;\n\t\t").split("\n"),t.Synth=y}(beepbox||(beepbox={})),function(t){t.ChangeNotifier=class{constructor(){this.L=[],this.I=!1}watch(t){-1==this.L.indexOf(t)&&this.L.push(t)}unwatch(t){const e=this.L.indexOf(t);-1!=e&&this.L.splice(e,1)}changed(){this.I=!0}notifyWatchers(){if(this.I){this.I=!1;for(const t of this.L.concat())t()}}}}(beepbox||(beepbox={})),function(t){t.SongDocument=class{constructor(e){this.notifier=new t.ChangeNotifier,this.channel=0,this.bar=0,this.alwaysFineNoteVol=!1,this.alwaysShowSettings=!0,this.volume=75,this.trackVisibleBars=16,this.barScrollPos=0,this.prompt=null,this.H=null,this.U=0,this.Z="replace",this.j=0,this.V=0,this.O=!1,this.W=(()=>{let e=window.history.state;e&&e.sequenceNumber==this.U||(null==e?(this.U++,e={canUndo:!0,sequenceNumber:this.U,bar:this.bar,channel:this.channel,prompt:this.prompt},new t.ChangeSong(this,location.hash),window.history.replaceState(e,"","#"+this.song.toBase64String())):(e.sequenceNumber==this.U-1?(this.bar=this.j,this.channel=this.V):e.sequenceNumber!=this.U&&(this.bar=e.bar,this.channel=e.channel),this.U=e.sequenceNumber,this.prompt=e.prompt,new t.ChangeSong(this,location.hash)),this.j=e.bar,this.V=e.channel,this.forgetLastChange(),this.notifier.notifyWatchers())}),this.Y=(()=>{this.notifier.notifyWatchers()}),this.J=(()=>{this.O=!1;const t="#"+this.song.toBase64String();"push"==this.Z?this.U++:"jump"==this.Z&&(this.U+=2);let e={canUndo:!0,sequenceNumber:this.U,bar:this.bar,channel:this.channel,prompt:this.prompt};"push"==this.Z||"jump"==this.Z?window.history.pushState(e,"",t):window.history.replaceState(e,"",t),this.j=e.bar,this.V=e.channel,this.Z="replace"}),this.song=new t.Song(e),""!=e&&void 0!=e||t.setDefaultInstruments(this.song),this.synth=new t.Synth(this.song),this.autoPlay="true"==localStorage.getItem("autoPlay"),this.autoFollow="true"==localStorage.getItem("autoFollow"),this.showFifth="true"==localStorage.getItem("showFifth"),this.showLetters="true"==localStorage.getItem("showLetters"),this.showChannels="true"==localStorage.getItem("showChannels"),this.showScrollBar="true"==localStorage.getItem("showScrollBar"),this.alwaysFineNoteVol="true"==localStorage.getItem("alwaysFineNoteVol"),null!=localStorage.getItem("volume")&&(this.volume=Number(localStorage.getItem("volume"))),this.synth.volume=this.X();let i=window.history.state;null==i&&(i={canUndo:!1,sequenceNumber:0,bar:0,channel:0,prompt:null},window.history.replaceState(i,"","#"+this.song.toBase64String())),window.addEventListener("hashchange",this.W),window.addEventListener("popstate",this.W),this.bar=i.bar,this.channel=i.channel,this.j=i.bar,this.V=i.channel,this.barScrollPos=Math.max(0,this.bar-(this.trackVisibleBars-6)),this.prompt=i.prompt;for(const t of["input","change","click","keyup","keydown","mousedown","mousemove","mouseup","touchstart","touchmove","touchend","touchcancel"])window.addEventListener(t,this.Y)}record(t,e="push"){t.isNoop()?(this.H=null,"replace"==e&&window.history.back()):(t.commit(),this.H=t,"push"==e&&"replace"==this.Z?this.Z=e:"jump"==e&&(this.Z=e),this.O||(window.requestAnimationFrame(this.J),this.O=!0))}openPrompt(t){this.prompt=t;const e="#"+this.song.toBase64String();this.U++;const i={canUndo:!0,sequenceNumber:this.U,bar:this.bar,channel:this.channel,prompt:this.prompt};window.history.pushState(i,"",e)}undo(){window.history.state.canUndo&&window.history.back()}redo(){window.history.forward()}setProspectiveChange(t){this.H=t}forgetLastChange(){this.H=null}lastChangeWas(t){return null!=t&&t==this.H}goBackToStart(){this.channel=0,this.bar=0,this.barScrollPos=0,this.notifier.changed(),this.synth.snapToStart(),this.notifier.changed()}savePreferences(){localStorage.setItem("autoPlay",this.autoPlay?"true":"false"),localStorage.setItem("autoFollow",this.autoFollow?"true":"false"),localStorage.setItem("showFifth",this.showFifth?"true":"false"),localStorage.setItem("showLetters",this.showLetters?"true":"false"),localStorage.setItem("showChannels",this.showChannels?"true":"false"),localStorage.setItem("showScrollBar",this.showScrollBar?"true":"false"),localStorage.setItem("alwaysFineNoteVol",this.alwaysFineNoteVol?"true":"false"),localStorage.setItem("volume",String(this.volume))}setVolume(t){this.volume=t,this.savePreferences(),this.synth.volume=this.X()}X(){return Math.min(1,Math.pow(this.volume/50,.5))*Math.pow(2,(this.volume-75)/25)}getCurrentPattern(){return this.song.getPattern(this.channel,this.bar)}getCurrentInstrument(){const t=this.getCurrentPattern();return null==t?0:t.instrument}}}(beepbox||(beepbox={})),function(t){const e={class:!0,classList:!0,className:!0};function i(t,s){for(const n of s)if(Array.isArray(n))i(t,n);else if(n instanceof Node)t.appendChild(n);else if(n&&n.constructor===Object)for(const i of Object.keys(n)){const s=n[i];if(e[i])if("classList"===i){const e=Array.isArray(s)?s:s.split(" ");for(const i of e)t.classList.add(i)}else t.setAttribute("class",Array.isArray(s)?s.join(" "):s);else if("style"===i)if(s&&s.constructor===Object)for(const e of Object.keys(s))e.startsWith("--")?t.style.setProperty(e,s[e]):t.style.hasOwnProperty(e)?t.style[e]=s[e]:console.log("Unrecognized style property name: "+e);else t.setAttribute(i,s);else"function"==typeof s?t[i]=s:"boolean"==typeof s?s?t.setAttribute(i,""):t.removeAttribute(i):t.setAttribute(i,s)}else t.appendChild(document.createTextNode(n));return t}const s="http://www.w3.org/2000/svg";t.HTML=function(){},t.HTML.element=function(t,...e){return i(document.createElement(t),e)},t.SVG=function(){},t.SVG.element=function(t,...e){return i(document.createElementNS(s,t),e)};for(const e of"a abbr address area article aside audio b base bdi bdo blockquote br button canvas caption cite code col colgroup datalist dd del details dfn dialog div dl dt em embed fieldset figcaption figure footer form h1 h2 h3 h4 h5 h6 header hr i iframe img input ins kbd label legend li link main map mark menu menuitem meta meter nav noscript object ol optgroup option output p param picture pre progress q rp rt ruby s samp script section select small source span strong style sub summary sup table tbody td template textarea tfoot th thead time title tr track u ul var video wbr".split(" "))t.HTML[e]=function(...t){return i(document.createElement(e),t)};for(const e of"a altGlyph altGlyphDef altGlyphItem animate animateMotion animateTransform circle clipPath color-profile cursor defs desc discard ellipse feBlend feColorMatrix feComponentTransfer feComposite feConvolveMatrix feDiffuseLighting feDisplacementMap feDistantLight feDropShadow feFlood feFuncA feFuncB feFuncG feFuncR feGaussianBlur feImage feMerge feMergeNode feMorphology feOffset fePointLight feSpecularLighting feSpotLight feTile feTurbulence filter font font-face font-face-format font-face-name font-face-src font-face-uri foreignObject g glyph glyphRef hkern image line linearGradient marker mask metadata missing-glyph mpath path pattern polygon polyline radialGradient rect script set stop style svg switch symbol text textPath title tref tspan use view vkern".split(" "))t.SVG[e]=function(...t){return i(document.createElementNS(s,e),t)};t.prettyNumber=function(t){return t.toFixed(2).replace(/\.?0*$/,"")}}(beepbox||(beepbox={})),function(t){const e=document.createElement("style");e.type="text/css",e.appendChild(document.createTextNode('\n\n/* This is a fix for being unable to click away from select2 nodes. See:\n  https://stackoverflow.com/questions/52297349/select2-does-not-close-the-choices-box-on-clicking-outside-it-with-closeonselec\n*/\nhtml,\nbody {\n  height: 100%;\n}\n\n.beepboxEditor {\n\tdisplay: flex;\n\t-webkit-touch-callout: none;\n\t-webkit-user-select: none;\n\t-khtml-user-select: none;\n\t-moz-user-select: none;\n\t-ms-user-select: none;\n\tuser-select: none;\n\tposition: relative;\n\ttouch-action: manipulation;\n\tcursor: default;\n\tfont-size: small;\n\toverflow: hidden;\n\n    opacity: 0;\n    -webkit-transition: opacity 0.2s ease-in;\n    -moz-transition: opacity 0.2s ease-in;\n    -o-transition: opacity 0.2s ease-in;\n    -ms-transition: opacity 0.2s ease-in;\n    transition: opacity 0.2s ease-in;\n    transition-delay: 0s;\n}\n\n.editorBox {\n     opacity: 0;\n    -webkit-transition: opacity 0.5s ease-in;\n    -moz-transition: opacity 0.5s ease-in;\n    -o-transition: opacity 0.5s ease-in;\n    -ms-transition: opacity 0.5s ease-in;\n    transition: opacity 0.5s ease-in;\n    transition-delay: 0s;\n}\n\n.playback-controls {\n    opacity: 0;\n    -webkit-transition: opacity 0.5s ease-in;\n    -moz-transition: opacity 0.5s ease-in;\n    -o-transition: opacity 0.5s ease-in;\n    -ms-transition: opacity 0.5s ease-in;\n    transition: opacity 0.5s ease-in;\n    transition-delay: 0.15s;\n}\n\n.editor-song-settings {\n    opacity: 0;\n    -webkit-transition: opacity 0.5s ease-in;\n    -moz-transition: opacity 0.5s ease-in;\n    -o-transition: opacity 0.5s ease-in;\n    -ms-transition: opacity 0.5s ease-in;\n    transition: opacity 0.5s ease-in;\n    transition-delay: 0.35s;\n}\n\n.editor-instrument-settings {\n    opacity: 0;\n    -webkit-transition: opacity 0.5s ease-in;\n    -moz-transition: opacity 0.5s ease-in;\n    -o-transition: opacity 0.5s ease-in;\n    -ms-transition: opacity 0.5s ease-in;\n    transition: opacity 0.5s ease-in;\n    transition-delay: 0.45s;\n}\n\n.trackBar {\n    opacity: 0;\n    -webkit-transition: opacity 0.5s ease-in;\n    -moz-transition: opacity 0.5s ease-in;\n    -o-transition: opacity 0.5s ease-in;\n    -ms-transition: opacity 0.5s ease-in;\n    transition: opacity 0.5s ease-in;\n    transition-delay: 0.4s;\n}\n\n.barScrollBar {\n    opacity: 0;\n    -webkit-transition: opacity 0.5s ease-in;\n    -moz-transition: opacity 0.5s ease-in;\n    -o-transition: opacity 0.5s ease-in;\n    -ms-transition: opacity 0.5s ease-in;\n    transition: opacity 0.5s ease-in;\n    transition-delay: 0.5s;\n}\n\n\n\n.load {\n    opacity: 1;\n}\n\n.beepboxEditor .noSelection {\n\t-webkit-touch-callout: none;\n\t-webkit-user-select: none;\n\t-moz-user-select: none;\n\t-ms-user-select: none;\n\tuser-select: none;\n}\n\n.beepboxEditor div {\n\tmargin: 0;\n\tpadding: 0;\n}\n\n.beepboxEditor .tip {\n\tcursor: help;\n}\n\n.beepboxEditor .tip:hover {\n\tcolor: #98f;\n\ttext-decoration: underline;\n}\n.beepboxEditor .tip:active {\n\tcolor: white;\n}\n\n.beepboxEditor .promptContainer {\n\tposition: absolute;\n\ttop: 0;\n\tleft: 0;\n\twidth: 100%;\n\theight: 100%;\n\tbackground: rgba(0,0,0,0.5);\n\tdisplay: flex;\n\tjustify-content: center;\n\talign-items: center;\n}\n\n.beepboxEditor .prompt {\n\tmargin: auto;\n\ttext-align: center;\n\tbackground: #040410;\n\tborder-radius: 15px;\n\tborder: 4px solid #393e4f;\n\tcolor: #fff;\n\tpadding: 20px;\n\tdisplay: flex;\n\tflex-direction: column;\n\tposition: relative;\n}\n\n.beepboxEditor .prompt > *:not(:first-child):not(.cancelButton) {\n\tmargin-top: 1.5em;\n}\n\n.beepboxEditor .prompt h2 {\n\tfont-size: 2em;\n\tmargin: 0 16px;\n\tfont-weight: normal;\n}\n\n.beepboxEditor .prompt p {\n\ttext-align: left;\n\tmargin: 1em 0;\n}\n\n/* Use psuedo-elements to add cross-browser up & down arrows to select elements: */\n.beepboxEditor .selectContainer {\n\tposition: relative;\n}\n.beepboxEditor .selectContainer:not(.menu)::before {\n\tcontent: "";\n\tposition: absolute;\n\tright: 0.3em;\n\ttop: 0.4em;\n\tborder-bottom: 0.4em solid currentColor;\n\tborder-left: 0.3em solid transparent;\n\tborder-right: 0.3em solid transparent;\n\tpointer-events: none;\n}\n.beepboxEditor .selectContainer:not(.menu)::after {\n\tcontent: "";\n\tposition: absolute;\n\tright: 0.3em;\n\tbottom: 0.4em;\n\tborder-top: 0.4em solid currentColor;\n\tborder-left: 0.3em solid transparent;\n\tborder-right: 0.3em solid transparent;\n\tpointer-events: none;\n}\n.beepboxEditor .selectContainer.menu::after {\n\tcontent: "";\n\tposition: absolute;\n\tright: 0.7em;\n\tmargin: auto;\n\ttop: 0;\n\tbottom: 0;\n\theight: 0;\n\tborder-top: 0.4em solid currentColor;\n\tborder-left: 0.3em solid transparent;\n\tborder-right: 0.3em solid transparent;\n\tpointer-events: none;\n}\n.beepboxEditor select {\n\tmargin: 0;\n\tpadding: 0 0.3em;\n\tdisplay: block;\n\theight: 2em;\n\tborder: none;\n\tborder-radius: 0.4em;\n\tbackground: #393e4f;\n\tcolor: inherit;\n\tfont-size: inherit;\n\tcursor: pointer;\n\tfont-family: inherit;\n\n\t-webkit-appearance:none;\n\t-moz-appearance: none;\n\tappearance: none;\n}\n\n.select2-container .select2-selection--single {\n  height: auto;\n}\n\n.select2-container--default .select2-selection--single{\n  border-radius: 0px;\n  border: 0px;\n  background-color: transparent;\n  outline: none;\n}\n\n.select2-selection__rendered:not(.menu)::before {\n\tcontent: "";\n\tposition: absolute;\n\tright: 0.3em;\n\ttop: 0.4em;\n\tborder-bottom: 0.4em solid currentColor;\n\tborder-left: 0.3em solid transparent;\n\tborder-right: 0.3em solid transparent;\n\tpointer-events: none;\n}\n.select2-selection__rendered:not(.menu)::after {\n\tcontent: "";\n\tposition: absolute;\n\tright: 0.3em;\n\tbottom: 0.4em;\n\tborder-top: 0.4em solid currentColor;\n\tborder-left: 0.3em solid transparent;\n\tborder-right: 0.3em solid transparent;\n\tpointer-events: none;\n}\n.select2-selection__rendered {\n\tmargin: 0;\n\tpadding: 0 0.3em;\n\tdisplay: block;\n\theight: 2em;\n\tborder: none;\n\tborder-radius: 0.4em;\n\tbackground: #393e4f;\n\tcolor: inherit !important;\n\tfont-size: inherit;\n\tcursor: pointer;\n\tfont-family: inherit;\n\n\t-webkit-appearance:none;\n\t-moz-appearance: none;\n\tappearance: none;\n}\n.select2-selection__arrow b{\n    display:none !important;\n}\n\n.select2-selection__rendered--focus {\n\tbackground: #6d6886;\n\toutline: none;\n}\n.select2-search__field {\n    background: #393e4f;\n    color: inherit !important;\n    font-size: small;\n    font-family: inherit;\n    border: 0px !important;\n    padding: 1px !important;\n}\n.select2-dropdown {\n    box-sizing: border-box;\n    display: inline-block;\n    margin: 0;\n    font-size: small;\n    position: relative;\n    vertical-align: middle;\n    background-color: #6d6886;\n}\n\n.select2-container--default .select2-results>.select2-results__options {\n    max-height: 430px;\n    overflow-x: hidden;\n}\n.select2-container--default .select2-results__group {\n    cursor: default;\n    display: block;\n    padding: 1px;\n    background: #5d576f;\n}\n.select2-results__option {\n    padding: 2px;\n    user-select: none;\n    -webkit-user-select: none;\n}\n.select2-container--default .select2-results__option .select2-results__option {\n    padding-left: 0.1em;\n}\n.select2-container--default .select2-results__option[aria-selected=true] {\n  background-color: transparent !important;\n}\n\n.beepboxEditor .menu select {\n\tpadding: 0 2em;\n}\n.beepboxEditor select:focus {\n\tbackground: #6d6886;\n\toutline: none;\n}\n.beepboxEditor .menu select {\n\ttext-align: center;\n\ttext-align-last: center;\n}\n.beepboxEditor .editor-settings select {\n\twidth: 100%;\n}\n\n/* This makes it look better in firefox on my computer... What about others?\n@-moz-document url-prefix() {\n\t.beepboxEditor select { padding: 0 2px; }\n}\n*/\n.beepboxEditor button {\n\tmargin: 0;\n\tposition: relative;\n\theight: 2em;\n\tborder: none;\n\tborder-radius: 0.4em;\n\tbackground: #393e4f;\n\tcolor: inherit;\n\tfont-size: inherit;\n\tfont-family: inherit;\n\tcursor: pointer;\n}\n.beepboxEditor button:focus {\n\tbackground: #6d6886;\n\toutline: none;\n}\n\n.beepboxEditor button.cancelButton {\n\tfloat: right;\n\twidth: 2em;\n\tposition: absolute;\n\ttop: 8px;\n\tright: 8px;\n}\n\n.beepboxEditor button.playButton, .beepboxEditor button.pauseButton, .beepboxEditor button.okayButton, .beepboxEditor button.exportButton {\n\tpadding-left: 2em;\n}\n.beepboxEditor button.playButton::before {\n\tcontent: "";\n\tposition: absolute;\n\tleft: 0.7em;\n\ttop: 50%;\n\tmargin-top: -0.65em;\n\tborder-left: 1em solid currentColor;\n\tborder-top: 0.65em solid transparent;\n\tborder-bottom: 0.65em solid transparent;\n\tpointer-events: none;\n}\n.beepboxEditor button.pauseButton::before {\n\tcontent: "";\n\tposition: absolute;\n\tleft: 0.7em;\n\ttop: 50%;\n\tmargin-top: -0.65em;\n\twidth: 0.3em;\n\theight: 1.3em;\n\tbackground: currentColor;\n\tpointer-events: none;\n}\n.beepboxEditor button.pauseButton::after {\n\tcontent: "";\n\tposition: absolute;\n\tleft: 1.4em;\n\ttop: 50%;\n\tmargin-top: -0.65em;\n\twidth: 0.3em;\n\theight: 1.3em;\n\tbackground: currentColor;\n\tpointer-events: none;\n}\n\n.beepboxEditor button.prevBarButton::before {\n\tcontent: "";\n\tposition: absolute;\n\tleft: 50%;\n\ttop: 50%;\n\tmargin-left: -0.5em;\n\tmargin-top: -0.5em;\n\twidth: 0.2em;\n\theight: 1em;\n\tbackground: currentColor;\n\tpointer-events: none;\n}\n.beepboxEditor button.prevBarButton::after {\n\tcontent: "";\n\tposition: absolute;\n\tleft: 50%;\n\ttop: 50%;\n\tmargin-left: -0.3em;\n\tmargin-top: -0.5em;\n\tborder-right: 0.8em solid currentColor;\n\tborder-top: 0.5em solid transparent;\n\tborder-bottom: 0.5em solid transparent;\n\tpointer-events: none;\n}\n\n.beepboxEditor button.nextBarButton::before {\n\tcontent: "";\n\tposition: absolute;\n\tleft: 50%;\n\ttop: 50%;\n\tmargin-left: -0.5em;\n\tmargin-top: -0.5em;\n\tborder-left: 0.8em solid currentColor;\n\tborder-top: 0.5em solid transparent;\n\tborder-bottom: 0.5em solid transparent;\n\tpointer-events: none;\n}\n.beepboxEditor button.nextBarButton::after {\n\tcontent: "";\n\tposition: absolute;\n\tleft: 50%;\n\ttop: 50%;\n\tmargin-left: 0.3em;\n\tmargin-top: -0.5em;\n\twidth: 0.2em;\n\theight: 1em;\n\tbackground: currentColor;\n\tpointer-events: none;\n}\n\n.beepboxEditor button.cancelButton::before {\n\tcontent: "";\n\tposition: absolute;\n\twidth: 2em;\n\theight: 2em;\n\tleft: 0;\n\ttop: 0;\n\tpointer-events: none;\n\tbackground-image: url(\'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="-13 -13 26 26"><path fill="white" d="M -8 -6 L -6 -8 L 0 -2  L 6 -8 L 8 -6 L 2 0 L 8 6 L 6 8 L 0 2 L -6 8 L -8 6 L -2 0 z"></path></svg>\');\n\tbackground-repeat: no-repeat;\n}\n\n.beepboxEditor button.okayButton::before {\n\tcontent: "";\n\tposition: absolute;\n\twidth: 2em;\n\theight: 2em;\n\tleft: 0;\n\ttop: 0;\n\tpointer-events: none;\n\tbackground-image: url(\'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="-13 -13 26 26"><path fill="white" d="M -9 -2 L -8 -3 L -3 2 L 9 -8 L 10 -7 L -3 8 z"></path></svg>\');\n\tbackground-repeat: no-repeat;\n}\n\n.beepboxEditor button.exportButton::before {\n\tcontent: "";\n\tposition: absolute;\n\twidth: 2em;\n\theight: 2em;\n\tleft: 0;\n\ttop: 0;\n\tpointer-events: none;\n\tbackground-image: url(\'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="-13 -13 26 26"><path fill="white" d="M -8 3 L -8 8 L 8 8 L 8 3 L 6 3 L 6 6 L -6 6 L -6 3 z M 0 2 L -4 -2 L -1 -2 L -1 -8 L 1 -8 L 1 -2 L 4 -2 z"></path></svg>\');\n\tbackground-repeat: no-repeat;\n}\n\n.beepboxEditor canvas {\n\toverflow: hidden;\n\tposition: absolute;\n\tdisplay: block;\n  cursor: crosshair;\n}\n\n@keyframes dash-animation {\n  to {\n    stroke-dashoffset: -100;\n  }\n}\n\n.beepboxEditor .dash-move {\n  animation: dash-animation 20s infinite linear;\n}\n\n.beepboxEditor .trackContainer {\n\toverflow-x: hidden;\n}\n\n.beepboxEditor .selectRow {\n\tmargin: 2px 0;\n\theight: 2.2em;\n\tdisplay: flex;\n\tflex-direction: row;\n\talign-items: center;\n\tjustify-content: space-between;\n}\n\n.beepboxEditor .selectRow > span:first-child {\n\tcolor: #999;\n}\n\n.beepboxEditor .operatorRow {\n\tmargin: 2px 0;\n\theight: 2.2em;\n\tdisplay: flex;\n\tflex-direction: row;\n\talign-items: center;\n}\n\n.beepboxEditor .operatorRow > * {\n\tflex-grow: 1;\n\tflex-shrink: 1;\n}\n\n.beepboxEditor .editor-widget-column {\n\tdisplay: flex;\n\tflex-direction: column;\n}\n\n.beepboxEditor .editor-widgets {\n\tdisplay: flex;\n\tflex-direction: column;\n}\n\n.beepboxEditor .editor-controls {\n\tdisplay: flex;\n\tflex-direction: column;\n}\n\n.beepboxEditor .editor-menus {\n\tdisplay: flex;\n\tflex-direction: column;\n}\n.beepboxEditor .editor-menus > * {\n\tflex-grow: 1;\n\tmargin: 2px 0;\n}\n.beepboxEditor .editor-menus > button {\n\tpadding: 0 2em;\n\twhite-space: nowrap;\n}\n\n.beepboxEditor .editor-settings {\n\tdisplay: flex;\n\tflex-direction: column;\n}\n\n.beepboxEditor .editor-song-settings {\n\tdisplay: flex;\n\tflex-direction: column;\n}\n\n.beepboxEditor .editor-instrument-settings {\n\tdisplay: flex;\n\tflex-direction: column;\n}\n\n.beepboxEditor .editor-right-side-top > *, .beepboxEditor .editor-right-side-bottom > * {\n\tflex-shrink: 0;\n}\n\n.beepboxEditor input[type=text], .beepboxEditor input[type=number] {\n\tfont-size: inherit;\n\tbackground: transparent;\n    text-align: center;\n\tborder: 1px solid #222222;\n\tcolor: white;\n}\n\n.beepboxEditor input[type=checkbox] {\n  transform: scale(1.5);\n}\n\n.beepboxEditor input[type=range] {\n\t-webkit-appearance: none;\n\tcolor: inherit;\n\twidth: 100%;\n\theight: 2em;\n\tfont-size: inherit;\n\tmargin: 0;\n\tcursor: pointer;\n\tbackground-color: #040410;\n\ttouch-action: pan-y;\n  position: relative;\n}\n.beepboxEditor input[type=range]:focus {\n\toutline: none;\n}\n.beepboxEditor input[type=range]::-webkit-slider-runnable-track {\n\twidth: 100%;\n\theight: 0.5em;\n\tcursor: pointer;\n\tbackground: #393e4f;\n\n}\n\n.beepboxEditor input[type=range].midTick:after {\n    content: "";\n    display:inline-block;\n    position: absolute;\n    background: currentColor;\n    width: 2%;\n    left: 49%;\n    height: 0.5em;\n    top: 37%;\n    z-index: 1;\n}\n.beepboxEditor input[type=range]::-webkit-slider-thumb {\n\theight: 2em;\n\twidth: 0.5em;\n\tborder-radius: 0.25em;\n\tbackground: currentColor;\n\tcursor: pointer;\n\t-webkit-appearance: none;\n\tmargin-top: -0.75em;\n}\n.beepboxEditor input[type=range]:focus::-webkit-slider-runnable-track {\n\tbackground: #7a7596;\n}\n.beepboxEditor input[type=range]::-moz-range-track {\n\twidth: 100%;\n\theight: 0.5em;\n\tcursor: pointer;\n\tbackground: #393e4f;\n}\n.beepboxEditor input[type=range]:focus::-moz-range-track {\n\tbackground: #6d6886;\n}\n.beepboxEditor input[type=range]::-moz-range-thumb {\n\theight: 2em;\n\twidth: 0.5em;\n\tborder-radius: 0.25em;\n\tborder: none;\n\tbackground: currentColor;\n\tcursor: pointer;\n}\n.beepboxEditor input[type=range]::-ms-track {\n\twidth: 100%;\n\theight: 0.5em;\n\tcursor: pointer;\n\tbackground: #393e4f;\n\tborder-color: transparent;\n}\n.beepboxEditor input[type=range]:focus::-ms-track {\n\tbackground: #6d6886;\n}\n.beepboxEditor input[type=range]::-ms-thumb {\n\theight: 2em;\n\twidth: 0.5em;\n\tborder-radius: 0.25em;\n\tbackground: currentColor;\n\tcursor: pointer;\n}\n.beepboxEditor .hintButton {\n\tborder: 1px solid currentColor;\n\tborder-radius: 50%;\n\ttext-decoration: none;\n\twidth: 1em;\n\theight: 1em;\n\ttext-align: center;\n\tmargin-left: auto;\n\tmargin-right: .4em;\n\tcursor: pointer;\n}\n\nli.select2-results__option[role=group] > strong:hover {\n  background-color: #516fbb;\n}\n\n/* wide screen */\n@media (min-width: 701px) {\n\t#beepboxEditorContainer {\n\t\tdisplay: table;\n\t}\n\t.beepboxEditor {\n\t\tflex-direction: row;\n\t}\n\t.beepboxEditor:focus-within {\n\t\toutline: 3px solid #555;\n\t}\n\t.beepboxEditor .trackContainer {\n\t\twidth: 512px;\n\t}\n\t.beepboxEditor .trackSelectBox {\n\t\tdisplay: none;\n\t}\n    .beepboxEditor .muteButtonSelectBox {\n\t\tdisplay: none;\n\t}\n\t.beepboxEditor .playback-controls {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t}\n\t.beepboxEditor .playback-bar-controls {\n\t\tdisplay: flex;\n\t\tflex-direction: row;\n\t\tmargin: 2px 0;\n\t}\n\t.beepboxEditor .playback-volume-controls {\n\t\tdisplay: flex;\n\t\tflex-direction: row;\n\t\tmargin: 2px 0;\n\t\talign-items: center;\n\t}\n\t.beepboxEditor .pauseButton, .beepboxEditor .playButton,\n    .beepboxEditor .copyButton, .beepboxEditor .pasteButton\n    {\n\t\tflex-grow: 1;\n\t}\n\t.beepboxEditor .nextBarButton, .beepboxEditor .prevBarButton {\n\t\tflex-grow: 1;\n\t\tmargin-left: 10px;\n\t}\n\t.beepboxEditor .editor-widget-column {\n\t\tmargin-left: 6px;\n\t\twidth: 14em;\n\t\tflex-direction: column;\n\t}\n\t.beepboxEditor .editor-widgets {\n\t\tflex-grow: 1;\n\t}\n\t.beepboxEditor .editor-settings input, .beepboxEditor .editor-settings select {\n\t\twidth: 8.6em;\n\t}\n\t.beepboxEditor .selectRow > :nth-child(2) {\n\t\twidth: 8.6em;\n\t}\n}\n\n/* narrow screen */\n@media (max-width: 700px) {\n\t.beepboxEditor {\n\t\tflex-direction: column;\n\t}\n\t.beepboxEditor:focus-within {\n\t\toutline: none;\n\t}\n\t.beepboxEditor .editorBox {\n\t\tmax-height: 75vh;\n\t}\n\t.beepboxEditor .trackContainer {\n\t\toverflow-x: auto;\n\t}\n\t.beepboxEditor .barScrollBar {\n\t\tdisplay: none;\n\t}\n\t.beepboxEditor .playback-controls {\n\t\tdisplay: flex;\n\t\tflex-direction: row;\n\t\tmargin: 2px 0;\n\t}\n\t.beepboxEditor .playback-bar-controls {\n\t\tdisplay: flex;\n\t\tflex-direction: row;\n\t\tflex-grow: 1;\n\t}\n\t.beepboxEditor .playback-volume-controls {\n\t\tdisplay: flex;\n\t\tflex-direction: row;\n\t\talign-items: center;\n\t\tflex-grow: 1;\n\t\tmargin: 0 2px;\n\t}\n\t.beepboxEditor .editor-widget-column {\n\t\tflex-direction: column-reverse;\n\t}\n\t.beepboxEditor .editor-settings {\n\t\tflex-direction: row;\n\t}\n\t.beepboxEditor .pauseButton, .beepboxEditor .playButton,\n\t.beepboxEditor .nextBarButton, .beepboxEditor .prevBarButton,\n    .beepboxEditor .copyButton, .beepboxEditor .pasteButton\n    {\n\t\tflex-grow: 1;\n\t\tmargin: 0 2px;\n\t}\n\t.beepboxEditor .editor-song-settings, .beepboxEditor .editor-instrument-settings {\n\t\tflex-grow: 1;\n\t\tflex-basis: 0;\n\t\tmargin: 0 4px;\n\t}\n\t.beepboxEditor .selectRow > :nth-child(2) {\n\t\twidth: 60%;\n\t}\n\t.fullWidthOnly {\n\t\tdisplay: none;\n\t}\n\tp {\n\t\tmargin: 1em 0.5em;\n\t}\n\t\n\t.beepboxEditor .soundIcon {\n\t  background: #393e4f;\n\t  display: inline-block;\n\t  height: 10px;\n\t  margin-left: 0px;\n\t  margin-top: 8px;\n\t\tposition: relative;\n\t\twidth: 10px;\n\t}\n\t.beepboxEditor .soundIcon:before {\n\t  border-bottom: 6px solid transparent;\n\t  border-top: 6px solid transparent;\n\t  border-right: 10px solid #393e4f;\n\t  content: "";\n\t  height: 10px;\n\t  left: 6px;\n\t  position: absolute;\n\t  top: -6px;\n\t  width: 0;\n\t}\n}\n\n')),document.head.appendChild(e)}(beepbox||(beepbox={})),function(t){const{button:e,div:i,p:s,h2:n,h3:o}=t.HTML;t.TipPrompt=class{constructor(t,h){let r;switch(this._=t,this.K=e({className:"cancelButton"}),this.$=(()=>{this._.undo()}),this.cleanUp=(()=>{this.K.removeEventListener("click",this.$)}),h){case"scale":r=i(n("Scale"),s("This setting limits the available pitches for adding notes. You may think that there's no point in limiting your choices, but the set of pitches you use has a strong influence on the mood and feel of your song, and these scales serve as guides to help you choose appropriate pitches. Don't worry, you can change the scale at any time, so you're not locked into it. Try making little melodies using all the available notes of a scale to get a sense for how it sounds."),s('The most common scales are major and minor. Major scales tend to sound more playful or optimistic if you emphasize "tonic" notes (the brown rows in the pattern editor) at various points in your melody, whereas minor scales sound more serious or sad if you emphasize "tonic" notes.'));break;case"key":r=i(n("Song Key"),s('This setting can shift the frequency of every note in your entire song up or down to align the tonic notes (the brown rows) with the selected "key" pitch.'));break;case"tempo":r=i(n("Song Tempo"),s("This setting controls the speed of your song, measured in beats-per-minute."));break;case"reverb":r=i(n("Reverb"),s("Reverb is a kind of echo effect. You can use this slider to control the amount of reverb for instruments that enable it. A little bit helps instruments sound more natural. Adding a lot of reverb can add sense of depth or mystery."));break;case"rhythm":r=i(n("Rhythm"),s("This setting determines how beats are divided. The pattern editor helps you align notes to fractions of a beat based on this setting."));break;case"instrumentIndex":r=i(n("Instrument Number"),s("BeepBox can have multiple instruments per channel, but it can only play one instrument at a time in each channel. This setting determines which of the instruments should be used to play the currently selected pattern. Different patterns in the channel can use different instruments."));break;case"instrumentVolume":r=i(n("Instrument Volume"),s("This setting controls the volume of the selected instrument without affecting the volume of the other instruments. This allows you to balance the loudness of each instrument relative to each other."),s("Please be careful when using volume settings above 0. This indicates amplification and too much of that can trip the audio limiter built into this tool. This can lead to your song sounding muffled if overused. But when used carefully, amplification can be a powerful tool!"));break;case"pan":r=i(n("Instrument Panning"),s("If you're listening through headphones or some other stereo sound system, this controls the position of the instrument and where the sound is coming from, ranging from left to right."),s("As a rule of thumb, composers typically put lead melodies, drums, and basses in the center, and spread any other instruments to either side. If too many instruments seem like they're coming from the same place, it can feel crowded and harder to distinguish individual sounds, especially if they cover a similar pitch range."));break;case"instrumentType":r=i(n("Instrument Type"),s("BeepBox comes with many instrument presets. You can also create your own custom instruments, or even generate random ones!"));break;case"filterCutoff":r=i(n("Low-Pass Filter Cutoff Frequency"),s('The lowest setting feels "muffled" or "dark", and the highest setting feels "harsh" or "bright".'),s("Most sounds include a range of frequencies from low to high. BeepBox instruments have a filter that allows the lowest frequencies to pass through at full volume, but can reduce the volume of the higher frequencies that are above a cutoff frequency. This setting controls the cutoff frequency and thus the range of higher frequencies that are reduced."),s("This cutoff setting also determines which frequency resonates when the resonance peak setting is used."));break;case"filterResonance":r=i(n("Low-Pass Filter Resonance Peak"),s("Increasing this setting emphasizes a narrow range of frequencies, based on the position of the filter cutoff setting. This can be used to imitate the resonant bodies of acoustic instruments and other interesting effects."),s("The filter preserves the volume of frequencies that are below the cutoff frequency, and reduces the volume of frequencies that are above the cutoff. If this setting is used, the filter also increases the volume of frequencies that are near the cutoff."));break;case"filterEnvelope":r=i(n("Low-Pass Filter Envelope"),s("This setting can dynamically change the filter cutoff frequency over time. Try the different options to see how they sound!"),s('The "custom" option uses the note volume as drawn in the pattern editor as the cutoff envelope.'));break;case"transition":r=i(n("Transition"),s("This setting controls how quickly notes begin and end."),s("Hard transitions start suddenly and sound like instruments that are played by hitting or plucking, whereas soft transitions start gradually and sound like instruments that are played by blowing air. Some transitions stop suddenly, but some fade out slowly after the end of the note."),s('The "seamless" and "slide" transitions connect the end of a note with the start of the next note.'));break;case"chipWave":r=i(n("Chip Wave"),s("BeepBox comes with some sound waves based on classic electronic sound chips, as well as several unique waves."));break;case"chipNoise":r=i(n("Noise"),s("BeepBox comes with several basic noise sounds. These do not have any distinct musical pitch, and can be used like drums to create beats and emphasize your song's rhythm."));break;case"pulseEnvelope":r=i(n("Pulse Wave Envelope"),s("This setting can dynamically change the pulse width over time. Try the different options to see how they sound!"),s('The "custom" option uses the note volume as drawn in the pattern editor as the pulse width envelope.'));break;case"pulseWidth":r=i(n("Pulse Wave Width"),s("This setting controls the shape and sound of a pulse wave. At the minimum width, it sounds light and buzzy. At the maximum width, it is shaped like a classic square wave."));break;case"interval":r=i(n("Instrument Interval"),s('Some BeepBox instrument types can play two waves at slightly different frequencies. The difference between the frequencies is called an "interval", and this setting controls how large it is.'),s("When two similar waves play at slightly different frequencies, they move in and out of phase with each other over time as different parts of the waves line up. This creates a dynamic, shifting sound. Pianos are a common example of this kind of sound, because each piano key strikes multiple strings that are tuned to slightly different frequencies."),s('If the interval is large, then the waves can sound out-of-tune and "dissonant". If the interval is even larger, then the two frequencies can even be distinct pitches.'));break;case"chords":r=i(n("Chords"),s("When multiple notes occur at the same time, this is called a chord. Chords can be created in BeepBox's pattern editor by adding notes above or below another note."),s('This setting determines how chords are played. The standard option is "harmony" which plays all of the notes out loud simultaneously. The "strum" option is similar, but plays the notes starting at slightly different times. The "arpeggio" option is used in "chiptune" style music and plays a single tone that rapidly alternates between all of the pitches in the chord.'),s('Some BeepBox instruments have an option called "custom interval" which uses the chord notes to control the interval between the waves of a single tone. This can create strange sound effects when combined with FM modulators.'));break;case"vibrato":r=i(n("Vibrato"),s("This setting causes the frequency of a note to wobble slightly. Singers and violinists often use vibrato."));break;case"algorithm":r=i(n("FM Algorithm"),s("FM Synthesis is a mysterious but powerful technique for crafting sounds, popularized by Yamaha keyboards and the Sega Genesis/Mega Drive. It may seem confusing, but try playing around with the options until you get a feel for it, or check out some of the preset examples!"),s("This FM synthesizer uses up to four waves, numbered 1, 2, 3, and 4. Each wave may have its own frequency, volume, and volume envelope to control its effect over time."),s('There are two kinds of waves: "carrier" waves play a tone out loud, but "modulator" waves distort other waves instead. Wave 1 is always a carrier and plays a tone, but other waves may distort it. The "Algorithm" setting determines which waves are modulators, and which other waves those modulators distort. For example, "1‚Üê2" means that wave 2 modulates wave 1, and wave 1 plays out loud.'));break;case"feedbackType":r=i(n("Feedback"),s("Modulators distort in one direction (like 1‚Üê2), but you can also use the feedback setting to make any wave distort in the opposite direction (1‚Üí2), or even itself (1‚ü≤)."));break;case"operatorFrequency":r=i(n("Operator Frequency"),s('This setting controls the frequency of an individual FM wave. The fundamental frequency (1√ó) is determined by the pitch of the note, and the frequency (2√ó) is an octave (12 semitones) above it. The frequencies with a "~" are slightly detuned and shift in and out of phase over time compared to the other frequencies.'),s('Try different combinations of a "carrier" wave and a "modulator" wave with different frequencies to get a feel for how they sound together.'));break;case"operatorVolume":r=i(n("Operator Volume"),s('This setting controls the volume of "carrier" waves, or the amount of distortion that "modulator" waves apply to other waves.'));break;case"operatorEnvelope":r=i(n("Operator Envelope"),s("This setting can dynamically change the FM wave volume over time. Try the different options to see how they sound!"),s('The "custom" option uses the note volume as drawn in the pattern editor as the FM wave envelope.'));break;case"spectrum":r=i(n("Spectrum"),s("This setting allows you to draw your own noise spectrum! This is good for making drum sounds when combined with a hard transition and a falling filter cutoff envelope."),s("If you only use certain frequencies and a soft transition, it's also possible to make howling wind sounds or even musical blown bottle sounds."),s("The left side of the spectrum editor controls the noise energy at lower frequencies, and the right side controls higher frequencies."));break;case"harmonics":r=i(n("Harmonics"),s("This setting allows you to design your own sound wave! Most musical waves are actually a combination of sine waves at certain frequencies, and this lets you control the volume of each sine wave individually."),s("The left side of the harmonics editor controls the sine wave volumes at lower frequencies, and the right side controls higher frequencies."));break;case"effects":r=i(n("Effects"),s("BeepBox has two special effects you can add to instruments. You can turn on either effect, or both at once."),s('Reverb is a kind of echo effect. You can use the "reverb" slider in the "Song Settings" section above to control the amount of reverb for instruments that enable it. A little bit helps instruments sound more natural. Adding a lot of reverb can add sense of depth or mystery.'),s("The chorus effect combines multiple copies of the instrument's sound and adds a bit of vibrato to simulate an ensemble of instruments or voices."));break;case"drumsetEnvelope":r=i(n("Drumset Envelope"),s("This setting can dynamically change the filter cutoff frequency over time. Each row in the pattern editor gets its own envelope."),s('The "custom" option uses the note volume as drawn in the pattern editor as the drumset cutoff envelope.'));break;case"drumsetSpectrum":r=i(n("Drumset Spectrum"),s("This setting allows you to draw your own noise spectrum! This is good for making drumsets. Each row in the pattern editor gets its own spectrum."),s("The left side of the spectrum editor controls the noise energy at lower frequencies, and the right side controls higher frequencies."));break;case"usedInstrument":r=i(o("'Is this instrument used somehwere else?'"),s("This indicator will light up when the instrument you're currently looking at is used in another place in your song (outside the selection)."),s("This can be useful when you're not sure if you've used the instrument before and making edits carelessly could change other parts of the song."));break;case"usedPattern":r=i(o("'Is this pattern used somewhere else?'"),s("This indicator will light up when the pattern you're currently looking at is used in another place in your song (outside the selection)."),s("This can be useful when you're not sure if you've used the pattern before and making edits carelessly could change other parts of the song."));break;default:throw new Error("Unhandled TipPrompt type: "+h)}this.container=i({className:"prompt",style:"width: 250px;"},r,this.K),setTimeout(()=>this.K.focus()),this.K.addEventListener("click",this.$)}}}(beepbox||(beepbox={})),function(t){class e{constructor(){this.tt=!0}et(){this.tt=!1}isNoop(){return this.tt}commit(){}}t.Change=e;class i extends e{constructor(t){super(),this.it=t,this.st=!t}undo(){this.it?(this.nt(),this.st=!0):(this.ot(),this.st=!1)}redo(){this.it?(this.ot(),this.st=!1):(this.nt(),this.st=!0)}ht(){return this.st}nt(){throw new Error("Change.doForwards(): Override me.")}ot(){throw new Error("Change.doBackwards(): Override me.")}}t.UndoableChange=i;t.ChangeGroup=class extends e{constructor(){super()}append(t){t.isNoop()||this.et()}};t.ChangeSequence=class extends i{constructor(t){super(!1),this.rt=void 0==t?[]:t.concat()}append(t){t.isNoop()||(this.rt[this.rt.length]=t,this.et())}nt(){for(let t=0;t<this.rt.length;t++)this.rt[t].redo()}ot(){for(let t=this.rt.length-1;t>=0;t--)this.rt[t].undo()}}}(beepbox||(beepbox={})),function(t){const{div:e,select:i,option:s}=t.HTML;class n{constructor(e,i,s){this.at=32,this.lt=t.SVG.rect({width:30,height:30,x:1,y:1}),this.ct=t.SVG.polygon({points:"7,10 14,10 24,4 24,28 14,22 7,22",fill:"#dda85d"}),this.ft=t.SVG.circle({cx:"21",cy:"20",r:"6",stroke:"red",fill:"none",visibility:"hidden"}),this.dt=t.SVG.line({x1:"17",y1:"16",x2:"25",y2:"24",stroke:"red",visibility:"hidden"}),this.container=t.SVG.svg(void 0,[this.lt,this.ct,this.ft,this.dt]),this.ut=!1,this.ft.setAttribute("stroke-width","2"),this.dt.setAttribute("stroke-width","3"),this.container.setAttribute("x",""+i*this.at),this.container.setAttribute("y",""+(t.Config.barEditorHeight+32*s)),this.lt.setAttribute("fill","#040410")}setSquashed(e,i){e?(this.container.setAttribute("y",""+(t.Config.barEditorHeight+27*i)),this.lt.setAttribute("height","25"),this.ct.setAttribute("y","21")):(this.container.setAttribute("y",""+(t.Config.barEditorHeight+32*i)),this.lt.setAttribute("height","30"),this.ct.setAttribute("y","23"))}getMuteState(){return this.ut}toggleMute(){this.ut?(this.ut=!1,this.ct.setAttribute("fill","#dda85d"),this.ft.setAttribute("visibility","hidden"),this.dt.setAttribute("visibility","hidden")):(this.ut=!0,this.ct.setAttribute("fill","#1c1d28"),this.ft.setAttribute("visibility","visibile"),this.dt.setAttribute("visibility","visible"))}}t.MuteButton=n;t.MuteButtonEditor=class{constructor(n){this._=n,this.at=32,this.pt=t.SVG.svg({style:"background-color: #040410; position: absolute;",height:128,width:this.at}),this.yt=t.SVG.path({d:"M 2 1 H 30 V "+(t.Config.barEditorHeight-3)+" H 2 V 1 Z",fill:"#5a3e4f",stroke:"#5a3e4f","stroke-width":1,"pointer-events":"none"}),this.bt=i({style:"width: 32px; height: "+t.Config.barEditorHeight+"px; position:absolute; opacity:0"},[s({value:"solo"},"Solo Current Channel"),s({value:"unmuteAll"},"Unmute All Channels")]),this.container=e({style:"height: 128px; width: 32px; position: relative; overflow:hidden;"},[this.pt,this.bt]),this.gt=t.SVG.g(),this.vt=[],this.wt=0,this.Mt=!1,this.kt=128,this.xt=32,this.Et=0,this.At=!1,this.Ct=(t=>{if("solo"==this.bt.value)for(let t=0;t<this.vt.length;t++)t==this._.channel&&1==this.vt[t].getMuteState()?this.vt[t].toggleMute():t!=this._.channel&&0==this.vt[t].getMuteState()&&this.vt[t].toggleMute(),this._.song.channels[t].muted=this.vt[t].getMuteState();if("unmuteAll"==this.bt.value)for(let t=0;t<this.vt.length;t++)1==this.vt[t].getMuteState()&&this.vt[t].toggleMute(),this._.song.channels[t].muted=this.vt[t].getMuteState();this.bt.selectedIndex=-1}),this.Pt=(t=>{this.Mt||(this.Mt=!0)}),this.Nt=(t=>{this.Mt&&(this.Mt=!1)}),this.qt=(e=>{e.preventDefault();const i=this.pt.getBoundingClientRect();if(this.wt=(e.clientY||e.pageY)-i.top,this.wt>=t.Config.barEditorHeight){const e=Math.floor(Math.min(this._.song.getChannelCount()-1,Math.max(0,(this.wt-t.Config.barEditorHeight)/this.xt)));this.vt[e].toggleMute(),this._.song.channels[e].muted=this.vt[e].getMuteState()}}),this.pt.appendChild(this.gt),this.pt.appendChild(this.yt),this.pt.addEventListener("mousedown",this.qt),this.pt.addEventListener("mouseover",this.Pt),this.pt.addEventListener("mouseout",this.Nt),this.bt.selectedIndex=-1,this.bt.addEventListener("change",this.Ct)}render(){const e=!(window.innerWidth>700)||this._.song.getChannelCount()>4||this._.song.barCount>this._.trackVisibleBars&&this._.song.getChannelCount()>3;if(this.xt=e?27:32,this.Et!=this._.song.getChannelCount()){for(let t=this.Et;t<this._.song.getChannelCount();t++){const i=new n(t,0,t);this.vt[t]=i,i.setSquashed(e,t),this.gt.appendChild(i.container)}for(let t=this._.song.getChannelCount();t<this.Et;t++)this.gt.removeChild(this.vt[t].container);this.vt.length=this._.song.getChannelCount()}if(this.At!=e)for(let t=0;t<this._.song.getChannelCount();t++)this.vt[t].setSquashed(e,t);this.At==e&&this.Et==this._.song.getChannelCount()||(this.At=e,this.Et=this._.song.getChannelCount(),this.kt=t.Config.barEditorHeight+this._.song.getChannelCount()*this.xt,this.pt.setAttribute("height",""+this.kt),this.container.style.height=this.kt+"px")}}}(beepbox||(beepbox={})),function(t){function e(e,i,s,n,o){const h=new t.Note(-1,s,n,3,!1);o.push(h),h.pins.length=0,h.pitches.length=0;const r=n-s;for(const t of e.pitches)h.pitches.push(t);for(let s=0;s<e.pins.length;s++){const n=e.pins[s],o=n.time+i;if(o<0){if(s+1>=e.pins.length)throw new Error("Error converting pins in note overflow.");const r=e.pins[s+1],a=r.time+i;if(a>0){const e=-o/(a-o);h.pins.push(t.makeNotePin(Math.round(n.interval+e*(r.interval-n.interval)),0,Math.round(n.volume+e*(r.volume-n.volume))))}}else if(o<=r)h.pins.push(t.makeNotePin(n.interval,o,n.volume));else{if(s<1)throw new Error("Error converting pins in note overflow.");const a=e.pins[s-1],l=a.time+i;if(l<r){const e=(r-l)/(o-l);h.pins.push(t.makeNotePin(Math.round(a.interval+e*(n.interval-a.interval)),r,Math.round(a.volume+e*(n.volume-a.volume))))}}}}t.unionOfUsedNotes=function(t,e){for(const i of t.notes)for(const t of i.pitches)for(const s of i.pins){const i=(t+s.interval)%12;e[i]||(e[i]=!0)}},t.generateScaleMap=function(e,i){const s=t.Config.scales[i].flags,n=[],o=[];for(let t=0;t<12;t++)e[t]&&n.push(t),s[t]&&o.push(t);const h=n.length>o.length,r=h?o:n,a=h?n:o,l=["root","second","second","third","third","fourth","tritone","fifth","sixth","sixth","seventh","seventh","root"];let c=Number.MAX_SAFE_INTEGER,f=[];const d=[[0]];for(;d.length>0;){const t=d.pop();if(t.length==r.length){let e=0;for(let i=0;i<t.length;i++)e+=Math.abs(r[i]-a[t[i]]),l[r[i]]!=l[a[t[i]]]&&(e+=.75);c>e&&(c=e,f=t)}else{const e=t[t.length-1]+1,i=a.length-r.length+t.length;for(let s=e;s<=i;s++)d.push(t.concat(s))}}const u=[];for(let t=0;t<f.length;t++){const e=r[t],i=a[f[t]];u[t]=h?[i,e]:[e,i]}u.push([12,12]),o.push(12);let m=0;const p=[];for(let t=0;t<12;t++){const e=u[m][0],i=u[m][1],s=u[m+1][0],n=u[m+1][1];t==s-1&&m++;const h=(t-e)*(n-i)/(s-e)+i;let r=0,a=Number.MAX_SAFE_INTEGER;for(const e of o){let i=Math.abs(e-h);l[e]!=l[t]&&(i+=.1),a>i&&(a=i,r=e)}p[t]=r}return p};class i extends t.ChangeGroup{constructor(i,s,n){super();const o=[],h=[];for(let r=0;r<i.song.getChannelCount();r++){const a=i.song.channels[r],l=new t.Channel;r<i.song.pitchChannelCount?o.push(l):h.push(l),l.octave=a.octave;for(const t of a.instruments)l.instruments.push(t);const c=t.Config.partsPerBeat*i.song.beatsPerBar,f=t.Config.partsPerBeat*s;let d=-1,u=null;for(let s=0;s<i.song.barCount;s++){const o=i.song.getPattern(r,s);if(null!=o){const i=s*c;for(const s of o.notes){const h=s.start+i+n,r=s.end+i+n,a=Math.floor(h/f),c=Math.ceil(r/f);for(let i=a;i<c;i++){const n=i*f,a=Math.max(0,h-n),c=Math.min(f,r-n);if(a<c){if(d!=i||null==u){for(d++;d<i;)l.bars[d]=0,d++;u=new t.Pattern,l.patterns.push(u),l.bars[d]=l.patterns.length,u.instrument=o.instrument}e(s,h-n-a,a,c,u.notes)}}}}}}f(o),f(h),this.append(new l(i,o,h))}}t.ChangeMoveAndOverflowNotes=i;class s extends t.UndoableChange{constructor(t,e){super(!1),this._=t,this.Rt=e,this.St=this.Rt.start,this.zt=this.Rt.end,this.Tt=this.Rt.start,this.Bt=this.Rt.end,this.Ft=this.Rt.pins,this.Lt=[],this.It=this.Rt.pitches,this.Ht=[]}Ut(){for(let t=0;t<this.Lt.length-1;)this.Lt[t].time>=this.Lt[t+1].time?this.Lt.splice(t,1):t++;for(let t=1;t<this.Lt.length-1;)this.Lt[t-1].interval==this.Lt[t].interval&&this.Lt[t].interval==this.Lt[t+1].interval&&this.Lt[t-1].volume==this.Lt[t].volume&&this.Lt[t].volume==this.Lt[t+1].volume?this.Lt.splice(t,1):t++;const t=this.Lt[0].interval,e=this.Lt[0].time;for(let e=0;e<this.It.length;e++)this.Ht[e]=this.It[e]+t;for(let i=0;i<this.Lt.length;i++)this.Lt[i].interval-=t,this.Lt[i].time-=e;this.Tt=this.St+e,this.Bt=this.Tt+this.Lt[this.Lt.length-1].time,this.nt(),this.et()}nt(){this.Rt.pins=this.Lt,this.Rt.pitches=this.Ht,this.Rt.start=this.Tt,this.Rt.end=this.Bt,this._.notifier.changed()}ot(){this.Rt.pins=this.Ft,this.Rt.pitches=this.It,this.Rt.start=this.St,this.Rt.end=this.zt,this._.notifier.changed()}}t.ChangePins=s;t.ChangeCustomizeInstrument=class extends t.Change{constructor(t){super();const e=t.song.channels[t.channel].instruments[t.getCurrentInstrument()];e.preset!=e.type&&(e.preset=e.type,t.notifier.changed(),this.et())}};t.ChangeCustomWave=class extends t.Change{constructor(t,e){super();const i=t.song.channels[t.channel].instruments[t.getCurrentInstrument()].customChipWave;var s=!0;for(let t=0;t<i.length;t++)i[t]!=e[t]&&(s=!1,t=i.length);if(0==s){let i=t.song.channels[t.channel].instruments[t.getCurrentInstrument()];for(let t=0;t<e.length;t++)i.customChipWave[t]=e[t];let s=0;for(let t=0;t<i.customChipWave.length;t++)s+=i.customChipWave[t];const n=s/i.customChipWave.length;let o=0,h=0;for(let t=0;t<i.customChipWave.length;t++)o+=h,h=i.customChipWave[t]-n,i.customChipWaveIntegral[t]=o;i.customChipWaveIntegral[64]=0,i.preset=i.type,t.notifier.changed(),this.et()}}};t.ChangePreset=class extends t.Change{constructor(e,i){super();const s=e.song.channels[e.channel].instruments[e.getCurrentInstrument()];if(s.preset!=i){const n=t.EditorConfig.valueToPreset(i);if(null!=n)if(void 0!=n.customType)s.type=n.customType,!t.Config.instrumentTypeHasSpecialInterval[s.type]&&t.Config.chords[s.chord].isCustomInterval&&(s.chord=0),t.Config.instrumentTypeHasChorus[s.type]||-1==t.Config.effectsNames[s.effects].indexOf("chorus")||(s.effects-=2);else if(void 0!=n.settings){const t=s.volume,i=s.pan;s.fromJsonObject(n.settings,e.song.getChannelIsNoise(e.channel)),s.volume=t,s.pan=i}s.preset=i,e.notifier.changed(),this.et()}}};t.ChangeRandomGeneratedInstrument=class extends t.Change{constructor(e){function i(t){let e=0;for(const i of t)e+=i.weight;let i=Math.random()*e;for(const e of t)if((i-=e.weight)<=0)return e.item;return t[Math.random()*t.length|0].item}function s(t,e,s,n){const o=[];for(let i=t;i<=e;i++)o.push({item:i,weight:1/(Math.pow((i-s)/n,2)+1)});return i(o)}super();const n=e.song.getChannelIsNoise(e.channel),o=e.song.channels[e.channel].instruments[e.getCurrentInstrument()];if(n){const e=i([{item:2,weight:1},{item:3,weight:3}]);function h(e){let i=0;for(const t of e)t>i&&(i=t);for(let s=0;s<e.length;s++)e[s]=t.Config.harmonicsMax*e[s]/i}switch(o.preset=o.type=e,o.filterCutoff=s(4,t.Config.filterCutoffRange-1,t.Config.filterCutoffRange-2,2),o.filterResonance=s(0,t.Config.filterResonanceRange-1,1,2),o.filterEnvelope=t.Config.envelopes.dictionary[i([{item:"steady",weight:2},{item:"punch",weight:4},{item:"flare 1",weight:2},{item:"flare 2",weight:2},{item:"flare 3",weight:2},{item:"twang 1",weight:8},{item:"twang 2",weight:8},{item:"twang 3",weight:8},{item:"swell 1",weight:2},{item:"swell 2",weight:2},{item:"swell 3",weight:1},{item:"tremolo1",weight:1},{item:"tremolo2",weight:1},{item:"tremolo3",weight:1},{item:"tremolo4",weight:1},{item:"tremolo5",weight:1},{item:"tremolo6",weight:1},{item:"decay 1",weight:4},{item:"decay 2",weight:4},{item:"decay 3",weight:4}])].index,o.transition=t.Config.transitions.dictionary[i([{item:"seamless",weight:1},{item:"hard",weight:4},{item:"soft",weight:2},{item:"slide",weight:1},{item:"cross fade",weight:2},{item:"hard fade",weight:8},{item:"medium fade",weight:2},{item:"soft fade",weight:1}])].index,o.effects=t.Config.effectsNames.indexOf(i([{item:"none",weight:1},{item:"reverb",weight:3}])),o.chord=t.Config.chords.dictionary[i([{item:"harmony",weight:4},{item:"strum",weight:2},{item:"arpeggio",weight:1}])].index,e){case 2:o.chipNoise=Math.random()*t.Config.chipNoises.length|0;break;case 3:{const e=[()=>{const e=[];for(let i=0;i<t.Config.spectrumControlPoints;i++)e[i]=Math.random()<.5?Math.random():0;return e},()=>{let e=1;const i=[e];for(let s=1;s<t.Config.spectrumControlPoints;s++)e*=Math.pow(2,Math.random()-.52),i[s]=e;return i},()=>{let e=1;const i=[e];for(let s=1;s<t.Config.spectrumControlPoints;s++)e*=Math.pow(2,Math.random()-.52),i[s]=e*Math.random();return i}],i=(0,e[Math.random()*e.length|0])();h(i);for(let e=0;e<t.Config.spectrumControlPoints;e++)o.spectrumWave.spectrum[e]=Math.round(i[e]);o.spectrumWave.markCustomWaveDirty()}break;default:throw new Error("Unhandled noise instrument type in random generator.")}}else{const e=i([{item:0,weight:4},{item:6,weight:4},{item:5,weight:6},{item:3,weight:1},{item:1,weight:4}]);function h(e){let i=0;for(const t of e)t>i&&(i=t);for(let s=0;s<e.length;s++)e[s]=t.Config.harmonicsMax*e[s]/i}switch(o.preset=o.type=e,o.filterCutoff=s(2,t.Config.filterCutoffRange-1,7,1.5),o.filterResonance=s(0,t.Config.filterResonanceRange-1,1,2),o.filterEnvelope=t.Config.envelopes.dictionary[i([{item:"steady",weight:10},{item:"punch",weight:6},{item:"flare 1",weight:2},{item:"flare 2",weight:4},{item:"flare 3",weight:2},{item:"twang 1",weight:2},{item:"twang 2",weight:4},{item:"twang 3",weight:4},{item:"swell 1",weight:4},{item:"swell 2",weight:2},{item:"swell 3",weight:1},{item:"tremolo1",weight:1},{item:"tremolo2",weight:1},{item:"tremolo3",weight:1},{item:"tremolo4",weight:1},{item:"tremolo5",weight:1},{item:"tremolo6",weight:1},{item:"decay 1",weight:1},{item:"decay 2",weight:2},{item:"decay 3",weight:2}])].index,o.transition=t.Config.transitions.dictionary[i([{item:"seamless",weight:1},{item:"hard",weight:4},{item:"soft",weight:4},{item:"slide",weight:2},{item:"cross fade",weight:4},{item:"hard fade",weight:4},{item:"medium fade",weight:2},{item:"soft fade",weight:2}])].index,o.effects=t.Config.effectsNames.indexOf(i([{item:"none",weight:1},{item:"reverb",weight:10},{item:"chorus",weight:t.Config.instrumentTypeHasChorus[e]?2:0},{item:"chorus & reverb",weight:t.Config.instrumentTypeHasChorus[e]?2:0}])),o.chord=t.Config.chords.dictionary[i([{item:"harmony",weight:7},{item:"strum",weight:2},{item:"arpeggio",weight:1}])].index,3!=e&&(o.vibrato=t.Config.vibratos.dictionary[i([{item:"none",weight:6},{item:"light",weight:2},{item:"delayed",weight:2},{item:"heavy",weight:1},{item:"shaky",weight:2}])].index),0!=e&&5!=e||(o.interval=t.Config.intervals.dictionary[i([{item:"union",weight:10},{item:"shimmer",weight:5},{item:"hum",weight:4},{item:"honky tonk",weight:3},{item:"dissonant",weight:1},{item:"fifth",weight:1},{item:"octave",weight:2},{item:"bowed",weight:2}])].index),e){case 0:o.chipWave=Math.random()*t.Config.chipWaves.length|0;break;case 6:o.pulseEnvelope=t.Config.envelopes.dictionary[i([{item:"steady",weight:10},{item:"punch",weight:6},{item:"flare 1",weight:2},{item:"flare 2",weight:4},{item:"flare 3",weight:2},{item:"twang 1",weight:4},{item:"twang 2",weight:4},{item:"twang 3",weight:4},{item:"swell 1",weight:4},{item:"swell 2",weight:4},{item:"swell 3",weight:4},{item:"tremolo1",weight:1},{item:"tremolo2",weight:1},{item:"tremolo3",weight:1},{item:"tremolo4",weight:2},{item:"tremolo5",weight:2},{item:"tremolo6",weight:2},{item:"decay 1",weight:2},{item:"decay 2",weight:2},{item:"decay 3",weight:2}])].index,o.pulseWidth=s(0,t.Config.pulseWidthRange-1,t.Config.pulseWidthRange-1,2);break;case 5:{const e=[()=>{const e=[];for(let i=0;i<t.Config.harmonicsControlPoints;i++)e[i]=Math.random()<.4?Math.random():0;return e[8*Math.random()|0]=Math.pow(Math.random(),.25),e},()=>{let e=1;const i=[e];for(let s=1;s<t.Config.harmonicsControlPoints;s++)e*=Math.pow(2,Math.random()-.55),i[s]=e;return i},()=>{let e=1;const i=[e];for(let s=1;s<t.Config.harmonicsControlPoints;s++)e*=Math.pow(2,Math.random()-.55),i[s]=e*Math.random();return i}],i=(0,e[Math.random()*e.length|0])();h(i);for(let e=0;e<t.Config.harmonicsControlPoints;e++)o.harmonicsWave.harmonics[e]=Math.round(i[e]);o.harmonicsWave.markCustomWaveDirty()}break;case 3:{const e=[];for(let i=0;i<t.Config.spectrumControlPoints;i++){const t=0==i||7==i||11==i||14==i||16==i||18==i||21==i;e[i]=t?Math.pow(Math.random(),.25):.5*Math.pow(Math.random(),3)}h(e);for(let i=0;i<t.Config.spectrumControlPoints;i++)o.spectrumWave.spectrum[i]=Math.round(e[i]);o.spectrumWave.markCustomWaveDirty()}break;case 1:{o.algorithm=Math.random()*t.Config.algorithms.length|0,o.feedbackType=Math.random()*t.Config.feedbacks.length|0;const e=t.Config.algorithms[o.algorithm];for(let i=0;i<e.carrierCount;i++)o.operators[i].frequency=s(0,t.Config.operatorFrequencies.length-1,0,3),o.operators[i].amplitude=s(0,t.Config.operatorAmplitudeMax,t.Config.operatorAmplitudeMax-1,2),o.operators[i].envelope=t.Config.envelopes.dictionary.custom.index;for(let n=e.carrierCount;n<t.Config.operatorCount;n++)o.operators[n].frequency=s(3,t.Config.operatorFrequencies.length-1,0,3),o.operators[n].amplitude=Math.pow(Math.random(),2)*t.Config.operatorAmplitudeMax|0,o.operators[n].envelope=t.Config.envelopes.dictionary[i([{item:"steady",weight:6},{item:"punch",weight:2},{item:"flare 1",weight:2},{item:"flare 2",weight:2},{item:"flare 3",weight:2},{item:"twang 1",weight:2},{item:"twang 2",weight:2},{item:"twang 3",weight:2},{item:"swell 1",weight:2},{item:"swell 2",weight:2},{item:"swell 3",weight:2},{item:"tremolo1",weight:1},{item:"tremolo2",weight:1},{item:"tremolo3",weight:1},{item:"tremolo4",weight:1},{item:"tremolo5",weight:1},{item:"tremolo6",weight:1},{item:"decay 1",weight:1},{item:"decay 2",weight:1},{item:"decay 3",weight:1}])].index;o.feedbackAmplitude=Math.pow(Math.random(),3)*t.Config.operatorAmplitudeMax|0,o.feedbackEnvelope=t.Config.envelopes.dictionary[i([{item:"steady",weight:4},{item:"punch",weight:2},{item:"flare 1",weight:2},{item:"flare 2",weight:2},{item:"flare 3",weight:2},{item:"twang 1",weight:2},{item:"twang 2",weight:2},{item:"twang 3",weight:2},{item:"swell 1",weight:2},{item:"swell 2",weight:2},{item:"swell 3",weight:2},{item:"tremolo1",weight:1},{item:"tremolo2",weight:1},{item:"tremolo3",weight:1},{item:"tremolo4",weight:1},{item:"tremolo5",weight:1},{item:"tremolo6",weight:1},{item:"decay 1",weight:1},{item:"decay 2",weight:1},{item:"decay 3",weight:1}])].index}break;default:throw new Error("Unhandled pitched instrument type in random generator.")}}e.notifier.changed(),this.et()}};t.ChangeTransition=class extends t.Change{constructor(t,e){super();const i=t.song.channels[t.channel].instruments[t.getCurrentInstrument()];i.transition!=e&&(this.et(),i.transition=e,i.preset=i.type,t.notifier.changed())}};t.ChangeEffects=class extends t.Change{constructor(t,e){super();const i=t.song.channels[t.channel].instruments[t.getCurrentInstrument()];i.effects!=e&&(this.et(),i.effects=e,i.preset=i.type,t.notifier.changed())}};t.ChangePatternNumbers=class extends t.Change{constructor(t,e,i,s,n,o){if(super(),e>t.song.patternsPerChannel)throw new Error("invalid pattern");for(let h=i;h<i+n;h++)for(let i=s;i<s+o;i++)t.song.channels[i].bars[h]!=e&&(t.song.channels[i].bars[h]=e,this.et());t.notifier.changed()}};t.ChangeBarCount=class extends t.Change{constructor(t,e,i,s){if(super(),t.song.barCount!=i){for(const e of t.song.channels)if(s){for(;e.bars.length<i;)e.bars.unshift(0);t.song.barCount>i&&e.bars.splice(0,t.song.barCount-i)}else{for(;e.bars.length<i;)e.bars.push(0);e.bars.length=i}if(s){const e=i-t.song.barCount;t.bar=Math.max(0,t.bar+e),(e<0||t.barScrollPos>0)&&(t.barScrollPos=Math.max(0,t.barScrollPos+e)),t.song.loopStart=Math.max(0,t.song.loopStart+e)}t.bar=Math.min(t.bar,i-1),t.barScrollPos=Math.max(0,Math.min(i-t.trackVisibleBars,t.barScrollPos)),t.song.loopLength=Math.min(i,t.song.loopLength),t.song.loopStart=Math.min(i-t.song.loopLength,t.song.loopStart),t.song.barCount=i,t.notifier.changed(),this.et()}}};t.ChangeInsertBars=class extends t.Change{constructor(e,i,s){super();const n=Math.min(t.Config.barCountMax,e.song.barCount+s);if(0!=(s=n-e.song.barCount)){for(const t of e.song.channels)for(;t.bars.length<n;)t.bars.splice(i,0,0);e.song.barCount=n,e.bar=i,e.barScrollPos=Math.min(n-e.trackVisibleBars,e.barScrollPos+s),e.song.loopStart>=i?e.song.loopStart+=s:e.song.loopStart+e.song.loopLength>=i&&(e.song.loopLength+=s),e.notifier.changed(),this.et()}}};t.ChangeDeleteBars=class extends t.Change{constructor(t,e,i){super();for(const s of t.song.channels)s.bars.splice(e,i),0==s.bars.length&&s.bars.push(0);t.song.barCount=Math.max(1,t.song.barCount-i),t.bar=Math.max(0,e-i),t.barScrollPos=Math.max(0,t.barScrollPos-i),t.song.loopStart>=e?t.song.loopStart=Math.max(0,t.song.loopStart-i):t.song.loopStart+t.song.loopLength>e&&(t.song.loopLength-=i),t.song.loopLength=Math.max(1,Math.min(t.song.barCount-t.song.loopStart,t.song.loopLength)),t.notifier.changed(),this.et()}};t.ChangeChannelCount=class extends t.Change{constructor(e,i,s){if(super(),e.song.pitchChannelCount!=i||e.song.noiseChannelCount!=s){const o=[];function n(i,s,n,r,a,l){for(let c=0;c<i;c++){const i=c+n,f=c+r;if(c<s)o[i]=e.song.channels[f];else{o[i]=new t.Channel,o[i].octave=a;for(let s=0;s<e.song.instrumentsPerChannel;s++){const e=new t.Instrument(l),n=h(l),r=t.EditorConfig.valueToPreset(n);e.fromJsonObject(r.settings,l),e.preset=n,o[i].instruments[s]=e}for(let s=0;s<e.song.patternsPerChannel;s++)o[i].patterns[s]=new t.Pattern;for(let t=0;t<e.song.barCount;t++)o[i].bars[t]=t<4?1:0}}}n(i,e.song.pitchChannelCount,0,0,2,!1),n(s,e.song.noiseChannelCount,i,e.song.pitchChannelCount,0,!0),e.song.pitchChannelCount=i,e.song.noiseChannelCount=s;for(let t=0;t<e.song.getChannelCount();t++)e.song.channels[t]=o[t];e.song.channels.length=e.song.getChannelCount(),e.channel=Math.min(e.channel,i+s-1),e.notifier.changed(),t.ColorConfig.resetColors(),this.et()}}};t.ChangeChannelBar=class extends t.Change{constructor(t,e,i,s=!1){super();const n=t.channel,o=t.bar;t.channel=e,t.bar=i,s||(t.barScrollPos=Math.min(t.bar,Math.max(t.bar-(t.trackVisibleBars-1),t.barScrollPos))),t.notifier.changed(),n==e&&o==i||this.et()}};t.ChangeInterval=class extends t.Change{constructor(t,e){super();const i=t.song.channels[t.channel].instruments[t.getCurrentInstrument()];i.interval!=e&&(this.et(),i.interval=e,i.preset=i.type,t.notifier.changed())}};t.ChangeChord=class extends t.Change{constructor(t,e){super();const i=t.song.channels[t.channel].instruments[t.getCurrentInstrument()];i.chord!=e&&(this.et(),i.chord=e,i.preset=i.type,t.notifier.changed())}};t.ChangeVibrato=class extends t.Change{constructor(t,e){super();const i=t.song.channels[t.channel].instruments[t.getCurrentInstrument()];i.vibrato!=e&&(i.vibrato=e,i.preset=i.type,t.notifier.changed(),this.et())}};t.ChangeSpectrum=class extends t.Change{constructor(t,e,i){super(),i.markCustomWaveDirty(),e.preset=e.type,t.notifier.changed(),this.et()}};t.ChangeHarmonics=class extends t.Change{constructor(t,e,i){super(),i.markCustomWaveDirty(),e.preset=e.type,t.notifier.changed(),this.et()}};t.ChangeDrumsetEnvelope=class extends t.Change{constructor(t,e,i){super();const s=t.song.channels[t.channel].instruments[t.getCurrentInstrument()];s.drumsetEnvelopes[e]!=i&&(s.drumsetEnvelopes[e]=i,s.preset=s.type,t.notifier.changed(),this.et())}};class n extends t.Change{constructor(t){super(),this._=t,this.Dt=this._.song.channels[this._.channel].instruments[this._.getCurrentInstrument()]}commit(){this.isNoop()||(this.Dt.preset=this.Dt.type,this._.notifier.changed())}}t.ChangePulseWidth=class extends n{constructor(t,e,i){super(t),this.Dt.pulseWidth=i,t.notifier.changed(),e!=i&&this.et()}};t.ChangePulseEnvelope=class extends t.Change{constructor(t,e){super();const i=t.song.channels[t.channel].instruments[t.getCurrentInstrument()];i.pulseEnvelope!=e&&(i.pulseEnvelope=e,i.preset=i.type,t.notifier.changed(),this.et())}};t.ChangeFilterCutoff=class extends n{constructor(t,e,i){super(t),this.Dt.filterCutoff=i,t.notifier.changed(),e!=i&&this.et()}};t.ChangeFilterResonance=class extends n{constructor(t,e,i){super(t),this.Dt.filterResonance=i,t.notifier.changed(),e!=i&&this.et()}};t.ChangeFilterEnvelope=class extends t.Change{constructor(t,e){super();const i=t.song.channels[t.channel].instruments[t.getCurrentInstrument()];i.filterEnvelope!=e&&(i.filterEnvelope=e,i.preset=i.type,t.notifier.changed(),this.et())}};t.ChangeAlgorithm=class extends t.Change{constructor(t,e){super();const i=t.song.channels[t.channel].instruments[t.getCurrentInstrument()];i.algorithm!=e&&(i.algorithm=e,i.preset=i.type,t.notifier.changed(),this.et())}};t.ChangeFeedbackType=class extends t.Change{constructor(t,e){super();const i=t.song.channels[t.channel].instruments[t.getCurrentInstrument()];i.feedbackType!=e&&(i.feedbackType=e,i.preset=i.type,t.notifier.changed(),this.et())}};t.ChangeFeedbackEnvelope=class extends t.Change{constructor(t,e){super();const i=t.song.channels[t.channel].instruments[t.getCurrentInstrument()];i.feedbackEnvelope!=e&&(i.feedbackEnvelope=e,i.preset=i.type,t.notifier.changed(),this.et())}};t.ChangeOperatorEnvelope=class extends t.Change{constructor(t,e,i){super();const s=t.song.channels[t.channel].instruments[t.getCurrentInstrument()];s.operators[e].envelope!=i&&(s.operators[e].envelope=i,s.preset=s.type,t.notifier.changed(),this.et())}};t.ChangeOperatorFrequency=class extends t.Change{constructor(t,e,i){super();const s=t.song.channels[t.channel].instruments[t.getCurrentInstrument()];s.operators[e].frequency!=i&&(s.operators[e].frequency=i,s.preset=s.type,t.notifier.changed(),this.et())}};t.ChangeOperatorAmplitude=class extends n{constructor(t,e,i,s){super(t),this.Dt.operators[e].amplitude=s,t.notifier.changed(),i!=s&&this.et()}};t.ChangeFeedbackAmplitude=class extends n{constructor(t,e,i){super(t),this.Dt.feedbackAmplitude=i,t.notifier.changed(),e!=i&&this.et()}};t.ChangeInstrumentsPerChannel=class extends t.Change{constructor(e,i){if(super(),e.song.instrumentsPerChannel!=i){for(let s=0;s<e.song.getChannelCount();s++){const n=e.song.channels[s].instruments[e.song.instrumentsPerChannel-1],o=n.toJsonObject();for(let h=e.song.instrumentsPerChannel;h<i;h++){const i=new t.Instrument(e.song.getChannelIsNoise(s));4==n.type?i.setTypeAndReset(3,!0):i.fromJsonObject(o,e.song.getChannelIsNoise(s)),e.song.channels[s].instruments[h]=i}e.song.channels[s].instruments.length=i;for(let t=0;t<e.song.patternsPerChannel;t++)e.song.channels[s].patterns[t].instrument>=i&&(e.song.channels[s].patterns[t].instrument=0)}e.song.instrumentsPerChannel=i,e.notifier.changed(),this.et()}}};t.ChangeKey=class extends t.Change{constructor(t,e){super(),t.song.key!=e&&(t.song.key=e,t.notifier.changed(),this.et())}};t.ChangeLoop=class extends t.Change{constructor(t,e,i,s,n){super(),this._=t,this.oldStart=e,this.oldLength=i,this.newStart=s,this.newLength=n,this._.song.loopStart=this.newStart,this._.song.loopLength=this.newLength,this._.notifier.changed(),this.oldStart==this.newStart&&this.oldLength==this.newLength||this.et()}};t.ChangePitchAdded=class extends t.UndoableChange{constructor(t,e,i,s,n=!1){super(n),this._=t,this.Rt=e,this.Zt=i,this.jt=s,this.et(),this.redo()}nt(){this.Rt.pitches.splice(this.jt,0,this.Zt),this._.notifier.changed()}ot(){this.Rt.pitches.splice(this.jt,1),this._.notifier.changed()}};t.ChangeOctave=class extends t.Change{constructor(t,e,i){super(),this.oldValue=e,t.song.channels[t.channel].octave=i,t.notifier.changed(),e!=i&&this.et()}};t.ChangeRhythm=class extends t.ChangeGroup{constructor(t,e){super(),t.song.rhythm!=e&&(t.song.rhythm=e,t.notifier.changed(),this.et())}};t.ChangePaste=class extends t.ChangeGroup{constructor(e,i,s,n){super(),i.notes.length=0;for(const e of s){const s=new t.Note(e.pitches[0],e.start,e.end,e.pins[0].volume,!1);s.pitches.length=0;for(const t of e.pitches)s.pitches.push(t);s.pins.length=0;for(const i of e.pins)s.pins.push(t.makeNotePin(i.interval,i.time,i.volume));i.notes.push(s)}e.song.beatsPerBar<n&&this.append(new m(e,i,e.song.beatsPerBar*t.Config.partsPerBeat,n*t.Config.partsPerBeat)),e.notifier.changed(),this.et()}};t.ChangePasteInstrument=class extends t.ChangeGroup{constructor(t,e,i){super(),e.fromJsonObject(i,i.isDrum),t.notifier.changed(),this.et()}};t.ChangePatternInstrument=class extends t.Change{constructor(t,e,i){super(),i.instrument!=e&&(i.instrument=e,t.notifier.changed(),this.et())}};t.ChangePatternsPerChannel=class extends t.Change{constructor(e,i){if(super(),e.song.patternsPerChannel!=i){for(let s=0;s<e.song.getChannelCount();s++){const n=e.song.channels[s].bars,o=e.song.channels[s].patterns;for(let t=0;t<n.length;t++)n[t]>i&&(n[t]=0);for(let e=o.length;e<i;e++)o[e]=new t.Pattern;o.length=i}e.song.patternsPerChannel=i,e.notifier.changed(),this.et()}}};t.ChangeEnsurePatternExists=class extends t.UndoableChange{constructor(t,e,i){super(!1),this.Vt=null;const s=t.song;if(0!=s.channels[e].bars[i])return;this._=t,this.Ot=i,this.Gt=e,this.Wt=s.patternsPerChannel,this.Yt=s.patternsPerChannel;let n=null,o=null;for(let t=1;t<=s.patternsPerChannel;t++){let i=!1;for(let n=0;n<s.barCount;n++)if(s.channels[e].bars[n]==t){i=!0;break}if(!i&&(null==o&&(o=t),0==s.channels[e].patterns[t-1].notes.length)){n=t;break}}if(null!=n)this.Jt=n;else if(s.patternsPerChannel<s.barCount)this.Yt=s.patternsPerChannel+1,this.Jt=s.patternsPerChannel+1;else{if(null==o)throw new Error;this.Jt=o,this.Vt=s.channels[e].patterns[o-1].notes}this.et(),this.nt()}nt(){const e=this._.song;for(let i=e.patternsPerChannel;i<this.Yt;i++)for(let s=0;s<e.getChannelCount();s++)e.channels[s].patterns[i]=new t.Pattern;e.patternsPerChannel=this.Yt,e.channels[this.Gt].patterns[this.Jt-1].notes=[],e.channels[this.Gt].bars[this.Ot]=this.Jt,this._.notifier.changed()}ot(){const t=this._.song,e=t.channels[this.Gt].patterns[this.Jt-1];null!=this.Vt&&(e.notes=this.Vt),t.channels[this.Gt].bars[this.Ot]=0;for(let e=0;e<t.getChannelCount();e++)t.channels[e].patterns.length=this.Wt;t.patternsPerChannel=this.Wt,this._.notifier.changed()}};t.ChangePinTime=class extends s{constructor(e,i,s,n){super(e,i),n-=this.St;const o=this.Ft[s].time,h=Math.min(o,n),r=Math.max(o,n);let a=!1;for(let e=0;e<this.Ft.length;e++){const o=i.pins[e],l=o.time;l<h?this.Lt.push(t.makeNotePin(o.interval,l,o.volume)):l>r&&(a||(this.Lt.push(t.makeNotePin(this.Ft[s].interval,n,this.Ft[s].volume)),a=!0),this.Lt.push(t.makeNotePin(o.interval,l,o.volume)))}a||this.Lt.push(t.makeNotePin(this.Ft[s].interval,n,this.Ft[s].volume)),this.Ut()}};t.ChangePitchBend=class extends s{constructor(e,i,s,n,o,h){super(e,i),s-=this.St,n-=this.St,o-=i.pitches[h];let r,a,l,c,f=!1,d=!1,u=0,m=3,p=!0;for(n>s?(r=0,a=1,l=i.pins.length,c=(t=>{this.Lt.push(t)})):(r=i.pins.length-1,a=-1,l=-1,c=(t=>{this.Lt.unshift(t)}));r!=l;r+=a){const e=i.pins[r],h=e.time;for(;;)if(f){if(d){if(h*a==n*a)break;e.interval!=u&&(p=!1),c(t.makeNotePin(p?o:e.interval,h,e.volume));break}if(h*a<=n*a&&(u=e.interval,m=e.volume),h*a<n*a)break;c(t.makeNotePin(o,n,m)),d=!0}else{if(h*a<=s*a&&(u=e.interval,m=e.volume),h*a<s*a){c(t.makeNotePin(e.interval,h,e.volume));break}c(t.makeNotePin(u,s,m)),f=!0}}d||c(t.makeNotePin(o,n,m)),this.Ut()}};t.ChangePatternRhythm=class extends t.ChangeSequence{constructor(e,i){super();const s=t.Config.partsPerBeat/t.Config.rhythms[e.song.rhythm].stepsPerBeat,n=function(i){let n=t.Config.rhythms[e.song.rhythm].roundUpThresholds;if(null!=n){const e=Math.floor(i/t.Config.partsPerBeat)*t.Config.partsPerBeat,o=i-e;let h=e;for(const t of n){if(!(o>=t))break;h+=s}return h}return Math.round(i/s)*s};let h=0;for(;h<i.notes.length;){const t=i.notes[h];n(t.start)>=n(t.end)?this.append(new d(e,i,t,h,!0)):(this.append(new o(e,t,n)),h++)}}};class o extends s{constructor(e,i,s){super(e,i);for(const e of this.Ft)this.Lt.push(t.makeNotePin(e.interval,s(e.time+this.St)-this.St,e.volume));this.Ut()}}t.ChangeMoveNotesSideways=class extends t.ChangeGroup{constructor(s,n,o){super();let h=Math.round(n%s.song.beatsPerBar*t.Config.partsPerBeat);if(h<0&&(h+=s.song.beatsPerBar*t.Config.partsPerBeat),0!=h){switch(o){case"wrapAround":{const i=t.Config.partsPerBeat*s.song.beatsPerBar;for(const t of s.song.channels)for(const s of t.patterns){const t=[];for(let n=1;n>=0;n--){const o=n*i;for(const n of s.notes){const s=n.start+h,r=n.end+h,a=Math.max(0,s-o),l=Math.min(i,r-o);a<l&&e(n,s-o-a,a,l,t)}}s.notes=t}}break;case"overflow":{let t=s.song.barCount,e=s.song.loopStart,o=s.song.loopLength;if(this.append(new i(s,s.song.beatsPerBar,h)),n<0){let i=!0;for(const t of s.song.channels)0!=t.bars[0]&&(i=!1);if(i){for(const t of s.song.channels)t.bars.shift();s.song.barCount--}else t++,e++,s.bar++}for(;s.song.barCount<t;){for(const t of s.song.channels)t.bars.push(0);s.song.barCount++}s.song.loopStart=e,s.song.loopLength=o}break;default:throw new Error("Unrecognized beats-per-bar conversion strategy.")}s.notifier.changed(),this.et()}}};t.ChangeBeatsPerBar=class extends t.ChangeGroup{constructor(e,s,n){if(super(),e.song.beatsPerBar!=s){switch(n){case"splice":if(e.song.beatsPerBar>s){const i=new t.ChangeSequence;for(let n=0;n<e.song.getChannelCount();n++)for(let o=0;o<e.song.channels[n].patterns.length;o++)i.append(new m(e,e.song.channels[n].patterns[o],s*t.Config.partsPerBeat,e.song.beatsPerBar*t.Config.partsPerBeat))}break;case"stretch":{const t=function(t){return Math.round(t*s/e.song.beatsPerBar)};for(let i=0;i<e.song.getChannelCount();i++)for(let s=0;s<e.song.channels[i].patterns.length;s++){const n=e.song.channels[i].patterns[s];let h=0;for(;h<n.notes.length;){const i=n.notes[h];t(i.start)>=t(i.end)?this.append(new d(e,n,i,h,!0)):(this.append(new o(e,i,t)),h++)}}}break;case"overflow":this.append(new i(e,s,0)),e.song.loopStart=0,e.song.loopLength=e.song.barCount;break;default:throw new Error("Unrecognized beats-per-bar conversion strategy.")}e.song.beatsPerBar=s,e.notifier.changed(),this.et()}}};t.ChangeScale=class extends t.ChangeGroup{constructor(t,e){super(),t.song.scale!=e&&(t.song.scale=e,t.notifier.changed(),this.et())}};function h(e){const i=[];for(let s=0;s<t.EditorConfig.presetCategories.length;s++){const n=t.EditorConfig.presetCategories[s];if("Novelty Presets"!=n.name)for(let t=0;t<n.presets.length;t++){const o=n.presets[t];void 0!=o.settings&&1==o.isNoise==e&&i.push((s<<6)+t)}}return i[Math.random()*i.length|0]}function r(e){for(let i=0;i<e.channels.length;i++)for(const s of e.channels[i].instruments){const n=e.getChannelIsNoise(i),o=i==e.pitchChannelCount?t.EditorConfig.nameToPresetValue(Math.random()>.5?"chip noise":"standard drumset"):h(n),r=t.EditorConfig.valueToPreset(o);s.fromJsonObject(r.settings,n),s.preset=o}}t.ChangeDetectKey=class extends t.ChangeGroup{constructor(e){super();const i=e.song,s=t.Config.keys[i.key].basePitch,n=[0,0,0,0,0,0,0,0,0,0,0,0];for(let e=0;e<i.pitchChannelCount;e++)for(let o=0;o<i.barCount;o++){const h=i.getPattern(e,o);if(null!=h)for(const e of h.notes){const i=e.pins[0];for(let o=1;o<e.pins.length;o++){const h=e.pins[o];if(i.interval==h.interval){let o=h.time-i.time;o+=Math.max(0,Math.min(t.Config.partsPerBeat,h.time+e.start)-(i.time+e.start)),o*=h.volume+i.volume;for(const t of e.pitches)n[(s+i.interval+t)%12]+=o}}}}let o=0,h=0;for(let t=0;t<12;t++){const e=n[t]+.6*n[(t+7)%12]+.2*n[(t+4)%12]+.2*n[(t+3)%12];h<e&&(h=e,o=t)}if(o!=i.key){const t=i.key-o,s=Math.abs(t);for(let n=0;n<i.pitchChannelCount;n++)for(const o of i.channels[n].patterns)for(let i=0;i<s;i++)this.append(new y(e,n,o,t>0,!0));i.key=o,e.notifier.changed(),this.et()}}},t.pickRandomPresetValue=h,t.setDefaultInstruments=r;t.ChangeSong=class extends t.ChangeGroup{constructor(t,e){super(),t.song.fromBase64String(e),this.append(new a(t)),""==e&&r(t.song),t.notifier.changed(),this.et()}};class a extends t.Change{constructor(t){super();const e=Math.min(t.channel,t.song.getChannelCount()-1),i=Math.max(0,Math.min(t.song.barCount-1,t.bar)),s=Math.min(t.bar,Math.max(t.bar-(t.trackVisibleBars-1),Math.max(0,Math.min(t.song.barCount-t.trackVisibleBars,t.barScrollPos))));t.channel==e&&t.bar==i&&t.barScrollPos==s||(t.channel=e,t.bar=i,t.barScrollPos=s,t.notifier.changed(),this.et())}}t.ChangeValidateDoc=a;class l extends t.ChangeGroup{constructor(e,i,s){super();const n=e.song;function o(t,e){for(;t.length>e;){let e=t.length-1,i=0;for(let s=0;s<t.length-1;s++){let n=0;for(const e of t[s].bars)0==e&&n++;n>=i&&(e=s,i=n)}t.splice(e,1)}}for(o(i,t.Config.pitchChannelCountMax),o(s,t.Config.noiseChannelCountMax);i.length<t.Config.pitchChannelCountMin;)i.push(new t.Channel);for(;s.length<t.Config.noiseChannelCountMin;)s.push(new t.Channel);n.barCount=1,n.instrumentsPerChannel=1,n.patternsPerChannel=8;const h=i.concat(s);for(let t=0;t<h.length;t++){const e=h[t];n.barCount=Math.max(n.barCount,e.bars.length),n.patternsPerChannel=Math.max(n.patternsPerChannel,e.patterns.length),n.instrumentsPerChannel=Math.max(n.instrumentsPerChannel,e.instruments.length),n.channels[t]=e}n.channels.length=h.length,n.pitchChannelCount=i.length,n.noiseChannelCount=s.length,n.barCount=Math.min(t.Config.barCountMax,n.barCount),n.patternsPerChannel=Math.min(t.Config.barCountMax,n.patternsPerChannel),n.instrumentsPerChannel=Math.min(t.Config.instrumentsPerChannelMax,n.instrumentsPerChannel);for(let i=0;i<n.channels.length;i++){const s=n.channels[i];for(let t=0;t<s.bars.length;t++)(s.bars[t]>n.patternsPerChannel||s.bars[t]<0)&&(s.bars[t]=0);for(const t of s.patterns)(t.instrument>=n.instrumentsPerChannel||t.instrument<0)&&(t.instrument=0);for(;s.bars.length<n.barCount;)s.bars.push(0);for(;s.patterns.length<n.patternsPerChannel;)s.patterns.push(new t.Pattern);for(;s.instruments.length<n.instrumentsPerChannel;){const o=new t.Instrument(e.song.getChannelIsNoise(i));n.getChannelIsNoise(i)?o.setTypeAndReset(2,!0):o.setTypeAndReset(0,!1),s.instruments.push(o)}s.bars.length=n.barCount,s.patterns.length=n.patternsPerChannel,s.instruments.length=n.instrumentsPerChannel}n.loopStart=Math.max(0,Math.min(n.barCount-1,n.loopStart)),n.loopLength=Math.min(n.barCount-n.loopStart,n.loopLength),this.append(new a(e)),e.notifier.changed(),this.et(),t.ColorConfig.resetColors()}}function c(t,e){if(t.length!=e.length)return!1;for(let i=0;i<t.length;i++){const s=t[i],n=e[i];if(n.start!=s.start||n.end!=s.end||n.pitches.length!=s.pitches.length||n.pins.length!=s.pins.length)return!1;for(let t=0;t<s.pitches.length;t++)if(n.pitches[t]!=s.pitches[t])return!1;for(let t=0;t<s.pins.length;t++)if(n.pins[t].interval!=s.pins[t].interval||n.pins[t].time!=s.pins[t].time||n.pins[t].volume!=s.pins[t].volume)return!1}return!0}function f(t){for(const e of t){const t=[];for(let i=0;i<e.bars.length;i++){if(0==e.bars[i])continue;const s=e.patterns[e.bars[i]-1];let n=!1;for(let o=0;o<t.length;o++){const h=t[o];if(h.instrument==s.instrument&&h.notes.length==s.notes.length&&c(s.notes,h.notes)){n=!0,e.bars[i]=o+1;break}}n||(t.push(s),e.bars[i]=t.length)}for(let i=0;i<t.length;i++)e.patterns[i]=t[i];e.patterns.length=t.length}}t.ChangeReplacePatterns=l,t.comparePatternNotes=c,t.removeDuplicatePatterns=f;t.ChangeTempo=class extends t.Change{constructor(e,i,s){super(),e.song.tempo=Math.max(t.Config.tempoMin,Math.min(t.Config.tempoMax,s)),e.notifier.changed(),i!=s&&this.et()}};t.ChangeReverb=class extends t.Change{constructor(t,e,i){super(),t.song.reverb=i,t.notifier.changed(),e!=i&&this.et()}};class d extends t.UndoableChange{constructor(t,e,i,s,n=!1){super(n),this._=t,this.Qt=e,this.Rt=i,this.jt=s,this.et(),this.redo()}nt(){this.Qt.notes.splice(this.jt,0,this.Rt),this._.notifier.changed()}ot(){this.Qt.notes.splice(this.jt,1),this._.notifier.changed()}}t.ChangeNoteAdded=d;class u extends s{constructor(e,i,s,n){super(e,i),s-=this.St,n-=this.St;let o,h=!1,r=this.Ft[0].volume,a=this.Ft[0].interval,l=!0;for(o=0;o<this.Ft.length;o++){const e=this.Ft[o];if(e.time<s)r=e.volume,a=e.interval;else{if(!(e.time<=n))break;if(e.time>s&&!h&&this.Lt.push(t.makeNotePin(a,s,r)),this.Lt.push(t.makeNotePin(e.interval,e.time,e.volume)),h=!0,e.time==n){l=!1;break}}}l&&this.Lt.push(t.makeNotePin(this.Ft[o].interval,n,this.Ft[o].volume)),this.Ut()}}t.ChangeNoteLength=u;class m extends t.ChangeSequence{constructor(t,e,i,s,n){super();let o=0;for(;o<e.notes.length;){const h=e.notes[o];if(h==n&&void 0!=n)o++;else if(h.end<=i)o++;else{if(h.start>=s)break;h.start<i?(this.append(new u(t,h,h.start,i)),o++):h.end>s?(this.append(new u(t,h,s,h.end)),o++):this.append(new d(t,e,h,o,!0))}}}}t.ChangeNoteTruncate=m;class p extends t.UndoableChange{constructor(e,i,s,n,o=!1,h=!1){super(!1),this._=e,this.Rt=s,this.Ft=s.pins,this.Lt=[],this.It=s.pitches,this.Ht=[];const r=e.song.getChannelIsNoise(i);if(r!=e.song.getChannelIsNoise(e.channel))return;const a=r?t.Config.drumCount-1:t.Config.maxPitch;for(let i=0;i<this.It.length;i++){let s=this.It[i];if(h&&!r)s=n?Math.min(a,s+12):Math.max(0,s-12);else if(n){for(let i=s+1;i<=a;i++)if(r||o||t.Config.scales[e.song.scale].flags[i%12]){s=i;break}}else for(let i=s-1;i>=0;i--)if(r||o||t.Config.scales[e.song.scale].flags[i%12]){s=i;break}let l=!1;for(let t=0;t<this.Ht.length;t++)if(this.Ht[t]==s){l=!0;break}l||this.Ht.push(s)}let l=0,c=a;for(let t=1;t<this.Ht.length;t++){const e=this.Ht[0]-this.Ht[t];l<e&&(l=e),c>e+a&&(c=e+a)}for(const i of this.Ft){let s=i.interval+this.It[0];if(s<l&&(s=l),s>c&&(s=c),h&&!r)s=n?Math.min(c,s+12):Math.max(l,s-12);else if(n){for(let i=s+1;i<=c;i++)if(r||o||t.Config.scales[e.song.scale].flags[i%12]){s=i;break}}else for(let i=s-1;i>=l;i--)if(r||o||t.Config.scales[e.song.scale].flags[i%12]){s=i;break}s-=this.Ht[0],this.Lt.push(t.makeNotePin(s,i.time,i.volume))}if(0!=this.Lt[0].interval)throw new Error("wrong pin start interval");for(let t=1;t<this.Lt.length-1;)this.Lt[t-1].interval==this.Lt[t].interval&&this.Lt[t].interval==this.Lt[t+1].interval&&this.Lt[t-1].volume==this.Lt[t].volume&&this.Lt[t].volume==this.Lt[t+1].volume?this.Lt.splice(t,1):t++;this.nt(),this.et()}nt(){this.Rt.pins=this.Lt,this.Rt.pitches=this.Ht,this._.notifier.changed()}ot(){this.Rt.pins=this.Ft,this.Rt.pitches=this.It,this._.notifier.changed()}}class y extends t.ChangeSequence{constructor(t,e,i,s,n=!1,o=!1){super();for(let h=0;h<i.notes.length;h++)this.append(new p(t,e,i.notes[h],s,n,o))}}t.ChangeTranspose=y;t.ChangePatternScale=class extends t.Change{constructor(e,i,s){super();const n=t.Config.maxPitch;for(const e of i.notes){const i=[],o=[];for(let t=0;t<e.pitches.length;t++){const n=e.pitches[t],o=s[n%12]+(n-n%12);-1==i.indexOf(o)&&i.push(o)}let h=0,r=n;for(let t=1;t<i.length;t++){const e=i[0]-i[t];h<e&&(h=e),r>e+n&&(r=e+n)}for(const n of e.pins){let a=n.interval+e.pitches[0];a<h&&(a=h),a>r&&(a=r);const l=s[a%12]+(a-a%12);o.push(t.makeNotePin(l-i[0],n.time,n.volume))}if(0!=o[0].interval)throw new Error("wrong pin start interval");for(let t=1;t<o.length-1;)o[t-1].interval==o[t].interval&&o[t].interval==o[t+1].interval&&o[t-1].volume==o[t].volume&&o[t].volume==o[t+1].volume?o.splice(t,1):t++;e.pitches=i,e.pins=o}this.et(),e.notifier.changed()}};t.ChangeVolume=class extends t.Change{constructor(t,e,i){super(),t.song.channels[t.channel].instruments[t.getCurrentInstrument()].volume=i,t.notifier.changed(),e!=i&&this.et()}};t.ChangeInputBoxText=class extends t.Change{constructor(t,e,i){super(),i.length>30&&(i=i.substring(0,30)),t.song.title=i,document.title=i+" - Jummbox 1.3",t.notifier.changed(),e!=i&&this.et()}};t.ChangePan=class extends t.Change{constructor(t,e,i){super(),t.song.channels[t.channel].instruments[t.getCurrentInstrument()].pan=i,t.notifier.changed(),e!=i&&this.et()}};t.ChangeVolumeBend=class extends t.UndoableChange{constructor(e,i,s,n,o){super(!1),this._=e,this.Rt=i,this.Ft=i.pins,this.Lt=[];let h=!1;for(const e of i.pins)e.time<s?this.Lt.push(e):e.time==s?(this.Lt.push(t.makeNotePin(o,s,n)),h=!0):(h||(this.Lt.push(t.makeNotePin(o,s,n)),h=!0),this.Lt.push(e));for(let t=1;t<this.Lt.length-1;)this.Lt[t-1].interval==this.Lt[t].interval&&this.Lt[t].interval==this.Lt[t+1].interval&&this.Lt[t-1].volume==this.Lt[t].volume&&this.Lt[t].volume==this.Lt[t+1].volume?this.Lt.splice(t,1):t++;this.nt(),this.et()}nt(){this.Rt.pins=this.Lt,this._.notifier.changed()}ot(){this.Rt.pins=this.Ft,this._.notifier.changed()}};t.ChangeChipWave=class extends t.Change{constructor(t,e){super();const i=t.song.channels[t.channel].instruments[t.getCurrentInstrument()];i.chipWave!=e&&(i.chipWave=e,i.preset=i.type,t.notifier.changed(),this.et())}};t.ChangeNoiseWave=class extends t.Change{constructor(t,e){super();const i=t.song.channels[t.channel].instruments[t.getCurrentInstrument()];i.chipNoise!=e&&(i.chipNoise=e,i.preset=i.type,t.notifier.changed(),this.et())}}}(beepbox||(beepbox={})),function(t){class e{constructor(){this.valid=!1,this.prevNote=null,this.curNote=null,this.nextNote=null,this.pitch=0,this.pitchIndex=-1,this.curIndex=0,this.start=0,this.end=0,this.part=0,this.notePart=0,this.nearPinIndex=0,this.pins=[]}}t.PatternEditor=class{constructor(i){this._=i,this.controlMode=!1,this.Xt=t.SVG.pattern({id:"patternEditorNoteBackground",x:"0",y:"0",width:"64",height:"156",patternUnits:"userSpaceOnUse"}),this._t=t.SVG.pattern({id:"patternEditorDrumBackground",x:"0",y:"0",width:"64",height:"40",patternUnits:"userSpaceOnUse"}),this.Kt=t.SVG.rect({x:"0",y:"0",width:"512",height:"481","pointer-events":"none",fill:"url(#patternEditorNoteBackground)"}),this.$t=t.SVG.svg(),this.te=t.SVG.rect({id:"",x:"0",y:"0",width:"4",height:"481",fill:"white","pointer-events":"none"}),this.ee=t.SVG.path({fill:"none",stroke:"white","stroke-width":"2","pointer-events":"none"}),this.pt=t.SVG.svg({style:"background-color: #040410; touch-action: none; position: absolute;",width:"100%",height:"100%",viewBox:"0 0 512 481",preserveAspectRatio:"none"},t.SVG.defs(this.Xt,this._t),this.Kt,this.$t,this.ee,this.te),this.container=t.HTML.div({style:"height: 100%; overflow:hidden; position: relative; flex-grow: 1;"},this.pt),this.ie=13,this.se=40,this.ne=[],this.oe=t.SVG.rect(),this.kt=481,this.he=0,this.wt=0,this.re=!1,this.Mt=!1,this.ae=!1,this.le=!1,this.ce=!1,this.fe=[],this.de=0,this.ue=0,this.me=0,this.pe=0,this.ye=0,this.be=!1,this.ge=null,this.ve=new e,this.Qt=null,this.we=0,this.Me=0,this.ke=-1,this.xe=-1,this.Ee=!1,this.Ae=!1,this.Ce=-1,this.Pe=-1,this.Ne=-1,this.qe=-1,this.resetCopiedPins=(()=>{const e=this.Re();this.fe.length=this._.song.getChannelCount();for(let i=0;i<this._.song.pitchChannelCount;i++)this.fe[i]=[t.makeNotePin(0,0,6),t.makeNotePin(0,e,6)];for(let i=this._.song.pitchChannelCount;i<this._.song.getChannelCount();i++)this.fe[i]=[t.makeNotePin(0,0,6),t.makeNotePin(0,e,0)]}),this.Se=(e=>{const i=Math.floor(this._.synth.playhead);if(this._.synth.playing&&(null!=this.Qt&&this._.song.getPattern(this._.channel,Math.floor(this._.synth.playhead))==this.Qt||Math.floor(this._.synth.playhead)==this._.bar)){this.te.setAttribute("visibility","visible");const e=this._.synth.playhead-i;Math.abs(e-this.we)>.1?this.we=e:this.we+=.2*(e-this.we),this.te.setAttribute("x",""+t.prettyNumber(this.we*this.ze-2))}else this.te.setAttribute("visibility","hidden");this._.synth.playing&&this._.autoFollow&&this.qe!=i&&(new t.ChangeChannelBar(this._,this._.channel,i),this._.notifier.notifyWatchers()),this.qe=i,window.requestAnimationFrame(this.Se)}),this.Pt=(t=>{this.Mt||(this.Mt=!0,this.ce=!1)}),this.Nt=(t=>{this.Mt&&(this.Mt=!1)}),this.qt=(t=>{t.preventDefault();const e=this.pt.getBoundingClientRect();this.he=((t.clientX||t.pageX)-e.left)*this.ze/(e.right-e.left),this.wt=((t.clientY||t.pageY)-e.top)*this.kt/(e.bottom-e.top),isNaN(this.he)&&(this.he=0),isNaN(this.wt)&&(this.wt=0),this.ce=!1,this.Te()}),this.Be=(t=>{t.preventDefault();const e=this.pt.getBoundingClientRect();this.he=(t.touches[0].clientX-e.left)*this.ze/(e.right-e.left),this.wt=(t.touches[0].clientY-e.top)*this.kt/(e.bottom-e.top),isNaN(this.he)&&(this.he=0),isNaN(this.wt)&&(this.wt=0),this.ce=!0,this.Te()}),this.Fe=(t=>{const e=this.pt.getBoundingClientRect();this.he=((t.clientX||t.pageX)-e.left)*this.ze/(e.right-e.left),this.wt=((t.clientY||t.pageY)-e.top)*this.kt/(e.bottom-e.top),isNaN(this.he)&&(this.he=0),isNaN(this.wt)&&(this.wt=0),this.ce=!1,this.Le()}),this.Ie=(t=>{if(!this.re)return;t.preventDefault();const e=this.pt.getBoundingClientRect();this.he=(t.touches[0].clientX-e.left)*this.ze/(e.right-e.left),this.wt=(t.touches[0].clientY-e.top)*this.kt/(e.bottom-e.top),isNaN(this.he)&&(this.he=0),isNaN(this.wt)&&(this.wt=0),this.Le()}),this.He=(e=>{if(!this.ve.valid)return;const i=this._.lastChangeWas(this.ge);if(this.ae&&i)null!=this.ge&&(this._.record(this.ge),this.ge=null);else if(this.re&&i)if(null==this.ve.curNote){const e=new t.Note(this.ve.pitch,this.ve.start,this.ve.end,6,this._.song.getChannelIsNoise(this._.channel));e.pins=[];for(const i of this.ve.pins)e.pins.push(t.makeNotePin(0,i.time,i.volume));const i=new t.ChangeSequence;i.append(new t.ChangeEnsurePatternExists(this._,this._.channel,this._.bar));const s=this._.getCurrentPattern();if(null==s)throw new Error;i.append(new t.ChangeNoteAdded(this._,s,e,this.ve.curIndex)),this._.record(i)}else{if(null==this.Qt)throw new Error;if(-1==this.ve.pitchIndex){const e=new t.ChangeSequence;4==this.ve.curNote.pitches.length&&e.append(new t.ChangePitchAdded(this._,this.ve.curNote,this.ve.curNote.pitches[0],0,!0)),e.append(new t.ChangePitchAdded(this._,this.ve.curNote,this.ve.pitch,this.ve.curNote.pitches.length)),this._.record(e),this.Ue(this.ve.curNote)}else 1==this.ve.curNote.pitches.length?this._.record(new t.ChangeNoteAdded(this._,this.Qt,this.ve.curNote,this.ve.curIndex,!0)):this._.record(new t.ChangePitchAdded(this._,this.ve.curNote,this.ve.pitch,this.ve.curNote.pitches.indexOf(this.ve.pitch),!0))}this.re=!1,this.ae=!1,this.De(),this.Ze()}),this.je=(()=>{const e=this._.getCurrentPattern();this.Qt!=e&&(this.He(null),this.ge=null),this.Qt=e,this.ze=this._.showLetters?this._.showScrollBar?460:480:this._.showScrollBar?492:512,this.Ve=this.ze/(this._.song.beatsPerBar*t.Config.partsPerBeat),this.Oe=this._.song.getChannelIsNoise(this._.channel)?this.se:this.ie,this.Ge=this._.song.getChannelIsNoise(this._.channel)?t.Config.drumCount:t.Config.windowPitchCount,this.Me=12*this._.song.channels[this._.channel].octave,this.Ce==this._.song.rhythm&&this.Pe==this._.song.pitchChannelCount&&this.Ne==this._.song.noiseChannelCount||(this.Ce=this._.song.rhythm,this.Pe=this._.song.pitchChannelCount,this.Ne=this._.song.noiseChannelCount,this.resetCopiedPins()),this.We=this.fe[this._.channel],this.ke!=this.ze&&(this.ke=this.ze,this.pt.setAttribute("viewBox","0 0 "+this.ze+" 481"),this.Kt.setAttribute("width",""+this.ze));const i=this.ze/this._.song.beatsPerBar;if(this.xe!=i){this.xe=i,this.Xt.setAttribute("width",""+i),this._t.setAttribute("width",""+i),this.oe.setAttribute("width",""+(i-2));for(let t=0;t<12;t++)this.ne[t].setAttribute("width",""+(i-2))}if(this.re||this.De(),this.$t=function(t){const e=t.cloneNode(!1);return t.parentNode.replaceChild(e,t),e}(this.$t),this.Ze(),this.Ee!=this._.showFifth){this.Ee=this._.showFifth;for(let e=1;e<t.ColorConfig.pitchBackgroundColors.length;e++)this.ne[e].setAttribute("fill",this._.showFifth?t.ColorConfig.pitchBackgroundColors[e]:"#393e4f")}for(let e=0;e<12;e++)this.ne[e].style.visibility=t.Config.scales[this._.song.scale].flags[e]?"visible":"hidden";if(this._.song.getChannelIsNoise(this._.channel)?this.Ae||(this.Ae=!0,this.Kt.setAttribute("fill","url(#patternEditorDrumBackground)"),this.Kt.setAttribute("height",""+this.se*t.Config.drumCount)):this.Ae&&(this.Ae=!1,this.Kt.setAttribute("fill","url(#patternEditorNoteBackground)"),this.Kt.setAttribute("height",""+this.kt)),this._.showChannels)for(let e=this._.song.getChannelCount()-1;e>=0;e--){if(e==this._.channel)continue;if(this._.song.getChannelIsNoise(e)!=this._.song.getChannelIsNoise(this._.channel))continue;const i=this._.song.getPattern(e,this._.bar);if(null!=i)for(const s of i.notes)for(const i of s.pitches){const n=t.SVG.path();n.setAttribute("fill",t.ColorConfig.getChannelColor(this._.song,e).noteDim),n.setAttribute("pointer-events","none"),this.Ye(n,i,s.start,s.pins,.19*this.Oe,!1,12*this._.song.channels[e].octave),this.$t.appendChild(n)}}if(null!=this.Qt)for(const e of this.Qt.notes)for(let i=0;i<e.pitches.length;i++){const s=e.pitches[i];let n=t.SVG.path();if(n.setAttribute("fill",t.ColorConfig.getChannelColor(this._.song,this._.channel).noteDim),n.setAttribute("pointer-events","none"),this.Ye(n,s,e.start,e.pins,this.Oe/2+1,!1,this.Me),this.$t.appendChild(n),(n=t.SVG.path()).setAttribute("fill",t.ColorConfig.getChannelColor(this._.song,this._.channel).noteBright),n.setAttribute("pointer-events","none"),this.Ye(n,s,e.start,e.pins,this.Oe/2+1,!0,this.Me),this.$t.appendChild(n),e.pitches.length>1){const n=this._.song.channels[this._.channel].instruments[this._.getCurrentInstrument()].getChord();if(!n.harmonizes||n.arpeggiates||n.strumParts>0){let n=t.SVG.text();n.setAttribute("x",""+t.prettyNumber(this.Ve*e.start+2)),n.setAttribute("y",""+t.prettyNumber(this.Je(s-this.Me))),n.setAttribute("width","30"),n.setAttribute("fill","#040410"),n.setAttribute("text-anchor","start"),n.setAttribute("dominant-baseline","central"),n.setAttribute("pointer-events","none"),n.textContent=""+(i+1),this.$t.appendChild(n)}}}});for(let e=0;e<12;e++){const i=(12-e)%12,s=t.SVG.rect();s.setAttribute("x","1"),s.setAttribute("y",""+(i*this.ie+1)),s.setAttribute("height",""+(this.ie-2)),s.setAttribute("fill",0==e?"#725491":"#393e4f"),this.Xt.appendChild(s),this.ne[e]=s}this.oe.setAttribute("x","1"),this.oe.setAttribute("y","1"),this.oe.setAttribute("height",""+(this.se-2)),this.oe.setAttribute("fill","#393e4f"),this._t.appendChild(this.oe),this._.notifier.watch(this.je),this.je(),this.De(),this.Ze(),window.requestAnimationFrame(this.Se),this.pt.addEventListener("mousedown",this.qt),document.addEventListener("mousemove",this.Fe),document.addEventListener("mouseup",this.He),this.pt.addEventListener("mouseover",this.Pt),this.pt.addEventListener("mouseout",this.Nt),this.pt.addEventListener("touchstart",this.Be),this.pt.addEventListener("touchmove",this.Ie),this.pt.addEventListener("touchend",this.He),this.pt.addEventListener("touchcancel",this.He),this.resetCopiedPins()}Re(){const e=t.Config.rhythms[this._.song.rhythm].stepsPerBeat;return e%4==0?t.Config.partsPerBeat/2:e%3==0?t.Config.partsPerBeat/3:e%2==0?t.Config.partsPerBeat/2:t.Config.partsPerBeat}Qe(){return t.Config.partsPerBeat/t.Config.rhythms[this._.song.rhythm].stepsPerBeat}Xe(t){const e=this.Qe();return Math.floor(t/e)*e}De(){if(this.ve=new e,this.he<0||this.he>this.ze||this.wt<0||this.wt>this.kt)return;const i=this.Qe(),s=this.he/this.Ve;if(this.ve.part=Math.floor(Math.max(0,Math.min(this._.song.beatsPerBar*t.Config.partsPerBeat-i,s))/i)*i,null!=this.Qt)for(const t of this.Qt.notes)if(t.end<=s)this.ve.prevNote=t,this.ve.curIndex++;else if(t.start<=s&&t.end>s)this.ve.curNote=t;else if(t.start>s){this.ve.nextNote=t;break}let n=this._e(this.wt);if(null!=this.ve.curNote){this.ve.start=this.ve.curNote.start,this.ve.end=this.ve.curNote.end,this.ve.pins=this.ve.curNote.pins;let e,i=0,s=0,o=this.ve.curNote.pins[0];for(let t=1;t<this.ve.curNote.pins.length;t++){e=o,o=this.ve.curNote.pins[t];const n=this.Ve*(this.ve.curNote.start+e.time),h=this.Ve*(this.ve.curNote.start+o.time);if(this.he>h)continue;if(this.he<n)throw new Error;const r=(this.he-n)/(h-n),a=Math.sqrt(1/Math.sqrt(4)-Math.pow(r-.5,2))-.5,l=Math.abs(o.interval-e.interval);i=e.interval*(1-r)+o.interval*r,s=a*l+.95;break}let h=Number.MAX_VALUE,r=-Number.MAX_VALUE,a=Number.MAX_VALUE;for(const t of this.ve.curNote.pins){h>t.interval&&(h=t.interval),r<t.interval&&(r=t.interval);const e=Math.abs(this.ve.curNote.start+t.time-this.he/this.Ve);a>e&&(a=e,this.ve.nearPinIndex=this.ve.curNote.pins.indexOf(t))}if(n-=i,this.ve.pitch=this.Ke(n,-h,(this._.song.getChannelIsNoise(this._.channel)?t.Config.drumCount-1:t.Config.maxPitch)-r),!this._.song.getChannelIsNoise(this._.channel)){let t=s;for(let e=0;e<this.ve.curNote.pitches.length;e++){const i=Math.abs(this.ve.curNote.pitches[e]-n+.5);i>t||(t=i,this.ve.pitch=this.ve.curNote.pitches[e])}}for(let t=0;t<this.ve.curNote.pitches.length;t++)if(this.ve.curNote.pitches[t]==this.ve.pitch){this.ve.pitchIndex=t;break}}else{this.ve.pitch=this.Ke(n,0,t.Config.maxPitch);const e=this.We[this.We.length-1].time,i=Math.floor(this.ve.part/t.Config.partsPerBeat),s=this.Re(),o=this.ve.part%t.Config.partsPerBeat;if(1==e)this.ve.start=this.ve.part;else if(e>t.Config.partsPerBeat)this.ve.start=i*t.Config.partsPerBeat;else if(e==t.Config.partsPerBeat)this.ve.start=i*t.Config.partsPerBeat,s<t.Config.partsPerBeat&&o>s&&(this.ve.start+=Math.floor(o/s)*s);else{this.ve.start=i*t.Config.partsPerBeat;let n=t.Config.partsPerBeat%e==0?e:Math.min(e,s);for(;n<s&&t.Config.partsPerBeat%n!=0;)n++;this.ve.start+=Math.floor(o/n)*n}this.ve.end=this.ve.start+e;let h=0,r=this._.song.beatsPerBar*t.Config.partsPerBeat;if(null!=this.ve.prevNote&&(h=this.ve.prevNote.end),null!=this.ve.nextNote&&(r=this.ve.nextNote.start),this.ve.start<h?(this.ve.start=h,this.ve.end=this.ve.start+e,this.ve.end>r&&(this.ve.end=r)):this.ve.end>r&&(this.ve.end=r,this.ve.start=this.ve.end-e,this.ve.start<h&&(this.ve.start=h)),this.ve.end-this.ve.start==e)this.ve.pins=this.We;else{this.ve.pins=[];for(const e of this.We){if(!(e.time<=this.ve.end-this.ve.start)){this.ve.pins.push(t.makeNotePin(0,this.ve.end-this.ve.start,e.volume));break}if(this.ve.pins.push(t.makeNotePin(0,e.time,e.volume)),e.time==this.ve.end-this.ve.start)break}}}this.ve.valid=!0}_e(t){return Math.max(0,Math.min(this.Ge-1,this.Ge-t/this.Oe))+this.Me}Ke(e,i,s){e<i&&(e=i),e>s&&(e=s);const n=t.Config.scales[this._.song.scale].flags;if(n[Math.floor(e)%12]||this._.song.getChannelIsNoise(this._.channel))return Math.floor(e);{let t=Math.floor(e)+1,o=Math.floor(e)-1;for(;!n[t%12];)t++;for(;!n[o%12];)o--;if(t>s)return o<i?i:o;if(o<i)return t;let h=t,r=o+1;return t%12!=0&&t%12!=7||(h-=.5),o%12!=0&&o%12!=7||(r+=.5),e-r>h-e?t:o}}Ue(e){this.We=[];for(const i of e.pins)this.We.push(t.makeNotePin(0,i.time,i.volume));for(let t=1;t<this.We.length-1;)this.We[t-1].volume==this.We[t].volume&&this.We[t].volume==this.We[t+1].volume?this.We.splice(t,1):t++;this.fe[this._.channel]=this.We}Te(){this.re=!0,this.de=this.he,this.ue=this.wt,this.De(),this.Ze(),this.ge=new t.ChangeSequence,this._.setProspectiveChange(this.ge)}Le(){let e,i;const s=this._.lastChangeWas(this.ge);if(this.re&&this.ve.valid&&s){const s=this.Qe();if(!this.ae){const t=this.he-this.de,e=this.wt-this.ue;Math.sqrt(t*t+e*e)>5&&(this.ae=!0,this.le=Math.abs(t)>=Math.abs(e))}if(this.ae){null!=this.ge&&this.ge.undo();const n=this.Xe(this.he/this.Ve),o=new t.ChangeSequence;if(this.ge=o,this._.setProspectiveChange(this.ge),null==this.ve.curNote){let h,r;n<this.ve.start?(h=!0,r=this.ve.start-n):(h=!1,r=n-this.ve.start+s);let a=s;for(let e=s;e<=this._.song.beatsPerBar*t.Config.partsPerBeat;e+=s){if(1==s){if(e<5);else if(e<=t.Config.partsPerBeat/2){if(e%3!=0&&e%4!=0)continue}else if(e<=1.5*t.Config.partsPerBeat){if(e%6!=0&&e%8!=0)continue}else if(e%t.Config.partsPerBeat!=0)continue}else if(e>=5*s&&e%t.Config.partsPerBeat!=0&&e!=3*t.Config.partsPerBeat/4&&e!=3*t.Config.partsPerBeat/2&&e!=4*t.Config.partsPerBeat/3)continue;if(e==r){a=e;break}if(e<r&&(a=e),e>r){a<r-s&&(a=e);break}}if(h?e=(i=this.ve.start)-a:i=(e=this.ve.start)+a,e<0&&(e=0),i>this._.song.beatsPerBar*t.Config.partsPerBeat&&(i=this._.song.beatsPerBar*t.Config.partsPerBeat),e<i){o.append(new t.ChangeEnsurePatternExists(this._,this._.channel,this._.bar));const s=this._.getCurrentPattern();if(null==s)throw new Error;let n;for(o.append(new t.ChangeNoteTruncate(this._,s,e,i)),n=0;n<s.notes.length&&!(s.notes[n].start>=i);n++);const r=new t.Note(this.ve.pitch,e,i,6,this._.song.getChannelIsNoise(this._.channel));o.append(new t.ChangeNoteAdded(this._,s,r,n)),this.Ue(r),this.me=h?e:i,this.pe=this.ve.pitch,this.ye=r.pins[h?0:1].volume,this.be=!0}this.Qt=this._.getCurrentPattern()}else if(this.le){const n=(this.he-this.de)/this.Ve,h=this.ve.curNote.pins[this.ve.nearPinIndex];let r=Math.round((this.ve.curNote.start+h.time+n)/s)*s;if(r<0&&(r=0),r>this._.song.beatsPerBar*t.Config.partsPerBeat&&(r=this._.song.beatsPerBar*t.Config.partsPerBeat),null==this.Qt)throw new Error;r<=this.ve.curNote.start&&this.ve.nearPinIndex==this.ve.curNote.pins.length-1||r>=this.ve.curNote.end&&0==this.ve.nearPinIndex?(o.append(new t.ChangeNoteAdded(this._,this.Qt,this.ve.curNote,this.ve.curIndex,!0)),this.be=!1):(e=Math.min(this.ve.curNote.start,r),i=Math.max(this.ve.curNote.end,r),this.me=r,this.pe=this.ve.curNote.pitches[-1==this.ve.pitchIndex?0:this.ve.pitchIndex]+this.ve.curNote.pins[this.ve.nearPinIndex].interval,this.ye=this.ve.curNote.pins[this.ve.nearPinIndex].volume,this.be=!0,o.append(new t.ChangeNoteTruncate(this._,this.Qt,e,i,this.ve.curNote)),o.append(new t.ChangePinTime(this._,this.ve.curNote,this.ve.nearPinIndex,r)),this.Ue(this.ve.curNote))}else if(-1==this.ve.pitchIndex){const e=Math.max(this.ve.curNote.start,Math.min(this.ve.curNote.end,Math.round(this.he/(this.Ve*s))*s))-this.ve.curNote.start;let i,n=this.ve.curNote.pins[0],h=0,r=0;for(let s=1;s<this.ve.curNote.pins.length;s++){if(i=n,e>(n=this.ve.curNote.pins[s]).time)continue;if(e<i.time)throw new Error;const o=(e-i.time)/(n.time-i.time);h=Math.round(i.volume*(1-o)+n.volume*o+(this.ue-this.wt)/13),0==this.controlMode&&0==this._.alwaysFineNoteVol&&(h=2*Math.floor(h/2)),h<0&&(h=0),h>6&&(h=6),r=this.Ke(i.interval*(1-o)+n.interval*o+this.ve.curNote.pitches[0],0,t.Config.maxPitch)-this.ve.curNote.pitches[0];break}this.me=this.ve.curNote.start+e,this.pe=this.ve.curNote.pitches[-1==this.ve.pitchIndex?0:this.ve.pitchIndex]+r,this.ye=h,this.be=!0,o.append(new t.ChangeVolumeBend(this._,this.ve.curNote,e,h,r)),this.Ue(this.ve.curNote)}else{if(this.ye=this.ve.curNote.pins[this.ve.nearPinIndex].volume,null==this.Qt)throw new Error;let e,i;this.he>=this.de?(e=Math.max(this.ve.curNote.start,this.ve.part),i=n+s):(e=Math.min(this.ve.curNote.end,this.ve.part+s),i=n),i<0&&(i=0),i>this._.song.beatsPerBar*t.Config.partsPerBeat&&(i=this._.song.beatsPerBar*t.Config.partsPerBeat),i>this.ve.curNote.end&&o.append(new t.ChangeNoteTruncate(this._,this.Qt,this.ve.curNote.start,i,this.ve.curNote)),i<this.ve.curNote.start&&o.append(new t.ChangeNoteTruncate(this._,this.Qt,i,this.ve.curNote.end,this.ve.curNote));let h=Number.MAX_VALUE,r=-Number.MAX_VALUE;for(const t of this.ve.curNote.pitches)h>t&&(h=t),r<t&&(r=t);h-=this.ve.curNote.pitches[this.ve.pitchIndex],r-=this.ve.curNote.pitches[this.ve.pitchIndex];const a=this.Ke(this._e(this.wt),-h,(this._.song.getChannelIsNoise(this._.channel)?t.Config.drumCount-1:t.Config.maxPitch)-r);o.append(new t.ChangePitchBend(this._,this.ve.curNote,e,i,a,this.ve.pitchIndex)),this.Ue(this.ve.curNote),this.me=i,this.pe=a,this.be=!0}}}else this.De(),this.Ze()}Ze(){if(this.ce)if(this.re&&this.ve.valid&&this.ae&&this.be){this.ee.setAttribute("visibility","visible");const e=this.Ve*this.me,i=this.Je(this.pe-this.Me),s=this.Oe/2,n=80,o=60;let h="";h+="M "+t.prettyNumber(e)+" "+t.prettyNumber(i-s*(this.ye/6))+" ",h+="L "+t.prettyNumber(e)+" "+t.prettyNumber(i-s*(this.ye/6)-o)+" ",h+="M "+t.prettyNumber(e)+" "+t.prettyNumber(i+s*(this.ye/6))+" ",h+="L "+t.prettyNumber(e)+" "+t.prettyNumber(i+s*(this.ye/6)+o)+" ",h+="M "+t.prettyNumber(e)+" "+t.prettyNumber(i-s*(this.ye/6))+" ",h+="L "+t.prettyNumber(e+n)+" "+t.prettyNumber(i-s*(this.ye/6))+" ",h+="M "+t.prettyNumber(e)+" "+t.prettyNumber(i+s*(this.ye/6))+" ",h+="L "+t.prettyNumber(e+n)+" "+t.prettyNumber(i+s*(this.ye/6))+" ",h+="M "+t.prettyNumber(e)+" "+t.prettyNumber(i-s*(this.ye/6))+" ",h+="L "+t.prettyNumber(e-n)+" "+t.prettyNumber(i-s*(this.ye/6))+" ",h+="M "+t.prettyNumber(e)+" "+t.prettyNumber(i+s*(this.ye/6))+" ",h+="L "+t.prettyNumber(e-n)+" "+t.prettyNumber(i+s*(this.ye/6))+" ",this.ee.setAttribute("d",h)}else this.ee.setAttribute("visibility","hidden");else this.Mt&&!this.re&&this.ve.valid?(this.ee.setAttribute("visibility","visible"),this.Ye(this.ee,this.ve.pitch,this.ve.start,this.ve.pins,this.Oe/2+1,!0,this.Me)):this.ee.setAttribute("visibility","hidden")}Ye(e,i,s,n,o,h,r){const a=this.Ve*(n[n.length-1].time+n[0].time),l=.5*Math.min(2,a-1);let c=n[0],f="M "+t.prettyNumber(this.Ve*(s+c.time)+l)+" "+t.prettyNumber(this.Je(i-r)+o*(h?c.volume/6:1))+" ";for(let e=1;e<n.length;e++){let a=c;c=n[e];let d=this.Ve*(s+a.time)+(1==e?l:0),u=this.Ve*(s+c.time)-(e==n.length-1?l:0),m=this.Je(i+a.interval-r),p=this.Je(i+c.interval-r),y=h?a.volume/6:1,b=h?c.volume/6:1;f+="L "+t.prettyNumber(d)+" "+t.prettyNumber(m-o*y)+" ",a.interval>c.interval&&(f+="L "+t.prettyNumber(d+1)+" "+t.prettyNumber(m-o*y)+" "),a.interval<c.interval&&(f+="L "+t.prettyNumber(u-1)+" "+t.prettyNumber(p-o*b)+" "),f+="L "+t.prettyNumber(u)+" "+t.prettyNumber(p-o*b)+" "}for(let e=n.length-2;e>=0;e--){let a=c;c=n[e];let d=this.Ve*(s+a.time)-(e==n.length-2?l:0),u=this.Ve*(s+c.time)+(0==e?l:0),m=this.Je(i+a.interval-r),p=this.Je(i+c.interval-r),y=h?a.volume/6:1,b=h?c.volume/6:1;f+="L "+t.prettyNumber(d)+" "+t.prettyNumber(m+o*y)+" ",a.interval<c.interval&&(f+="L "+t.prettyNumber(d-1)+" "+t.prettyNumber(m+o*y)+" "),a.interval>c.interval&&(f+="L "+t.prettyNumber(u+1)+" "+t.prettyNumber(p+o*b)+" "),f+="L "+t.prettyNumber(u)+" "+t.prettyNumber(p+o*b)+" "}f+="z",e.setAttribute("d",f)}Je(t){return this.Oe*(this.Ge-t-.5)}}}(beepbox||(beepbox={})),function(t){class e{constructor(e,i,s,n){this.$e=document.createTextNode("1"),this.ti=t.SVG.text({x:16,y:23,"font-family":"sans-serif","font-size":20,"text-anchor":"middle","font-weight":"bold",fill:"red"},this.$e),this.lt=t.SVG.rect({width:30,height:30,x:1,y:1}),this.container=t.SVG.svg(this.lt,this.ti),this.ei=1,this.ii=!0,this.si=!1,this.ni="",this.container.setAttribute("x",""+32*i),this.container.setAttribute("y",""+(t.Config.barEditorHeight+32*s)),this.lt.setAttribute("fill","#393e4f"),this.ti.setAttribute("fill",n)}setSquashed(e,i){e?(this.container.setAttribute("y",""+(t.Config.barEditorHeight+27*i)),this.lt.setAttribute("height","25"),this.ti.setAttribute("y","21")):(this.container.setAttribute("y",""+(t.Config.barEditorHeight+32*i)),this.lt.setAttribute("height","30"),this.ti.setAttribute("y","23"))}setIndex(t,e,i,s,n,o){this.ei!=t&&(this.si||0==t==(0==this.ei)||(0==t?this.lt.setAttribute("fill","none"):o?this.lt.setAttribute("fill",e?"#161313":"#3d3535"):this.lt.setAttribute("fill",e?"#1c1d28":"#393e4f")),this.ei=t,this.$e.data=""+t),this.ii==e&&this.ni==n||(this.ii=e,i?this.ti.setAttribute("fill","#040410"):(this.ti.setAttribute("fill",n),0==this.ei?this.lt.setAttribute("fill","#040410"):o?this.lt.setAttribute("fill",e?"#161313":"#3d3535"):this.lt.setAttribute("fill",e?"#1c1d28":"#393e4f"))),this.si==i&&this.ni==n||(this.si=i,i?(this.lt.setAttribute("fill",n),this.ti.setAttribute("fill","#040410")):(this.ti.setAttribute("fill",n),0==this.ei?this.lt.setAttribute("fill","#040410"):o?this.lt.setAttribute("fill",e?"#161313":"#3d3535"):this.lt.setAttribute("fill",e?"#1c1d28":"#393e4f"))),this.ni=n}}t.TrackEditor=class{constructor(e,i){this._=e,this.oi=i,this.at=32,this.bt=t.HTML.select({style:"width: 32px; height: "+t.Config.barEditorHeight+"px; position:absolute; opacity:0"},t.HTML.option({value:"barBefore"},"Insert Bar Before"),t.HTML.option({value:"barAfter"},"Insert Bar After"),t.HTML.option({value:"deleteBar"},"Delete This Bar")),this.hi=t.SVG.g(),this.ri=t.SVG.rect({fill:"white",x:0,y:0,width:4,height:128}),this.ai=t.SVG.rect({fill:"none",stroke:"white","stroke-width":2,"pointer-events":"none",x:1,y:1,width:30,height:30}),this.li=t.SVG.path({fill:"040410",stroke:"040410","stroke-width":1,"pointer-events":"none"}),this.ci=t.SVG.path({fill:"040410",stroke:"040410","stroke-width":1,"pointer-events":"none"}),this.yt=t.SVG.path({fill:"#393e4f",stroke:"#393e4f","stroke-width":1,"pointer-events":"none"}),this.fi=t.SVG.rect({class:"dashed-line dash-move",fill:"#044B94","stroke-width":"2",stroke:"#3030fb","stroke-dasharray":"5, 3","fill-opacity":"0.4"}),this.pt=t.SVG.svg({style:"background-color: #040410; position: absolute;",height:128},this.hi,this.yt,this.fi,this.ai,this.li,this.ci,this.ri),this.di=t.HTML.select({className:"trackSelectBox",style:"width: 32px; height: 32px; background: none; border: none; appearance: none; color: transparent; position: absolute;"}),this.container=t.HTML.div({style:"height: 128px; position: relative; overflow:hidden;"},this.pt,this.di,this.bt),this.ui=[],this.he=0,this.wt=0,this.mi=0,this.pi=0,this.yi=0,this.bi=0,this.Mt=!1,this.gi=!1,this.ae=!1,this.vi="",this.wi="",this.kt=128,this.xt=32,this.Mi=0,this.ki=0,this.xi=1,this.Ei=1,this.Et=0,this.Ai=0,this.Ci=0,this.Pi=-1,this.At=!1,this.Ni=t.isMobile,this.qi=null,this.Ri=0,this.Si=(t=>{this.Ri=Math.floor(Math.min(this._.song.barCount-1,Math.max(0,this.he/this.at)))}),this.Ct=(t=>{var e="barBefore"==this.bt.value?0:1;"barBefore"==this.bt.value||"barAfter"==this.bt.value?(this._.bar=this.Ri-1+e,this.zi(),this.insertBars(),this._.synth.playhead>=this.Ri+e&&this._.synth.playhead++):"deleteBar"==this.bt.value&&(this._.bar=this.Ri,this.zi(),this.deleteBars(),this._.synth.playhead>this.Ri&&this._.synth.playhead--),this.bt.selectedIndex=-1}),this.Ti=(()=>{this.Bi(this.di.selectedIndex)}),this.Se=(t=>{const e=this.at*this._.synth.playhead-2;this.Pi!=e&&(this.Pi=e,this.ri.setAttribute("x",""+e)),window.requestAnimationFrame(this.Se)}),this.Fi=(t=>{this.gi=!0,this.ae=!0,this.Li(t),this.mi=this.yi,this.pi=this.bi}),this.Ii=(t=>{this.Li(t),this.mi==this.yi&&this.pi==this.bi||t.preventDefault(),this.gi&&this.Hi(),this.Ze()}),this.Ui=(t=>{this.gi=!1,this.ae=!1,this.Ze()}),this.Pt=(t=>{this.Mt||(this.Mt=!0)}),this.Nt=(t=>{this.Mt&&(this.Mt=!1)}),this.qt=(e=>{e.preventDefault(),this.gi=!0,this.ae=!1,this.Di(e),this.mi=this.yi,this.pi=this.bi,this.wt>=t.Config.barEditorHeight&&(this._.channel==this.bi&&this._.bar==this.yi||(this.Zi(this.bi,this.yi),this.ae=!0),this.zi())}),this.Fe=(t=>{this.Di(t),this.gi&&(this.mi==this.yi&&this.pi==this.bi||(this.ae=!0),this.Hi()),this.Ze()}),this.ji=(e=>{if(this.gi&&!this.ae&&this._.channel==this.bi&&this._.bar==this.yi){const e=(this.wt-t.Config.barEditorHeight)%this.xt<this.xt/2,i=this._.song.patternsPerChannel;this.Bi((this._.song.channels[this.bi].bars[this.yi]+(e?1:i))%(i+1))}this.gi=!1,this.ae=!1,this.Ze()}),window.requestAnimationFrame(this.Se),this.pt.addEventListener("mousedown",this.qt),document.addEventListener("mousemove",this.Fe),document.addEventListener("mouseup",this.ji),this.pt.addEventListener("mouseover",this.Pt),this.pt.addEventListener("mouseout",this.Nt),this.di.addEventListener("change",this.Ti),this.di.addEventListener("touchstart",this.Fi),this.di.addEventListener("touchmove",this.Ii),this.di.addEventListener("touchend",this.Ui),this.di.addEventListener("touchcancel",this.Ui);let s=!1;document.addEventListener("mousedown",()=>{s||(this.Ni=!1,this.Ze()),s=!0},!0),document.addEventListener("touchstart",()=>{s||(this.Ni=!0,this.Ze()),s=!0},!0),this.bt.selectedIndex=-1,this.bt.addEventListener("change",this.Ct),this.bt.addEventListener("mousedown",this.Si)}hasASelection(){return this.xi>1||this.Ei>1}Vi(){this._.notifier.changed(),this.vi="",this._.forgetLastChange()}Zi(e,i){new t.ChangeChannelBar(this._,e,i),this.Vi()}Bi(e){this._.record(new t.ChangePatternNumbers(this._,e,this.Mi,this.ki,this.xi,this.Ei))}onKeyPressed(t){switch(t.keyCode){case 27:this.zi(),this.Zi(this._.channel,this._.bar),t.preventDefault();break;case 38:this.Zi((this._.channel-1+this._.song.getChannelCount())%this._.song.getChannelCount(),this._.bar),this.zi(),t.preventDefault();break;case 40:this.Zi((this._.channel+1)%this._.song.getChannelCount(),this._.bar),this.zi(),t.preventDefault();break;case 37:this.Zi(this._.channel,(this._.bar+this._.song.barCount-1)%this._.song.barCount),this.zi(),t.preventDefault();break;case 39:this.Zi(this._.channel,(this._.bar+1)%this._.song.barCount),this.zi(),t.preventDefault();break;case 46:this.vi="",this.Oi("0",!1),t.preventDefault();break;case 48:this.Oi("0",t.shiftKey||t.ctrlKey),t.preventDefault();break;case 49:this.Oi("1",t.shiftKey||t.ctrlKey),t.preventDefault();break;case 50:this.Oi("2",t.shiftKey||t.ctrlKey),t.preventDefault();break;case 51:this.Oi("3",t.shiftKey||t.ctrlKey),t.preventDefault();break;case 52:this.Oi("4",t.shiftKey||t.ctrlKey),t.preventDefault();break;case 53:this.Oi("5",t.shiftKey||t.ctrlKey),t.preventDefault();break;case 54:this.Oi("6",t.shiftKey||t.ctrlKey),t.preventDefault();break;case 55:this.Oi("7",t.shiftKey||t.ctrlKey),t.preventDefault();break;case 56:this.Oi("8",t.shiftKey||t.ctrlKey),t.preventDefault();break;case 57:this.Oi("9",t.shiftKey||t.ctrlKey),t.preventDefault();break;default:this.vi="",this.wi=""}}insertBars(){this._.record(new t.ChangeInsertBars(this._,this.Mi+this.xi,this.xi),"jump"),this.Mi+=this.xi}deleteBars(){this._.record(new t.ChangeDeleteBars(this._,this.Mi,this.xi),"jump"),this.Mi=Math.max(0,this.Mi-this.xi)}*Gi(){for(let t=this.ki;t<this.ki+this.Ei;t++)yield t}*Wi(){for(let t=this.Mi;t<this.Mi+this.xi;t++)yield t}*Yi(){for(let t=0;t<this._.song.barCount;t++)(t<this.Mi||t>=this.Mi+this.xi)&&(yield t)}*Ji(t){const e={};for(const i of this.Wi()){const s=this._.song.channels[t].bars[i];if(0==s)continue;if(e[String(s)])continue;e[String(s)]=!0;const n=this._.song.getPattern(t,i);if(null==n)throw new Error;yield n}}Qi(t,e){for(let i=0;i<this._.song.barCount;i++)if(this._.song.channels[t].bars[i]==e)return!1;return!0}copy(){const t=[];for(const e of this.Gi()){const i={},s=[];for(const t of this.Wi()){const n=this._.song.channels[e].bars[t];if(s.push(n),void 0==i[String(n)]){const s=this._.song.getPattern(e,t);let o=0,h=[];null!=s&&(o=s.instrument,h=s.notes),i[String(n)]={instrument:o,notes:h}}}const n={isNoise:this._.song.getChannelIsNoise(e),patterns:i,bars:s};t.push(n)}const e={beatsPerBar:this._.song.beatsPerBar,channels:t};window.localStorage.setItem("selectionCopy",JSON.stringify(e))}pasteNotes(){const e=JSON.parse(String(window.localStorage.getItem("selectionCopy")));if(null==e)return;const i=e.channels||[],s=e.beatsPerBar>>>0,n=new t.ChangeGroup,o=this.xi>1||this.Ei>1,h=o?this.Ei:Math.min(i.length,this._.song.getChannelCount()-this.ki);for(let e=0;e<h;e++){const h=i[e%i.length],r=this.ki+e,a=!!h.isNoise,l=h.patterns||{},c=h.bars||[];if(0==c.length)continue;if(a!=this._.song.getChannelIsNoise(r))continue;const f=o?this.xi:Math.min(c.length,this._.song.barCount-this.Mi);if(o||1!=c.length||1!=i.length){for(let e=0;e<f;e++){const i=this.Mi+e,s=this._.song.channels[r].bars[i];0!=s&&(n.append(new t.ChangePatternNumbers(this._,0,i,r,1,1)),this.Qi(r,s)&&(this._.song.channels[r].patterns[s-1].notes.length=0))}const e={};for(let i=0;i<f;i++){const o=c[i%c.length]>>>0;if(0==o)continue;const h=this.Mi+i;if(void 0!=e[String(o)])n.append(new t.ChangePatternNumbers(this._,e[String(o)],h,r,1,1));else{const i=l[String(o)],a=Math.min(i.instrument>>>0,this._.song.instrumentsPerChannel-1),c=this._.song.channels[r].patterns[o-1];if(void 0!=c&&t.comparePatternNotes(i.notes,c.notes)&&a==c.instrument)n.append(new t.ChangePatternNumbers(this._,o,h,r,1,1));else{void 0!=c&&this.Qi(r,o)?n.append(new t.ChangePatternNumbers(this._,o,h,r,1,1)):n.append(new t.ChangeEnsurePatternExists(this._,r,h));const e=this._.song.getPattern(r,h);if(null==e)throw new Error;n.append(new t.ChangePaste(this._,e,i.notes,s)),n.append(new t.ChangePatternInstrument(this._,a,e))}e[String(o)]=this._.song.channels[r].bars[h]}}}else{const e=c[0]>>>0,i=this.Mi,o=this._.song.channels[r].bars[i];if(0==e&&0==o)continue;const h=l[String(e)],a=Math.min(h.instrument>>>0,this._.song.instrumentsPerChannel-1);if(0==o){const s=this._.song.channels[r].patterns[e-1];void 0!=s&&(t.comparePatternNotes(h.notes,s.notes)&&a==s.instrument||this.Qi(r,e))?n.append(new t.ChangePatternNumbers(this._,e,i,r,1,1)):n.append(new t.ChangeEnsurePatternExists(this._,r,i))}const f=this._.song.getPattern(r,i);if(null==f)throw new Error;n.append(new t.ChangePaste(this._,f,h.notes,s)),n.append(new t.ChangePatternInstrument(this._,a,f))}}this._.record(n)}pasteNumbers(){const e=JSON.parse(String(window.localStorage.getItem("selectionCopy")));if(null==e)return;const i=e.channels||[],s=new t.ChangeGroup,n=this.xi>1||this.Ei>1,o=n?this.Ei:Math.min(i.length,this._.song.getChannelCount()-this.ki);for(let e=0;e<o;e++){const o=i[e%i.length],h=this.ki+e,r=o.bars||[];if(0==r.length)continue;const a=n?this.xi:Math.min(r.length,this._.song.barCount-this.Mi);for(let e=0;e<a;e++){const i=r[e%r.length]>>>0,n=this.Mi+e;i>this._.song.patternsPerChannel&&s.append(new t.ChangePatternsPerChannel(this._,i)),s.append(new t.ChangePatternNumbers(this._,i,n,h,1,1))}}this._.record(s)}selectAll(){0==this.Mi&&0==this.ki&&this.xi==this._.song.barCount&&this.Ei==this._.song.getChannelCount()?this.zi():(this.Mi=0,this.ki=0,this.xi=this._.song.barCount,this.Ei=this._.song.getChannelCount()),this.Vi()}selectChannel(){0==this.Mi&&this.xi==this._.song.barCount?(this.Mi=this._.bar,this.xi=1):(this.Mi=0,this.xi=this._.song.barCount),this.Vi()}duplicatePatterns(){const e=new t.ChangeGroup;for(const i of this.Gi()){const s={};for(const n of this.Wi()){const o=this._.song.channels[i].bars[n];if(0!=o){if(void 0==s[String(o)]){let h=!1;for(const t of this.Yi())if(this._.song.channels[i].bars[t]==o){h=!0;break}if(h){const h=this._.song.getPattern(i,n);e.append(new t.ChangePatternNumbers(this._,0,n,i,1,1)),e.append(new t.ChangeEnsurePatternExists(this._,i,n));const r=this._.song.getPattern(i,n);if(null==r)throw new Error;e.append(new t.ChangePaste(this._,r,h.notes,this._.song.beatsPerBar)),e.append(new t.ChangePatternInstrument(this._,h.instrument,r)),s[String(o)]=this._.song.channels[i].bars[n]}else s[String(o)]=o}e.append(new t.ChangePatternNumbers(this._,s[String(o)],n,i,1,1))}}}this._.record(e)}forceRhythm(){const e=new t.ChangeGroup;for(const i of this.Gi())for(const s of this.Ji(i))e.append(new t.ChangePatternRhythm(this._,s));this._.record(e)}forceScale(){const e=new t.ChangeGroup,i=[!0,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1];for(const e of this.Gi())if(!this._.song.getChannelIsNoise(e))for(const s of this.Ji(e))t.unionOfUsedNotes(s,i);const s=t.generateScaleMap(i,this._.song.scale);for(const i of this.Gi())if(!this._.song.getChannelIsNoise(i))for(const n of this.Ji(i))e.append(new t.ChangePatternScale(this._,n,s));this._.record(e)}transpose(e,i){const s=this._.lastChangeWas(this.qi),n=new t.ChangeGroup;this.qi=n;for(const s of this.Gi())for(const o of this.Ji(s))n.append(new t.ChangeTranspose(this._,s,o,e,!1,i));this._.record(n,s?"replace":"push")}setInstrument(e){const i=new t.ChangeGroup;for(const s of this.Gi())for(const n of this.Ji(s))i.append(new t.ChangePatternInstrument(this._,e,n));this._.record(i)}Oi(e,i){if(i){this.wi+=e;var s=parseInt(this.wi);if(0!=s&&s<=this._.song.instrumentsPerChannel)return void this.oi.changeInstrument(s-1);if(this.wi=e,0!=(s=parseInt(this.wi))&&s<=this._.song.instrumentsPerChannel)return void this.oi.changeInstrument(s-1);this.wi=""}else{this.vi+=e;let i=parseInt(this.vi);if(i<=this._.song.patternsPerChannel){if(this.hasASelection()){var n=new t.ChangeGroup;this._.record(n,"push")}else this.Bi(i);return}if(this.vi=e,(i=parseInt(this.vi))<=this._.song.patternsPerChannel)return void(this.hasASelection()?(n=new t.ChangeGroup,this._.record(n,"push")):this.Bi(i));this.vi=""}}zi(){this.Mi=this._.bar,this.ki=this._.channel,this.xi=1,this.Ei=1}Hi(){this.Mi=Math.min(this.mi,this.yi),this.ki=Math.min(this.pi,this.bi),this.xi=Math.abs(this.mi-this.yi)+1,this.Ei=Math.abs(this.pi-this.bi)+1,this.Vi()}Li(e){const i=this.pt.getBoundingClientRect();this.he=e.touches[0].clientX-i.left,this.wt=e.touches[0].clientY-i.top,isNaN(this.he)&&(this.he=0),isNaN(this.wt)&&(this.wt=0),this.yi=Math.floor(Math.min(this._.song.barCount-1,Math.max(0,this.he/this.at))),this.bi=Math.floor(Math.min(this._.song.getChannelCount()-1,Math.max(0,this.wt/this.xt-t.Config.barEditorHeight)))}Di(t){const e=this.pt.getBoundingClientRect();this.he=(t.clientX||t.pageX)-e.left,this.wt=(t.clientY||t.pageY)-e.top,this.yi=Math.floor(Math.min(this._.song.barCount-1,Math.max(0,this.he/this.at))),this.bi=Math.floor(Math.min(this._.song.getChannelCount()-1,Math.max(0,this.wt/this.xt)))}Ze(){let e=this.bi,i=this.yi;this.Ni&&(i=this._.bar,e=this._.channel);const s=i==this._.bar&&e==this._.channel,n=this.wt>=t.Config.barEditorHeight;if(this.Mt&&!this.gi&&!s&&n?(this.ai.setAttribute("x",""+(1+this.at*i)),this.ai.setAttribute("y",""+(1+t.Config.barEditorHeight+this.xt*e)),this.ai.setAttribute("height",""+(this.xt-2)),this.ai.style.visibility="visible"):(this.Mt||this.he>=32*i&&this.he<32*i+32&&this.wt>0)&&!n?(this.ai.setAttribute("x",""+(1+this.at*i)),this.ai.setAttribute("y","1"),this.ai.setAttribute("height",""+(t.Config.barEditorHeight-3)),this.ai.style.visibility="visible"):this.ai.style.visibility="hidden",(this.Mt||this.Ni)&&s&&n){const s=(this.wt-t.Config.barEditorHeight)%this.xt<this.xt/2,n=this.at*(i+.8),o=t.Config.barEditorHeight+this.xt*(e+.5),h=.1*this.xt,r=.4*this.xt,a=.175*this.xt;this.li.setAttribute("fill",s&&!this.Ni?"#fff":"#040410"),this.ci.setAttribute("fill",s||this.Ni?"#040410":"#fff"),this.li.setAttribute("d",`M ${n} ${o-r} L ${n+a} ${o-h} L ${n-a} ${o-h} z`),this.ci.setAttribute("d",`M ${n} ${o+r} L ${n+a} ${o+h} L ${n-a} ${o+h} z`),this.li.style.visibility="visible",this.ci.style.visibility="visible"}else this.li.style.visibility="hidden",this.ci.style.visibility="hidden";this.fi.style.left=this.at*this._.bar+"px",this.fi.style.top=t.Config.barEditorHeight+this.xt*this._.channel+"px",this.di.style.left=this.at*this._.bar+"px",this.di.style.top=t.Config.barEditorHeight+this.xt*this._.channel+"px",this.di.style.height=this.xt+"px",this.bt.style.left=this.at*i+"px",this.bt.style.top="0px";const o=this._.song.patternsPerChannel+1;for(let e=this.Ci;e<o;e++)this.di.appendChild(t.HTML.option({value:e},e));for(let t=o;t<this.Ci;t++)this.di.removeChild(this.di.lastChild);this.Ci=o;const h=this._.song.channels[this._.channel].bars[this._.bar];this.di.selectedIndex!=h&&(this.di.selectedIndex=h)}render(){const i=!(window.innerWidth>700)||this._.song.getChannelCount()>4||this._.song.barCount>this._.trackVisibleBars&&this._.song.getChannelCount()>3;if(this.xt=i?27:32,this.Et!=this._.song.getChannelCount()){for(let s=this.Et;s<this._.song.getChannelCount();s++){this.ui[s]=[];for(let n=0;n<this.Ai;n++){const o=new e(s,n,s,t.ColorConfig.getChannelColor(this._.song,s).channelDim);o.setSquashed(i,s),this.hi.appendChild(o.container),this.ui[s][n]=o}}for(let t=this._.song.getChannelCount();t<this.Et;t++)for(let e=0;e<this.Ai;e++)this.hi.removeChild(this.ui[t][e].container);this.ui.length=this._.song.getChannelCount(),this.gi=!1}if(this.Ai!=this._.song.barCount){for(let s=0;s<this._.song.getChannelCount();s++){for(let n=this.Ai;n<this._.song.barCount;n++){const o=new e(s,n,s,t.ColorConfig.getChannelColor(this._.song,s).channelDim);o.setSquashed(i,s),this.hi.appendChild(o.container),this.ui[s][n]=o}for(let t=this._.song.barCount;t<this.Ai;t++)this.hi.removeChild(this.ui[s][t].container);this.ui[s].length=this._.song.barCount}var s="";for(let e=0;e<this._.song.barCount;e++){var n=32*e+2;s+=`M ${n} 1 H ${32*e+30} V ${t.Config.barEditorHeight-3} H ${n} V 1 Z `}this.yt.setAttribute("d",s),this.Ai=this._.song.barCount;const o=32*this._.song.barCount;this.container.style.width=o+"px",this.pt.setAttribute("width",o+""),this.gi=!1}if(this.At!=i){for(let t=0;t<this._.song.getChannelCount();t++)for(let e=0;e<this.Ai;e++)this.ui[t][e].setSquashed(i,t);this.gi=!1}this.At==i&&this.Et==this._.song.getChannelCount()||(this.At=i,this.Et=this._.song.getChannelCount(),this.kt=t.Config.barEditorHeight+this._.song.getChannelCount()*this.xt,this.pt.setAttribute("height",""+this.kt),this.ri.setAttribute("height",""+this.kt),this.container.style.height=this.kt+"px");for(let e=0;e<this._.song.getChannelCount();e++)for(let i=0;i<this.Ai;i++){const s=this._.song.getPattern(e,i),n=i==this._.bar&&e==this._.channel,o=null==s||0==s.notes.length,h=this.ui[e][i];if(i<this._.song.barCount){const s=t.ColorConfig.getChannelColor(this._.song,e);h.setIndex(this._.song.channels[e].bars[i],o,n,e,o&&!n?s.channelDim:s.channelBright,e>=this._.song.pitchChannelCount),h.container.style.visibility="visible"}else h.container.style.visibility="hidden"}this.di.style.display=this.Ni?"":"none",(!this._.synth.playing&&(this._.bar<this.Mi||this.Mi+this.xi<=this._.bar)||this._.channel<this.ki||this.ki+this.Ei<=this._.channel||this._.song.barCount<this.Mi+this.xi||this._.song.getChannelCount()<this.ki+this.Ei||1==this.xi&&1==this.Ei)&&this.zi(),this.xi>1||this.Ei>1?(this.fi.setAttribute("x",String(this.at*this.Mi+1)),this.fi.setAttribute("y",String(t.Config.barEditorHeight+this.xt*this.ki+1)),this.fi.setAttribute("width",String(this.at*this.xi-2)),this.fi.setAttribute("height",String(this.xt*this.Ei-2)),this.fi.setAttribute("visibility","visible")):this.fi.setAttribute("visibility","hidden"),this.Ze()}}}(beepbox||(beepbox={})),function(t){t.LoopEditor=class{constructor(e){this._=e,this.at=32,this.kt=20,this.Xi=0,this._i=1,this.Ki=2,this.$i=t.SVG.path({fill:"none",stroke:"#7744ff","stroke-width":4}),this.ts=t.SVG.path({fill:"white","pointer-events":"none"}),this.pt=t.SVG.svg({style:"background-color: #040410; touch-action: pan-y; position: absolute;",height:this.kt},this.$i,this.ts),this.container=t.HTML.div({style:"height: 20px; position: relative; margin: 5px 0;"},this.pt),this.es=null,this.ve={startBar:-1,mode:-1},this.he=0,this.ss=0,this.ns=0,this.os=!1,this.hs=!1,this.re=!1,this.Mt=!1,this.rs=-1,this.as=-1,this.Ai=0,this.Pt=(t=>{this.Mt||(this.Mt=!0,this.Ze())}),this.Nt=(t=>{this.Mt&&(this.Mt=!1,this.Ze())}),this.qt=(t=>{t.preventDefault(),this.re=!0;const e=this.pt.getBoundingClientRect();this.he=(t.clientX||t.pageX)-e.left,this.De(),this.Ze(),this.Fe(t)}),this.Be=(t=>{this.re=!0;const e=this.pt.getBoundingClientRect();this.he=t.touches[0].clientX-e.left,this.De(),this.Ze(),this.ss=t.touches[0].clientX,this.ns=t.touches[0].clientY,this.hs=!1,this.os=!1}),this.Fe=(t=>{const e=this.pt.getBoundingClientRect();this.he=(t.clientX||t.pageX)-e.left,this.Le()}),this.Ie=(t=>{if(!this.re)return;const e=this.pt.getBoundingClientRect();this.he=t.touches[0].clientX-e.left,this.hs||this.os||(Math.abs(t.touches[0].clientY-this.ns)>10?this.os=!0:Math.abs(t.touches[0].clientX-this.ss)>10&&(this.hs=!0)),this.hs&&(this.Le(),t.preventDefault())}),this.ls=(t=>{t.preventDefault(),this.os||(this.Le(),this.Mt=!1,this.He(t),this.Ze())}),this.He=(t=>{null!=this.es&&this._.record(this.es),this.es=null,this.re=!1,this.De(),this.cs()}),this.je=(()=>{this.cs()}),this.De(),this.cs(),this._.notifier.watch(this.je),this.container.addEventListener("mousedown",this.qt),document.addEventListener("mousemove",this.Fe),document.addEventListener("mouseup",this.He),this.container.addEventListener("mouseover",this.Pt),this.container.addEventListener("mouseout",this.Nt),this.container.addEventListener("touchstart",this.Be),this.container.addEventListener("touchmove",this.Ie),this.container.addEventListener("touchend",this.ls),this.container.addEventListener("touchcancel",this.ls)}De(){const t=this.he/this.at;this.ve.startBar=t,t>this._.song.loopStart-.25&&t<this._.song.loopStart+this._.song.loopLength+.25?t-this._.song.loopStart<.5*this._.song.loopLength?this.ve.mode=this.Xi:this.ve.mode=this._i:this.ve.mode=this.Ki}fs(t){let e=Math.round(t-this._.song.loopLength/2),i=e+this._.song.loopLength;return e<0&&(i-=e,e=0),i>this._.song.barCount&&(e-=i-this._.song.barCount,i=this._.song.barCount),{start:e,length:i-e}}Le(){if(this.re){let e=this._.song.loopStart,i=this._.song.loopStart+this._.song.loopLength;null!=this.es&&this._.lastChangeWas(this.es)&&(i=(e=this.es.oldStart)+this.es.oldLength);const s=this.he/this.at;let n,o,h;if(this.ve.mode==this.Xi)n=e+Math.round(s-this.ve.startBar),o=i,n<0&&(n=0),n>=this._.song.barCount&&(n=this._.song.barCount),n==o?n=o-1:n>o&&(h=n,n=o,o=h),this.es=new t.ChangeLoop(this._,e,i-e,n,o-n);else if(this.ve.mode==this._i)n=e,(o=i+Math.round(s-this.ve.startBar))<0&&(o=0),o>=this._.song.barCount&&(o=this._.song.barCount),o==n?o=n+1:o<n&&(h=n,n=o,o=h),this.es=new t.ChangeLoop(this._,e,i-e,n,o-n);else if(this.ve.mode==this.Ki){const n=this.fs(s);this.es=new t.ChangeLoop(this._,e,i-e,n.start,n.length)}this._.synth.jumpIntoLoop(),this._.autoFollow&&new t.ChangeChannelBar(this._,this._.channel,Math.floor(this._.synth.playhead),!0),this._.setProspectiveChange(this.es)}else this.De(),this.Ze()}Ze(){const t=this.Mt&&!this.re;if(this.ts.style.visibility=t?"visible":"hidden",t){const t=this.kt/2;let e=this._.song.loopStart*this.at,i=(this._.song.loopStart+this._.song.loopLength)*this.at;if(this.ve.mode==this.Xi)i=this._.song.loopStart*this.at+2*t;else if(this.ve.mode==this._i)e=(this._.song.loopStart+this._.song.loopLength)*this.at-2*t;else{const t=this.fs(this.ve.startBar);e=t.start*this.at,i=(t.start+t.length)*this.at}this.ts.setAttribute("d",`M ${e+t} 4 `+`L ${i-t} 4 `+`A ${t-4} ${t-4} 0 0 1 ${i-t} ${this.kt-4} `+`L ${e+t} ${this.kt-4} `+`A ${t-4} ${t-4} 0 0 1 ${e+t} 4 `+"z")}}cs(){const t=this.kt/2,e=this._.song.loopStart*this.at,i=(this._.song.loopStart+this._.song.loopLength)*this.at;if(this.Ai!=this._.song.barCount){this.Ai=this._.song.barCount;const t=32*this._.song.barCount;this.container.style.width=t+"px",this.pt.setAttribute("width",t+"")}this.rs==e&&this.as==i||(this.rs=e,this.as=i,this.$i.setAttribute("d",`M ${e+t} 2 `+`L ${i-t} 2 `+`A ${t-2} ${t-2} 0 0 1 ${i-t} ${this.kt-2} `+`L ${e+t} ${this.kt-2} `+`A ${t-2} ${t-2} 0 0 1 ${e+t} 2 `+"z")),this.Ze()}}}(beepbox||(beepbox={})),function(t){t.SpectrumEditor=class{constructor(e,i){this._=e,this.ds=i,this.ze=112,this.kt=26,this.us=t.SVG.path({fill:"#444444","pointer-events":"none"}),this.ms=t.SVG.svg({"pointer-events":"none"}),this.ps=t.SVG.svg({"pointer-events":"none"}),this.ys=t.SVG.path({fill:"none",stroke:"currentColor","stroke-width":2,"pointer-events":"none"}),this.bs=t.SVG.path({fill:"currentColor","pointer-events":"none"}),this.pt=t.SVG.svg({style:"background-color: #040410; touch-action: none; cursor: crosshair;",width:"100%",height:"100%",viewBox:"0 0 "+this.ze+" "+this.kt,preserveAspectRatio:"none"},this.us,this.ms,this.ps,this.ys,this.bs),this.container=t.HTML.div({className:"spectrum",style:"height: 2em;"},this.pt),this.he=0,this.wt=0,this.gs=0,this.vs=0,this.re=!1,this.es=null,this.ws="",this.Ee=!0,this.qt=(t=>{t.preventDefault(),this.re=!0;const e=this.pt.getBoundingClientRect();this.he=((t.clientX||t.pageX)-e.left)*this.ze/(e.right-e.left),this.wt=((t.clientY||t.pageY)-e.top)*this.kt/(e.bottom-e.top),isNaN(this.he)&&(this.he=0),isNaN(this.wt)&&(this.wt=0),this.gs=this.Ms(this.he),this.vs=this.ks(this.wt),this.Le()}),this.Be=(t=>{t.preventDefault(),this.re=!0;const e=this.pt.getBoundingClientRect();this.he=(t.touches[0].clientX-e.left)*this.ze/(e.right-e.left),this.wt=(t.touches[0].clientY-e.top)*this.kt/(e.bottom-e.top),isNaN(this.he)&&(this.he=0),isNaN(this.wt)&&(this.wt=0),this.gs=this.Ms(this.he),this.vs=this.ks(this.wt),this.Le()}),this.Fe=(t=>{if(null==this.container.offsetParent)return;const e=this.pt.getBoundingClientRect();this.he=((t.clientX||t.pageX)-e.left)*this.ze/(e.right-e.left),this.wt=((t.clientY||t.pageY)-e.top)*this.kt/(e.bottom-e.top),isNaN(this.he)&&(this.he=0),isNaN(this.wt)&&(this.wt=0),this.Le()}),this.Ie=(t=>{if(null==this.container.offsetParent)return;if(!this.re)return;t.preventDefault();const e=this.pt.getBoundingClientRect();this.he=(t.touches[0].clientX-e.left)*this.ze/(e.right-e.left),this.wt=(t.touches[0].clientY-e.top)*this.kt/(e.bottom-e.top),isNaN(this.he)&&(this.he=0),isNaN(this.wt)&&(this.wt=0),this.Le()}),this.He=(t=>{this.re&&(this._.record(this.es),this.es=null),this.re=!1});for(let e=0;e<t.Config.spectrumControlPoints;e+=t.Config.spectrumControlPointsPerOctave)this.ms.appendChild(t.SVG.rect({fill:"#886644",x:(e+1)*this.ze/(t.Config.spectrumControlPoints+2)-1,y:0,width:2,height:this.kt}));for(let e=4;e<=t.Config.spectrumControlPoints;e+=t.Config.spectrumControlPointsPerOctave)this.ps.appendChild(t.SVG.rect({fill:"#446688",x:(e+1)*this.ze/(t.Config.spectrumControlPoints+2)-1,y:0,width:2,height:this.kt}));this.container.addEventListener("mousedown",this.qt),document.addEventListener("mousemove",this.Fe),document.addEventListener("mouseup",this.He),this.container.addEventListener("touchstart",this.Be),this.container.addEventListener("touchmove",this.Ie),this.container.addEventListener("touchend",this.He),this.container.addEventListener("touchcancel",this.He)}Ms(e){return(t.Config.spectrumControlPoints+2)*e/this.ze-1}ks(e){return t.Config.spectrumMax*(1-(e-1)/(this.kt-2))}Le(){if(this.re){const e=this.Ms(this.he),i=this.ks(this.wt),s=this._.song.channels[this._.channel].instruments[this._.getCurrentInstrument()],n=null==this.ds?s.spectrumWave:s.drumsetSpectrumWaves[this.ds];if(e!=this.gs){const s=(i-this.vs)/(e-this.gs),o=this.vs-this.gs*s,h=Math.ceil(Math.min(this.gs,e)),r=Math.floor(Math.max(this.gs,e));for(let e=h;e<=r;e++)e<0||e>=t.Config.spectrumControlPoints||(n.spectrum[e]=Math.max(0,Math.min(t.Config.spectrumMax,Math.round(e*s+o))))}n.spectrum[Math.max(0,Math.min(t.Config.spectrumControlPoints-1,Math.round(e)))]=Math.max(0,Math.min(t.Config.spectrumMax,Math.round(i))),this.gs=e,this.vs=i,this.es=new t.ChangeSpectrum(this._,s,n),this._.setProspectiveChange(this.es)}}render(){const e=this._.song.channels[this._.channel].instruments[this._.getCurrentInstrument()],i=null==this.ds?e.spectrumWave:e.drumsetSpectrumWaves[this.ds],s=e=>(1-e/t.Config.spectrumMax)*(this.kt-1)+1;let n=0,o="M 0 "+t.prettyNumber(this.kt)+" ";for(let e=0;e<t.Config.spectrumControlPoints;e++){let h=i.spectrum[e];o+=0!=n||0!=h?"L ":"M ",o+=t.prettyNumber((e+1)*this.ze/(t.Config.spectrumControlPoints+2))+" "+t.prettyNumber(s(h))+" ",n=h}const h=s(n);n>0&&(o+="L "+(this.ze-1)+" "+t.prettyNumber(h)+" "),this.ws!=o&&(this.ws=o,this.ys.setAttribute("d",o),this.us.setAttribute("d",o+"L "+this.ze+" "+t.prettyNumber(h)+" L "+this.ze+" "+t.prettyNumber(this.kt)+" L 0 "+t.prettyNumber(this.kt)+" z "),this.bs.setAttribute("d","M "+this.ze+" "+t.prettyNumber(h)+" L "+(this.ze-4)+" "+t.prettyNumber(h-4)+" L "+(this.ze-4)+" "+t.prettyNumber(h+4)+" z"),this.bs.style.display=n>0?"":"none"),this.Ee!=this._.showFifth&&(this.Ee=this._.showFifth,this.ps.style.display=this._.showFifth?"":"none")}}}(beepbox||(beepbox={})),function(t){t.HarmonicsEditor=class{constructor(e){this._=e,this.ze=112,this.kt=26,this.ms=t.SVG.svg({"pointer-events":"none"}),this.ps=t.SVG.svg({"pointer-events":"none"}),this.ys=t.SVG.path({fill:"none",stroke:"currentColor","stroke-width":2,"pointer-events":"none"}),this.xs=[],this.Es=t.SVG.svg({"pointer-events":"none"}),this.pt=t.SVG.svg({style:"background-color: #040410; touch-action: none; cursor: crosshair;",width:"100%",height:"100%",viewBox:"0 0 "+this.ze+" "+this.kt,preserveAspectRatio:"none"},this.ms,this.ps,this.ys,this.Es),this.container=t.HTML.div({className:"harmonics",style:"height: 2em;"},this.pt),this.he=0,this.wt=0,this.gs=0,this.vs=0,this.re=!1,this.es=null,this.ws="",this.Ee=!0,this.qt=(t=>{t.preventDefault(),this.re=!0;const e=this.pt.getBoundingClientRect();this.he=((t.clientX||t.pageX)-e.left)*this.ze/(e.right-e.left),this.wt=((t.clientY||t.pageY)-e.top)*this.kt/(e.bottom-e.top),isNaN(this.he)&&(this.he=0),isNaN(this.wt)&&(this.wt=0),this.gs=this.Ms(this.he),this.vs=this.ks(this.wt),this.Le()}),this.Be=(t=>{t.preventDefault(),this.re=!0;const e=this.pt.getBoundingClientRect();this.he=(t.touches[0].clientX-e.left)*this.ze/(e.right-e.left),this.wt=(t.touches[0].clientY-e.top)*this.kt/(e.bottom-e.top),isNaN(this.he)&&(this.he=0),isNaN(this.wt)&&(this.wt=0),this.gs=this.Ms(this.he),this.vs=this.ks(this.wt),this.Le()}),this.Fe=(t=>{if(null==this.container.offsetParent)return;const e=this.pt.getBoundingClientRect();this.he=((t.clientX||t.pageX)-e.left)*this.ze/(e.right-e.left),this.wt=((t.clientY||t.pageY)-e.top)*this.kt/(e.bottom-e.top),isNaN(this.he)&&(this.he=0),isNaN(this.wt)&&(this.wt=0),this.Le()}),this.Ie=(t=>{if(null==this.container.offsetParent)return;if(!this.re)return;t.preventDefault();const e=this.pt.getBoundingClientRect();this.he=(t.touches[0].clientX-e.left)*this.ze/(e.right-e.left),this.wt=(t.touches[0].clientY-e.top)*this.kt/(e.bottom-e.top),isNaN(this.he)&&(this.he=0),isNaN(this.wt)&&(this.wt=0),this.Le()}),this.He=(t=>{this.re&&(this._.record(this.es),this.es=null),this.re=!1});for(let e=1;e<=t.Config.harmonicsControlPoints;e*=2)this.ms.appendChild(t.SVG.rect({fill:"#886644",x:(e-.5)*(this.ze-8)/(t.Config.harmonicsControlPoints-1)-1,y:0,width:2,height:this.kt}));for(let e=3;e<=t.Config.harmonicsControlPoints;e*=2)this.ps.appendChild(t.SVG.rect({fill:"#446688",x:(e-.5)*(this.ze-8)/(t.Config.harmonicsControlPoints-1)-1,y:0,width:2,height:this.kt}));for(let e=0;e<4;e++){const i=t.SVG.rect({fill:"currentColor",x:this.ze-2*e-1,y:0,width:1,height:this.kt});this.xs.push(i),this.Es.appendChild(i)}this.container.addEventListener("mousedown",this.qt),document.addEventListener("mousemove",this.Fe),document.addEventListener("mouseup",this.He),this.container.addEventListener("touchstart",this.Be),this.container.addEventListener("touchmove",this.Ie),this.container.addEventListener("touchend",this.He),this.container.addEventListener("touchcancel",this.He)}Ms(e){return(t.Config.harmonicsControlPoints-1)*e/(this.ze-8)-.5}ks(e){return t.Config.harmonicsMax*(1-e/this.kt)}Le(){if(this.re){const e=this.Ms(this.he),i=this.ks(this.wt),s=this._.song.channels[this._.channel].instruments[this._.getCurrentInstrument()],n=s.harmonicsWave;if(e!=this.gs){const s=(i-this.vs)/(e-this.gs),o=this.vs-this.gs*s,h=Math.ceil(Math.min(this.gs,e)),r=Math.floor(Math.max(this.gs,e));for(let e=h;e<=r;e++)e<0||e>=t.Config.harmonicsControlPoints||(n.harmonics[e]=Math.max(0,Math.min(t.Config.harmonicsMax,Math.round(e*s+o))))}n.harmonics[Math.max(0,Math.min(t.Config.harmonicsControlPoints-1,Math.round(e)))]=Math.max(0,Math.min(t.Config.harmonicsMax,Math.round(i))),this.gs=e,this.vs=i,this.es=new t.ChangeHarmonics(this._,s,n),this._.setProspectiveChange(this.es)}}render(){const e=this._.song.channels[this._.channel].instruments[this._.getCurrentInstrument()].harmonicsWave,i=e=>(1-e/t.Config.harmonicsMax)*this.kt;let s=t.prettyNumber(this.kt),n="";for(let o=0;o<t.Config.harmonicsControlPoints-1;o++){if(0==e.harmonics[o])continue;let h=t.prettyNumber((o+.5)*(this.ze-8)/(t.Config.harmonicsControlPoints-1));n+="M "+h+" "+s+" ",n+="L "+h+" "+t.prettyNumber(i(e.harmonics[o]))+" "}const o=i(e.harmonics[t.Config.harmonicsControlPoints-1]);for(let e=0;e<4;e++){const i=this.xs[e];i.setAttribute("y",t.prettyNumber(o)),i.setAttribute("height",t.prettyNumber(this.kt-o))}this.ws!=n&&(this.ws=n,this.ys.setAttribute("d",n)),this.Ee!=this._.showFifth&&(this.Ee=this._.showFifth,this.ps.style.display=this._.showFifth?"":"none")}}}(beepbox||(beepbox={})),function(t){t.BarScrollBar=class{constructor(e,i){this._=e,this.As=i,this.ze=512,this.kt=20,this.ri=t.SVG.rect("rect",{fill:"white",x:0,y:0,width:2,height:this.kt}),this.Cs=t.SVG.svg({"pointer-events":"none"}),this.Ps=t.SVG.rect({fill:"#393e4f",x:0,y:2,width:10,height:this.kt-4}),this.Ns=t.SVG.rect({fill:"none",stroke:"white","stroke-width":2,"pointer-events":"none",x:0,y:1,width:10,height:this.kt-2}),this.qs=t.SVG.path({fill:"white","pointer-events":"none"}),this.Rs=t.SVG.path({fill:"white","pointer-events":"none"}),this.Pi=-1,this.pt=t.SVG.svg({style:"background-color: #040410; touch-action: pan-y; position: absolute;",width:this.ze,height:this.kt},this.Cs,this.Ps,this.Ns,this.qs,this.Rs,this.ri),this.container=t.HTML.div({className:"barScrollBar",style:"width: 512px; height: 20px; overflow: hidden; position: relative;"},this.pt),this.he=0,this.re=!1,this.Mt=!1,this.Ss=!1,this.zs=-1,this.Ts=-1,this.Se=(t=>{const e=Math.min(512,Math.max(0,this.at*this._.synth.playhead-2));this.Pi!=e&&(this.Pi=e,this.ri.setAttribute("x",""+e)),window.requestAnimationFrame(this.Se)}),this.Bs=(t=>{this._.barScrollPos=this.As.scrollLeft/32}),this.Pt=(t=>{this.Mt||(this.Mt=!0,this.Ze())}),this.Nt=(t=>{this.Mt&&(this.Mt=!1,this.Ze())}),this.qt=(t=>{t.preventDefault(),this.re=!0;const e=this.pt.getBoundingClientRect();this.he=(t.clientX||t.pageX)-e.left,this.Ze(),this.he>=this._.barScrollPos*this.at&&this.he<=(this._.barScrollPos+this._.trackVisibleBars)*this.at&&(this.Ss=!0,this.Fs=this.he)}),this.Be=(t=>{t.preventDefault(),this.re=!0;const e=this.pt.getBoundingClientRect();this.he=t.touches[0].clientX-e.left,this.Ze(),this.he>=this._.barScrollPos*this.at&&this.he<=(this._.barScrollPos+this._.trackVisibleBars)*this.at&&(this.Ss=!0,this.Fs=this.he)}),this.Fe=(t=>{const e=this.pt.getBoundingClientRect();this.he=(t.clientX||t.pageX)-e.left,this.Le()}),this.Ie=(t=>{if(!this.re)return;t.preventDefault();const e=this.pt.getBoundingClientRect();this.he=t.touches[0].clientX-e.left,this.Le()}),this.He=(t=>{!this.Ss&&this.re&&(this.he<(this._.barScrollPos+8)*this.at?(this._.barScrollPos>0&&this._.barScrollPos--,this._.notifier.changed()):(this._.barScrollPos<this._.song.barCount-this._.trackVisibleBars&&this._.barScrollPos++,this._.notifier.changed())),this.re=!1,this.Ss=!1,this.Ze()});const s=.5*this.kt;this.qs.setAttribute("d",`M 9 ${s} L 20 ${s+6} L 20 ${s-6} z`),this.Rs.setAttribute("d",`M ${this.ze-9} ${s} L ${this.ze-20} ${s+6} L ${this.ze-20} ${s-6} z`),this.container.addEventListener("mousedown",this.qt),document.addEventListener("mousemove",this.Fe),document.addEventListener("mouseup",this.He),this.container.addEventListener("mouseover",this.Pt),this.container.addEventListener("mouseout",this.Nt),this.container.addEventListener("touchstart",this.Be),this.container.addEventListener("touchmove",this.Ie),this.container.addEventListener("touchend",this.He),this.container.addEventListener("touchcancel",this.He),window.requestAnimationFrame(this.Se),this.As.addEventListener("scroll",this.Bs,{capture:!1,passive:!0})}Le(){if(this.Ss){for(;this.he-this.Fs<.5*-this.at&&this._.barScrollPos>0;)this._.barScrollPos--,this.Fs-=this.at,this._.notifier.changed();for(;this.he-this.Fs>.5*this.at&&this._.barScrollPos<this._.song.barCount-this._.trackVisibleBars;)this._.barScrollPos++,this.Fs+=this.at,this._.notifier.changed()}this.Mt&&this.Ze()}changePos(t){for(;Math.abs(t)>=1;)t<0?this._.barScrollPos>0&&(this._.barScrollPos--,this.Fs+=this.at,this._.notifier.changed()):this._.barScrollPos<this._.song.barCount-this._.trackVisibleBars&&(this._.barScrollPos++,this.Fs+=this.at,this._.notifier.changed()),t+=t>0?-1:1}Ze(){let t=!1,e=!1,i=!1;this.Mt&&!this.re&&(this.he<this._.barScrollPos*this.at?t=!0:this.he>(this._.barScrollPos+this._.trackVisibleBars)*this.at?e=!0:i=!0),this.qs.style.visibility=t?"visible":"hidden",this.Rs.style.visibility=e?"visible":"hidden",this.Ns.style.visibility=i?"visible":"hidden"}render(){this.at=(this.ze-1)/Math.max(this._.trackVisibleBars,this._.song.barCount);const e=this.zs!=this._.song.barCount;if(e){for(this.zs=this._.song.barCount;this.Cs.firstChild;)this.Cs.removeChild(this.Cs.firstChild);for(let e=0;e<=this._.song.barCount;e++){const i=e%16==0?0:e%4==0?this.kt/8:this.kt/3;this.Cs.appendChild(t.SVG.rect({fill:"#393e4f",x:e*this.at-1,y:i,width:2,height:this.kt-2*i}))}}(e||this.Ts!=this._.barScrollPos)&&(this.Ts=this._.barScrollPos,this.Ps.setAttribute("x",""+this.at*this._.barScrollPos),this.Ps.setAttribute("width",""+this.at*this._.trackVisibleBars),this.Ns.setAttribute("x",""+this.at*this._.barScrollPos),this.Ns.setAttribute("width",""+this.at*this._.trackVisibleBars)),this.Ze(),this.As.scrollLeft=32*this._.barScrollPos}}}(beepbox||(beepbox={})),function(t){t.OctaveScrollBar=class{constructor(e){this._=e,this.ze=20,this.kt=481,this.Ls=4,this.Is=t.Config.pitchOctaves,this.Hs=(this.kt-this.Ls)/this.Is,this.Us=this.Hs*t.Config.windowOctaves+this.Ls,this.Ps=t.SVG.rect({fill:"#393e4f",x:2,y:0,width:this.ze-4,height:this.Us}),this.Ns=t.SVG.rect({fill:"none",stroke:"white","stroke-width":2,"pointer-events":"none",x:1,y:0,width:this.ze-2,height:this.Us}),this.li=t.SVG.path({fill:"white","pointer-events":"none"}),this.ci=t.SVG.path({fill:"white","pointer-events":"none"}),this.pt=t.SVG.svg({style:"background-color: #040410; touch-action: pan-x; position: absolute;",width:this.ze,height:"100%",viewBox:"0 0 20 481",preserveAspectRatio:"none"}),this.container=t.HTML.div({id:"octaveScrollBarContainer",style:"width: 20px; height: 100%; overflow: hidden; position: relative; flex-shrink: 0;"},this.pt),this.wt=0,this.re=!1,this.Mt=!1,this.Ss=!1,this.Ds=-1,this.es=null,this.Pt=(t=>{this.Mt||(this.Mt=!0,this.Ze())}),this.Nt=(t=>{this.Mt&&(this.Mt=!1,this.Ze())}),this.qt=(t=>{t.preventDefault(),this.re=!0;const e=this.pt.getBoundingClientRect();this.wt=((t.clientY||t.pageY)-e.top)*this.kt/(e.bottom-e.top),isNaN(this.wt)&&(this.wt=0),this._.song.getChannelIsNoise(this._.channel)||(this.Ze(),this.wt>=this.Zs-this.Us&&this.wt<=this.Zs&&(this.Ss=!0,this.es=null,this.Fs=this.wt))}),this.Be=(t=>{t.preventDefault(),this.re=!0;const e=this.pt.getBoundingClientRect();this.wt=(t.touches[0].clientY-e.top)*this.kt/(e.bottom-e.top),isNaN(this.wt)&&(this.wt=0),this._.song.getChannelIsNoise(this._.channel)||(this.Ze(),this.wt>=this.Zs-this.Us&&this.wt<=this.Zs&&(this.Ss=!0,this.es=null,this.Fs=this.wt))}),this.Fe=(t=>{const e=this.pt.getBoundingClientRect();this.wt=((t.clientY||t.pageY)-e.top)*this.kt/(e.bottom-e.top),isNaN(this.wt)&&(this.wt=0),this.Le()}),this.Ie=(t=>{if(!this.re)return;t.preventDefault();const e=this.pt.getBoundingClientRect();this.wt=(t.touches[0].clientY-e.top)*this.kt/(e.bottom-e.top),isNaN(this.wt)&&(this.wt=0),this.Le()}),this.He=(e=>{if(!this._.song.getChannelIsNoise(this._.channel)&&this.re)if(this.Ss)null!=this.es&&this._.record(this.es);else{const e=this._.lastChangeWas(this.es),i=e?this.es.oldValue:this._.song.channels[this._.channel].octave,s=this._.song.channels[this._.channel].octave;this.wt<this.Zs-.5*this.Us?s<t.Config.scrollableOctaves&&(this.es=new t.ChangeOctave(this._,i,s+1),this._.record(this.es,e?"replace":"push")):s>0&&(this.es=new t.ChangeOctave(this._,i,s-1),this._.record(this.es,e?"replace":"push"))}this.re=!1,this.Ss=!1,this.Ze()}),this.je=(()=>{this.Zs=this.kt-this.Hs*this._.song.channels[this._.channel].octave,this.cs()}),this._.notifier.watch(this.je),this.je(),this.pt.appendChild(this.Ps);for(let e=0;e<=this.Is;e++)this.pt.appendChild(t.SVG.rect({fill:"#725491",x:0,y:e*this.Hs,width:this.ze,height:this.Ls}));this.pt.appendChild(this.Ns),this.pt.appendChild(this.li),this.pt.appendChild(this.ci);const i=.5*this.ze;this.li.setAttribute("d",`M ${i} 9 L ${i+6} 20 L ${i-6} 20 z`),this.ci.setAttribute("d",`M ${i} ${this.kt-9} L ${i+6} ${this.kt-20} L ${i-6} ${this.kt-20} z`),this.container.addEventListener("mousedown",this.qt),document.addEventListener("mousemove",this.Fe),document.addEventListener("mouseup",this.He),this.container.addEventListener("mouseover",this.Pt),this.container.addEventListener("mouseout",this.Nt),this.container.addEventListener("touchstart",this.Be),this.container.addEventListener("touchmove",this.Ie),this.container.addEventListener("touchend",this.He),this.container.addEventListener("touchcancel",this.He)}Le(){if(!this._.song.getChannelIsNoise(this._.channel)){if(this.Ss){const e=this._.song.channels[this._.channel].octave,i=this._.lastChangeWas(this.es)?this.es.oldValue:e;let s=e;for(;this.wt-this.Fs<.5*-this.Hs&&s<t.Config.scrollableOctaves;)s++,this.Fs-=this.Hs;for(;this.wt-this.Fs>.5*this.Hs&&s>0;)s--,this.Fs+=this.Hs;this.es=new t.ChangeOctave(this._,i,s),this._.setProspectiveChange(this.es)}this.Mt&&this.Ze()}}Ze(){let t=!1,e=!1,i=!1;this.Mt&&!this.re&&(this.wt<this.Zs-this.Us?t=!0:this.wt>this.Zs?e=!0:i=!0),this.li.style.visibility=t?"inherit":"hidden",this.ci.style.visibility=e?"inherit":"hidden",this.Ns.style.visibility=i?"inherit":"hidden"}cs(){this.pt.style.visibility=this._.song.getChannelIsNoise(this._.channel)?"hidden":"visible",this.Ds!=this.Zs&&(this.Ds=this.Zs,this.Ps.setAttribute("y",""+(this.Zs-this.Us)),this.Ns.setAttribute("y",""+(this.Zs-this.Us))),this.Ze()}}}(beepbox||(beepbox={})),function(t){let e=0,i=!1;function s(){--e<=0&&(i=!0)}function n(t){i=!1,e++;const n=document.createElement("img");return n.onload=s,n.src=t,n}const o=n("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAANCAIAAABHKvtLAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6NEU3RTM2RTg0NzBEMTFFMTgyMjBBREEyQTVGRDY5MjIiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6NEU3RTM2RTk0NzBEMTFFMTgyMjBBREEyQTVGRDY5MjIiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDozMzYxN0U3RDQ3MEQxMUUxODIyMEFEQTJBNUZENjkyMiIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDozMzYxN0U3RTQ3MEQxMUUxODIyMEFEQTJBNUZENjkyMiIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PomGIaQAAABgSURBVHjaYpSWlmZhYWFmZgaSTExMQAYTGGAyIICRkRFIMhANWISFhdlggAUHANrBysoKNBfuCGKMvnjx4r59+xhp5wOg6UCSBM+SB0YtGLVgCFgAzDeMeOSGgAUAAQYAGgwJrOg8pdQAAAAASUVORK5CYII="),h=n("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAANCAIAAABHKvtLAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6NEU3RTM2RUM0NzBEMTFFMTgyMjBBREEyQTVGRDY5MjIiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6NEU3RTM2RUQ0NzBEMTFFMTgyMjBBREEyQTVGRDY5MjIiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo0RTdFMzZFQTQ3MEQxMUUxODIyMEFEQTJBNUZENjkyMiIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo0RTdFMzZFQjQ3MEQxMUUxODIyMEFEQTJBNUZENjkyMiIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PhURscAAAAB1SURBVHja7NPBCoAgDAZgnaMX8Oj7P2KKldXPhiR4CwwCv4PInPvxoA0hMLNzDisRYUPCCiMucVallJzzJnaBih5pp2mw936puKEZ2qQ3MeUQmLiKGGNKCZ1IQr2fDnb0C8gMNgNmwA8Cnt/0Tv91vw64BRgALUuP70jrlrwAAAAASUVORK5CYII="),r=n("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAANCAIAAABHKvtLAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6MzM2MTdFNzc0NzBEMTFFMTgyMjBBREEyQTVGRDY5MjIiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6MzM2MTdFNzg0NzBEMTFFMTgyMjBBREEyQTVGRDY5MjIiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDozMzYxN0U3NTQ3MEQxMUUxODIyMEFEQTJBNUZENjkyMiIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDozMzYxN0U3NjQ3MEQxMUUxODIyMEFEQTJBNUZENjkyMiIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PgBmMXoAAACTSURBVHja7JQ7CgMhGIT3920M2Hko7+RJPYWViE0myi5sEXAhKQL7FcP8PmawkWKMjx2llNb60MNIKY0xnPPphRDbMsJ7/xw458wAodZa6PRQ5GIF0RjlYCU655xSEqWU3ntrrdb63RcgHcq2H3MX3AV/UEAhBL7DBkTEzmAFuzSY44UC/BDHtU+8z539esFLgAEAkZ4XCDjZXPEAAAAASUVORK5CYII="),a=n("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAANCAIAAABHKvtLAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6MzM2MTdFN0I0NzBEMTFFMTgyMjBBREEyQTVGRDY5MjIiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6MzM2MTdFN0M0NzBEMTFFMTgyMjBBREEyQTVGRDY5MjIiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDozMzYxN0U3OTQ3MEQxMUUxODIyMEFEQTJBNUZENjkyMiIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDozMzYxN0U3QTQ3MEQxMUUxODIyMEFEQTJBNUZENjkyMiIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PlZjoH4AAADHSURBVHja7JTNDoMgEIRBGq21iTcfyvd/DeNvJBYBp7uFEE+99NDE70AMMDPLYZRt2z4CeZ4XRcFrRkgphRD7vnvvX8RGdF03DEPf99M0LcuitcamMcZa6wkRuNV1/SSqqroTcC/LEu5KKQ6AEhq21oRzDl5bAME8DUjd3wHjOELPyu9fgNnneV7XNQ6OyNPsTCZ+zBVwBfxBgGyaRgViuWIt+ZIPuAAaZwh00BKxaKeuSfwhUsfI55g+WOMT2DEl3jm94BBgAAtY6T6d3wTNAAAAAElFTkSuQmCC"),l=n("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAArCAIAAACW3x1gAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDowMTgwMTE3NDA3MjA2ODExOUJCOEEzOUJCMkI3MTdFNCIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDo5NzVEOTA1QzQ5MjMxMUUxOTM3RDhDNEI4QkIxQkFCNSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDo5NzVEOTA1QjQ5MjMxMUUxOTM3RDhDNEI4QkIxQkFCNSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjAxODAxMTc0MDcyMDY4MTE5QkI4QTM5QkIyQjcxN0U0IiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjAxODAxMTc0MDcyMDY4MTE5QkI4QTM5QkIyQjcxN0U0Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+dtFK5QAACbRJREFUeNrcV0lsG9cZnnmzcJdIcRHFRZtly5IVSVYSOcriNY7jqHHTBE2bJkCRNijQQ9re2kOBAj30kByKAm1PvQVF0RYIkLRpkiZuLMqyLVm7bGvlIpKiuHOGyww52+ubIbXYCYLk2P4ccobz3nzf+9f3D4b9rwv+5cOXL5x48crDT54b8Pr6jOZWQJoxKIi13WJ+Oziz+Z/r6x9N3AvMhb42gcWkf/P1Mz/40fkWz2iuAAsFrljkOK5crVYwTNTrcaMRNDURNhtl1Slrn9x55x+zf/5ooVIVvhLBq1ce+eXPLpt6RnZ22EIBmk1Oi8VuMFoMBgNF6RUMF2tcrVqscPlSKcGV4zaC85qNd25u/PHdm/+8tf5lBBRJ/Oan49/98cVEDmcYg9PZ09LSrjcYSRzHcAAxDGBQQfMgJiuyAiFUFMSUT23mtu9YxYxVgX/6YPa3796QZGUfk9i/Mhvo3//8W99443wwKtB0T1fXqM3m0en0iJUgSIIkKYoiKBL9A4QqAEcCSFJnbnI3uboqIpHP7D7T73WYDbfW4+IexwHB22+OX3zpsfAu5nI96vUM0gY9wqN0JEJG2AAATFs7hlABrhKgk3qJQwwCgrY4/ZiuaSceO+VvslkM11Yi9xG8+dLj33/tdDgLPB1POB09JE0RAOESFEEiVOWQaIZBPxCtX2MBUKVRMAXTWZyk2RaPRp440lIV5PngboPgZE/br16/kBJwR9dTTtdxQkejBzUOoHxO4P2CCAgcV+8iDSHUWWyA0ieDa4N++1J4N8VUVMVfvTCEm/S0vc/Z1g9IoKIjU6PHkCBvyrJ63hMJffZ+tQkyDnDVPThR18beM6zvHmky0i8/OYDAwTGvfXz0WKoCXL5BFVv1p0qgmULRMJTD0HVKWdqj1EZVS2meV+MNU1zHTmZE6tLJ7qOeFvLMQ504TRkt3SarC00j1aOBrhmksUxFu4PuNxytAqHAhZj2Bw2h6Kprgym40d5m9PXqmbXTA53gzIA/V+KaXZ3aTBSCuKrpniDMOo+yv/bGr3qCyv46VE8jDVCmIBT0t7mtK1fkn+rzgpPdrWy5arS2qloCXHMWdp8flYatZGVPm7rd7nc6psUV0BgQgsnhYbnacGcr8DltXE3UGZsxFNA4JAgcUzU/RHDoWsOFh2Pp8ES0OnX9anWAtNnK1wSf00paTIZG0UAhV19+4/uAHNCqc2Hj3n2CDCxDWRvU1FCLJuB43qijahyLiFG2wEZ5wr+gLOKac7USUX/+gVlQ1pahsdZKjEFHcxwPWIZpNus5JgUhPICqY+1B4XvAQItHrUjsDR6aiRRT9gAq2USzUccyLNhNpe0WI5uOYFrEoAPDDqHvoSJMcJ8Q+7f3J6rxIGP1hbKJsN1iQOAgtJNutZu5bKjEpmU1HNXQeABcKzsNIfeKqVbv8H0OLbCgamQIuXySS6y7rOZQIgO2M2WsxrealHRsSdEiW5Kkfez6uV47Dyg0+ANzgUbqIAfXDZBZn3eSoiJUorkyoMzW9bW1Tk+LkFtNJ1YQPApESZFAAxqAQ9jEYZK6aKPItJJaPdRPdmupGlnocDWvra4hcHCi7/jdxXtihe3yWFKx2+lsUJZESVKLxAH2F1A0wNEAsrooC5Ko5ggb38wsBbps+mqZXVxZHeg7Dvq7vYlo+c78vN9t7fSARPxmMrmuCKIgSfUqRnwxeEOQZQRBRnpDWcxur6QWPm3XcT67eX5uLrHD93V5SSOsWk2ttwMLNp9rePwiyZbC0Vs8X/R5T+gNFog41F2SOEjdevRrXhVFUS2sklTjSsmt21xw7ogZ8za3XEcyvdzS3KOXeeInlx9iC3IikqkKCZ2ROjr6kKXJVCjsRqMx9CRBGpHBkWXrW1g9nRG0pNpRRGav8Gw6thy995mhuHW81eSxmK4HpiYnrzNFU9+xXp/XQLz8aIel2RqeTZZrNVHYJYDi7u7s6OqkaaJQSEajYYbJ8xwvSgJaLDI3YuW5EsNkc7lIYmchEbtJC9tHHFS/z6GUuclrE4GJwG6BBpJ1bKy3WGXJ5WDs+WfOOX0t+UgmaqieOM1uXP2Xb/iUv+Nhv7+DYYRstlIoZLYj259rvMg2D+mwuq2ohjL81vTC8tQ0hyk7eRpyTd52W09P6/uBKXLmXuSlK7D3VM+tSAZugv7Lb3349otCOe3OxW3+oWb7gNXqwDAdhqHdX0I1BsNQ+8ZjWBXDOHQh88XY3EpoZml1ZjGdLP/ivX9cffcVtKcPDXdStHJ7bZtcjGS2Ntb7xwbDs2F2K4UX37rzMcOOQoN5RSpuNbnnjPYjlMkP6DaIm1AfpDZdQqlWSVVyMSYeTm5sJtZCHMOHd2q7O2T449+hXdPvd5wc7tpYX12OZslIEd6YWe4a7h+8PHT9D5/GVxhXEiTey2eC1aOnnINnUUuUx2vLtIGUqlKVq/FlgWf5ClstM1yF4Zk0F4zUIiGhkiLNgNxeLaDUfvzxXkAIgfmV7TJGcBJGSJUeFz36wllBlP/+6+suknQSlCGthGfyK7PpWKhcydckUYtRHBN5KZ/m4qHS+jK7OFNYmC6mNyRzlTIRSDlseT537uzApUvDk4HAX29s3C2olsUWk9K/r06jPBj94WmlJu68v4RuNpGEkzLCNJbbza98mL4qiowsj35vOLZVWL8VpnFcDwA6/AQt62FVwQSo7iVjj/WOP/fwzVs3PpicvVuAjcarJKhrawM5i8My+NoFqSxVtlKEApE1DQA4KKqd1nXrdb1Gw/jf/jL2/KPyO5+00bSVotCoorkexS9OkWPnB158eWxpbnYiEPgsrmyyh1rHGCOhztkF07SJOHrlrMnTVo3nFKaCdmgSRxs56kXU3a79lZ3NTz/JLORFXkG4yGwSVNFt7Y6nvzM2dubo7NTUxLVrEzH5Zgo+2PyGswJqarwUq0gV92ivf/wSbbFIGRayZVSP1WqM47pHbKH5TC3MCRW5TmBpt498e/TZN85RRHn6s4mF2flAVJ5Mavb6/K6K2pZvPuZ45ZK364jTfXzE2j5EQn95LsyvbJXWQ+VofDIci4vC00d9lMdlOuZ2DHndI242EgqjPJheiCdLE1vVqYSswC99wznVZ33hvOfKxQ5Ts6HJ3X0oD8xaHlQVoVCrJCq5OLMTSm5sJO4FObY6tVqcCnJrWfkrvaPpaXBxzP3sOd9zT3fYXSa9kab0lFhFVRPlAepAahUWJUEV5UE2XZ5azE6vl+YivCDDr/2WOdzfcmqkdWTINXDC4XXpzTqiWq7F42wwyKxuFO5sMneDxc0Ej/0/y38FGACBHjS0mkQ17AAAAABJRU5ErkJggg==");t.Piano=class{constructor(e){this._=e,this.js=t.HTML.canvas({width:"32",height:"481",style:"width: 100%; height: 100%;"}),this.Vs=t.HTML.canvas({width:"32",height:"40"}),this.container=t.HTML.div({style:"width: 32px; height: 100%; overflow:hidden; position: relative; flex-shrink: 0; touch-action: none;"},this.js,this.Vs),this.Os=this.js.getContext("2d"),this.Gs=this.Vs.getContext("2d"),this.ze=32,this.kt=481,this.wt=0,this.re=!1,this.Mt=!1,this.Ws=-1,this.Ae=!1,this.Ys=-1,this.Pt=(t=>{this.Mt||(this.Mt=!0,this.Ze())}),this.Nt=(t=>{this.Mt&&(this.Mt=!1,this.Ze())}),this.qt=(t=>{t.preventDefault(),this.re=!0;const e=this.js.getBoundingClientRect();this.wt=((t.clientY||t.pageY)-e.top)*this.kt/(e.bottom-e.top),isNaN(this.wt)&&(this.wt=0),this._.synth.liveInputPressed=!0,this.Ze()}),this.Fe=(t=>{const e=this.js.getBoundingClientRect();this.wt=((t.clientY||t.pageY)-e.top)*this.kt/(e.bottom-e.top),isNaN(this.wt)&&(this.wt=0),this.Js(),this._.synth.liveInputPitches[0]=this.Qs+12*this._.song.channels[this._.channel].octave,this.Ze()}),this.ji=(t=>{this.re=!1,this._.synth.liveInputPressed=!1,this.Ze()}),this.Be=(t=>{t.preventDefault(),this.re=!0;const e=this.js.getBoundingClientRect();this.wt=(t.touches[0].clientY-e.top)*this.kt/(e.bottom-e.top),isNaN(this.wt)&&(this.wt=0),this.Js(),this._.synth.liveInputPressed=!0,this._.synth.liveInputPitches[0]=this.Qs+12*this._.song.channels[this._.channel].octave}),this.Ie=(t=>{t.preventDefault();const e=this.js.getBoundingClientRect();this.wt=(t.touches[0].clientY-e.top)*this.kt/(e.bottom-e.top),isNaN(this.wt)&&(this.wt=0),this.Js(),this._.synth.liveInputPitches[0]=this.Qs+12*this._.song.channels[this._.channel].octave}),this.ls=(t=>{t.preventDefault(),this._.synth.liveInputPressed=!1}),this.je=(()=>{const e=this._.song.getChannelIsNoise(this._.channel);this.Oe=e?40:13,this.Ge=e?t.Config.drumCount:t.Config.windowPitchCount,this.Js(),this._.synth.liveInputPitches[0]=this.Qs+12*this._.song.channels[this._.channel].octave,this._.synth.liveInputChannel=this._.channel,this.cs()}),this.cs=(()=>{if(!i)return void window.requestAnimationFrame(this.cs);if(!this._.showLetters)return;const e=this._.song.getChannelIsNoise(this._.channel);if(this.Ws==this._.song.scale&&this.Ys==this._.song.key&&this.Ae==e)return;let s;this.Ws=this._.song.scale,this.Ys=this._.song.key,this.Ae=e,this.Os.clearRect(0,0,this.ze,this.kt);for(let i=0;i<this.Ge;i++){const n=(i+t.Config.keys[this._.song.key].basePitch)%12;if(e){s=l;const t=1-i/this.Ge*.35,e=.5*(1-t),n=s.width*e,o=s.height*e+this.Oe*(this.Ge-i-1),h=s.width*t,r=s.height*t;this.Os.drawImage(s,n,o,h,r);const a=1+(i-this.Ge/2)/this.Ge*.5,c=this.Os.getImageData(n,o,h,r),f=c.data;for(let t=0;t<f.length;t+=4)f[t+0]*=a,f[t+1]*=a,f[t+2]*=a;this.Os.putImageData(c,n,o)}else if(t.Config.scales[this._.song.scale].flags[i%12]){let e;if(t.Config.keys[n].isWhiteKey)e=t.Config.keys[n].name;else{const s=t.Config.blackKeyNameParents[i%12];e=t.Config.keys[(n+12+s)%12].name,1==s?e+="‚ô≠":-1==s&&(e+="‚ôØ")}const h=t.Config.keys[n].isWhiteKey?"#000000":"#ffffff";s=t.Config.keys[n].isWhiteKey?r:o,this.Os.drawImage(s,0,this.Oe*(this.Ge-i-1)),this.Os.font="bold 11px sans-serif",this.Os.fillStyle=h,this.Os.fillText(e,15,this.Oe*(this.Ge-i)-3)}else s=t.Config.keys[n].isWhiteKey?a:h,this.Os.drawImage(s,0,this.Oe*(this.Ge-i-1))}this.Ze()}),this._.notifier.watch(this.je),this.je(),this.container.addEventListener("mousedown",this.qt),document.addEventListener("mousemove",this.Fe),document.addEventListener("mouseup",this.ji),this.container.addEventListener("mouseover",this.Pt),this.container.addEventListener("mouseout",this.Nt),this.container.addEventListener("touchstart",this.Be),this.container.addEventListener("touchmove",this.Ie),this.container.addEventListener("touchend",this.ls),this.container.addEventListener("touchcancel",this.ls)}Js(){const e=t.Config.scales[this._.song.scale].flags,i=Math.max(0,Math.min(this.Ge-1,this.Ge-this.wt/this.Oe));if(e[Math.floor(i)%12]||this._.song.getChannelIsNoise(this._.channel))this.Qs=Math.floor(i);else{let t=Math.floor(i)+1,s=Math.floor(i)-1;for(;!e[t%12];)t++;for(;!e[s%12];)s--;let n=t,o=s+1;t%12!=0&&t%12!=7||(n-=.5),s%12!=0&&s%12!=7||(o+=.5),this.Qs=i-o>n-i?t:s}}Ze(){this.Vs.style.visibility=!this.Mt||this.re?"hidden":"visible",this.Mt&&!this.re&&(this.Gs.clearRect(0,0,32,40),this.Vs.style.left="0px",this.Vs.style.top=this.Oe*(this.Ge-this.Qs-1)+"px",this.Gs.lineWidth=2,this.Gs.strokeStyle="#ffffff",this.Gs.strokeRect(1,1,this.ze-2,this.Oe-2))}}}(beepbox||(beepbox={})),function(t){const{button:e,div:i,span:s,h2:n,input:o,br:h,select:r,option:a}=t.HTML;class l{constructor(c){this._=c,this.Xs=o({style:"width: 3em; margin-left: 1em;",type:"number",step:"1"}),this._s=r({style:"width: 100%;"},a({value:"splice"},"Splice beats at end of bars."),a({value:"stretch"},"Stretch notes to fit in bars."),a({value:"overflow"},"Overflow notes across bars.")),this.Ks=e({className:"cancelButton"}),this.$s=e({className:"okayButton",style:"width:45%;"},"Okay"),this.container=i({className:"prompt noSelection",style:"width: 250px;"},n("Beats Per Bar"),i({style:"display: flex; flex-direction: row; align-items: center; height: 2em; justify-content: flex-end;"},i({style:"text-align: right;"},"Beats per bar:",h(),s({style:"font-size: smaller; color: #888888;"},"(Multiples of 3 or 4 are recommended)")),this.Xs),i({style:"display: flex; flex-direction: row; align-items: center; height: 2em; justify-content: flex-end;"},i({className:"selectContainer",style:"width: 100%;"},this._s)),i({style:"display: flex; flex-direction: row-reverse; justify-content: space-between;"},this.$s),this.Ks),this.$=(()=>{this._.undo()}),this.cleanUp=(()=>{this.$s.removeEventListener("click",this.tn),this.Ks.removeEventListener("click",this.$),this.Xs.removeEventListener("keypress",l.en),this.Xs.removeEventListener("blur",l.in),this.container.removeEventListener("keydown",this.sn)}),this.sn=(t=>{"BUTTON"!=t.target.tagName&&13==t.keyCode&&this.tn()}),this.tn=(()=>{window.localStorage.setItem("beatCountStrategy",this._s.value),this._.prompt=null,this._.record(new t.ChangeBeatsPerBar(this._,l.nn(this.Xs),this._s.value),"replace")}),this.Xs.value=this._.song.beatsPerBar+"",this.Xs.min=t.Config.beatsPerBarMin+"",this.Xs.max=t.Config.beatsPerBarMax+"";const f=window.localStorage.getItem("beatCountStrategy");null!=f&&(this._s.value=f),this.Xs.select(),setTimeout(()=>this.Xs.focus()),this.$s.addEventListener("click",this.tn),this.Ks.addEventListener("click",this.$),this.Xs.addEventListener("keypress",l.en),this.Xs.addEventListener("blur",l.in),this.container.addEventListener("keydown",this.sn)}static en(t){const e=t.which?t.which:t.keyCode;return 46!=e&&e>31&&(e<48||e>57)&&(t.preventDefault(),!0)}static in(t){const e=t.target;e.value=Math.floor(Math.max(Number(e.min),Math.min(Number(e.max),Number(e.value))))+""}static nn(t){return Math.floor(Number(t.value))}}t.BeatsPerBarPrompt=l}(beepbox||(beepbox={})),function(t){const{button:e,div:i,span:s,h2:n,input:o,br:h,select:r,option:a}=t.HTML;class l{constructor(c){this._=c,this.Xs=o({style:"width: 3em; margin-left: 1em;",type:"number",step:"0.01",value:"0"}),this._s=r({style:"width: 100%;"},a({value:"overflow"},"Overflow notes across bars."),a({value:"wrapAround"},"Wrap notes around within bars.")),this.Ks=e({className:"cancelButton"}),this.$s=e({className:"okayButton",style:"width:45%;"},"Okay"),this.container=i({className:"prompt noSelection",style:"width: 250px;"},n("Move Notes Sideways"),i({style:"display: flex; flex-direction: row; align-items: center; height: 2em; justify-content: flex-end;"},i({style:"text-align: right;"},"Beats to move:",h(),s({style:"font-size: smaller; color: #888888;"},"(Negative is left, positive is right)")),this.Xs),i({style:"display: flex; flex-direction: row; align-items: center; height: 2em; justify-content: flex-end;"},i({className:"selectContainer",style:"width: 100%;"},this._s)),i({style:"display: flex; flex-direction: row-reverse; justify-content: space-between;"},this.$s),this.Ks),this.$=(()=>{this._.undo()}),this.cleanUp=(()=>{this.$s.removeEventListener("click",this.tn),this.Ks.removeEventListener("click",this.$),this.Xs.removeEventListener("blur",l.in),this.container.removeEventListener("keydown",this.sn)}),this.sn=(t=>{"BUTTON"!=t.target.tagName&&13==t.keyCode&&this.tn()}),this.tn=(()=>{window.localStorage.setItem("moveNotesSidewaysStrategy",this._s.value),this._.prompt=null,this._.record(new t.ChangeMoveNotesSideways(this._,+this.Xs.value,this._s.value),"replace")}),this.Xs.min=-this._.song.beatsPerBar+"",this.Xs.max=this._.song.beatsPerBar+"";const f=window.localStorage.getItem("moveNotesSidewaysStrategy");null!=f&&(this._s.value=f),this.Xs.select(),setTimeout(()=>this.Xs.focus()),this.$s.addEventListener("click",this.tn),this.Ks.addEventListener("click",this.$),this.Xs.addEventListener("blur",l.in),this.container.addEventListener("keydown",this.sn)}static in(e){const i=e.target;let s=+i.value;s=Math.round(s*t.Config.partsPerBeat)/t.Config.partsPerBeat,s=Math.round(100*s)/100,i.value=Math.max(+i.min,Math.min(+i.max,s))+""}}t.MoveNotesSidewaysPrompt=l}(beepbox||(beepbox={})),function(t){const{button:e,div:i,span:s,h2:n,input:o,br:h,select:r,option:a}=t.HTML;class l{constructor(c,f){this._=c,this.hn=f,this.rn=o({style:"width: 3em; margin-left: 1em;",type:"number",step:"1"}),this.an=r({style:"width: 100%;"},a({value:"end"},"Apply change at end of song."),a({value:"beginning"},"Apply change at beginning of song.")),this.Ks=e({className:"cancelButton"}),this.$s=e({className:"okayButton",style:"width:45%;"},"Okay"),this.container=i({className:"prompt noSelection",style:"width: 250px;"},n("Song Length"),i({style:"display: flex; flex-direction: row; align-items: center; height: 2em; justify-content: flex-end;"},i({style:"display: inline-block; text-align: right;"},"Bars per song:",h(),s({style:"font-size: smaller; color: #888888;"},"(Multiples of 4 are recommended)")),this.rn),i({style:"display: flex; flex-direction: row; align-items: center; height: 2em; justify-content: flex-end;"},i({className:"selectContainer",style:"width: 100%;"},this.an)),i({style:"display: flex; flex-direction: row-reverse; justify-content: space-between;"},this.$s),this.Ks),this.$=(()=>{this._.undo()}),this.cleanUp=(()=>{this.$s.removeEventListener("click",this.tn),this.Ks.removeEventListener("click",this.$),this.rn.removeEventListener("keypress",l.en),this.rn.removeEventListener("blur",l.in),this.container.removeEventListener("keydown",this.sn)}),this.sn=(t=>{"BUTTON"!=t.target.tagName&&13==t.keyCode&&this.tn()}),this.tn=(()=>{window.localStorage.setItem("barCountPosition",this.an.value);const e=new t.ChangeGroup;e.append(new t.ChangeBarCount(this._,this.hn,l.nn(this.rn),"beginning"==this.an.value)),this._.prompt=null,this._.record(e,"replace")}),this.rn.value=this._.song.barCount+"",this.rn.min=t.Config.barCountMin+"",this.rn.max=t.Config.barCountMax+"";const d=window.localStorage.getItem("barCountPosition");null!=d&&(this.an.value=d),this.rn.select(),setTimeout(()=>this.rn.focus()),this.$s.addEventListener("click",this.tn),this.Ks.addEventListener("click",this.$),this.rn.addEventListener("keypress",l.en),this.rn.addEventListener("blur",l.in),this.container.addEventListener("keydown",this.sn)}static en(t){const e=t.which?t.which:t.keyCode;return 46!=e&&e>31&&(e<48||e>57)&&(t.preventDefault(),!0)}static in(t){const e=t.target;e.value=Math.floor(Math.max(Number(e.min),Math.min(Number(e.max),Number(e.value))))+""}static nn(t){return Math.floor(Number(t.value))}}t.SongDurationPrompt=l}(beepbox||(beepbox={})),function(t){const{button:e,div:i,h2:s,input:n}=t.HTML;class o{constructor(h){this._=h,this.ln=n({style:"width: 3em; margin-left: 1em;",type:"number",step:"1"}),this.cn=n({style:"width: 3em; margin-left: 1em;",type:"number",step:"1"}),this.fn=n({style:"width: 3em; margin-left: 1em;",type:"number",step:"1"}),this.dn=n({style:"width: 3em; margin-left: 1em;",type:"number",step:"1"}),this.Ks=e({className:"cancelButton"}),this.$s=e({className:"okayButton",style:"width:45%;"},"Okay"),this.container=i({className:"prompt noSelection",style:"width: 250px;"},s("Channel Settings"),i({style:"display: flex; flex-direction: row; align-items: center; height: 2em; justify-content: flex-end;"},"Pitch channels:",this.fn),i({style:"display: flex; flex-direction: row; align-items: center; height: 2em; justify-content: flex-end;"},"Drum channels:",this.dn),i({style:"display: flex; flex-direction: row; align-items: center; height: 2em; justify-content: flex-end;"},"Patterns per channel:",this.ln),i({style:"display: flex; flex-direction: row; align-items: center; height: 2em; justify-content: flex-end;"},"Instruments per channel:",this.cn),i({style:"display: flex; flex-direction: row-reverse; justify-content: space-between;"},this.$s),this.Ks),this.$=(()=>{this._.undo()}),this.cleanUp=(()=>{this.$s.removeEventListener("click",this.tn),this.Ks.removeEventListener("click",this.$),this.ln.removeEventListener("keypress",o.en),this.cn.removeEventListener("keypress",o.en),this.fn.removeEventListener("keypress",o.en),this.dn.removeEventListener("keypress",o.en),this.ln.removeEventListener("blur",o.in),this.cn.removeEventListener("blur",o.in),this.fn.removeEventListener("blur",o.in),this.dn.removeEventListener("blur",o.in),this.container.removeEventListener("keydown",this.sn)}),this.sn=(t=>{"BUTTON"!=t.target.tagName&&13==t.keyCode&&this.tn()}),this.tn=(()=>{const e=new t.ChangeGroup;e.append(new t.ChangePatternsPerChannel(this._,o.nn(this.ln))),e.append(new t.ChangeInstrumentsPerChannel(this._,o.nn(this.cn))),e.append(new t.ChangeChannelCount(this._,o.nn(this.fn),o.nn(this.dn))),this._.prompt=null,this._.record(e,"replace")}),this.ln.value=this._.song.patternsPerChannel+"",this.ln.min="1",this.ln.max=t.Config.barCountMax+"",this.cn.value=this._.song.instrumentsPerChannel+"",this.cn.min=t.Config.instrumentsPerChannelMin+"",this.cn.max=t.Config.instrumentsPerChannelMax+"",this.fn.value=this._.song.pitchChannelCount+"",this.fn.min=t.Config.pitchChannelCountMin+"",this.fn.max=t.Config.pitchChannelCountMax+"",this.dn.value=this._.song.noiseChannelCount+"",this.dn.min=t.Config.noiseChannelCountMin+"",this.dn.max=t.Config.noiseChannelCountMax+"",this.fn.select(),setTimeout(()=>this.fn.focus()),this.$s.addEventListener("click",this.tn),this.Ks.addEventListener("click",this.$),this.ln.addEventListener("keypress",o.en),this.cn.addEventListener("keypress",o.en),this.fn.addEventListener("keypress",o.en),this.dn.addEventListener("keypress",o.en),this.ln.addEventListener("blur",o.in),this.cn.addEventListener("blur",o.in),this.fn.addEventListener("blur",o.in),this.dn.addEventListener("blur",o.in),this.container.addEventListener("keydown",this.sn)}static en(t){const e=t.which?t.which:t.keyCode;return 46!=e&&e>31&&(e<48||e>57)&&(t.preventDefault(),!0)}static in(t){const e=t.target;e.value=Math.floor(Math.max(Number(e.min),Math.min(Number(e.max),Number(e.value))))+""}static nn(t){return Math.floor(Number(t.value))}}t.ChannelSettingsPrompt=o}(beepbox||(beepbox={})),function(t){function e(t,e){const i=new ArrayBuffer(e);let s=0,n=Math.min(t.byteLength,i.byteLength);const o=[8,4,2,1];for(const e of o)if(n>=e){const o=h(e,t,i,s,n);s=o.nextOffset,n=o.leftBytes}return i;function h(t,e,i,s,n){let o=Uint8Array;switch(t){case 8:o=Float64Array;break;case 4:o=Float32Array;break;case 2:o=Uint16Array;break;case 1:default:o=Uint8Array}const h=new o(e,s,n/t|0),r=new o(i,s,n/t|0);for(let t=0;t<r.length;t++)r[t]=h[t];return{nextOffset:h.byteOffset+h.byteLength,leftBytes:n-r.length*t}}}t.ArrayBufferWriter=class{constructor(t){this.un=0,this.mn=0,this.pn=new ArrayBuffer(t),this.yn=new DataView(this.pn)}bn(t){this.mn+=t,this.mn>this.pn.byteLength&&(this.pn=e(this.pn,Math.max(2*this.pn.byteLength,this.mn)),this.yn=new DataView(this.pn))}getWriteIndex(){return this.un}rewriteUint32(t,e){this.yn.setUint32(t,e>>>0,!1)}writeUint32(t){t>>>=0,this.bn(4),this.yn.setUint32(this.un,t,!1),this.un=this.mn}writeUint24(t){t>>>=0,this.bn(3),this.yn.setUint8(this.un,t>>16&255),this.yn.setUint8(this.un+1,t>>8&255),this.yn.setUint8(this.un+2,255&t),this.un=this.mn}writeUint16(t){t>>>=0,this.bn(2),this.yn.setUint16(this.un,t,!1),this.un=this.mn}writeUint8(t){t>>>=0,this.bn(1),this.yn.setUint8(this.un,t),this.un=this.mn}writeInt8(t){t|=0,this.bn(1),this.yn.setInt8(this.un,t),this.un=this.mn}writeMidi7Bits(t){if((t>>>=0)>=128)throw new Error("7 bit value contained 8th bit!");this.bn(1),this.yn.setUint8(this.un,t),this.un=this.mn}writeMidiVariableLength(t){if((t>>>=0)>268435455)throw new Error("writeVariableLength value too big.");let e=!1;for(let i=0;i<4;i++){const s=t>>>21-7*i&127;0==s&&3!=i||(e=!0),e&&this.writeUint8((3==i?0:128)|s)}}writeMidiAscii(t){this.writeMidiVariableLength(t.length);for(let e=0;e<t.length;e++){const i=t.charCodeAt(e);if(i>127)throw new Error("Trying to write unicode character as ascii.");this.writeUint8(i)}}toCompactArrayBuffer(){return e(this.pn,this.mn)}}}(beepbox||(beepbox={})),function(t){t.defaultMidiExpression=127,t.defaultMidiPitchBend=8192,t.analogousDrumMap={35:{frequency:0,duration:2,volume:3},36:{frequency:0,duration:2,volume:3},37:{frequency:5,duration:1,volume:3},38:{frequency:4,duration:2,volume:3},39:{frequency:5,duration:2,volume:3},40:{frequency:4,duration:2,volume:3},41:{frequency:1,duration:2,volume:3},42:{frequency:8,duration:1,volume:3},43:{frequency:1,duration:2,volume:3},44:{frequency:8,duration:1,volume:2},45:{frequency:2,duration:2,volume:3},46:{frequency:8,duration:4,volume:3},47:{frequency:2,duration:2,volume:3},48:{frequency:3,duration:2,volume:3},49:{frequency:7,duration:4,volume:3},50:{frequency:3,duration:2,volume:3},51:{frequency:6,duration:4,volume:2},52:{frequency:7,duration:4,volume:3},53:{frequency:6,duration:2,volume:3},54:{frequency:11,duration:2,volume:3},55:{frequency:9,duration:4,volume:3},56:{frequency:7,duration:1,volume:2},57:{frequency:7,duration:4,volume:3},58:{frequency:10,duration:2,volume:2},59:{frequency:6,duration:4,volume:3},69:{frequency:10,duration:2,volume:3},70:{frequency:10,duration:2,volume:3},73:{frequency:10,duration:1,volume:2},74:{frequency:10,duration:2,volume:2}},t.midiVolumeToVolumeMult=function(t){return Math.pow(t/127,4)/.3844015376046128},t.volumeMultToMidiVolume=function(t){return 127*Math.pow(.3844015376046128*t,.25)},t.midiExpressionToVolumeMult=function(t){return Math.pow(t/127,4)},t.volumeMultToMidiExpression=function(t){return 127*Math.pow(t,.25)}}(beepbox||(beepbox={})),function(t){const{button:e,div:i,h2:s,input:n,select:o,option:h}=t.HTML;function r(t,e,i){return t+i*(e-t)}function a(t,e){if(navigator.msSaveOrOpenBlob)return void navigator.msSaveOrOpenBlob(t,e);const i=document.createElement("a");if(void 0!=i.download){const s=URL.createObjectURL(t);setTimeout(function(){URL.revokeObjectURL(s)},6e4),i.href=s,i.download=e,setTimeout(function(){i.dispatchEvent(new MouseEvent("click"))},0)}else{const e=URL.createObjectURL(t);setTimeout(function(){URL.revokeObjectURL(e)},6e4),window.open(e,"_blank")||(window.location.href=e)}}class l{constructor(t){this._=t,this.gn=n({type:"text",style:"width: 10em;",value:"BeepBox-Song",maxlength:250,autofocus:"autofocus"}),this.vn=n({type:"checkbox"}),this.wn=n({style:"width: 2em;",type:"number",min:"1",max:"4",step:"1"}),this.Mn=n({type:"checkbox"}),this.kn=o({style:"width: 100%;"},h({value:"wav"},"Export to .wav file."),h({value:"midi"},"Export to .mid file."),h({value:"json"},"Export to .json file.")),this.Ks=e({className:"cancelButton"}),this.xn=e({className:"exportButton",style:"width:45%;"},"Export"),this.container=i({className:"prompt noSelection",style:"width: 200px;"},s("Export Options"),i({style:"display: flex; flex-direction: row; align-items: center; justify-content: space-between;"},"File name:",this.gn),i({style:"display: table; width: 100%;"},i({style:"display: table-row;"},i({style:"display: table-cell;"},"Intro:"),i({style:"display: table-cell;"},"Loop Count:"),i({style:"display: table-cell;"},"Outro:")),i({style:"display: table-row;"},i({style:"display: table-cell; vertical-align: middle;"},this.vn),i({style:"display: table-cell; vertical-align: middle;"},this.wn),i({style:"display: table-cell; vertical-align: middle;"},this.Mn))),i({className:"selectContainer",style:"width: 100%;"},this.kn),i({style:"display: flex; flex-direction: row-reverse; justify-content: space-between;"},this.xn),this.Ks),this.$=(()=>{this._.undo()}),this.cleanUp=(()=>{this.gn.removeEventListener("input",l.En),this.wn.removeEventListener("blur",l.in),this.xn.removeEventListener("click",this.An),this.Ks.removeEventListener("click",this.$),this.container.removeEventListener("keydown",this.sn)}),this.sn=(t=>{"BUTTON"!=t.target.tagName&&13==t.keyCode&&this.An()}),this.An=(()=>{switch(window.localStorage.setItem("exportFormat",this.kn.value),this.kn.value){case"wav":this.Cn();break;case"midi":this.Pn();break;case"json":this.Nn();break;default:throw new Error("Unhandled file export type.")}}),this.wn.value="1",0==this._.song.loopStart?(this.vn.checked=!1,this.vn.disabled=!0):(this.vn.checked=!0,this.vn.disabled=!1),this._.song.loopStart+this._.song.loopLength==this._.song.barCount?(this.Mn.checked=!1,this.Mn.disabled=!0):(this.Mn.checked=!0,this.Mn.disabled=!1);const r=window.localStorage.getItem("exportFormat");null!=r&&(this.kn.value=r),this.gn.select(),setTimeout(()=>this.gn.focus()),this.gn.addEventListener("input",l.En),this.wn.addEventListener("blur",l.in),this.xn.addEventListener("click",this.An),this.Ks.addEventListener("click",this.$),this.container.addEventListener("keydown",this.sn),this.gn.value=t.song.title,l.En(null,this.gn)}changeFileName(t){this.gn.value=t}static En(t,e){let i;if(null!=t)i=t.target;else{if(void 0==e)return;i=e}const s=/[\+\*\$\?\|\{\}\\\/<>#%!`&'"=:@]/gi;if(s.test(i.value)){let t=i.selectionStart;i.value=i.value.replace(s,""),t--,i.setSelectionRange(t,t)}}static in(t){const e=t.target;e.value=Math.floor(Math.max(Number(e.min),Math.min(Number(e.max),Number(e.value))))+""}Cn(){const e=new t.Synth(this._.song);if(e.loopRepeatCount=Number(this.wn.value)-1,!this.vn.checked)for(let t=0;t<this._.song.loopStart;t++)e.nextBar();const i=e.getSamplesPerBar()*e.getTotalBars(this.vn.checked,this.Mn.checked),s=new Float32Array(i),n=new Float32Array(i);e.synthesize(s,n,i);const o=2*i;let h=0;const r=new ArrayBuffer(44+2*o),l=new DataView(r);l.setUint32(h,1380533830,!1),h+=4,l.setUint32(h,36+2*o,!0),h+=4,l.setUint32(h,1463899717,!1),h+=4,l.setUint32(h,1718449184,!1),h+=4,l.setUint32(h,16,!0),h+=4,l.setUint16(h,1,!0),h+=2,l.setUint16(h,2,!0),h+=2,l.setUint32(h,44100,!0),h+=4,l.setUint32(h,176400,!0),h+=4,l.setUint16(h,2,!0),h+=2,l.setUint16(h,16,!0),h+=2,l.setUint32(h,1684108385,!1),h+=4,l.setUint32(h,2*o,!0),h+=4;for(let t=0;t<i;t++){let e=Math.floor(32767*Math.max(-1,Math.min(1,s[t]))),i=Math.floor(32767*Math.max(-1,Math.min(1,n[t])));l.setInt16(h,e,!0),h+=2,l.setInt16(h,i,!0),h+=2}a(new Blob([r],{type:"audio/wav"}),this.gn.value.trim()+".wav"),this.$()}Pn(){const e=this._.song,i=2*t.Config.ticksPerPart*t.Config.partsPerBeat,s=2*t.Config.ticksPerPart,n=e.getBeatsPerMinute(),o=Math.round(6e7/n),h=i*e.beatsPerBar,c=[];if(this.vn.checked)for(let t=0;t<e.loopStart;t++)c.push(t);for(let t=0;t<Number(this.wn.value);t++)for(let t=e.loopStart;t<e.loopStart+e.loopLength;t++)c.push(t);if(this.Mn.checked)for(let t=e.loopStart+e.loopLength;t<e.barCount;t++)c.push(t);const f=[{isMeta:!0,channel:-1,midiChannel:-1,isNoise:!1,isDrumset:!1}];let d=0,u=!1;for(let t=0;t<this._.song.getChannelCount();t++)u||4!=this._.song.channels[t].instruments[0].type?(f.push({isMeta:!1,channel:t,midiChannel:d++,isNoise:this._.song.getChannelIsNoise(t),isDrumset:!1}),9==d&&d++):(f.push({isMeta:!1,channel:t,midiChannel:9,isNoise:!0,isDrumset:!0}),u=!0);const m=new t.ArrayBufferWriter(1024);m.writeUint32(1297377380),m.writeUint32(6),m.writeUint16(1),m.writeUint16(f.length),m.writeUint16(i);for(const n of f){m.writeUint32(1297379947);const{isMeta:a,channel:f,midiChannel:d,isNoise:u,isDrumset:y}=n,b=m.getWriteIndex();m.writeUint32(0);let g=0,v=0;const w=function(t){if(t<g)throw new Error("Midi event time cannot go backwards.");m.writeMidiVariableLength(t-g),g=t},M=function(t,e){if(!(e>=0&&e<=127))throw new Error("Midi control event value out of range: "+e);m.writeUint8(176|d),m.writeMidi7Bits(t),m.writeMidi7Bits(0|e)};if(a){w(0),m.writeUint8(255),m.writeMidi7Bits(1),m.writeMidiAscii("Composed with beepbox.co"),w(0),m.writeUint8(255),m.writeMidi7Bits(81),m.writeMidiVariableLength(3),m.writeUint24(o),w(0),m.writeUint8(255),m.writeMidi7Bits(88),m.writeMidiVariableLength(4),m.writeUint8(e.beatsPerBar),m.writeUint8(2),m.writeUint8(24),m.writeUint8(8);const i=t.Config.scales[e.scale].flags[3]&&!t.Config.scales[e.scale].flags[4],s=e.key;let n=s;for(1==(1&s)&&(n+=6),i&&(n+=9);n>6;)n-=12;w(0),m.writeUint8(255),m.writeMidi7Bits(89),m.writeMidiVariableLength(2),m.writeInt8(n),m.writeUint8(i?1:0),this.vn.checked&&(v+=h*e.loopStart),w(v),m.writeUint8(255),m.writeMidi7Bits(6),m.writeMidiAscii("Loop Start");for(let t=0;t<parseInt(this.wn.value);t++)v+=h*e.loopLength,w(v),m.writeUint8(255),m.writeMidi7Bits(6),m.writeMidiAscii(t<Number(this.wn.value)-1?"Loop Repeat":"Loop End");if(this.Mn.checked&&(v+=h*(e.barCount-e.loopStart-e.loopLength)),v!=h*c.length)throw new Error("Miscalculated number of bars.")}else{let n=u?"noise channel "+f:"pitch channel "+f;w(0),m.writeUint8(255),m.writeMidi7Bits(3),m.writeMidiAscii(n),w(0),M(101,0),w(0),M(100,0),w(0),M(6,24),w(0),M(38,0),w(0),M(101,127),w(0),M(100,127);let o=-1;function p(i){const s=e.channels[f].instruments[i],n=t.EditorConfig.valueToPreset(s.preset);if(o!=i){if(o=i,w(v),m.writeUint8(255),m.writeMidi7Bits(4),m.writeMidiAscii("Instrument "+(i+1)),!y){let t=81;if(null!=n&&void 0!=n.midiProgram)t=n.midiProgram;else if(4==s.type)t=116;else{const e=s.getFilterEnvelope().type,i=8==e||4==e;if(2==s.type||3==s.type)t=u?116:i?47:75;else if(0==s.type){const e=i?l.midiDecayInstruments:l.midiSustainInstruments;e.length>s.chipWave&&(t=e[s.chipWave])}else if(6==s.type)t=i?25:81;else{if(1!=s.type&&5!=s.type)throw new Error("Unrecognized instrument type.");t=i?2:81}}w(v),m.writeUint8(192|d),m.writeMidi7Bits(t)}w(v);let e=t.volumeMultToMidiVolume(t.Synth.instrumentVolumeToVolumeMult(s.volume));M(7,Math.min(127,Math.round(e))),w(v);let h=63*(s.pan/t.Config.panCenter-1)+64;M(10,Math.min(127,Math.round(h)))}}null==e.getPattern(f,0)&&p(0);let a=t.defaultMidiPitchBend,b=t.defaultMidiExpression,g=!1;const k=u?t.Config.spectrumBasePitch:t.Config.keys[e.key].basePitch,x=u?t.Config.noiseInterval:1;for(const n of c){const o=e.getPattern(f,n);if(null!=o){const n=o.instrument,h=e.channels[f].instruments[n],l=t.EditorConfig.valueToPreset(h.preset);p(n);let c=!1,E=!0,A=1;c=h.getChord().harmonizes,(E=h.getChord().arpeggiates)?c&&(0==h.type?A=2:1==h.type?A=4:console.error("Unrecognized instrument type for harmonizing arpeggio: "+h.type)):A=4;for(let n=0;n<o.notes.length;n++){const h=o.notes[n],c=v+h.start*s;let f=c,p=h.pins[0].volume,C=h.pins[0].interval;const P=[-1,-1,-1,-1],N=[-1,-1,-1,-1],q=Math.min(A,h.pitches.length),R=y?Math.max(1,Math.round(90*h.pins[0].volume/3)):90;let S=h.pickMainInterval()*x;if(!y){let t=24,e=-24;for(let i=1;i<h.pins.length;i++){const s=h.pins[i].interval*x;t=Math.min(t,s+24),e=Math.max(e,s-24)}S=Math.min(t,Math.max(e,S))}for(let n=1;n<h.pins.length;n++){const o=c+h.pins[n].time*s,g=h.pins[n].volume,A=h.pins[n].interval,z=o-f;for(let n=0;n<z;n++){const o=f+n,T=r(p,g,n/z),B=r(C,A,n/z)*x-S,F=Math.max(0,Math.min(16383,Math.round(8192*(1+B/24)))),L=Math.min(127,Math.round(t.volumeMultToMidiExpression(t.Synth.expressionToVolumeMult(T))));F!=a&&(w(o),m.writeUint8(224|d),m.writeMidi7Bits(127&F),m.writeMidi7Bits(F>>7&127),a=F),L==b||y||(w(o),M(11,L),b=L);const I=o==c;for(let n=0;n<q;n++){let r=h.pitches[n];if(y){const t=[36,41,45,48,40,39,59,49,46,55,69,54];if((r+=S)<0||r>=t.length)throw new Error("Could not find corresponding drumset pitch. "+r);r=t[r]}else{if(E&&h.pitches.length>n+1&&n==q-1){const a=(o-v)%i,l=t.Config.rhythms[e.rhythm].ticksPerArpeggio*s/t.Config.ticksPerPart,c=Math.floor(a/l),f=t.Config.rhythms[e.rhythm].arpeggioPatterns[h.pitches.length-1-n];r=h.pitches[n+f[c%f.length]]}r=k+r*x+S,null!=l&&void 0!=l.midiSubharmonicOctaves?r+=12*l.midiSubharmonicOctaves:u&&(r+=12*+t.EditorConfig.presetCategories.dictionary["Drum Presets"].presets.dictionary["taiko drum"].midiSubharmonicOctaves),u&&(r*=2)}r=Math.max(0,Math.min(127,r)),N[n]=r,I||P[n]==N[n]||(w(o),m.writeUint8(128|d),m.writeMidi7Bits(P[n]),m.writeMidi7Bits(R))}for(let t=0;t<q;t++)(I||P[t]!=N[t])&&(w(o),m.writeUint8(144|d),m.writeMidi7Bits(N[t]),m.writeMidi7Bits(R),P[t]=N[t])}f=o,p=g,C=A}const z=v+h.end*s;for(let t=0;t<q;t++)w(z),m.writeUint8(128|d),m.writeMidi7Bits(P[t]),m.writeMidi7Bits(R);g=!0}}else g&&(g=!1,b!=t.defaultMidiExpression&&(b=t.defaultMidiExpression,w(v),M(11,b)),a!=t.defaultMidiPitchBend&&(a=t.defaultMidiPitchBend,w(v),m.writeUint8(224|d),m.writeMidi7Bits(127&a),m.writeMidi7Bits(a>>7&127)));v+=h}}w(v),m.writeUint8(255),m.writeMidi7Bits(47),m.writeMidiVariableLength(0),m.rewriteUint32(b,m.getWriteIndex()-b-4)}a(new Blob([m.toCompactArrayBuffer()],{type:"audio/midi"}),this.gn.value.trim()+".mid"),this.$()}Nn(){const t=this._.song.toJsonObject(this.vn.checked,Number(this.wn.value),this.Mn.checked),e=JSON.stringify(t,null,"\t");a(new Blob([e],{type:"application/json"}),this.gn.value.trim()+".json"),this.$()}}l.midiSustainInstruments=[74,71,80,70,70,68,68,81,81,81,81,81,81],l.midiDecayInstruments=[33,46,46,6,6,24,24,25,25,25,25,106,106],t.ExportPrompt=l}(beepbox||(beepbox={})),function(t){class e{constructor(t){this.m=0,this.yn=t}getReadIndex(){return this.m}readUint32(){if(this.m+4>this.yn.byteLength)throw new Error("Reading past the end of the buffer.");const t=this.yn.getUint32(this.m,!1);return this.m+=4,t}readUint24(){return this.readUint8()<<16|this.readUint8()<<8|this.readUint8()}readUint16(){if(this.m+2>this.yn.byteLength)throw new Error("Reading past the end of the buffer.");const t=this.yn.getUint16(this.m,!1);return this.m+=2,t}readUint8(){if(this.m+1>this.yn.byteLength)throw new Error("Reading past the end of the buffer.");const t=this.yn.getUint8(this.m);return this.m++,t}readInt8(){if(this.m+1>this.yn.byteLength)throw new Error("Reading past the end of the buffer.");const t=this.yn.getInt8(this.m);return this.m++,t}peakUint8(){if(this.m+1>this.yn.byteLength)throw new Error("Reading past the end of the buffer.");return this.yn.getUint8(this.m)}readMidi7Bits(){const t=this.readUint8();return t>=128&&console.log("7 bit value contained 8th bit! value "+t+", index "+this.m),127&t}readMidiVariableLength(){let t=0;for(let e=0;e<4;e++){const e=this.readUint8();if(t+=127&e,!(128&e))break;t<<=7}return t}skipBytes(t){this.m+=t}hasMore(){return this.yn.byteLength>this.m}getReaderForNextBytes(t){if(this.m+t>this.yn.byteLength)throw new Error("Reading past the end of the buffer.");const i=new e(new DataView(this.yn.buffer,this.yn.byteOffset+this.m,t));return this.skipBytes(t),i}}t.ArrayBufferReader=e}(beepbox||(beepbox={})),function(t){const{button:e,p:i,div:s,h2:n,input:o}=t.HTML;t.ImportPrompt=class{constructor(h){this._=h,this.qn=o({type:"file",accept:".json,application/json,.mid,.midi,audio/midi,audio/x-midi"}),this.Ks=e({className:"cancelButton"}),this.container=s({className:"prompt noSelection",style:"width: 300px;"},n("Import"),i({style:"text-align: left; margin: 0.5em 0;"},"BeepBox songs can be exported and re-imported as .json files. You could also use other means to make .json files for BeepBox as long as they follow the same structure."),i({style:"text-align: left; margin: 0.5em 0;"},"BeepBox can also (crudely) import .mid files. There are many tools available for creating .mid files. Shorter and simpler songs are more likely to work well."),this.qn,this.Ks),this.$=(()=>{this._.undo()}),this.cleanUp=(()=>{this.qn.removeEventListener("change",this.Rn),this.Ks.removeEventListener("click",this.$)}),this.Rn=(()=>{const e=this.qn.files[0];if(!e)return;const i=e.name.slice(2+(e.name.lastIndexOf(".")-1>>>0));if("json"==i){const i=new FileReader;i.addEventListener("load",e=>{this._.prompt=null,this._.goBackToStart(),this._.record(new t.ChangeSong(this._,i.result),"replace")}),i.readAsText(e)}else if("midi"==i||"mid"==i){const t=new FileReader;t.addEventListener("load",e=>{this._.prompt=null,this._.goBackToStart(),this.Sn(t.result)}),t.readAsArrayBuffer(e)}else console.error("Unrecognized file extension."),this.$()}),this.qn.select(),setTimeout(()=>this.qn.focus()),this.qn.addEventListener("change",this.Rn),this.Ks.addEventListener("click",this.$)}Sn(e){const i=new t.ArrayBufferReader(new DataView(e));let s=null;const n=[];for(;i.hasMore();){const t=i.readUint32(),e=i.readUint32();if(1297377380==t)null==s?s=i.getReaderForNextBytes(e):console.error("This MIDI file has more than one header chunk.");else if(1297379947==t){const t=i.getReaderForNextBytes(e);t.hasMore()&&n.push({reader:t,nextEventMidiTick:t.readMidiVariableLength(),ended:!1,runningStatus:-1})}else i.skipBytes(e)}if(null==s)return console.error("No header chunk found in this MIDI file."),void this.$();const o=s.readUint16();s.readUint16();const h=s.readUint16();let r=0;const a=[],l=2==o;if(l)a.push(r);else for(let t=0;t<n.length;t++)a.push(t);const c=[255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255],f=[255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255],d=[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],u=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],m=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],p=[100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100],y=[64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64],b=[[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]],g=[[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]],v=[[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]];let w=5e5,M=8,k=0,x=!1,E=0;for(;;){let e=Number.MAX_VALUE,i=!1;for(const s of a){const o=n[s];for(;!o.ended&&o.nextEventMidiTick==E;){const s=128&o.reader.peakUint8()?o.reader.readUint8():o.runningStatus,h=240&s,A=15&s;240!=h&&(o.runningStatus=s);let C=!1;switch(h){case 128:{const t=o.reader.readMidi7Bits();o.reader.readMidi7Bits(),b[A].push({midiTick:E,pitch:t,velocity:0,program:-1,instrumentVolume:-1,instrumentPan:-1,on:!1})}break;case 144:{const e=o.reader.readMidi7Bits(),i=o.reader.readMidi7Bits();if(0==i)b[A].push({midiTick:E,pitch:e,velocity:0,program:-1,instrumentVolume:-1,instrumentPan:-1,on:!1});else{const s=Math.max(0,Math.min(t.Config.volumeRange-1,Math.round(t.Synth.volumeMultToInstrumentVolume(t.midiVolumeToVolumeMult(p[A]))))),n=Math.max(0,Math.min(t.Config.panMax,Math.round(((y[A]-64)/63+1)*t.Config.panCenter)));b[A].push({midiTick:E,pitch:e,velocity:Math.max(0,Math.min(1,(i+14)/90)),program:m[A],instrumentVolume:s,instrumentPan:n,on:!0})}}break;case 160:o.reader.readMidi7Bits(),o.reader.readMidi7Bits();break;case 176:{const e=o.reader.readMidi7Bits(),i=o.reader.readMidi7Bits();switch(e){case 6:0==c[A]&&0==f[A]&&(d[A]=i);break;case 7:p[A]=i;break;case 10:y[A]=i;break;case 11:v[A].push({midiTick:E,volume:t.Synth.volumeMultToExpression(t.midiExpressionToVolumeMult(i))});break;case 38:0==c[A]&&0==f[A]&&(u[A]=i);break;case 100:f[A]=i;break;case 101:c[A]=i}}break;case 192:{const t=o.reader.readMidi7Bits();m[A]=t}break;case 208:o.reader.readMidi7Bits();break;case 224:{const t=o.reader.readMidi7Bits(),e=((o.reader.readMidi7Bits()<<7|t)/8192-1)*(d[A]+.01*u[A]);g[A].push({midiTick:E,interval:e})}break;case 240:if(255==s){const e=o.reader.readMidi7Bits(),i=o.reader.readMidiVariableLength();if(47==e)C=!0,o.reader.skipBytes(i);else if(81==e)w=o.reader.readUint24(),o.reader.skipBytes(i-3);else if(88==e){const e=o.reader.readUint8();let s=o.reader.readUint8();for(o.reader.readUint8(),o.reader.readUint8(),o.reader.skipBytes(i-4),M=4*e;0==(1&M)&&(s>0||M>t.Config.beatsPerBarMax)&&M>=2*t.Config.beatsPerBarMin;)M>>=1,s-=1;M=Math.max(t.Config.beatsPerBarMin,Math.min(t.Config.beatsPerBarMax,M))}else 89==e?(k=o.reader.readInt8(),x=1==o.reader.readUint8(),o.reader.skipBytes(i-2)):o.reader.skipBytes(i)}else{if(240!=s&&247!=s)return console.error("Unrecognized event status: "+s),void this.$();{const t=o.reader.readMidiVariableLength();o.reader.skipBytes(t)}}break;default:return console.error("Unrecognized event type: "+h),void this.$()}!C&&o.reader.hasMore()?o.nextEventMidiTick=E+o.reader.readMidiVariableLength():(o.ended=!0,l&&++r<n.length&&(a[0]=r,n[r].nextEventMidiTick+=E,e=Math.min(e,n[r].nextEventMidiTick),i=!0))}o.ended||(i=!0,e=Math.min(e,o.nextEventMidiTick))}if(!i)break;E=e}const A=6e7/w,C=h/t.Config.partsPerBeat,P=t.Config.partsPerBeat*M,N=Math.ceil(E/C/P);function q(t){return Math.round(t/C)}let R=k;for(x&&(R+=3),1==(1&R)&&(R+=6);R<0;)R+=12;R%=12;const S=[],z=[];for(let e=0;e<16;e++){if(0==b[e].length)continue;const i=new t.Channel,s=t.EditorConfig.midiProgramToPresetValue(b[e][0].program),n=null==s?null:t.EditorConfig.valueToPreset(s),o=9==e,r=o||null!=n&&1==n.isNoise,a=r?t.Config.spectrumBasePitch:t.Config.keys[R].basePitch,l=r?t.Config.noiseInterval:1,c=r?.5:1,f=r?t.Config.drumCount-1:t.Config.maxPitch;r?o?z.unshift(i):z.push(i):S.push(i);let d=1,u=0,m=0,p=t.Config.panCenter;if(o){const s=[];let n=-1,o=null,h=0,r=!1;const a=t.EditorConfig.nameToPresetValue("standard drumset"),l=t.EditorConfig.valueToPreset(a),c=new t.Instrument(!1);c.fromJsonObject(l.settings,!1),c.preset=a,i.instruments.push(c);for(let a=0;a<=b[e].length;a++){const l=a==b[e].length?null:b[e][a],u=null==l?Number.MAX_SAFE_INTEGER:q(l.midiTick);if(s.length>0&&u>h&&(null==l||l.on)){const e=Math.floor(h/P),a=e*P;if(n!=e||null==o){for(n++;n<e;)i.bars[n]=0,n++;o=new t.Pattern,i.patterns.push(o),i.bars[n]=i.patterns.length,o.instrument=0}(!r||c.volume>m)&&(c.volume=m,c.pan=p,r=!0);const l=[];let y=f,b=0,g=1;for(const e of s){const i=t.analogousDrumMap[e];-1==l.indexOf(i.frequency)&&l.push(i.frequency),g=Math.max(g,Math.round(i.volume*d)),y=Math.min(y,i.duration),b=Math.max(b,i.duration)}const v=Math.min(b,Math.max(y,2)),w=h-a,M=Math.min(P,Math.min(u-a,w+6*v)),k=new t.Note(-1,w,M,g,!0);k.pitches.length=0;for(let t=0;t<Math.min(4,l.length);t++){const e=l[t+Math.max(0,l.length-4)];-1==k.pitches.indexOf(e)&&k.pitches.push(e)}o.notes.push(k),s.length=0}null!=l&&l.on&&void 0!=t.analogousDrumMap[l.pitch]&&(s.push(l.pitch),h=u,d=l.velocity,m=l.instrumentVolume,p=l.instrumentPan)}}else{let s=0,n=3,o=0,y=0;function T(t){for(;o<g[e].length&&g[e][o].midiTick<=t;)s=g[e][o].interval,o++}function B(t){for(;y<v[e].length&&v[e][y].midiTick<=t;)n=v[e][y].volume,y++}const w=[],k=[];let x=-1,E=null,A=0,N=0,R=0,S=0;for(let o of b[e]){const e=o.midiTick,y=q(e);if(k.length>0&&y>N){const o=Math.floor(N/P),b=Math.ceil(y/P);for(let g=o;g<b;g++){const o=g*P,b=g*M*h,v=(g+1)*M*h,q=Math.max(0,N-o),z=Math.min(P,y-o),F=Math.max(b,A),L=Math.min(v,e);if(q<z){const e=t.EditorConfig.midiProgramToPresetValue(u),h=null==e?null:t.EditorConfig.valueToPreset(e);if(x!=g||null==E){for(x++;x<g;)i.bars[x]=0,x++;if(E=new t.Pattern,i.patterns.push(E),i.bars[x]=i.patterns.length,void 0==w[u]){const s=new t.Instrument(r);w[u]=s,null!=e&&null!=h&&1==h.isNoise==r?(s.fromJsonObject(h.settings,r),s.preset=e):(s.setTypeAndReset(r?2:0,r),s.chord=0),s.volume=m,s.pan=p,i.instruments.push(s)}E.instrument=i.instruments.indexOf(w[u])}void 0!=w[u]&&(w[u].volume=Math.min(w[u].volume,m),w[u].pan=Math.min(w[u].pan,p));const y=new t.Note(-1,q,z,3,!1);y.pins.length=0,T(F),B(F);const b=k[0]*c-a,v=Math.round((b+s)/l),M=Math.round(s-a);let A=t.makeNotePin(0,0,Math.round(d*n));y.pins.push(A);const P=[{part:0,pitch:v,volume:A.volume,keyPitch:!1,keyVolume:!1}];let N=0,I=(b+s)/l,H=d*n;for(let e=q+1;e<=z;e++){const i=Math.max(F,Math.min(L-1,Math.round(C*(e+o)))),h=e-q,r=e==z;T(i),B(i);const a=(s+b)/l,c=d*n,f=Math.round(a),u=Math.abs(a-f)<.01,m=Math.abs(I-Math.round(I))<.01?Math.abs(a-I)>=1:Math.floor(a)!=Math.floor(I),p=u||m,g=Math.round(c),w=Math.abs(c-g)<.01,M=Math.abs(H-Math.round(H))?Math.abs(c-H)>=1:Math.floor(c)!=Math.floor(H),k=w||M;if(I=a,H=c,p||k||r){const e={part:h,pitch:f,volume:g,keyPitch:p||r,keyVolume:k||r},i=P[N];let s=!1,n=Number.MAX_VALUE;if(e.keyPitch){const t=(e.pitch-i.pitch)/(e.part-i.part);let o=Math.abs(t),h=!1,r=Number.MAX_VALUE;for(let e=N+1;e<P.length;e++){const s=P[e];if(s.keyPitch){const n=i.pitch+t*(s.part-i.part),a=Math.abs(n-s.pitch);o<a&&(o=a,h=!0,r=e)}}h&&(s=!0,n=Math.min(n,r))}if(e.keyVolume){const t=(e.volume-i.volume)/(e.part-i.part);let o=Math.abs(t),h=!1,r=Number.MAX_VALUE;for(let e=N+1;e<P.length;e++){const s=P[e];if(s.keyVolume){const n=i.volume+t*(s.part-i.part),a=Math.abs(n-s.volume);o<a&&(o=a,h=!0,r=e)}}h&&(s=!0,n=Math.min(n,r))}if(s){const e=P[n];y.pins.push(t.makeNotePin(e.pitch-v,e.part,e.volume)),N=n}P.push(e)}}const U=P[P.length-1];y.pins.push(t.makeNotePin(U.pitch-v,U.part,U.volume));let D=f,Z=0;for(const t of y.pins)D=Math.min(D,f-t.interval),Z=Math.min(Z,-t.interval);y.pitches.length=0;for(let t=0;t<Math.min(4,k.length);t++){let e=k[t+Math.max(0,k.length-4)]*c;null!=h&&void 0!=h.midiSubharmonicOctaves&&(e-=12*h.midiSubharmonicOctaves);const i=Math.max(Z,Math.min(D,Math.round((e+M)/l)));if(-1==y.pitches.indexOf(i)){y.pitches.push(i);const t=y.end-y.start;R+=i*t,S+=t}}E.notes.push(y)}}}-1!=k.indexOf(o.pitch)&&k.splice(k.indexOf(o.pitch),1),o.on&&(k.push(o.pitch),d=o.velocity,u=o.program,m=o.instrumentVolume,p=o.instrumentPan),A=e,N=y}const z=R/S;i.octave=r?0:Math.max(0,Math.min(t.Config.scrollableOctaves,Math.round(z/12-1.5)))}for(;i.bars.length<N;)i.bars.push(0)}function F(t,e){for(;t.length>e;){let e=t.length-2,i=t.length-1,s=Number.MAX_VALUE,n=Number.MAX_VALUE;for(let o=0;o<t.length-1;o++)for(let h=o+1;h<t.length;h++){const r=t[o],a=t[h];let l=0,c=0;for(let t=0;t<r.bars.length&&t<a.bars.length;t++)0!=r.bars[t]&&0!=a.bars[t]&&l++,0==r.bars[t]&&0==a.bars[t]&&c++;l<=s&&(l<s||c<n)&&(e=o,i=h,s=l,n=c)}const o=t[e],h=t[i],r=o.instruments.length,a=o.patterns.length;for(const t of h.instruments)o.instruments.push(t);for(const t of h.patterns)t.instrument+=r,o.patterns.push(t);for(let t=0;t<o.bars.length&&t<h.bars.length;t++)0==o.bars[t]&&0!=h.bars[t]&&(o.bars[t]=h.bars[t]+a);t.splice(i,1)}}F(S,t.Config.pitchChannelCountMax),F(z,t.Config.noiseChannelCountMax),this._.goBackToStart(),this._.prompt=null,this._.record(new class extends t.ChangeGroup{constructor(e){super();const i=e.song;i.tempo=Math.max(t.Config.tempoMin,Math.min(t.Config.tempoMax,A)),i.beatsPerBar=M,i.key=R,i.scale=11,i.reverb=1,i.rhythm=1,t.removeDuplicatePatterns(S),t.removeDuplicatePatterns(z),this.append(new t.ChangeReplacePatterns(e,S,z)),i.loopStart=0,i.loopLength=i.barCount,this.et(),e.notifier.changed()}}(this._),"replace")}}}(beepbox||(beepbox={})),function(t){const{button:e,div:i,span:s,select:n,option:o,optgroup:h,input:r,canvas:a}=t.HTML;function l(t,e){for(let i=0;i<e.length;i++)t.appendChild(o({value:i},e[i]));return t}function c(e,i){const s=n({id:i});e?(s.appendChild(o({value:2},t.EditorConfig.valueToPreset(2).name)),s.appendChild(o({value:3},t.EditorConfig.valueToPreset(3).name)),s.appendChild(o({value:4},t.EditorConfig.valueToPreset(4).name))):(s.appendChild(o({value:0},t.EditorConfig.valueToPreset(0).name)),s.appendChild(o({value:6},t.EditorConfig.valueToPreset(6).name)),s.appendChild(o({value:5},t.EditorConfig.valueToPreset(5).name)),s.appendChild(o({value:3},t.EditorConfig.valueToPreset(3).name)),s.appendChild(o({value:1},t.EditorConfig.valueToPreset(1).name)),s.appendChild(o({value:7},t.EditorConfig.valueToPreset(7).name)));for(let i=1;i<t.EditorConfig.presetCategories.length;i++){const n=t.EditorConfig.presetCategories[i],r=h({label:n.name+" ‚ñæ"});let a=!1;for(let t=0;t<n.presets.length;t++){const s=n.presets[t];1==s.isNoise==e&&(r.appendChild(o({value:(i<<6)+t},s.name)),a=!0)}if("String Presets"==n.name&&a){let t=r.removeChild(r.children[11]);r.insertBefore(t,r.children[1])}if("Flute Presets"==n.name&&a){let t=r.removeChild(r.children[11]);r.insertBefore(t,r.children[1])}if("Keyboard Presets"==n.name&&a){let t=r.removeChild(r.children[9]);r.insertBefore(t,r.children[1])}a&&s.appendChild(r)}const r=h({label:"Randomize ‚ñæ"});return r.appendChild(o({value:"randomPreset"},"Random Preset")),r.appendChild(o({value:"randomGenerated"},"Random Generated")),s.appendChild(r),s}function f(t,e){const i=e.toString();t.value!=i&&(t.value=i),$(t).data("select2")&&$(t).val(e).trigger("change.select2")}class d{constructor(e,i,s){this.canvas=e,this._=i,this.zn=s,this.es=null,this.Tn=(e=>{if(this.mouseDown){var i=(e.clientX||e.pageX)-this.canvas.getBoundingClientRect().left,s=Math.floor((e.clientY||e.pageY)-this.canvas.getBoundingClientRect().top);s<2&&(s=2),s>50&&(s=50);var n=this.canvas.getContext("2d");if(1==this.continuousEdit&&Math.abs(this.lastX-i)<40){var o=i<this.lastX?i:this.lastX,h=i<this.lastX?this.lastX:i;for(let e=o;e<=h;e+=2){var r=Math.abs(i-this.lastX)>2?i>this.lastX?1-(e-o)/(h-o):(e-o)/(h-o):0,a=Math.round(s+(this.lastY-s)*r);n.fillStyle="#040410",n.fillRect(2*Math.floor(e/2),0,2,53),n.fillStyle="#393e4f",n.fillRect(2*Math.floor(e/2),25,2,2),n.fillStyle="#1c1d28",n.fillRect(2*Math.floor(e/2),13,2,1),n.fillRect(2*Math.floor(e/2),39,2,1),n.fillStyle=t.ColorConfig.getChannelColor(this._.song,this._.channel).noteBright,n.fillRect(2*Math.floor(e/2),a-2,2,4),this.newArray[Math.floor(e/2)]=a-26}}else n.fillStyle="#040410",n.fillRect(2*Math.floor(i/2),0,2,52),n.fillStyle="#393e4f",n.fillRect(2*Math.floor(i/2),25,2,2),n.fillStyle="#1c1d28",n.fillRect(2*Math.floor(i/2),13,2,1),n.fillRect(2*Math.floor(i/2),39,2,1),n.fillStyle=t.ColorConfig.getChannelColor(this._.song,this._.channel).noteBright,n.fillRect(2*Math.floor(i/2),s-2,2,4),this.newArray[Math.floor(i/2)]=s-26;this.continuousEdit=!0,this.lastX=i,this.lastY=s;let l=this._.song.channels[this._.channel].instruments[this._.getCurrentInstrument()],c=0;for(let t=0;t<this.newArray.length;t++)c+=this.newArray[t];const f=c/this.newArray.length;let d=0,u=0;for(let t=0;t<this.newArray.length;t++)d+=u,u=this.newArray[t]-f,l.customChipWaveIntegral[t]=d;l.customChipWaveIntegral[64]=0}}),this.Bn=(t=>{this.mouseDown=!0,this.Tn(t)}),this.Fn=(()=>{this.mouseDown=!1,this.continuousEdit=!1,this.Ln()}),this.Ln=(()=>{this.es=this.zn(this.newArray),this._.record(this.es),this.es=null}),e.addEventListener("mousemove",this.Tn),e.addEventListener("mousedown",this.Bn),e.addEventListener("mouseup",this.Fn),e.addEventListener("mouseleave",this.Fn),this.mouseDown=!1,this.continuousEdit=!1,this.lastX=0,this.lastY=0,this.newArray=new Float64Array(64),this.redrawCanvas()}redrawCanvas(){var e=this.canvas.getContext("2d");e.fillStyle="#040410",e.fillRect(0,0,128,52),e.fillStyle="#393e4f",e.fillRect(0,25,128,2),e.fillStyle="#1c1d28",e.fillRect(0,13,128,1),e.fillRect(0,39,128,1),e.fillStyle=t.ColorConfig.getChannelColor(this._.song,this._.channel).noteBright;for(let t=0;t<64;t++){var i=this._.song.channels[this._.channel].instruments[this._.getCurrentInstrument()].customChipWave[t]+26;e.fillRect(2*t,i-2,2,4),this.newArray[t]=i-26}}}class u{constructor(t,e,i){this.input=t,this._=e,this.zn=i,this.es=null,this.In="",this.Hn="",this.Un=(()=>{this._.lastChangeWas(this.es)||(this.Hn=this.In),this.es=this.zn(this.Hn,this.input.value),this._.setProspectiveChange(this.es)}),this.Ln=(()=>{this._.record(this.es),this.es=null}),t.addEventListener("input",this.Un),t.addEventListener("change",this.Ln)}updateValue(t){this.In=t,this.input.value=String(t)}}class m{constructor(t,e,i){this.input=t,this._=e,this.zn=i,this.es=null,this.In=0,this.Hn=0,this.Un=(()=>{this._.lastChangeWas(this.es)||(this.Hn=this.In),this.es=this.zn(this.Hn,parseInt(this.input.value)),this._.setProspectiveChange(this.es)}),this.Ln=(()=>{this._.record(this.es),this.es=null}),t.addEventListener("input",this.Un),t.addEventListener("change",this.Ln)}updateValue(t){this.In=t,this.input.value=String(t)}}t.SongEditor=class{constructor(h){this._=h,this.prompt=null,this.Dn=new t.PatternEditor(this._),this.hn=new t.TrackEditor(this._,this),this.Zn=new t.LoopEditor(this._),this.jn=new t.MuteButtonEditor(this._),this.Vn=i({className:"trackEditorOptions",style:"width: 32px; display: flex; flex-direction: row"},[this.jn.container]),this.As=i({className:"trackContainer",tabindex:"1"},[this.hn.container,this.Zn.container]),this.On=i({className:"trackBar",style:"display: flex; flex-direction: row;"},[this.Vn,this.As]),this.Gn=new t.BarScrollBar(this._,this.As),this.Wn=new t.OctaveScrollBar(this._),this.Yn=new t.Piano(this._),this.Jn=i(i({className:"editorBox noSelection",style:"height: 481px; display: flex; flex-direction: row; margin-bottom: 6px;"},this.Yn.container,this.Dn.container,this.Wn.container),this.On,i({style:"display:flex; flex-direction: row;"},i({style:"width: 32px; height: 32px"},[]),this.Gn.container)),this.Qn=e({style:"width: 80px;",type:"button"}),this.Xn=e({className:"prevBarButton",style:"width: 40px;",type:"button",title:"Previous Bar (left bracket)"}),this._n=e({className:"nextBarButton",style:"width: 40px;",type:"button",title:"Next Bar (right bracket)"}),this.Kn=r({title:"main volume",style:"width: 5em; flex-grow: 1; margin: 0;",type:"range",min:"0",max:"115",value:"50",step:"1"}),this.$n=n({style:"width: 100%;"},o({selected:!0,disabled:!0,hidden:!1},"File"),o({value:"new"},"+ New Blank Song"),o({value:"import"},"‚Üë Import Song..."),o({value:"export"},"‚Üì Export Song..."),o({value:"copyUrl"},"‚éò Copy Song URL"),o({value:"shareUrl"},"‚§≥ Share Song URL"),o({value:"viewPlayer"},"‚ñ∂ View in Song Player"),o({value:"copyEmbed"},"‚éò Copy HTML Embed Code")),this.to=n({style:"width: 100%;"},o({selected:!0,disabled:!0,hidden:!1},"Edit"),o({value:"undo"},"Undo (Z)"),o({value:"redo"},"Redo (Y)"),o({value:"copy"},"Copy Pattern (C)"),o({value:"pasteNotes"},"Paste Pattern Notes (V)"),o({value:"pasteNumbers"},"Paste Pattern Numbers (‚áßV)"),o({value:"insertBars"},"Insert Bar After Selection (‚èé)"),o({value:"deleteBars"},"Delete Selected Bar (‚å´)"),o({value:"selectAll"},"Select All (A)"),o({value:"selectChannel"},"Select Channel (‚áßA)"),o({value:"duplicatePatterns"},"Duplicate Reused Patterns (D)"),o({value:"transposeUp"},"Move Notes Up (+)"),o({value:"transposeDown"},"Move Notes Down (-)"),o({value:"forceScale"},"Snap Notes To Scale"),o({value:"forceRhythm"},"Snap Notes To Rhythm"),o({value:"moveNotesSideways"},"Move All Notes Sideways..."),o({value:"beatsPerBar"},"Change Beats Per Bar..."),o({value:"barCount"},"Change Song Length..."),o({value:"channelSettings"},"Channel Settings..."),o({value:"detectKey"},"Detect Key")),this.eo=n({style:"width: 100%;"},o({selected:!0,disabled:!0,hidden:!1},"Preferences"),o({value:"autoPlay"},"Auto Play On Load"),o({value:"autoFollow"},"Auto Follow Track"),o({value:"showLetters"},"Show Piano Keys"),o({value:"showFifth"},'Highlight "Fifth" Notes'),o({value:"showChannels"},"Show All Channels"),o({value:"showScrollBar"},"Octave Scroll Bar"),o({value:"alwaysFineNoteVol"},"Always Fine Note Vol.")),this.io=l(n(),t.Config.scales.map(t=>t.name)),this.so=l(n(),t.Config.keys.map(t=>t.name).reverse()),this.no=new m(r({style:"margin: 0; vertical-align: middle;",type:"range",min:"30",max:"320",value:"160",step:"1"}),this._,(e,i)=>new t.ChangeTempo(this._,e,i)),this.oo=r({style:"width: 4em; font-size: 80%; margin-left: 0.4em; vertical-align: middle;",type:"number",step:"1"}),this.ho=new m(r({style:"margin: 0;",type:"range",min:"0",max:t.Config.reverbRange-1,value:"0",step:"1"}),this._,(e,i)=>new t.ChangeReverb(this._,e,i)),this.ro=l(n(),t.Config.rhythms.map(t=>t.name)),this.ao=c(!1,"pitchPresetSelect"),this.lo=c(!0,"drumPresetSelect"),this.co=l(n(),t.Config.algorithms.map(t=>t.name)),this.fo=i({className:"selectRow"},s({class:"tip",onclick:()=>this.do("algorithm")},"Algorithm: "),i({className:"selectContainer"},this.co)),this.uo=n(),this.mo=i({className:"selectRow",style:"display: none;"},s({class:"tip",onclick:()=>this.do("instrumentIndex")},"Instrument: "),i({className:"selectContainer"},this.uo)),this.po=new m(r({style:"margin: 0; position: sticky;",className:"midTick",type:"range",min:Math.floor(-t.Config.volumeRange/2),max:Math.floor(t.Config.volumeRange/2),value:"0",step:"1"}),this._,(e,i)=>new t.ChangeVolume(this._,e,i)),this.yo=r({style:"width: 4em; font-size: 80%",id:"volumeSliderInputBox",type:"number",step:"1",min:Math.floor(-t.Config.volumeRange/2),max:Math.floor(t.Config.volumeRange/2),value:"0"}),this.bo=i({className:"selectRow",style:"height: 1em"},s({class:"tip",onclick:()=>this.do("instrumentVolume")},"Volume: ")),this.vo=i({className:"selectRow"},i({},i({style:"color: #999"},s({},this.bo)),i({style:"color: #555"},this.yo)),this.po.input),this.wo=new m(r({style:"margin: 0;",position:"sticky;",className:"midTick",type:"range",min:"0",max:t.Config.panMax,value:t.Config.panCenter,step:"1"}),this._,(e,i)=>new t.ChangePan(this._,e,i)),this.Mo=r({style:"width: 4em; font-size: 80%; ",id:"panSliderInputBox",type:"number",step:"1",min:"0",max:"100",value:"0"}),this.ko=i({className:"selectRow"},i({},i({class:"tip",style:"color: #999; height:1em;",onclick:()=>this.do("pan")},"Pan: "),i({style:"color: #555"},this.Mo)),this.wo.input),this.xo=l(n(),t.Config.chipWaves.map(t=>t.name)),this.Eo=l(n(),t.Config.chipNoises.map(t=>t.name)),this.Ao=i({className:"selectRow"},s({class:"tip",onclick:()=>this.do("chipWave")},"Wave: "),i({className:"selectContainer"},this.xo)),this.Co=i({className:"selectRow"},s({class:"tip",onclick:()=>this.do("chipNoise")},"Noise: "),i({className:"selectContainer"},this.Eo)),this.Po=l(n(),t.Config.transitions.map(t=>t.name)),this.No=i({className:"selectRow"},s({class:"tip",onclick:()=>this.do("transition")},"Transition:"),i({className:"selectContainer"},this.Po)),this.qo=l(n(),t.Config.effectsNames),this.Ro=new m(r({style:"margin: 0;",type:"range",min:"0",max:t.Config.filterCutoffRange-1,value:"6",step:"1"}),this._,(e,i)=>new t.ChangeFilterCutoff(this._,e,i)),this.So=i({className:"selectRow",title:"Low-pass Filter Cutoff Frequency"},s({class:"tip",onclick:()=>this.do("filterCutoff")},"Filter Cut:"),this.Ro.input),this.zo=new m(r({style:"margin: 0;",type:"range",min:"0",max:t.Config.filterResonanceRange-1,value:"6",step:"1"}),this._,(e,i)=>new t.ChangeFilterResonance(this._,e,i)),this.To=i({className:"selectRow",title:"Low-pass Filter Peak Resonance"},s({class:"tip",onclick:()=>this.do("filterResonance")},"Filter Peak:"),this.zo.input),this.Bo=l(n(),t.Config.envelopes.map(t=>t.name)),this.Fo=i({className:"selectRow",title:"Low-pass Filter Envelope"},s({class:"tip",onclick:()=>this.do("filterEnvelope")},"Filter Env:"),i({className:"selectContainer"},this.Bo)),this.Lo=l(n(),t.Config.envelopes.map(t=>t.name)),this.Io=i({className:"selectRow",title:"Pulse Width Modulator Envelope"},s({class:"tip",onclick:()=>this.do("pulseEnvelope")},"Pulse Env:"),i({className:"selectContainer"},this.Lo)),this.Ho=new m(r({style:"margin: 0;",type:"range",min:"0",max:t.Config.pulseWidthRange-1,value:"0",step:"1"}),this._,(e,i)=>new t.ChangePulseWidth(this._,e,i)),this.Uo=i({className:"selectRow"},s({class:"tip",onclick:()=>this.do("pulseWidth")},"Pulse Width:"),this.Ho.input),this.Do=l(n(),t.Config.intervals.map(t=>t.name)),this.Zo=i({className:"selectRow"},s({class:"tip",onclick:()=>this.do("interval")},"Interval:"),i({className:"selectContainer"},this.Do)),this.jo=l(n(),t.Config.chords.map(t=>t.name)),this.Vo=i({className:"selectRow"},s({class:"tip",onclick:()=>this.do("chords")},"Chords:"),i({className:"selectContainer"},this.jo)),this.Oo=l(n(),t.Config.vibratos.map(t=>t.name)),this.Go=i({className:"selectRow"},s({class:"tip",onclick:()=>this.do("vibrato")},"Vibrato:"),i({className:"selectContainer"},this.Oo)),this.Wo=i({className:"editor-controls"}),this.Yo=l(n(),t.Config.feedbacks.map(t=>t.name)),this.Jo=i({className:"selectRow"},s({class:"tip",onclick:()=>this.do("feedbackType")},"Feedback:"),i({className:"selectContainer"},this.Yo)),this.Qo=new t.SpectrumEditor(this._,null),this.Xo=i({className:"selectRow"},s({class:"tip",onclick:()=>this.do("spectrum")},"Spectrum:"),this.Qo.container),this._o=new t.HarmonicsEditor(this._),this.Ko=i({className:"selectRow"},s({class:"tip",onclick:()=>this.do("harmonics")},"Harmonics:"),this._o.container),this.$o=i({className:"editor-controls"}),this.th=e({style:"max-width:86px;",className:"copyButton"},["Copy",t.SVG.svg({style:"flex-shrink: 0; position: absolute; left: 0; top: 50%; margin-top: -1em; pointer-events: none;",width:"2em",height:"2em",viewBox:"-5 -21 26 26"},[t.SVG.path({d:"M 0 -15 L 1 -15 L 1 0 L 13 0 L 13 1 L 0 1 L 0 -15 z M 2 -1 L 2 -17 L 10 -17 L 14 -13 L 14 -1 z M 3 -2 L 13 -2 L 13 -12 L 9 -12 L 9 -16 L 3 -16 z",fill:"currentColor"})])]),this.eh=e({style:"max-width:86px;",className:"pasteButton"},["Paste",t.SVG.svg({style:"flex-shrink: 0; position: absolute; left: 0; top: 50%; margin-top: -1em; pointer-events: none;",width:"2em",height:"2em",viewBox:"0 0 26 26"},[t.SVG.path({d:"M 8 18 L 6 18 L 6 5 L 17 5 L 17 7 M 9 8 L 16 8 L 20 12 L 20 22 L 9 22 z",stroke:"currentColor",fill:"none"}),t.SVG.path({d:"M 9 3 L 14 3 L 14 6 L 9 6 L 9 3 z M 16 8 L 20 12 L 16 12 L 16 8 z",fill:"currentColor"})])]),this.ih=new d(a({width:128,height:52,style:"border:2px solid #393e4f;",id:"customWaveDrawCanvas"}),this._,e=>new t.ChangeCustomWave(this._,e)),this.sh=function(t,e,i){e.appendChild(o({selected:!0,disabled:!0,value:t},t));for(const t of i)e.appendChild(o({value:t},t));return e}("Load Preset",n({style:"height:1.5em; text-align: center; text-align-last: center;"}),t.Config.chipWaves.map(t=>t.name)),this.nh=i({style:"height:80px; margin-top:10px; margin-bottom:5px"},[i({style:"height:54px; display:flex; justify-content:center;"},[this.ih.canvas]),i({style:"margin-top:5px; display:flex; justify-content:center;"},[this.sh])]),this.oh=new u(r({style:"border:none; background-color:#040410; color:#FFFFFF; text-align:center",maxlength:"30",type:"text",value:"JummBox 1.3"}),this._,(e,i)=>new t.ChangeInputBoxText(this._,e,i)),this.hh=new m(r({style:"margin: 0; width: 4em;",type:"range",min:"0",max:t.Config.operatorAmplitudeMax,value:"0",step:"1",title:"Feedback Amplitude"}),this._,(e,i)=>new t.ChangeFeedbackAmplitude(this._,e,i)),this.rh=l(n({style:"width: 100%;",title:"Feedback Envelope"}),t.Config.envelopes.map(t=>t.name)),this.ah=i({className:"operatorRow"},i({style:"margin-right: .1em; visibility: hidden;"},"1."),i({style:"width: 3em; margin-right: .3em;"}),this.hh.input,i({className:"selectContainer",style:"width: 5em; margin-left: .3em;"},this.rh)),this.lh=i({className:"editor-controls"},this.Ao,this.Co,this.nh,this.So,this.To,this.Fo,this.No,i({className:"selectRow"},s({class:"tip",onclick:()=>this.do("effects")},"Effects:"),i({className:"selectContainer"},this.qo)),this.Vo,this.Go,this.Zo,this.fo,this.Wo,this.Jo,this.ah,this.Xo,this.Ko,this.$o,this.Io,this.Uo),this.fh=i({},i({className:"selectRow"},this.th,this.eh)),this.dh=i({className:"editor-controls"},this.mo,i({className:"selectRow",id:"typeSelectRow"},s({class:"tip",onclick:()=>this.do("instrumentType")},"Type: "),i(i({className:"pitchSelect"},this.ao),i({className:"drumSelect"},this.lo))),this.vo,this.ko,this.lh),this.uh=t.SVG.path({d:"M -6 -6 H 6 V 6 H -6 V -6 M -2 -3 L -2 -3 L -1 -4 H 1 V 4 H -1 V -1.2 L -1.2 -1 H -2 V -3 z",fill:"#393e4f","fill-rule":"evenodd"}),this.mh=t.SVG.path({d:"M -6 -0.8 H -3.8 V -6 H 0.8 V 4.4 H 2.2 V -0.8 H 6 V 0.8 H 3.8 V 6 H -0.8 V -4.4 H -2.2 V 0.8 H -6 z",fill:"#393e4f"}),this.ph=i({className:"promptContainer",style:"display: none;"}),this.mainLayer=i({className:"beepboxEditor",tabIndex:"0"},this.Jn,i({className:"editor-widget-column noSelection"},i({style:"text-align: center; color: #79B;"},[this.oh.input]),i({className:"editor-widgets"},i({className:"editor-controls"},i({className:"playback-controls"},i({className:"playback-bar-controls"},this.Qn,this.Xn,this._n),i({className:"playback-volume-controls"},t.SVG.svg({style:"flex-shrink: 0;",width:"2em",height:"2em",viewBox:"0 0 26 26"},t.SVG.path({d:"M 4 16 L 4 10 L 8 10 L 13 5 L 13 21 L 8 16 z M 15 11 L 16 10 A 7.2 7.2 0 0 1 16 16 L 15 15 A 5.8 5.8 0 0 0 15 12 z M 18 8 L 19 7 A 11.5 11.5 0 0 1 19 19 L 18 18 A 10.1 10.1 0 0 0 18 8 z",fill:"#777"})),this.Kn))),i({className:"editor-settings"},i({className:"editor-song-settings"},i({className:"editor-menus"},i({className:"selectContainer menu"},this.$n,t.SVG.svg({style:"flex-shrink: 0; position: absolute; left: 0; top: 50%; margin-top: -1em; pointer-events: none;",width:"2em",height:"2em",viewBox:"-5 -21 26 26"},t.SVG.path({d:"M 2 0 L 2 -16 L 10 -16 L 14 -12 L 14 0 z M 3 -1 L 13 -1 L 13 -11 L 9 -11 L 9 -15 L 3 -15 z",fill:"currentColor"}))),i({className:"selectContainer menu"},this.to,t.SVG.svg({style:"flex-shrink: 0; position: absolute; left: 0; top: 50%; margin-top: -1em; pointer-events: none;",width:"2em",height:"2em",viewBox:"-5 -21 26 26"},t.SVG.path({d:"M 0 0 L 1 -4 L 4 -1 z M 2 -5 L 10 -13 L 13 -10 L 5 -2 zM 11 -14 L 13 -16 L 14 -16 L 16 -14 L 16 -13 L 14 -11 z",fill:"currentColor"}))),i({className:"selectContainer menu"},this.eo,t.SVG.svg({style:"flex-shrink: 0; position: absolute; left: 0; top: 50%; margin-top: -1em; pointer-events: none;",width:"2em",height:"2em",viewBox:"-13 -13 26 26"},t.SVG.path({d:"M 5.78 -1.6 L 7.93 -0.94 L 7.93 0.94 L 5.78 1.6 L 4.85 3.53 L 5.68 5.61 L 4.21 6.78 L 2.36 5.52 L 0.27 5.99 L -0.85 7.94 L -2.68 7.52 L -2.84 5.28 L -4.52 3.95 L -6.73 4.28 L -7.55 2.59 L -5.9 1.07 L -5.9 -1.07 L -7.55 -2.59 L -6.73 -4.28 L -4.52 -3.95 L -2.84 -5.28 L -2.68 -7.52 L -0.85 -7.94 L 0.27 -5.99 L 2.36 -5.52 L 4.21 -6.78 L 5.68 -5.61 L 4.85 -3.53 M 2.92 0.67 L 2.92 -0.67 L 2.35 -1.87 L 1.3 -2.7 L 0 -3 L -1.3 -2.7 L -2.35 -1.87 L -2.92 -0.67 L -2.92 0.67 L -2.35 1.87 L -1.3 2.7 L -0 3 L 1.3 2.7 L 2.35 1.87 z",fill:"currentColor"})))),i({className:"editor-settings"},i({className:"editor-song-settings"},i({style:"margin: 3px 0; position: relative; text-align: center; color: #999;"},i({class:"tip",style:"flex-shrink: 0; position:absolute; left: 0; top: 0; width: 12px; height: 12px",onclick:()=>this.do("usedPattern")},t.SVG.svg({style:"flex-shrink: 0; position: absolute; left: 0; top: 0; pointer-events: none;",width:"12px",height:"12px","margin-right":"0.5em",viewBox:"-6 -6 12 12"},this.uh)),i({class:"tip",style:"flex-shrink: 0; position: absolute; left: 14px; top: 0; width: 12px; height: 12px",onclick:()=>this.do("usedInstrument")},t.SVG.svg({style:"flex-shrink: 0; position: absolute; left: 0; top: 0; pointer-events: none;",width:"12px",height:"12px","margin-right":"1em",viewBox:"-6 -6 12 12"},this.mh)),"Song Settings"))),i({className:"selectRow"},s({class:"tip",onclick:()=>this.do("scale")},"Scale: "),i({className:"selectContainer"},this.io)),i({className:"selectRow"},s({class:"tip",onclick:()=>this.do("key")},"Key: "),i({className:"selectContainer"},this.so)),i({className:"selectRow"},i({style:"color: #999"},s({},i({class:"tip",style:"color: #999; height:1em;",onclick:()=>this.do("tempo")},"Tempo: ")),i({style:"color: #555"},this.oo)),this.no.input),i({className:"selectRow"},s({class:"tip",onclick:()=>this.do("reverb")},"Reverb: "),this.ho.input),i({className:"selectRow"},s({class:"tip",onclick:()=>this.do("rhythm")},"Rhythm: "),i({className:"selectContainer"},this.ro))),i({className:"editor-instrument-settings"},i({style:"margin: 3px 0; text-align: center; color: #999;"},"Instrument Settings"),this.dh,this.fh)))),this.ph),this.yh=!1,this.bh=null,this.gh=[],this.vh=[],this.wh=[],this.Mh=[],this.kh=[],this.xh=[],this.Eh=(()=>{this.mainLayer.focus()}),this.whenUpdated=(()=>{const e=this.As.getBoundingClientRect();this._.trackVisibleBars=Math.floor((e.right-e.left)/32),this.hn.render(),this.Gn.render(),this.jn.render();const i=[(this._.autoPlay?"‚úì ":"")+"Auto Play On Load",(this._.autoFollow?"‚úì ":"")+"Auto Follow Track",(this._.showLetters?"‚úì ":"")+"Show Piano Keys",(this._.showFifth?"‚úì ":"")+'Highlight "Fifth" Notes',(this._.showChannels?"‚úì ":"")+"Show All Channels",(this._.showScrollBar?"‚úì ":"")+"Octave Scroll Bar",(this._.alwaysFineNoteVol?"‚úì ":"")+"Always Fine Note Vol."];for(let t=0;t<i.length;t++){const e=this.eo.children[t+1];e.innerText!=i[t]&&(e.innerText=i[t])}const s=this._.song.channels[this._.channel],n=this._.getCurrentPattern(),o=this._.getCurrentInstrument(),h=s.instruments[o],r=this.mainLayer.contains(document.activeElement),a=document.activeElement;f(this.io,this._.song.scale),f(this.so,t.Config.keys.length-1-this._.song.key),this.no.updateValue(Math.max(0,this._.song.tempo)),this.oo.value=this._.song.tempo.toString(),this.oh.updateValue(this._.song.title),this.ho.updateValue(this._.song.reverb);var c=!1,d=!1;if(0!=s.bars[this._.bar]){for(let t=0;t<this._.song.barCount;t++)s.bars[t]==s.bars[this._.bar]&&t!=this._.bar&&(t<this.hn.Mi||t>=this.hn.Mi+this.hn.xi||this._.channel<this.hn.ki||this._.channel>=this.hn.ki+this.hn.Ei)&&(d=!0,t=this._.song.barCount);for(let t=0;t<this._.song.barCount;t++)0!=s.bars[t]&&this._.song.getPatternInstrument(this._.channel,t)==o&&t!=this._.bar&&(t<this.hn.Mi||t>=this.hn.Mi+this.hn.xi||this._.channel<this.hn.ki||this._.channel>=this.hn.ki+this.hn.Ei)&&(c=!0,t=this._.song.barCount)}if(d?this.uh.style.setProperty("fill","#9c64f7"):this.uh.style.setProperty("fill","#393e4f"),c?this.mh.style.setProperty("fill","#9c64f7"):this.mh.style.setProperty("fill","#393e4f"),f(this.ro,this._.song.rhythm),this._.song.getChannelIsNoise(this._.channel)?(this.ao.style.display="none",this.lo.style.display="",$("#pitchPresetSelect").parent().hide(),$("#drumPresetSelect").parent().show(),f(this.lo,h.preset)):(this.ao.style.display="",this.lo.style.display="none",$("#pitchPresetSelect").parent().show(),$("#drumPresetSelect").parent().hide(),f(this.ao,h.preset)),this._.alwaysShowSettings||h.preset==h.type){if(2==h.type?(this.Co.style.display="",f(this.Eo,h.chipNoise)):this.Co.style.display="none",3==h.type?(this.Ao.style.display="none",this.Xo.style.display="",this.Qo.render()):this.Xo.style.display="none",5==h.type?(this.Ao.style.display="none",this.Ko.style.display="",this._o.render()):this.Ko.style.display="none",4==h.type){this.Ao.style.display="none",this.$o.style.display="",this.No.style.display="none",this.Vo.style.display="none",this.So.style.display="none",this.To.style.display="none",this.Fo.style.display="none";for(let e=0;e<t.Config.drumCount;e++)f(this.xh[e],h.drumsetEnvelopes[e]),this.kh[e].render()}else this.$o.style.display="none",this.No.style.display="",this.Vo.style.display="",this.So.style.display="",this.To.style.display="",this.Fo.style.display="";if(0==h.type&&(this.Ao.style.display="",f(this.xo,h.chipWave)),7==h.type?(this.nh.style.display="",this.Ao.style.display="none"):this.nh.style.display="none",1==h.type){this.Ao.style.display="none",this.fo.style.display="",this.Wo.style.display="",this.Jo.style.display="",this.ah.style.display="",f(this.co,h.algorithm),f(this.Yo,h.feedbackType),this.hh.updateValue(h.feedbackAmplitude),f(this.rh,h.feedbackEnvelope),this.rh.parentElement.style.color=h.feedbackAmplitude>0?"":"#999";for(let e=0;e<t.Config.operatorCount;e++){const i=e<t.Config.algorithms[h.algorithm].carrierCount;this.gh[e].style.color=i?"white":"",f(this.Mh[e],h.operators[e].frequency),this.vh[e].updateValue(h.operators[e].amplitude),f(this.wh[e],h.operators[e].envelope);const s=(i?"Voice ":"Modulator ")+(e+1);this.Mh[e].title=s+" Frequency",this.vh[e].input.title=s+(i?" Volume":" Amplitude"),this.wh[e].title=s+" Envelope",this.wh[e].parentElement.style.color=h.operators[e].amplitude>0?"":"#999"}}else this.fo.style.display="none",this.Wo.style.display="none",this.Jo.style.display="none",this.ah.style.display="none";if(6==h.type?(this.Ao.style.display="none",this.Io.style.display="",this.Uo.style.display="",this.Ho.input.title=t.prettyNumber(h.pulseWidth)+"%",f(this.Lo,h.pulseEnvelope),this.Ho.updateValue(h.pulseWidth)):(this.Io.style.display="none",this.Uo.style.display="none"),2==h.type)this.Ao.style.display="none",this.Go.style.display="none",this.Zo.style.display="none";else if(3==h.type)this.Go.style.display="none",this.Zo.style.display="none";else if(4==h.type)this.Go.style.display="none",this.Zo.style.display="none";else if(0==h.type)this.Go.style.display="",this.Zo.style.display="";else if(1==h.type)this.Go.style.display="",this.Zo.style.display="none";else if(5==h.type)this.Go.style.display="",this.Zo.style.display="";else if(6==h.type)this.Go.style.display="",this.Zo.style.display="none";else{if(7!=h.type)throw new Error("Unrecognized instrument type: "+h.type);this.Go.style.display="",this.Zo.style.display=""}}for(let e=0;e<t.Config.chords.length;e++){const i=!t.Config.instrumentTypeHasSpecialInterval[h.type]&&t.Config.chords[e].isCustomInterval,s=this.jo.children[e];i?s.hasAttribute("hidden")||s.setAttribute("hidden",""):s.removeAttribute("hidden")}for(let e=0;e<t.Config.effectsNames.length;e++){const i=!t.Config.instrumentTypeHasChorus[h.type]&&-1!=t.Config.effectsNames[e].indexOf("chorus"),s=this.qo.children[e];i?s.hasAttribute("hidden")||s.setAttribute("hidden",""):s.removeAttribute("hidden")}if(this.mo.style.display=this._.song.instrumentsPerChannel>1?"":"none",this.mo.style.visibility=null==n?"hidden":"",this.uo.children.length!=this._.song.instrumentsPerChannel){for(;this.uo.firstChild;)this.uo.removeChild(this.uo.firstChild);const t=[];for(let e=0;e<this._.song.instrumentsPerChannel;e++)t.push(e+1);l(this.uo,t)}this.dh.style.color=t.ColorConfig.getChannelColor(this._.song,this._.channel).noteBright,this.Ro.updateValue(h.filterCutoff),this.zo.updateValue(h.filterResonance),f(this.Bo,h.filterEnvelope),f(this.Po,h.transition),f(this.qo,h.effects),f(this.Oo,h.vibrato),f(this.Do,h.interval),f(this.jo,h.chord),this.wo.updateValue(h.pan),this.ih.redrawCanvas(),this.Mo.value=h.pan+"",this.po.updateValue(h.volume),this.yo.value=""+h.volume,f(this.uo,o),this.Yn.container.style.display=this._.showLetters?"":"none",this.Wn.container.style.display=this._.showScrollBar?"":"none",this.Gn.container.style.display=this._.song.barCount>this._.trackVisibleBars?"":"none";let u=512;this._.showLetters&&(u-=32),this._.showScrollBar&&(u-=20),this.Dn.container.style.width=String(u)+"px",this.Kn.value=String(this._.volume),r&&null!=a&&0==a.clientWidth&&this.Eh(),this.Ah(this._.prompt),this._.autoFollow&&!this._.synth.playing&&this._.synth.snapToBar(this._.bar)}),this.Ch=(t=>{17==t.keyCode&&(this.Dn.controlMode=!1)}),this.Ph=(t=>{switch(t.keyCode){case 8:case 13:case 38:case 40:case 37:case 39:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:t.stopPropagation()}}),this.sn=(e=>{if(this.prompt)27==e.keyCode&&window.history.back();else if(document.activeElement!=this.oh.input)if(document.activeElement!=this.Mo&&document.activeElement!=this.yo)switch(this.hn.onKeyPressed(e),e.keyCode){case 17:this.Dn.controlMode=!0;break;case 32:this.Nh(),e.preventDefault();break;case 90:e.shiftKey?this._.redo():this._.undo(),e.preventDefault();break;case 89:this._.redo(),e.preventDefault();break;case 67:this.hn.copy(),e.preventDefault();break;case 13:this.hn.insertBars(),e.preventDefault();break;case 8:this.hn.deleteBars(),e.preventDefault();break;case 65:e.shiftKey?this.hn.selectChannel():this.hn.selectAll(),e.preventDefault();break;case 68:this.hn.duplicatePatterns(),e.preventDefault();break;case 70:this._.synth.firstBar(),this._.autoFollow&&new t.ChangeChannelBar(this._,this._.channel,Math.floor(this._.synth.playhead)),e.preventDefault();break;case 72:this._.synth.jumpToEditingBar(this._.bar),new t.ChangeChannelBar(this._,this._.channel,Math.floor(this._.synth.playhead)),e.preventDefault();break;case 78:if(e.shiftKey||e.ctrlKey){let t=0;for(;this._.song.channels[this._.channel].patterns[t].notes.length>0&&t<=this._.song.patternsPerChannel;)t++;t<=this._.song.patternsPerChannel&&(this._.song.channels[this._.channel].bars[this._.bar]=t+1,this._.notifier.changed())}else{let t=1;for(;-1!=this._.song.channels[this._.channel].bars.indexOf(t)&&t<=this._.song.patternsPerChannel;)t++;t<=this._.song.patternsPerChannel&&(this._.song.channels[this._.channel].bars[this._.bar]=t,this._.notifier.changed())}e.preventDefault();break;case 77:if(e.shiftKey){var i=!0;for(let t=0;t<this._.song.getChannelCount();t++)1==this.jn.vt[t].getMuteState()&&(i=!1);if(0==i)for(let t=0;t<this._.song.getChannelCount();t++)1==this.jn.vt[t].getMuteState()&&this.jn.vt[t].toggleMute(),this._.song.channels[t].muted=this.jn.vt[t].getMuteState();else for(let t=0;t<this._.song.getChannelCount();t++)0==this.jn.vt[t].getMuteState()&&this.jn.vt[t].toggleMute(),this._.song.channels[t].muted=this.jn.vt[t].getMuteState();e.preventDefault()}else this.jn.vt[this._.channel].toggleMute(),this._.song.channels[this._.channel].muted=this.jn.vt[this._.channel].getMuteState(),e.preventDefault();break;case 83:i=!1;for(let t=0;t<this._.song.getChannelCount();t++)this.jn.vt[t].getMuteState()==(t==this._.channel)&&(i=!0);if(0==i)for(let t=0;t<this._.song.getChannelCount();t++)1==this.jn.vt[t].getMuteState()&&this.jn.vt[t].toggleMute(),this._.song.channels[t].muted=this.jn.vt[t].getMuteState();else for(let t=0;t<this.jn.vt.length;t++)t==this._.channel&&1==this.jn.vt[t].getMuteState()?this.jn.vt[t].toggleMute():t!=this._.channel&&0==this.jn.vt[t].getMuteState()&&this.jn.vt[t].toggleMute(),this._.song.channels[t].muted=this.jn.vt[t].getMuteState();e.preventDefault();break;case 86:e.shiftKey?this.hn.pasteNumbers():this.hn.pasteNotes(),e.preventDefault();break;case 73:if(e.shiftKey){const t=this._.song.channels[this._.channel].instruments[this._.getCurrentInstrument()].toJsonObject();delete t.volume,delete t.pan,delete t.preset,this.qh(JSON.stringify(t))}e.preventDefault();break;case 219:this._.synth.prevBar(),this._.autoFollow&&new t.ChangeChannelBar(this._,this._.channel,Math.floor(this._.synth.playhead)),e.preventDefault();break;case 221:this._.synth.nextBar(),this._.autoFollow&&new t.ChangeChannelBar(this._,this._.channel,Math.floor(this._.synth.playhead)),e.preventDefault();break;case 189:case 173:this.hn.transpose(!1,e.shiftKey||e.ctrlKey),e.preventDefault();break;case 187:case 61:this.hn.transpose(!0,e.shiftKey||e.ctrlKey),e.preventDefault()}else 13!=e.keyCode&&27!=e.keyCode||this.mainLayer.focus();else 13!=e.keyCode&&27!=e.keyCode||this.mainLayer.focus()}),this.Rh=(()=>{this._.synth.prevBar()}),this.Sh=(()=>{this._.synth.nextBar()}),this.Nh=(()=>{this._.synth.playing?this.zh():this.Th()}),this.Bh=(()=>{this._.setVolume(Number(this.Kn.value))}),this.Fh=(()=>{this._.record(new t.ChangeTempo(this._,-1,0|parseInt(this.oo.value)))}),this.Lh=(()=>{this._.record(new t.ChangeScale(this._,this.io.selectedIndex))}),this.Ih=(()=>{this._.record(new t.ChangeKey(this._,t.Config.keys.length-1-this.so.selectedIndex))}),this.Hh=(()=>{this._.record(new t.ChangeRhythm(this._,this.ro.selectedIndex))}),this.Uh=(()=>{var t=this;setTimeout(function(){t.mainLayer.focus()},20)}),this.Dh=(()=>{this.Zh($("#pitchPresetSelect").val()+"")}),this.jh=(()=>{this.Zh($("#drumPresetSelect").val()+"")}),this.Vh=(()=>{this._.record(new t.ChangeFeedbackType(this._,this.Yo.selectedIndex))}),this.Oh=(()=>{this._.record(new t.ChangeFeedbackEnvelope(this._,this.rh.selectedIndex))}),this.Gh=(()=>{this._.record(new t.ChangeAlgorithm(this._,this.co.selectedIndex))}),this.Wh=(()=>{this.hn.setInstrument(this.uo.selectedIndex)}),this.Yh=(()=>{this._.record(new t.ChangeChipWave(this._,this.xo.selectedIndex))}),this.Jh=(()=>{this._.record(new t.ChangeNoiseWave(this._,this.Eo.selectedIndex))}),this.Qh=(()=>{this._.record(new t.ChangeFilterEnvelope(this._,this.Bo.selectedIndex))}),this.Xh=(()=>{this._.record(new t.ChangePulseEnvelope(this._,this.Lo.selectedIndex))}),this._h=(()=>{this._.record(new t.ChangeTransition(this._,this.Po.selectedIndex))}),this.Kh=(()=>{this._.record(new t.ChangeEffects(this._,this.qo.selectedIndex))}),this.$h=(()=>{this._.record(new t.ChangeVibrato(this._,this.Oo.selectedIndex))}),this.tr=(()=>{this._.record(new t.ChangeInterval(this._,this.Do.selectedIndex))}),this.er=(()=>{this._.record(new t.ChangeChord(this._,this.jo.selectedIndex))}),this.ir=(e=>{switch(this.$n.value){case"new":this._.goBackToStart(),this._.record(new t.ChangeSong(this._,""));break;case"export":this.do("export");break;case"import":this.do("import");break;case"copyUrl":this.qh(location.href);break;case"shareUrl":navigator.share({url:location.href});break;case"viewPlayer":location.href="player/#song="+this._.song.toBase64String();break;case"copyEmbed":this.qh(`<iframe width="384" height="60" style="border: none;" src="${new URL("player/#song="+this._.song.toBase64String(),location.href).href}"></iframe>`)}this.$n.selectedIndex=0}),this.sr=(e=>{switch(this.to.value){case"undo":this._.undo();break;case"redo":this._.redo();break;case"copy":this.hn.copy();break;case"insertBars":this.hn.insertBars();break;case"deleteBars":this.hn.deleteBars();break;case"pasteNotes":this.hn.pasteNotes();break;case"pasteNumbers":this.hn.pasteNumbers();break;case"transposeUp":this.hn.transpose(!0,!1);break;case"transposeDown":this.hn.transpose(!1,!1);break;case"selectAll":this.hn.selectAll();break;case"selectChannel":this.hn.selectChannel();break;case"duplicatePatterns":this.hn.duplicatePatterns();break;case"detectKey":this._.record(new t.ChangeDetectKey(this._));break;case"forceScale":this.hn.forceScale();break;case"forceRhythm":this.hn.forceRhythm();break;case"barCount":this.do("barCount");break;case"beatsPerBar":this.do("beatsPerBar");break;case"moveNotesSideways":this.do("moveNotesSideways");break;case"channelSettings":this.do("channelSettings")}this.to.selectedIndex=0}),this.nr=(t=>{switch(this.eo.value){case"autoPlay":this._.autoPlay=!this._.autoPlay;break;case"autoFollow":this._.autoFollow=!this._.autoFollow;break;case"showLetters":this._.showLetters=!this._.showLetters;break;case"showFifth":this._.showFifth=!this._.showFifth;break;case"showChannels":this._.showChannels=!this._.showChannels;break;case"showScrollBar":this._.showScrollBar=!this._.showScrollBar;break;case"alwaysFineNoteVol":this._.alwaysFineNoteVol=!this._.alwaysFineNoteVol}this.eo.selectedIndex=0,this._.notifier.changed(),this._.savePreferences()}),this.or=(e=>{let i=new Float64Array(64),s=this.sh.selectedIndex-1,n=Number.MIN_VALUE,o=Number.MAX_VALUE,h=0,r=(t.Config.chipWaves[s].samples.length-1)/64;for(let e=0;e<64;e++)i[e]=(t.Config.chipWaves[s].samples[Math.floor(h)]-t.Config.chipWaves[s].samples[Math.floor(h)+1])/r,i[e]<o&&(o=i[e]),i[e]>n&&(n=i[e]),h+=r;for(let t=0;t<64;t++)i[t]-=o,i[t]/=n-o,i[t]*=48,i[t]-=24,i[t]=Math.ceil(i[t]),this.ih.newArray[t]=i[t];this._.record(new t.ChangeCustomWave(this._,i)),this._.record(new t.ChangeVolume(this._,+this.po.input.value,-t.Config.volumeRange/2+Math.round(t.Config.chipWaves[s].volume*t.Config.volumeRange/2))),this.sh.selectedIndex=0,this._.notifier.changed(),this._.savePreferences()}),this._.notifier.watch(this.whenUpdated),"share"in navigator||this.$n.removeChild(this.$n.querySelector("[value='shareUrl']")),this.Wo.appendChild(i({className:"operatorRow",style:"color: #999; height: 1em; margin-top: 0.5em;"},i({style:"margin-right: .1em; visibility: hidden;"},"1."),i({style:"width: 3em; margin-right: .3em;",class:"tip",onclick:()=>this.do("operatorFrequency")},"Freq:"),i({style:"width: 4em; margin: 0;",class:"tip",onclick:()=>this.do("operatorVolume")},"Volume:"),i({style:"width: 5em; margin-left: .3em;",class:"tip",onclick:()=>this.do("operatorEnvelope")},"Envelope:")));for(let e=0;e<t.Config.operatorCount;e++){const s=e,o=i({style:"margin-right: .1em; color: #999;"},e+1+"."),h=l(n({style:"width: 100%;",title:"Frequency"}),t.Config.operatorFrequencies.map(t=>t.name)),a=new m(r({style:"margin: 0; width: 4em;",type:"range",min:"0",max:t.Config.operatorAmplitudeMax,value:"0",step:"1",title:"Volume"}),this._,(e,i)=>new t.ChangeOperatorAmplitude(this._,s,e,i)),c=l(n({style:"width: 100%;",title:"Envelope"}),t.Config.envelopes.map(t=>t.name)),f=i({className:"operatorRow"},o,i({className:"selectContainer",style:"width: 3em; margin-right: .3em;"},h),a.input,i({className:"selectContainer",style:"width: 5em; margin-left: .3em;"},c));this.Wo.appendChild(f),this.gh[e]=f,this.vh[e]=a,this.wh[e]=c,this.Mh[e]=h,c.addEventListener("change",()=>{this._.record(new t.ChangeOperatorEnvelope(this._,s,c.selectedIndex))}),h.addEventListener("change",()=>{this._.record(new t.ChangeOperatorFrequency(this._,s,h.selectedIndex))})}this.$o.appendChild(i({className:"selectRow"},s({class:"tip",onclick:()=>this.do("drumsetEnvelope")},"Envelope:"),s({class:"tip",onclick:()=>this.do("drumsetSpectrum")},"Spectrum:")));for(let e=t.Config.drumCount-1;e>=0;e--){const s=e,o=new t.SpectrumEditor(this._,s);o.container.addEventListener("mousedown",this.Eh),this.kh[e]=o;const h=l(n({style:"width: 100%;",title:"Filter Envelope"}),t.Config.envelopes.map(t=>t.name));this.xh[e]=h,h.addEventListener("change",()=>{this._.record(new t.ChangeDrumsetEnvelope(this._,s,h.selectedIndex))});const r=i({className:"selectRow"},i({className:"selectContainer",style:"width: 5em; margin-right: .3em;"},h),this.kh[e].container);this.$o.appendChild(r)}if(this.$n.addEventListener("change",this.ir),this.to.addEventListener("change",this.sr),this.eo.addEventListener("change",this.nr),this.sh.addEventListener("change",this.or),this.oo.addEventListener("change",this.Fh),this.io.addEventListener("change",this.Lh),this.so.addEventListener("change",this.Ih),this.ro.addEventListener("change",this.Hh),this.co.addEventListener("change",this.Gh),this.uo.addEventListener("change",this.Wh),this.Yo.addEventListener("change",this.Vh),this.rh.addEventListener("change",this.Oh),this.xo.addEventListener("change",this.Yh),this.Eo.addEventListener("change",this.Jh),this.Po.addEventListener("change",this._h),this.qo.addEventListener("change",this.Kh),this.Bo.addEventListener("change",this.Qh),this.Lo.addEventListener("change",this.Xh),this.Do.addEventListener("change",this.tr),this.jo.addEventListener("change",this.er),this.Oo.addEventListener("change",this.$h),this.Qn.addEventListener("click",this.Nh),this.Xn.addEventListener("click",this.Rh),this._n.addEventListener("click",this.Sh),this.Kn.addEventListener("input",this.Bh),this.Jn.addEventListener("mousedown",this.Eh),this.Qo.container.addEventListener("mousedown",this.Eh),this._o.container.addEventListener("mousedown",this.Eh),this.oo.addEventListener("keydown",this.Ph,!1),this.mainLayer.addEventListener("keydown",this.sn),this.mainLayer.addEventListener("keyup",this.Ch),this.th.addEventListener("click",this.hr.bind(this)),this.eh.addEventListener("click",this.rr.bind(this)),this.yo.addEventListener("input",()=>{this._.record(new t.ChangeVolume(this._,this._.song.channels[this._.channel].instruments[this._.getCurrentInstrument()].volume,Math.min(25,Math.max(-25,Math.round(+this.yo.value)))))}),this.Mo.addEventListener("input",()=>{this._.record(new t.ChangePan(this._,this._.song.channels[this._.channel].instruments[this._.getCurrentInstrument()].pan,Math.min(100,Math.max(0,Math.round(+this.Mo.value)))))}),this.nh.addEventListener("input",()=>{this._.record(new t.ChangeCustomWave(this._,this.ih.newArray))}),this.ph.addEventListener("click",t=>{t.target==this.ph&&this._.undo()}),t.isMobile){const t=this.eo.children[1];t.disabled=!0,t.setAttribute("hidden","")}}changeInstrument(t){this.uo.selectedIndex=t,this.Wh()}do(t){this._.openPrompt(t),this.Ah(t)}Ah(e){if(this.bh!=e&&(this.bh=e,this.prompt&&(!this.yh||this.prompt instanceof t.TipPrompt||this.Th(),this.yh=!1,this.ph.style.display="none",this.ph.removeChild(this.prompt.container),this.prompt.cleanUp(),this.prompt=null,this.mainLayer.focus()),e)){switch(e){case"export":this.prompt=new t.ExportPrompt(this._);break;case"import":this.prompt=new t.ImportPrompt(this._);break;case"barCount":this.prompt=new t.SongDurationPrompt(this._,this.hn);break;case"beatsPerBar":this.prompt=new t.BeatsPerBarPrompt(this._);break;case"moveNotesSideways":this.prompt=new t.MoveNotesSidewaysPrompt(this._);break;case"channelSettings":this.prompt=new t.ChannelSettingsPrompt(this._);break;default:this.prompt=new t.TipPrompt(this._,e)}this.prompt&&(this.prompt instanceof t.TipPrompt||(this.yh=this._.synth.playing,this.zh()),this.ph.style.display="",this.ph.appendChild(this.prompt.container))}}changeBarScrollPos(t){this.Gn.changePos(t)}updatePlayButton(){this._.synth.playing?(this.Qn.classList.remove("playButton"),this.Qn.classList.add("pauseButton"),this.Qn.title="Pause (Space)",this.Qn.innerText="Pause"):(this.Qn.classList.remove("pauseButton"),this.Qn.classList.add("playButton"),this.Qn.title="Play (Space)",this.Qn.innerText="Play")}qh(t){let e;if((e=navigator).clipboard&&e.clipboard.writeText)return void e.clipboard.writeText(t).catch(()=>{window.prompt("Copy to clipboard:",t)});const i=document.createElement("textarea");i.innerText=t,document.body.appendChild(i),i.select();const s=document.execCommand("copy");i.remove(),this.Eh(),s||window.prompt("Copy this:",t)}Th(){this._.synth.play(),this.updatePlayButton()}zh(){this._.synth.pause(),this._.autoFollow?this._.synth.snapToBar(this._.bar):this._.synth.snapToBar(),this.updatePlayButton()}hr(){const t=this._.song.channels[this._.channel].instruments[this._.getCurrentInstrument()].toJsonObject();t.isDrum=this._.song.getChannelIsNoise(this._.channel),window.localStorage.setItem("instrumentCopy",JSON.stringify(t))}rr(){const e=this._.song.channels[this._.channel].instruments[this._.getCurrentInstrument()],i=JSON.parse(String(window.localStorage.getItem("instrumentCopy")));null!=i&&i.isDrum==this._.song.getChannelIsNoise(this._.channel)&&this._.record(new t.ChangePasteInstrument(this._,e,i))}ar(){const e=this._.song.getChannelIsNoise(this._.channel);this._.record(new t.ChangePreset(this._,t.pickRandomPresetValue(e)))}lr(){this._.record(new t.ChangeRandomGeneratedInstrument(this._))}Zh(e){if(isNaN(e)){switch(e){case"copyInstrument":this.hr();break;case"pasteInstrument":this.rr();break;case"randomPreset":this.ar();break;case"randomGenerated":this.lr()}this._.notifier.changed()}else this._.record(new t.ChangePreset(this._,parseInt(e)))}}}(beepbox||(beepbox={})),function(t){const e=new t.SongDocument(location.hash),i=new t.SongEditor(e);if(document.getElementById("beepboxEditorContainer").appendChild(i.mainLayer),i.whenUpdated(),i.mainLayer.className+=" load",i.mainLayer.getElementsByClassName("editorBox")[0].className+=" load",i.mainLayer.getElementsByClassName("playback-controls")[0].className+=" load",i.mainLayer.getElementsByClassName("editor-song-settings")[0].className+=" load",i.mainLayer.getElementsByClassName("editor-song-settings")[1].className+=" load",i.mainLayer.getElementsByClassName("editor-instrument-settings")[0].className+=" load",i.mainLayer.getElementsByClassName("trackBar")[0].className+=" load",i.mainLayer.getElementsByClassName("barScrollBar")[0].className+=" load",$("#pitchPresetSelect").select2({dropdownAutoWidth:!0}),$("#drumPresetSelect").select2({dropdownAutoWidth:!0}),$("body").on("click",".select2-container--open .select2-results__group",function(){$(this).siblings().toggle()}),$("#pitchPresetSelect").on("select2:open",function(){$(".select2-dropdown--below").css("opacity",0),$(".select2-dropdown").css("opacity",1),$("#pitchPresetSelect"),setTimeout(()=>{let i=$(".select2-container--open .select2-results__group"),s=$(".select2-container--open .select2-results__option");$.each(i,(i,s)=>{$(s).siblings().hide(),$(s)[0].setAttribute("style","color: "+t.ColorConfig.getChannelColor(e.song,e.channel).noteBright+";")}),$.each(s,(i,s)=>{$(s)[0].setAttribute("style","color: "+t.ColorConfig.getChannelColor(e.song,e.channel).noteBright+";")}),$(".select2-dropdown--below").css("opacity",1)},0)}),$("#drumPresetSelect").on("select2:open",function(){$(".select2-dropdown--below").css("opacity",0),$(".select2-dropdown").css("opacity",1),$("#drumPresetSelect"),setTimeout(()=>{let i=$(".select2-container--open .select2-results__group"),s=$(".select2-container--open .select2-results__option");$.each(i,(i,s)=>{$(s).siblings().hide(),$(s)[0].setAttribute("style","color: "+t.ColorConfig.getChannelColor(e.song,e.channel).noteBright+";")}),$.each(s,(i,s)=>{$(s)[0].setAttribute("style","color: "+t.ColorConfig.getChannelColor(e.song,e.channel).noteBright+";")}),$(".select2-dropdown--below").css("opacity",1)},0)}),$("#pitchPresetSelect").on("change",i.Dh),$("#pitchPresetSelect").on("select2:close",i.Uh),$("#drumPresetSelect").on("change",i.jh),$("#drumPresetSelect").on("select2:close",i.Uh),i.mainLayer.focus(),!t.isMobile&&e.autoPlay){function s(){document.hidden||(e.synth.play(),i.updatePlayButton(),window.removeEventListener("visibilitychange",s))}document.hidden?window.addEventListener("visibilitychange",s):s()}"scrollRestoration"in history&&(history.scrollRestoration="manual"),i.updatePlayButton(),"serviceWorker"in navigator&&navigator.serviceWorker.register("/service_worker.js",{updateViaCache:"all",scope:"/"}).catch(()=>{})}(beepbox||(beepbox={}));
	</script>
</body></html>
